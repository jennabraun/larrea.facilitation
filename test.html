<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Chapter 2 Data and Statistics</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Pollinator Mediated Interactions of Foundation Plants in the Mojave Desert</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown-header">by Jenna L. Braun</li>
<li>
  <a href="index.html">Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Chapter 2 Data and Statistics</h1>

</div>


<div id="overview" class="section level1">
<h1>Overview</h1>
<p>Chapter 2 data wrangling, data visualization and statistics.</p>
</div>
<div id="data-wrangling-and-clean-up" class="section level1">
<h1>Data wrangling and clean up</h1>
<p>This section creates several .csv files that get used later for stats</p>
<div id="video-data-clean-up" class="section level3">
<h3>Video data clean up</h3>
<p>This section takes the raw datas, wrangles it into three formats, adds covariates and outputs the cleaned data as .csv files which re then sourced in later scripts</p>
<pre class="r"><code>#data wrangling for video data

library(dplyr)
library(ggplot2)
library(lubridate)
library(tidyr)

vids &lt;- read.csv(&quot;Clean Data/videos_clean.csv&quot;)
IDlist &lt;- read.csv(&quot;Clean Data/video_repID.csv&quot;)


str(vids)</code></pre>
<pre><code>## &#39;data.frame&#39;:    1313 obs. of  23 variables:
##  $ Recorder            : Factor w/ 6 levels &quot;Brian&quot;,&quot;Jenna&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Rep                 : Factor w/ 13 levels &quot;LO1&quot;,&quot;LO2&quot;,&quot;LO3&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ plant.id            : Factor w/ 61 levels &quot;104&quot;,&quot;114&quot;,&quot;146&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ microsite           : Factor w/ 4 levels &quot;open&quot;,&quot;open &quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ flowering           : Factor w/ 6 levels &quot; Bloom&quot;,&quot; Bloom &quot;,..: 6 6 6 6 6 6 6 6 6 6 ...
##  $ magnet.species      : Factor w/ 2 levels &quot;larrea&quot;,&quot;Larrea&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ phyto.species       : Factor w/ 1 level &quot;malacothrix&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ video.date          : Factor w/ 20 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ video.length        : Factor w/ 201 levels &quot;0:31:34&quot;,&quot;0:32:53&quot;,..: 105 105 105 105 105 105 105 105 105 105 ...
##  $ flower.fov          : int  18 18 18 18 18 18 18 18 18 18 ...
##  $ visitor.descript    : Factor w/ 26 levels &quot;&quot;,&quot;big!&quot;,&quot;can see elytra in flight&quot;,..: 26 26 1 26 26 26 26 26 26 26 ...
##  $ visitor.rtu.original: Factor w/ 118 levels &quot;&quot;,&quot;?&quot;,&quot;?little guy&quot;,..: 96 96 33 96 96 96 96 96 96 96 ...
##  $ highest.rtu         : Factor w/ 105 levels &quot;&quot;,&quot;?&quot;,&quot;ant&quot;,&quot;apis mellifera&quot;,..: 46 46 69 46 46 46 46 46 46 46 ...
##  $ flies.on            : Factor w/ 4 levels &quot;&quot;,&quot;0&quot;,&quot;N&quot;,&quot;Y&quot;: 4 4 4 4 4 4 4 4 4 4 ...
##  $ visitor.behaviour   : Factor w/ 304 levels &quot;&quot;,&quot;*same flower as beetle&quot;,..: 20 262 20 262 20 262 262 262 262 262 ...
##  $ other.description   : Factor w/ 59 levels &quot;&quot;,&quot; &quot;,&quot;1:06:00&quot;,..: 32 1 32 1 31 1 1 1 1 1 ...
##  $ start.time          : Factor w/ 1153 levels &quot;0:00:00&quot;,&quot;0:00:02&quot;,..: 177 302 326 330 342 408 437 456 460 477 ...
##  $ end.time            : Factor w/ 1137 levels &quot;&quot;,&quot;?&quot;,&quot;0:00:07&quot;,..: 157 308 300 374 313 394 417 435 439 447 ...
##  $ total.time          : Factor w/ 388 levels &quot;#VALUE!&quot;,&quot;0:00:00&quot;,..: 3 110 2 226 3 35 10 40 39 16 ...
##  $ flowers.visits      : int  0 1 0 2 0 2 1 1 3 1 ...
##  $ unique.fl.visited   : int  0 1 0 1 0 2 1 1 3 1 ...
##  $ X                   : Factor w/ 164 levels &quot;&quot;,&quot;0:00:05&quot;,&quot;0:00:16&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X.1                 : Factor w/ 8 levels &quot;&quot;,&quot;0:09:29&quot;,&quot;0:10:39&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>vids$Rep &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, vids$Rep)
vids$microsite &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, vids$microsite)
vids$flowering &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, vids$flowering)
vids$flowering &lt;-gsub(&quot;post&quot;, &quot;bloom&quot;, vids$flowering)
vids$flowering &lt;-gsub(&quot;Bloom&quot;, &quot;bloom&quot;, vids$flowering)
vids$microsite &lt;-gsub(&quot;Shrub&quot;, &quot;shrub&quot;, vids$microsite)
#check for correc rep info
vids$id.check &lt;- paste(vids$video.date, vids$plant.id, vids$Rep, vids$microsite, vids$flowering)

id.counts &lt;- count(vids, id.check)
sum(id.counts$n)</code></pre>
<pre><code>## [1] 1313</code></pre>
<pre class="r"><code>#it looks like 30 empty videos

#subset out floral visits only
#vids$flowers.visits &lt;- as.numeric(vids$flowers.visits)
vids$uniID &lt;- paste(vids$Rep, vids$video.date)
vids$uniID &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, vids$uniID)

#subset flower visits where insect flies on
flr &lt;- filter(vids, flowers.visits != 0 &amp; flies.on == &quot;Y&quot;) 
#flr &lt;- filter(vids, flowers.visits != 0) 
summary(flr)</code></pre>
<pre><code>##       Recorder       Rep               plant.id    microsite        
##  Brian    : 49   Length:697         193    : 34   Length:697        
##  Jenna    :527   Class :character   146    : 32   Class :character  
##  shima    :  0   Mode  :character   199    : 30   Mode  :character  
##  Shima    :  8                      268    : 30                     
##  Shobika  : 33                      192    : 26                     
##  Stephanie: 80                      187    : 24                     
##                                     (Other):521                     
##   flowering         magnet.species     phyto.species     video.date 
##  Length:697         larrea:648     malacothrix:697   4.10.2017:105  
##  Class :character   Larrea: 49                       4.13.2017: 86  
##  Mode  :character                                    4.12.2017: 66  
##                                                      4.15.2017: 48  
##                                                      4.16.2017: 48  
##                                                      4.11.2017: 47  
##                                                      (Other)  :297  
##   video.length   flower.fov                     visitor.descript
##  1:20:35: 27   Min.   : 4.000                           :639    
##  1:30:48: 24   1st Qu.: 8.000   yellow faced            : 36    
##  1:01:09: 20   Median : 9.000   big!                    :  2    
##  1:22:51: 20   Mean   : 9.753   metallic                :  2    
##  1:15:05: 17   3rd Qu.:12.000   orange and black pierdae:  2    
##  0:59:46: 15   Max.   :21.000   can see elytra in flight:  1    
##  (Other):574                    (Other)                 : 15    
##  visitor.rtu.original          highest.rtu  flies.on
##  syrphid   :279       syrphid        :247    :  0   
##  small fly?: 64       eupeodes/scaeva: 89   0:  0   
##  syrphid?  : 39       small fly?     : 70   N:  0   
##  fly?      : 37       bombylid       : 41   Y:697   
##  tiny black: 37       bee            : 36           
##  bombylid  : 29       tiny black     : 33           
##  (Other)   :212       (Other)        :181           
##              visitor.behaviour               other.description
##                       :448                            :672    
##  touchdown            : 25     flies on               :  5    
##  pollinate            : 24     disappears out of sight:  2    
##  flies on             : 12     rewatch                :  2    
##  outside of flower    : 10                            :  1    
##  disappears from sight:  9     1:06:00                :  1    
##  (Other)              :169     (Other)                : 14    
##    start.time     end.time     total.time  flowers.visits 
##  0:00:00:  9   0:31:33:  3   0:00:01: 74   Min.   :1.000  
##  0:09:12:  3   0:02:18:  2   0:00:02: 27   1st Qu.:1.000  
##  0:10:20:  3   0:03:48:  2   0:00:04: 17   Median :1.000  
##  0:20:23:  3   0:06:03:  2   0:00:03: 16   Mean   :1.327  
##  0:01:46:  2   0:06:49:  2   0:00:14: 15   3rd Qu.:1.000  
##  0:03:13:  2   0:07:51:  2   0:00:06: 14   Max.   :7.000  
##  (Other):675   (Other):684   (Other):534                  
##  unique.fl.visited       X            X.1        id.check        
##  Min.   :1.000            :604          :696   Length:697        
##  1st Qu.:1.000     1:06:00:  9   0:09:29:  1   Class :character  
##  Median :1.000     1:06:01:  3   0:10:39:  0   Mode  :character  
##  Mean   :1.281     0:07:09:  2   0:12   :  0                     
##  3rd Qu.:1.000     0:00:05:  1   0:18:58:  0                     
##  Max.   :5.000     0:00:55:  1   1:02:05:  0                     
##                    (Other): 77   (Other):  0                     
##     uniID          
##  Length:697        
##  Class :character  
##  Mode  :character  
##                    
##                    
##                    
## </code></pre>
<pre class="r"><code>str(flr)</code></pre>
<pre><code>## &#39;data.frame&#39;:    697 obs. of  25 variables:
##  $ Recorder            : Factor w/ 6 levels &quot;Brian&quot;,&quot;Jenna&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Rep                 : chr  &quot;LO1&quot; &quot;LO1&quot; &quot;LO1&quot; &quot;LO1&quot; ...
##  $ plant.id            : Factor w/ 61 levels &quot;104&quot;,&quot;114&quot;,&quot;146&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ microsite           : chr  &quot;open&quot; &quot;open&quot; &quot;open&quot; &quot;open&quot; ...
##  $ flowering           : chr  &quot;pre&quot; &quot;pre&quot; &quot;pre&quot; &quot;pre&quot; ...
##  $ magnet.species      : Factor w/ 2 levels &quot;larrea&quot;,&quot;Larrea&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ phyto.species       : Factor w/ 1 level &quot;malacothrix&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ video.date          : Factor w/ 20 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ video.length        : Factor w/ 201 levels &quot;0:31:34&quot;,&quot;0:32:53&quot;,..: 105 105 105 105 105 105 105 105 105 105 ...
##  $ flower.fov          : int  18 18 18 18 18 18 18 18 18 18 ...
##  $ visitor.descript    : Factor w/ 26 levels &quot;&quot;,&quot;big!&quot;,&quot;can see elytra in flight&quot;,..: 26 26 26 26 26 26 26 26 26 26 ...
##  $ visitor.rtu.original: Factor w/ 118 levels &quot;&quot;,&quot;?&quot;,&quot;?little guy&quot;,..: 96 96 96 96 96 96 96 96 96 96 ...
##  $ highest.rtu         : Factor w/ 105 levels &quot;&quot;,&quot;?&quot;,&quot;ant&quot;,&quot;apis mellifera&quot;,..: 46 46 46 46 46 46 46 46 46 46 ...
##  $ flies.on            : Factor w/ 4 levels &quot;&quot;,&quot;0&quot;,&quot;N&quot;,&quot;Y&quot;: 4 4 4 4 4 4 4 4 4 4 ...
##  $ visitor.behaviour   : Factor w/ 304 levels &quot;&quot;,&quot;*same flower as beetle&quot;,..: 262 262 262 262 262 262 262 262 262 262 ...
##  $ other.description   : Factor w/ 59 levels &quot;&quot;,&quot; &quot;,&quot;1:06:00&quot;,..: 1 1 1 1 1 1 1 1 21 1 ...
##  $ start.time          : Factor w/ 1153 levels &quot;0:00:00&quot;,&quot;0:00:02&quot;,..: 302 330 408 437 456 460 477 482 501 517 ...
##  $ end.time            : Factor w/ 1137 levels &quot;&quot;,&quot;?&quot;,&quot;0:00:07&quot;,..: 308 374 394 417 435 439 447 481 465 482 ...
##  $ total.time          : Factor w/ 388 levels &quot;#VALUE!&quot;,&quot;0:00:00&quot;,..: 110 226 35 10 40 39 16 138 10 16 ...
##  $ flowers.visits      : int  1 2 2 1 1 3 1 3 1 1 ...
##  $ unique.fl.visited   : int  1 1 2 1 1 3 1 3 1 1 ...
##  $ X                   : Factor w/ 164 levels &quot;&quot;,&quot;0:00:05&quot;,&quot;0:00:16&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X.1                 : Factor w/ 8 levels &quot;&quot;,&quot;0:09:29&quot;,&quot;0:10:39&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ id.check            : chr  &quot;4.10.2017 146 LO1 open pre&quot; &quot;4.10.2017 146 LO1 open pre&quot; &quot;4.10.2017 146 LO1 open pre&quot; &quot;4.10.2017 146 LO1 open pre&quot; ...
##  $ uniID               : chr  &quot;LO14.10.2017&quot; &quot;LO14.10.2017&quot; &quot;LO14.10.2017&quot; &quot;LO14.10.2017&quot; ...</code></pre>
<pre class="r"><code>#flr$unique.fl.visited &lt;- as.numeric(flr$unique.fl.visited)
flr$pos.total.time &lt;- as.POSIXct(strptime(flr$total.time, &quot;%H:%M:%S&quot;))
flr$dec.total.time &lt;- (hour(flr$pos.total.time) * 3600 + minute(flr$pos.total.time) * 60 + second(flr$pos.total.time)) / 3600
flr &lt;- mutate(flr, prop.fl.visited = flowers.visits/flower.fov, prop.un.fl.visited = unique.fl.visited/flower.fov)

counts &lt;- count(flr, uniID)
sum(counts$n)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#count(flr, Rep)
#count(flr, uniID)
#make fill ID list
IDlist$uniID &lt;- paste(IDlist$Rep, IDlist$Day)
IDlist$uniID &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, IDlist$uniID)

#exclude certain reps
IDlist &lt;- filter(IDlist, Exclude != &quot;Y&quot;)

#count visits per rep
counts &lt;- flr %&gt;% group_by(uniID) %&gt;% summarise(total.visits = n()) 
sum(counts$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#count the total number of flowers visited per video
count.fl &lt;- flr %&gt;% group_by(uniID) %&gt;% summarise(total.flowers = sum(flowers.visits)) 

sum(count.fl$total.flowers)</code></pre>
<pre><code>## [1] 925</code></pre>
<pre class="r"><code>#add reps with zero visits

zeros &lt;- anti_join(IDlist, counts, by = &quot;uniID&quot;)
all.data &lt;- bind_rows(zeros, counts)
all.data &lt;- dplyr::select(all.data, uniID, total.visits)



#replace NAs with zeros
all.data$total.visits[is.na(all.data$total.visits)] &lt;- 0
sum(all.data$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#join video length
all.data &lt;- IDlist %&gt;% dplyr::select(Length, uniID) %&gt;% right_join(all.data,., by = &quot;uniID&quot;)

#join covariates
cov &lt;- read.csv(&quot;Clean Data/video_cov.csv&quot;)
str(cov)</code></pre>
<pre><code>## &#39;data.frame&#39;:    360 obs. of  14 variables:
##  $ PlantID                       : Factor w/ 121 levels &quot;104&quot;,&quot;114&quot;,&quot;146&quot;,..: 24 24 25 25 37 37 38 38 61 61 ...
##  $ SecondaryID                   : Factor w/ 2 levels &quot;&quot;,&quot;na&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Cam                           : Factor w/ 24 levels &quot;BO1&quot;,&quot;BO2&quot;,&quot;BO3&quot;,..: 7 1 8 2 9 3 10 4 11 5 ...
##  $ treatment                     : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ flowering                     : Factor w/ 2 levels &quot;bloom&quot;,&quot;pre&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Date                          : Factor w/ 20 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ TimeOut                       : Factor w/ 123 levels &quot;&quot;,&quot;10:48&quot;,&quot;10:57&quot;,..: 53 53 54 54 56 56 55 55 58 58 ...
##  $ flowers.shrub                 : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ flowers.pot                   : Factor w/ 16 levels &quot;10&quot;,&quot;11&quot;,&quot;12&quot;,..: 16 16 16 16 16 16 5 2 7 6 ...
##  $ het.shrub.blooming.neighbours : int  0 0 1 1 5 6 6 5 3 3 ...
##  $ het.cactus.blooming.neighbours: int  0 0 0 0 0 0 0 0 0 0 ...
##  $ understory.richness           : int  5 4 5 2 3 3 5 3 5 3 ...
##  $ het.annual.floral.density     : int  10 16 29 19 8 18 8 15 4 0 ...
##  $ understory.assoc              : Factor w/ 21 levels &quot;&quot;,&quot;?&quot;,&quot;acamp&quot;,..: 11 13 8 13 2 2 18 13 19 13 ...</code></pre>
<pre class="r"><code>cov$uniID &lt;- paste(cov$Cam, cov$Date)
cov$uniID &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, cov$uniID)
all.data &lt;- right_join(cov, all.data, by = &quot;uniID&quot;)
sum(all.data$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#convert to decimal time to standardize visits
all.data$pos.Length &lt;- as.POSIXct(strptime(all.data$Length, &quot;%H:%M:%S&quot;))
all.data$dec.Length &lt;- (hour(all.data$pos.Length) * 3600 + minute(all.data$pos.Length) * 60 + second(all.data$pos.Length)) / 3600


#plant visits per hour
all.data &lt;- mutate(all.data, visits.per.hour = total.visits/dec.Length)
sum(all.data$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#number of flowers visited per hour
all.data &lt;- left_join(all.data, count.fl, by = &quot;uniID&quot;)
all.data$total.flowers[is.na(all.data$total.flowers)] &lt;- 0
all.data &lt;- mutate(all.data, flowers.per.hour = total.flowers/dec.Length)
sum(all.data$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#add weather data
weather &lt;- read.csv(&quot;Clean Data/video_weather.csv&quot;)
weather.av &lt;- weather %&gt;% group_by(., Date) %&gt;% summarise(., mean.Solar = mean(Solar), mean.Wind = mean(Wind), mean.MaxWind = mean(Max), mean.Temp = mean(Air.Temperature))
all.data &lt;- right_join(weather.av, all.data, by = &quot;Date&quot;)
sum(all.data$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#want to test out standardizing by visits/flower/hr
#fov &lt;- select(flr, uniID, flower.fov)
#fov &lt;- distinct(fov)
#fov &lt;- fov[-c(191,187),] #get rid of weird bit
#all.data &lt;- right_join(fov, all.data, by = &quot;uniID&quot;)

#calculate per flower/per hour

#all.data &lt;- mutate(all.data, visits.flower.hr = total.visits/flower.fov/dec.Length)
#all.data &lt;- mutate(all.data, flowers.flower.hr = total.flowers/flower.fov/dec.Length)

#replace NA with zeros
#all.data$visits.flower.hr[is.na(all.data$visits.flower.hr)] &lt;- 0
#all.data$flowers.flower.hr[is.na(all.data$flowers.flower.hr)] &lt;- 0


write.csv(all.data, &quot;byrep_cleaned.csv&quot;)
#write.csv(all.data, &quot;byrep_cleaned_all.csv&quot;)
write.csv(flr, &quot;byobs_cleaned.csv&quot;)


#I also want a dataframe grouped by rtu: Bees, syrphids, bombyliids, leps and others.

rtu.key &lt;- read.csv(&quot;Clean Data/video_rtu_key.csv&quot;)
rtu.data &lt;- left_join(rtu.key, flr, by = &quot;highest.rtu&quot;)</code></pre>
<pre><code>## Warning: Column `highest.rtu` joining factors with different levels,
## coercing to character vector</code></pre>
<pre class="r"><code>rtu.data &lt;- dplyr::select(rtu.data, rtu.ag, plant.id, microsite, flowering, video.date, video.length, flower.fov, total.time, flowers.visits, unique.fl.visited, uniID)                    
count.rtu.fl &lt;- rtu.data %&gt;% group_by(uniID, rtu.ag) %&gt;% summarise(total.flowers = sum(flowers.visits), total.visits = n()) 

#add zero rows
#zeros.rtu &lt;- anti_join(IDlist, count.rtu.fl, by = &quot;uniID&quot;)
#all.rtu.data &lt;- bind_rows(zeros.rtu, count.rtu.fl)
#all.rtu.data &lt;- dplyr::select(all.rtu.data, uniID, rtu.ag, total.visits, total.flowers)

#need to add the zero count rtu somehow. gonna be messy lol
#maybe if we spread, then fill in zeros, then gather back?
all.rtu.data &lt;- count.rtu.fl
id &lt;- as.data.frame(IDlist$uniID)
id$uniID &lt;- id$`IDlist$uniID`
id &lt;- dplyr::select(id, uniID)
id$syrphid &lt;- 1
id$bee &lt;- 2
id$other &lt;- 3
id$bombylid &lt;- 4
id$lep &lt;- 5
id$honeybee &lt;- 6
id &lt;- gather(id, &quot;rtu&quot;, &quot;count&quot;, 2:7)
count(id, rtu)</code></pre>
<pre><code>## # A tibble: 6 x 2
##   rtu          n
##   &lt;chr&gt;    &lt;int&gt;
## 1 bee        235
## 2 bombylid   235
## 3 honeybee   235
## 4 lep        235
## 5 other      235
## 6 syrphid    235</code></pre>
<pre class="r"><code>id$join &lt;- paste(id$uniID, id$rtu)
id$test &lt;- 1
all.rtu.data$join &lt;- paste(all.rtu.data$uniID, all.rtu.data$rtu.ag)

test &lt;- dplyr::full_join(id, all.rtu.data, by = &quot;join&quot;)

all.rtu &lt;- dplyr::select(test, uniID.x, rtu, total.visits, total.flowers)
all.rtu$total.visits[is.na(all.rtu$total.visits)] &lt;- 0
all.rtu$total.flowers[is.na(all.rtu$total.flowers)] &lt;- 0

all.rtu &lt;- dplyr::rename(all.rtu, uniID = uniID.x)
#join video length
all.rtu &lt;- IDlist %&gt;% dplyr::select(Length, uniID) %&gt;% right_join(all.rtu,., by = &quot;uniID&quot;)</code></pre>
<pre><code>## Warning: Column `uniID` joining factor and character vector, coercing into
## character vector</code></pre>
<pre class="r"><code>#join covariates

all.rtu &lt;- right_join(cov, all.rtu, by = &quot;uniID&quot;)


#convert to decimal time to standardize visits
all.rtu$pos.Length &lt;- as.POSIXct(strptime(all.rtu$Length, &quot;%H:%M:%S&quot;))
all.rtu$dec.Length &lt;- (hour(all.rtu$pos.Length) * 3600 + minute(all.rtu$pos.Length) * 60 + second(all.rtu$pos.Length)) / 3600

#plant visits per hour
all.rtu &lt;- mutate(all.rtu, visits.per.hour = total.visits/dec.Length)
all.rtu &lt;- mutate(all.rtu, flowers.per.hour = total.flowers/dec.Length)

all.rtu &lt;- dplyr::select(all.rtu, -SecondaryID, -Cam)

write.csv(all.rtu, &quot;rtu_by_rep.csv&quot;)</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
