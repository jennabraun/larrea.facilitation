<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Pollinator Mediated Interactions of Foundation Plants in the Mojave Desert</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown-header">by Jenna L. Braun</li>
<li>
  <a href="index.html">Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="disentangling-the-drivers-and-trade-offs-of-pollinator-mediated-interactions-between-the-foundation-shrub-creosote-bush-larrea-tridentata-and-the-annual-desert-dandelion-malacothrix-glabrata" class="section level1">
<h1>Disentangling the drivers and trade-offs of pollinator-mediated interactions between the foundation shrub Creosote bush (Larrea tridentata) and the annual desert dandelion (Malacothrix glabrata)</h1>

<hr />

<div id="overview" class="section level2">
<h2>Overview</h2>
<p>In arid ecosystems shrub facilitation is a critical process driving plant community structure and assembly, which leads to concentrations of annuals beneath the shrub canopies. Pollinator-mediated interactions have fitness consequences for their participants but are a largely unexplored indirect consequence of shrub-annual facilitation. We tested the capacity of the geographically widespread Creosote bush Larrea tridentata to influence the pollination of its annual understory during its phenological shift into spring flowering. In this system, we found that L. tridentata had a positive ecological effect on annual plant cover, as well as the abundance and richness of the arthropod community but that it also had indirect negative effects on pollinator visitation to a representative flowering annual plant which intensified when L. tridentata bloomed. These finding suggest that the net outcome of association with foundation plant species can be positive or negative depending on both the life-history stage of the protégé species tested and on the phenology of the foundation species. There is the capacity for these trade-offs to be widespread and an increasing focus on further documenting these trade-offs will advance both facilitation theory and assessment of selection processes that can drive co-evolutionary relationships between shrubs, annual plants, and pollinators.</p>

<hr />

<p><img src="Images/site.jpg" width="1000" /></p>
</div>
</div>
<div id="data-wrangling-and-clean-up" class="section level1">
<h1>Data wrangling and clean up</h1>
<p>This section creates several .csv files that get used later for stats</p>
<div id="video-data-clean-up" class="section level3">
<h3>Video data clean up</h3>
<p>This section takes the raw datas, wrangles it into three formats, adds covariates and outputs the cleaned data as .csv files which re then sourced in later scripts</p>
<pre class="r"><code>#data wrangling for video data

#import datasheets
vids &lt;- read.csv(&quot;Clean Data/videos_clean.csv&quot;)
IDlist &lt;- read.csv(&quot;Clean Data/video_repID.csv&quot;)
str(vids)</code></pre>
<pre><code>## &#39;data.frame&#39;:    1313 obs. of  23 variables:
##  $ Recorder            : Factor w/ 6 levels &quot;Brian&quot;,&quot;Jenna&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Rep                 : Factor w/ 13 levels &quot;LO1&quot;,&quot;LO2&quot;,&quot;LO3&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ plant.id            : Factor w/ 61 levels &quot;104&quot;,&quot;114&quot;,&quot;146&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ microsite           : Factor w/ 4 levels &quot;open&quot;,&quot;open &quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ flowering           : Factor w/ 6 levels &quot; Bloom&quot;,&quot; Bloom &quot;,..: 6 6 6 6 6 6 6 6 6 6 ...
##  $ magnet.species      : Factor w/ 2 levels &quot;larrea&quot;,&quot;Larrea&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ phyto.species       : Factor w/ 1 level &quot;malacothrix&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ video.date          : Factor w/ 20 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ video.length        : Factor w/ 201 levels &quot;0:31:34&quot;,&quot;0:32:53&quot;,..: 105 105 105 105 105 105 105 105 105 105 ...
##  $ flower.fov          : int  18 18 18 18 18 18 18 18 18 18 ...
##  $ visitor.descript    : Factor w/ 26 levels &quot;&quot;,&quot;big!&quot;,&quot;can see elytra in flight&quot;,..: 26 26 1 26 26 26 26 26 26 26 ...
##  $ visitor.rtu.original: Factor w/ 118 levels &quot;&quot;,&quot;?&quot;,&quot;?little guy&quot;,..: 96 96 33 96 96 96 96 96 96 96 ...
##  $ highest.rtu         : Factor w/ 105 levels &quot;&quot;,&quot;?&quot;,&quot;ant&quot;,&quot;apis mellifera&quot;,..: 46 46 69 46 46 46 46 46 46 46 ...
##  $ flies.on            : Factor w/ 4 levels &quot;&quot;,&quot;0&quot;,&quot;N&quot;,&quot;Y&quot;: 4 4 4 4 4 4 4 4 4 4 ...
##  $ visitor.behaviour   : Factor w/ 304 levels &quot;&quot;,&quot;*same flower as beetle&quot;,..: 20 262 20 262 20 262 262 262 262 262 ...
##  $ other.description   : Factor w/ 59 levels &quot;&quot;,&quot; &quot;,&quot;1:06:00&quot;,..: 32 1 32 1 31 1 1 1 1 1 ...
##  $ start.time          : Factor w/ 1153 levels &quot;0:00:00&quot;,&quot;0:00:02&quot;,..: 177 302 326 330 342 408 437 456 460 477 ...
##  $ end.time            : Factor w/ 1137 levels &quot;&quot;,&quot;?&quot;,&quot;0:00:07&quot;,..: 157 308 300 374 313 394 417 435 439 447 ...
##  $ total.time          : Factor w/ 388 levels &quot;#VALUE!&quot;,&quot;0:00:00&quot;,..: 3 110 2 226 3 35 10 40 39 16 ...
##  $ flowers.visits      : int  0 1 0 2 0 2 1 1 3 1 ...
##  $ unique.fl.visited   : int  0 1 0 1 0 2 1 1 3 1 ...
##  $ X                   : Factor w/ 164 levels &quot;&quot;,&quot;0:00:05&quot;,&quot;0:00:16&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X.1                 : Factor w/ 8 levels &quot;&quot;,&quot;0:09:29&quot;,&quot;0:10:39&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>#clean up factor names
vids$Rep &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, vids$Rep)
vids$microsite &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, vids$microsite)
vids$flowering &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, vids$flowering)
vids$flowering &lt;-gsub(&quot;post&quot;, &quot;bloom&quot;, vids$flowering)
vids$flowering &lt;-gsub(&quot;Bloom&quot;, &quot;bloom&quot;, vids$flowering)
vids$microsite &lt;-gsub(&quot;Shrub&quot;, &quot;shrub&quot;, vids$microsite)

#check for correc rep info
vids$id.check &lt;- paste(vids$video.date, vids$plant.id, vids$Rep, vids$microsite, vids$flowering)


#need to know how many videos are empty
id.counts &lt;- count(vids, id.check)
sum(id.counts$n)</code></pre>
<pre><code>## [1] 1313</code></pre>
<pre class="r"><code>#subset out floral visits only ie instances where an insect touched a flower. Other insect uses were extracted from videos but not included in analyses

vids$uniID &lt;- paste(vids$Rep, vids$video.date)
vids$uniID &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, vids$uniID)

#subset flower visits where insect flies on
flr &lt;- filter(vids, flowers.visits != 0 &amp; flies.on == &quot;Y&quot;) </code></pre>
<pre><code>## Warning: package &#39;bindrcpp&#39; was built under R version 3.4.4</code></pre>
<pre class="r"><code>summary(flr)</code></pre>
<pre><code>##       Recorder       Rep               plant.id    microsite        
##  Brian    : 49   Length:697         193    : 34   Length:697        
##  Jenna    :527   Class :character   146    : 32   Class :character  
##  shima    :  0   Mode  :character   199    : 30   Mode  :character  
##  Shima    :  8                      268    : 30                     
##  Shobika  : 33                      192    : 26                     
##  Stephanie: 80                      187    : 24                     
##                                     (Other):521                     
##   flowering         magnet.species     phyto.species     video.date 
##  Length:697         larrea:648     malacothrix:697   4.10.2017:105  
##  Class :character   Larrea: 49                       4.13.2017: 86  
##  Mode  :character                                    4.12.2017: 66  
##                                                      4.15.2017: 48  
##                                                      4.16.2017: 48  
##                                                      4.11.2017: 47  
##                                                      (Other)  :297  
##   video.length   flower.fov                     visitor.descript
##  1:20:35: 27   Min.   : 4.000                           :639    
##  1:30:48: 24   1st Qu.: 8.000   yellow faced            : 36    
##  1:01:09: 20   Median : 9.000   big!                    :  2    
##  1:22:51: 20   Mean   : 9.753   metallic                :  2    
##  1:15:05: 17   3rd Qu.:12.000   orange and black pierdae:  2    
##  0:59:46: 15   Max.   :21.000   can see elytra in flight:  1    
##  (Other):574                    (Other)                 : 15    
##  visitor.rtu.original          highest.rtu  flies.on
##  syrphid   :279       syrphid        :247    :  0   
##  small fly?: 64       eupeodes/scaeva: 89   0:  0   
##  syrphid?  : 39       small fly?     : 70   N:  0   
##  fly?      : 37       bombylid       : 41   Y:697   
##  tiny black: 37       bee            : 36           
##  bombylid  : 29       tiny black     : 33           
##  (Other)   :212       (Other)        :181           
##              visitor.behaviour               other.description
##                       :448                            :672    
##  touchdown            : 25     flies on               :  5    
##  pollinate            : 24     disappears out of sight:  2    
##  flies on             : 12     rewatch                :  2    
##  outside of flower    : 10                            :  1    
##  disappears from sight:  9     1:06:00                :  1    
##  (Other)              :169     (Other)                : 14    
##    start.time     end.time     total.time  flowers.visits 
##  0:00:00:  9   0:31:33:  3   0:00:01: 74   Min.   :1.000  
##  0:09:12:  3   0:02:18:  2   0:00:02: 27   1st Qu.:1.000  
##  0:10:20:  3   0:03:48:  2   0:00:04: 17   Median :1.000  
##  0:20:23:  3   0:06:03:  2   0:00:03: 16   Mean   :1.327  
##  0:01:46:  2   0:06:49:  2   0:00:14: 15   3rd Qu.:1.000  
##  0:03:13:  2   0:07:51:  2   0:00:06: 14   Max.   :7.000  
##  (Other):675   (Other):684   (Other):534                  
##  unique.fl.visited       X            X.1        id.check        
##  Min.   :1.000            :604          :696   Length:697        
##  1st Qu.:1.000     1:06:00:  9   0:09:29:  1   Class :character  
##  Median :1.000     1:06:01:  3   0:10:39:  0   Mode  :character  
##  Mean   :1.281     0:07:09:  2   0:12   :  0                     
##  3rd Qu.:1.000     0:00:05:  1   0:18:58:  0                     
##  Max.   :5.000     0:00:55:  1   1:02:05:  0                     
##                    (Other): 77   (Other):  0                     
##     uniID          
##  Length:697        
##  Class :character  
##  Mode  :character  
##                    
##                    
##                    
## </code></pre>
<pre class="r"><code>str(flr)</code></pre>
<pre><code>## &#39;data.frame&#39;:    697 obs. of  25 variables:
##  $ Recorder            : Factor w/ 6 levels &quot;Brian&quot;,&quot;Jenna&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Rep                 : chr  &quot;LO1&quot; &quot;LO1&quot; &quot;LO1&quot; &quot;LO1&quot; ...
##  $ plant.id            : Factor w/ 61 levels &quot;104&quot;,&quot;114&quot;,&quot;146&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ microsite           : chr  &quot;open&quot; &quot;open&quot; &quot;open&quot; &quot;open&quot; ...
##  $ flowering           : chr  &quot;pre&quot; &quot;pre&quot; &quot;pre&quot; &quot;pre&quot; ...
##  $ magnet.species      : Factor w/ 2 levels &quot;larrea&quot;,&quot;Larrea&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ phyto.species       : Factor w/ 1 level &quot;malacothrix&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ video.date          : Factor w/ 20 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ video.length        : Factor w/ 201 levels &quot;0:31:34&quot;,&quot;0:32:53&quot;,..: 105 105 105 105 105 105 105 105 105 105 ...
##  $ flower.fov          : int  18 18 18 18 18 18 18 18 18 18 ...
##  $ visitor.descript    : Factor w/ 26 levels &quot;&quot;,&quot;big!&quot;,&quot;can see elytra in flight&quot;,..: 26 26 26 26 26 26 26 26 26 26 ...
##  $ visitor.rtu.original: Factor w/ 118 levels &quot;&quot;,&quot;?&quot;,&quot;?little guy&quot;,..: 96 96 96 96 96 96 96 96 96 96 ...
##  $ highest.rtu         : Factor w/ 105 levels &quot;&quot;,&quot;?&quot;,&quot;ant&quot;,&quot;apis mellifera&quot;,..: 46 46 46 46 46 46 46 46 46 46 ...
##  $ flies.on            : Factor w/ 4 levels &quot;&quot;,&quot;0&quot;,&quot;N&quot;,&quot;Y&quot;: 4 4 4 4 4 4 4 4 4 4 ...
##  $ visitor.behaviour   : Factor w/ 304 levels &quot;&quot;,&quot;*same flower as beetle&quot;,..: 262 262 262 262 262 262 262 262 262 262 ...
##  $ other.description   : Factor w/ 59 levels &quot;&quot;,&quot; &quot;,&quot;1:06:00&quot;,..: 1 1 1 1 1 1 1 1 21 1 ...
##  $ start.time          : Factor w/ 1153 levels &quot;0:00:00&quot;,&quot;0:00:02&quot;,..: 302 330 408 437 456 460 477 482 501 517 ...
##  $ end.time            : Factor w/ 1137 levels &quot;&quot;,&quot;?&quot;,&quot;0:00:07&quot;,..: 308 374 394 417 435 439 447 481 465 482 ...
##  $ total.time          : Factor w/ 388 levels &quot;#VALUE!&quot;,&quot;0:00:00&quot;,..: 110 226 35 10 40 39 16 138 10 16 ...
##  $ flowers.visits      : int  1 2 2 1 1 3 1 3 1 1 ...
##  $ unique.fl.visited   : int  1 1 2 1 1 3 1 3 1 1 ...
##  $ X                   : Factor w/ 164 levels &quot;&quot;,&quot;0:00:05&quot;,&quot;0:00:16&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X.1                 : Factor w/ 8 levels &quot;&quot;,&quot;0:09:29&quot;,&quot;0:10:39&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ id.check            : chr  &quot;4.10.2017 146 LO1 open pre&quot; &quot;4.10.2017 146 LO1 open pre&quot; &quot;4.10.2017 146 LO1 open pre&quot; &quot;4.10.2017 146 LO1 open pre&quot; ...
##  $ uniID               : chr  &quot;LO14.10.2017&quot; &quot;LO14.10.2017&quot; &quot;LO14.10.2017&quot; &quot;LO14.10.2017&quot; ...</code></pre>
<pre class="r"><code>#convert time to seconds then decimal time
flr$pos.total.time &lt;- as.POSIXct(strptime(flr$total.time, &quot;%H:%M:%S&quot;))
flr$dec.total.time &lt;- (hour(flr$pos.total.time) * 3600 + minute(flr$pos.total.time) * 60 + second(flr$pos.total.time)) / 3600
flr &lt;- mutate(flr, prop.fl.visited = flowers.visits/flower.fov, prop.un.fl.visited = unique.fl.visited/flower.fov)

counts &lt;- count(flr, uniID)
sum(counts$n)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#count(flr, Rep)
#count(flr, uniID)
#make fill ID list
IDlist$uniID &lt;- paste(IDlist$Rep, IDlist$Day)
IDlist$uniID &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, IDlist$uniID)

#exclude certain reps. The excluded reps are those where the battery ran out or some disturbance occurred
IDlist &lt;- filter(IDlist, Exclude != &quot;Y&quot;)

#count visits per rep
counts &lt;- flr %&gt;% group_by(uniID) %&gt;% summarise(total.visits = n()) 
sum(counts$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#count the total number of flowers visited per video
count.fl &lt;- flr %&gt;% group_by(uniID) %&gt;% summarise(total.flowers = sum(flowers.visits)) 

sum(count.fl$total.flowers)</code></pre>
<pre><code>## [1] 925</code></pre>
<pre class="r"><code>#add reps with zero visits. Need to included videos that received no visits

zeros &lt;- anti_join(IDlist, counts, by = &quot;uniID&quot;)
all.data &lt;- bind_rows(zeros, counts)
all.data &lt;- dplyr::select(all.data, uniID, total.visits)

#replace NAs with zeros
all.data$total.visits[is.na(all.data$total.visits)] &lt;- 0
sum(all.data$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#join video length
all.data &lt;- IDlist %&gt;% dplyr::select(Length, uniID) %&gt;% right_join(all.data,., by = &quot;uniID&quot;)

#join covariates
cov &lt;- read.csv(&quot;Clean Data/video_cov.csv&quot;)
str(cov)</code></pre>
<pre><code>## &#39;data.frame&#39;:    360 obs. of  14 variables:
##  $ PlantID                       : Factor w/ 121 levels &quot;104&quot;,&quot;114&quot;,&quot;146&quot;,..: 24 24 25 25 37 37 38 38 61 61 ...
##  $ SecondaryID                   : Factor w/ 2 levels &quot;&quot;,&quot;na&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Cam                           : Factor w/ 24 levels &quot;BO1&quot;,&quot;BO2&quot;,&quot;BO3&quot;,..: 7 1 8 2 9 3 10 4 11 5 ...
##  $ treatment                     : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ flowering                     : Factor w/ 2 levels &quot;bloom&quot;,&quot;pre&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Date                          : Factor w/ 20 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ TimeOut                       : Factor w/ 123 levels &quot;&quot;,&quot;10:48&quot;,&quot;10:57&quot;,..: 53 53 54 54 56 56 55 55 58 58 ...
##  $ flowers.shrub                 : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ flowers.pot                   : Factor w/ 16 levels &quot;10&quot;,&quot;11&quot;,&quot;12&quot;,..: 16 16 16 16 16 16 5 2 7 6 ...
##  $ het.shrub.blooming.neighbours : int  0 0 1 1 5 6 6 5 3 3 ...
##  $ het.cactus.blooming.neighbours: int  0 0 0 0 0 0 0 0 0 0 ...
##  $ understory.richness           : int  5 4 5 2 3 3 5 3 5 3 ...
##  $ het.annual.floral.density     : int  10 16 29 19 8 18 8 15 4 0 ...
##  $ understory.assoc              : Factor w/ 21 levels &quot;&quot;,&quot;?&quot;,&quot;acamp&quot;,..: 11 13 8 13 2 2 18 13 19 13 ...</code></pre>
<pre class="r"><code>cov$uniID &lt;- paste(cov$Cam, cov$Date)
cov$uniID &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, cov$uniID)
all.data &lt;- right_join(cov, all.data, by = &quot;uniID&quot;)
sum(all.data$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#convert to decimal time to standardize visits
all.data$pos.Length &lt;- as.POSIXct(strptime(all.data$Length, &quot;%H:%M:%S&quot;))
all.data$dec.Length &lt;- (hour(all.data$pos.Length) * 3600 + minute(all.data$pos.Length) * 60 + second(all.data$pos.Length)) / 3600


#plant visits per hour
all.data &lt;- mutate(all.data, visits.per.hour = total.visits/dec.Length)
sum(all.data$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#number of flowers visited per hour
all.data &lt;- left_join(all.data, count.fl, by = &quot;uniID&quot;)
all.data$total.flowers[is.na(all.data$total.flowers)] &lt;- 0
all.data &lt;- mutate(all.data, flowers.per.hour = total.flowers/dec.Length)
sum(all.data$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#add weather data
weather &lt;- read.csv(&quot;Clean Data/video_weather.csv&quot;)
weather.av &lt;- weather %&gt;% group_by(., Date) %&gt;% summarise(., mean.Solar = mean(Solar), mean.Wind = mean(Wind), mean.MaxWind = mean(Max), mean.Temp = mean(Air.Temperature))
all.data &lt;- right_join(weather.av, all.data, by = &quot;Date&quot;)
sum(all.data$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#data aggregrated to replicate
write.csv(all.data, &quot;Output Data/byrep_cleaned.csv&quot;)
#data left as individual observations
write.csv(flr, &quot;Output Data/byobs_cleaned.csv&quot;)


#I also want a dataframe grouped by rtu: Bees, syrphids, bombyliids, leps and others.

#rtu.key is a table to classify the different rtu in datafile into categories

rtu.key &lt;- read.csv(&quot;Clean Data/video_rtu_key.csv&quot;)
rtu.data &lt;- left_join(rtu.key, flr, by = &quot;highest.rtu&quot;)</code></pre>
<pre><code>## Warning: Column `highest.rtu` joining factors with different levels,
## coercing to character vector</code></pre>
<pre class="r"><code>rtu.data &lt;- dplyr::select(rtu.data, rtu.ag, plant.id, microsite, flowering, video.date, video.length, flower.fov, total.time, flowers.visits, unique.fl.visited, uniID)                    
count.rtu.fl &lt;- rtu.data %&gt;% group_by(uniID, rtu.ag) %&gt;% summarise(total.flowers = sum(flowers.visits), total.visits = n()) 

#add zero rows
#zeros.rtu &lt;- anti_join(IDlist, count.rtu.fl, by = &quot;uniID&quot;)
#all.rtu.data &lt;- bind_rows(zeros.rtu, count.rtu.fl)
#all.rtu.data &lt;- dplyr::select(all.rtu.data, uniID, rtu.ag, total.visits, total.flowers)

#need to add the zero count rtu.
#spread, fill in zeros, then gather back
all.rtu.data &lt;- count.rtu.fl
id &lt;- as.data.frame(IDlist$uniID)
id$uniID &lt;- id$`IDlist$uniID`
id &lt;- dplyr::select(id, uniID)
id$syrphid &lt;- 1
id$bee &lt;- 2
id$other &lt;- 3
id$bombylid &lt;- 4
id$lep &lt;- 5
id$honeybee &lt;- 6
id &lt;- gather(id, &quot;rtu&quot;, &quot;count&quot;, 2:7)
count(id, rtu)</code></pre>
<pre><code>## # A tibble: 6 x 2
##   rtu          n
##   &lt;chr&gt;    &lt;int&gt;
## 1 bee        235
## 2 bombylid   235
## 3 honeybee   235
## 4 lep        235
## 5 other      235
## 6 syrphid    235</code></pre>
<pre class="r"><code>id$join &lt;- paste(id$uniID, id$rtu)
id$test &lt;- 1
all.rtu.data$join &lt;- paste(all.rtu.data$uniID, all.rtu.data$rtu.ag)

test &lt;- dplyr::full_join(id, all.rtu.data, by = &quot;join&quot;)

all.rtu &lt;- dplyr::select(test, uniID.x, rtu, total.visits, total.flowers)
all.rtu$total.visits[is.na(all.rtu$total.visits)] &lt;- 0
all.rtu$total.flowers[is.na(all.rtu$total.flowers)] &lt;- 0

all.rtu &lt;- dplyr::rename(all.rtu, uniID = uniID.x)

#join video length
all.rtu &lt;- IDlist %&gt;% dplyr::select(Length, uniID) %&gt;% right_join(all.rtu,., by = &quot;uniID&quot;)</code></pre>
<pre><code>## Warning: Column `uniID` joining factor and character vector, coercing into
## character vector</code></pre>
<pre class="r"><code>#join covariates
all.rtu &lt;- right_join(cov, all.rtu, by = &quot;uniID&quot;)

#convert to decimal time to standardize visits
all.rtu$pos.Length &lt;- as.POSIXct(strptime(all.rtu$Length, &quot;%H:%M:%S&quot;))
all.rtu$dec.Length &lt;- (hour(all.rtu$pos.Length) * 3600 + minute(all.rtu$pos.Length) * 60 + second(all.rtu$pos.Length)) / 3600

#plant visits per hour
all.rtu &lt;- mutate(all.rtu, visits.per.hour = total.visits/dec.Length)
all.rtu &lt;- mutate(all.rtu, flowers.per.hour = total.flowers/dec.Length)

all.rtu &lt;- dplyr::select(all.rtu, -SecondaryID, -Cam)

#output rtu level observations (ag. by replicate)
write.csv(all.rtu, &quot;Output Data/rtu_by_rep.csv&quot;)</code></pre>
</div>
<div id="pan-trap-data-wrangling" class="section level3">
<h3>Pan trap data wrangling</h3>
<p>This sections takes the long format ID sheet (pantrap_id.csv), converts it into wide format that vegan can use, and outputs the cleaned data as .csv to be sourced in later scripts</p>
<pre class="r"><code>#by rep
#need new simplified key to reflect species additions
long &lt;- read.csv(&quot;Clean Data/pantraps_ID.csv&quot;)
long$highest.rtu &lt;- gsub(&quot; &quot;,&quot;&quot;, long$highest.rtu)

sum(long$Quantity)</code></pre>
<pre><code>## [1] 3400</code></pre>
<pre class="r"><code>#sp.key &lt;- read.csv(&quot;Clean Data/species_key.csv&quot;)
long$Microsite &lt;- gsub(&quot; &quot;,&quot;&quot;, long$Microsite)
long$uniID &lt;- paste(long$Date, long$PlantID, long$Microsite)
#long &lt;- inner_join(long, sp.key, by = &quot;highest.rtu&quot;)
#for pinned specimens need to collapse &amp; add up the Quantity
long.fil &lt;- dplyr::select(long, uniID, highest.rtu, Quantity)
long.ag &lt;- long.fil %&gt;% group_by(uniID, highest.rtu) %&gt;% summarise(Quantity = sum(Quantity)) 
sum(long.ag$Quantity)</code></pre>
<pre><code>## [1] 3400</code></pre>
<pre class="r"><code>counts &lt;- long.ag %&gt;% group_by(highest.rtu) %&gt;% summarise(Quantity = sum(Quantity))
count(long.ag, highest.rtu)</code></pre>
<pre><code>## # A tibble: 1,636 x 3
## # Groups:   uniID [228]
##    uniID               highest.rtu          n
##    &lt;chr&gt;               &lt;chr&gt;            &lt;int&gt;
##  1 4.10.2017 184 open  Cicadellidae         1
##  2 4.10.2017 184 open  Eupeodesvolucris     1
##  3 4.10.2017 184 open  Melyridae            1
##  4 4.10.2017 184 open  Mythicomyiidae       1
##  5 4.10.2017 184 open  Sciaridae            1
##  6 4.10.2017 184 open  Usiinae              1
##  7 4.10.2017 184 shrub Anthidium            1
##  8 4.10.2017 184 shrub Chrysomelidae        1
##  9 4.10.2017 184 shrub Cicadellidae         1
## 10 4.10.2017 184 shrub Dialictus            1
## # ... with 1,626 more rows</code></pre>
<pre class="r"><code>#count number of specimens of each rtu and write to a table
sp_by_rep &lt;- long %&gt;% group_by(highest.rtu) %&gt;% summarise(Quantity = sum(Quantity))
write.csv(sp_by_rep, &quot;Output Data/pans_sp_by_rep.csv&quot;)

#output in long format
write.csv(long.ag, &quot;Output Data/pantraps_long.csv&quot;)

#spread into wide format for vegan calculations
wide &lt;- long.ag %&gt;% spread(highest.rtu, Quantity)

#not including damaged specimens in analyses
wide &lt;- dplyr::select(wide, -damaged, -destroyed)

#need to replace all 0 in data frame
wide[is.na(wide)] &lt;- 0


write.csv(wide, &quot;Output Data/pantraps_wide.csv&quot;)</code></pre>
</div>
<div id="pan-trap-diversity-calculations" class="section level3">
<h3>Pan trap diversity calculations</h3>
<p>This sections calculates diversity indices and exports full env/metadata .csv</p>
<p>Calculations excluding Melyrid beetles</p>
<pre class="r"><code>insects &lt;- read.csv(&quot;Output Data/pantraps_wide.csv&quot;, header = TRUE)
row.names(insects) &lt;- insects$uniID
insects &lt;- dplyr::select(insects, -X, -uniID)

#filter out Melyrid beetles
insects &lt;- dplyr::select(insects, -Melyridae)
metadata &lt;- read.csv(&quot;Clean Data/pantraps_cov.csv&quot;, header = TRUE)
metadata &lt;- filter(metadata, species != &quot;buckhorn&quot;)
metadata$plant.id &lt;- as.character(metadata$plant.id)
str(metadata)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  9 variables:
##  $ plant.id     : chr  &quot;296&quot; &quot;296&quot; &quot;189&quot; &quot;189&quot; ...
##  $ species      : Factor w/ 2 levels &quot;buckhorn&quot;,&quot;larrea&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ blooming     : Factor w/ 2 levels &quot;post&quot;,&quot;pre&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ date         : Factor w/ 21 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  15 3 25 2 40 15 40 3 70 10 ...
##  $ rich         : int  3 3 6 6 1 3 3 2 3 4 ...
##  $ perennial    : Factor w/ 5 levels &quot;&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X            : Factor w/ 6 levels &quot;&quot;,&quot;blue and white knocked over&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>metadata$uniID &lt;- paste(metadata$date, metadata$plant.id, metadata$treatment)
row.names(metadata) &lt;- metadata$uniID


#check all ids in datasheets are found in the other
#zero.row &lt;- anti_join(metadata, insects, by = &quot;uniID&quot;)
#missing &lt;- anti_join(insects, metadata, by = &quot;uniID&quot;)
#write.csv(zero.row, &quot;zeroreps.csv&quot;)

#check if insects and metadata are the same
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] &quot;214 string mismatches&quot;</code></pre>
<pre class="r"><code>#sort into the same order
metadata &lt;- metadata[rownames(insects), ]
#confirm - woo!
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>#grab and wrangle weather stn data
weather &lt;- read.csv(&quot;Clean Data/pantraps_weather.csv&quot;)
str(weather)</code></pre>
<pre><code>## &#39;data.frame&#39;:    152 obs. of  12 variables:
##  $ date            : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ Hour            : Factor w/ 8 levels &quot;1:00 PM&quot;,&quot;10:00 AM&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Solar           : num  0.81 0.79 0.8 0.81 0.81 0.8 0.63 0.82 0.84 0.76 ...
##  $ Wind            : num  3.9 4.1 5.1 4.9 4.5 3.2 3.3 4.3 4.6 4.7 ...
##  $ Max             : num  9 10.7 9.7 8.6 7.8 7.6 7.2 8.2 8.2 8.2 ...
##  $ Air.Temperature : num  15 15.6 16.9 18.5 19.8 21 21.1 20.7 20.2 18.8 ...
##  $ Soil.Temperature: num  18.9 18.8 18.7 18.8 19 19.3 19.8 20.4 21 21.5 ...
##  $ Humidity        : int  43 42 38 32 29 27 26 26 26 25 ...
##  $ Dew             : num  2.4 2.6 2.4 1.7 1.4 1.1 1.1 0.8 -0.1 -1.6 ...
##  $ Wet             : num  8.2 8.6 9.1 9.5 9.9 10.3 10.3 10 9.5 8.5 ...
##  $ Baro.           : int  873 873 873 873 872 872 872 872 871 871 ...
##  $ Total           : int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<pre class="r"><code>weather.av &lt;- weather %&gt;% group_by(., date) %&gt;% summarise(., mean.Solar = mean(Solar), mean.Wind = mean(Wind), mean.MaxWind = mean(Max), mean.Temp = mean(Air.Temperature))
metadata &lt;- right_join(weather.av, metadata, by = &quot;date&quot;)</code></pre>
<pre><code>## Warning: Column `date` joining factors with different levels, coercing to
## character vector</code></pre>
<pre class="r"><code>#calculate abundances using vegan
metadata$abun &lt;- apply(insects, 1, sum)
#check for total
sum(metadata$abun)</code></pre>
<pre><code>## [1] 2144</code></pre>
<pre class="r"><code>H &lt;- diversity(insects)
simp &lt;- diversity(insects, &quot;simpson&quot;)
S &lt;- specnumber(insects)
J &lt;- H/log(S)
metadata$H &lt;- H
metadata$Simpson &lt;- simp
metadata$Species &lt;- S
metadata$Even &lt;- J

summary(metadata)</code></pre>
<pre><code>##      date             mean.Solar       mean.Wind      mean.MaxWind   
##  Length:228         Min.   :0.5737   Min.   :3.525   Min.   : 9.238  
##  Class :character   1st Qu.:0.6663   1st Qu.:4.787   1st Qu.: 9.625  
##  Mode  :character   Median :0.7688   Median :5.175   Median :10.050  
##                     Mean   :0.7419   Mean   :5.241   Mean   :10.184  
##                     3rd Qu.:0.7987   3rd Qu.:6.025   3rd Qu.:10.512  
##                     Max.   :0.8125   Max.   :6.662   Max.   :11.537  
##                                                                      
##    mean.Temp       plant.id             species    treatment   blooming  
##  Min.   :17.16   Length:228         buckhorn:  0   open :114   post:120  
##  1st Qu.:17.40   Class :character   larrea  :228   shrub:114   pre :108  
##  Median :17.86   Mode  :character                                        
##  Mean   :18.46                                                           
##  3rd Qu.:18.56                                                           
##  Max.   :28.51                                                           
##                                                                          
##  percent.cover        rich      perennial 
##  Min.   : 1.00   Min.   :1.00       :223  
##  1st Qu.: 2.00   1st Qu.:2.00   1   :  4  
##  Median :10.00   Median :3.00   2   :  1  
##  Mean   :18.82   Mean   :3.25   3   :  0  
##  3rd Qu.:30.00   3rd Qu.:4.00   east:  0  
##  Max.   :80.00   Max.   :8.00             
##                                           
##                            X          uniID                abun       
##                             :227   Length:228         Min.   : 0.000  
##  blue and white knocked over:  1   Class :character   1st Qu.: 5.000  
##  east                       :  0   Mode  :character   Median : 9.000  
##  east side                  :  0                      Mean   : 9.404  
##  north                      :  0                      3rd Qu.:12.000  
##  yellow knocked over        :  0                      Max.   :30.000  
##                                                                       
##        H            Simpson          Species            Even       
##  Min.   :0.000   Min.   :0.0000   Min.   : 0.000   Min.   :0.0000  
##  1st Qu.:1.332   1st Qu.:0.7321   1st Qu.: 4.000   1st Qu.:0.9138  
##  Median :1.748   Median :0.8056   Median : 6.000   Median :0.9577  
##  Mean   :1.583   Mean   :0.7569   Mean   : 6.254   Mean   :0.9104  
##  3rd Qu.:1.994   3rd Qu.:0.8571   3rd Qu.: 8.000   3rd Qu.:0.9821  
##  Max.   :2.516   Max.   :1.0000   Max.   :15.000   Max.   :1.0000  
##                                                    NA&#39;s   :6</code></pre>
<pre class="r"><code>#no Melyrid beetle output
write.csv(metadata, &quot;Output Data/metadata_nobeetle.csv&quot;)
write.csv(insects, &quot;Output Data/wide_nobeetle.csv&quot;)</code></pre>
<p>Calculations including Melyrid beetles</p>
<pre class="r"><code>#with beetles
insects &lt;- read.csv(&quot;Output Data/pantraps_wide.csv&quot;, header = TRUE)
row.names(insects) &lt;- insects$uniID
insects &lt;- dplyr::select(insects, -X, -uniID, -Zeroes)
#filter out beetles
#insects &lt;- dplyr::select(insects, -Melyridae, -Melyridae.)
metadata &lt;- read.csv(&quot;Clean Data/pantraps_cov.csv&quot;, header = TRUE)
metadata &lt;- filter(metadata, species != &quot;buckhorn&quot;)
metadata$plant.id &lt;- as.character(metadata$plant.id)
str(metadata)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  9 variables:
##  $ plant.id     : chr  &quot;296&quot; &quot;296&quot; &quot;189&quot; &quot;189&quot; ...
##  $ species      : Factor w/ 2 levels &quot;buckhorn&quot;,&quot;larrea&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ blooming     : Factor w/ 2 levels &quot;post&quot;,&quot;pre&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ date         : Factor w/ 21 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  15 3 25 2 40 15 40 3 70 10 ...
##  $ rich         : int  3 3 6 6 1 3 3 2 3 4 ...
##  $ perennial    : Factor w/ 5 levels &quot;&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X            : Factor w/ 6 levels &quot;&quot;,&quot;blue and white knocked over&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>metadata$uniID &lt;- paste(metadata$date, metadata$plant.id, metadata$treatment)
row.names(metadata) &lt;- metadata$uniID


#check all ids in datasheets are found in the other
#zero.row &lt;- anti_join(metadata, insects, by = &quot;uniID&quot;)
#missing &lt;- anti_join(insects, metadata, by = &quot;uniID&quot;)
#write.csv(zero.row, &quot;zeroreps.csv&quot;)
#check if insects and metadata are the same
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] &quot;214 string mismatches&quot;</code></pre>
<pre class="r"><code>#sort into the same order
metadata &lt;- metadata[rownames(insects), ]
#confirm - woo!
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>#grab and wrangle weather stn data
weather &lt;- read.csv(&quot;Clean Data/pantraps_weather.csv&quot;)
str(weather)</code></pre>
<pre><code>## &#39;data.frame&#39;:    152 obs. of  12 variables:
##  $ date            : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ Hour            : Factor w/ 8 levels &quot;1:00 PM&quot;,&quot;10:00 AM&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Solar           : num  0.81 0.79 0.8 0.81 0.81 0.8 0.63 0.82 0.84 0.76 ...
##  $ Wind            : num  3.9 4.1 5.1 4.9 4.5 3.2 3.3 4.3 4.6 4.7 ...
##  $ Max             : num  9 10.7 9.7 8.6 7.8 7.6 7.2 8.2 8.2 8.2 ...
##  $ Air.Temperature : num  15 15.6 16.9 18.5 19.8 21 21.1 20.7 20.2 18.8 ...
##  $ Soil.Temperature: num  18.9 18.8 18.7 18.8 19 19.3 19.8 20.4 21 21.5 ...
##  $ Humidity        : int  43 42 38 32 29 27 26 26 26 25 ...
##  $ Dew             : num  2.4 2.6 2.4 1.7 1.4 1.1 1.1 0.8 -0.1 -1.6 ...
##  $ Wet             : num  8.2 8.6 9.1 9.5 9.9 10.3 10.3 10 9.5 8.5 ...
##  $ Baro.           : int  873 873 873 873 872 872 872 872 871 871 ...
##  $ Total           : int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<pre class="r"><code>weather.av &lt;- weather %&gt;% group_by(., date) %&gt;% summarise(., mean.Solar = mean(Solar), mean.Wind = mean(Wind), mean.MaxWind = mean(Max), mean.Temp = mean(Air.Temperature))
metadata &lt;- right_join(weather.av, metadata, by = &quot;date&quot;)</code></pre>
<pre><code>## Warning: Column `date` joining factors with different levels, coercing to
## character vector</code></pre>
<pre class="r"><code>metadata$abun &lt;- apply(insects, 1, sum)
#check for total
sum(metadata$abun)</code></pre>
<pre><code>## [1] 3387</code></pre>
<pre class="r"><code>H &lt;- diversity(insects)
simp &lt;- diversity(insects, &quot;simpson&quot;)
S &lt;- specnumber(insects)
J &lt;- H/log(S)
metadata$H &lt;- H
metadata$Simpson &lt;- simp
metadata$Species &lt;- S
metadata$Even &lt;- J

summary(metadata)</code></pre>
<pre><code>##      date             mean.Solar       mean.Wind      mean.MaxWind   
##  Length:228         Min.   :0.5737   Min.   :3.525   Min.   : 9.238  
##  Class :character   1st Qu.:0.6663   1st Qu.:4.787   1st Qu.: 9.625  
##  Mode  :character   Median :0.7688   Median :5.175   Median :10.050  
##                     Mean   :0.7419   Mean   :5.241   Mean   :10.184  
##                     3rd Qu.:0.7987   3rd Qu.:6.025   3rd Qu.:10.512  
##                     Max.   :0.8125   Max.   :6.662   Max.   :11.537  
##                                                                      
##    mean.Temp       plant.id             species    treatment   blooming  
##  Min.   :17.16   Length:228         buckhorn:  0   open :114   post:120  
##  1st Qu.:17.40   Class :character   larrea  :228   shrub:114   pre :108  
##  Median :17.86   Mode  :character                                        
##  Mean   :18.46                                                           
##  3rd Qu.:18.56                                                           
##  Max.   :28.51                                                           
##                                                                          
##  percent.cover        rich      perennial 
##  Min.   : 1.00   Min.   :1.00       :223  
##  1st Qu.: 2.00   1st Qu.:2.00   1   :  4  
##  Median :10.00   Median :3.00   2   :  1  
##  Mean   :18.82   Mean   :3.25   3   :  0  
##  3rd Qu.:30.00   3rd Qu.:4.00   east:  0  
##  Max.   :80.00   Max.   :8.00             
##                                           
##                            X          uniID                abun      
##                             :227   Length:228         Min.   : 0.00  
##  blue and white knocked over:  1   Class :character   1st Qu.:10.00  
##  east                       :  0   Mode  :character   Median :14.00  
##  east side                  :  0                      Mean   :14.86  
##  north                      :  0                      3rd Qu.:19.00  
##  yellow knocked over        :  0                      Max.   :55.00  
##                                                                      
##        H            Simpson          Species           Even       
##  Min.   :0.000   Min.   :0.0000   Min.   : 0.00   Min.   :0.0000  
##  1st Qu.:1.233   1st Qu.:0.6239   1st Qu.: 5.00   1st Qu.:0.7950  
##  Median :1.699   Median :0.7769   Median : 7.00   Median :0.8842  
##  Mean   :1.570   Mean   :0.7034   Mean   : 7.11   Mean   :0.8413  
##  3rd Qu.:1.991   3rd Qu.:0.8344   3rd Qu.: 9.00   3rd Qu.:0.9464  
##  Max.   :2.552   Max.   :1.0000   Max.   :16.00   Max.   :1.0000  
##                                                   NA&#39;s   :6</code></pre>
<pre class="r"><code>#beetle output
write.csv(metadata, &quot;Output Data/metadata_yesbeetle.csv&quot;)
write.csv(insects, &quot;Output Data/wide_yesbeetle.csv&quot;)</code></pre>
<p>Calculations for only Melyrid beetles</p>
<pre class="r"><code>##beetles only
insects &lt;- read.csv(&quot;Output Data/pantraps_wide.csv&quot;, header = TRUE)
row.names(insects) &lt;- insects$uniID
insects &lt;- dplyr::select(insects, -X, -uniID)
#filter out beetles
insects &lt;- dplyr::select(insects, Melyridae)
metadata &lt;- read.csv(&quot;Clean Data/pantraps_cov.csv&quot;, header = TRUE)
metadata &lt;- filter(metadata, species != &quot;buckhorn&quot;)
metadata$plant.id &lt;- as.character(metadata$plant.id)
str(metadata)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  9 variables:
##  $ plant.id     : chr  &quot;296&quot; &quot;296&quot; &quot;189&quot; &quot;189&quot; ...
##  $ species      : Factor w/ 2 levels &quot;buckhorn&quot;,&quot;larrea&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ blooming     : Factor w/ 2 levels &quot;post&quot;,&quot;pre&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ date         : Factor w/ 21 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  15 3 25 2 40 15 40 3 70 10 ...
##  $ rich         : int  3 3 6 6 1 3 3 2 3 4 ...
##  $ perennial    : Factor w/ 5 levels &quot;&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X            : Factor w/ 6 levels &quot;&quot;,&quot;blue and white knocked over&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>metadata$uniID &lt;- paste(metadata$date, metadata$plant.id, metadata$treatment)
row.names(metadata) &lt;- metadata$uniID

#check if insects and metadata are the same
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] &quot;214 string mismatches&quot;</code></pre>
<pre class="r"><code>#sort into the same order
metadata &lt;- metadata[rownames(insects), ]
#confirm - woo!
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>#grab and wrangle weather stn data
weather &lt;- read.csv(&quot;Clean Data/pantraps_weather.csv&quot;)
str(weather)</code></pre>
<pre><code>## &#39;data.frame&#39;:    152 obs. of  12 variables:
##  $ date            : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ Hour            : Factor w/ 8 levels &quot;1:00 PM&quot;,&quot;10:00 AM&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Solar           : num  0.81 0.79 0.8 0.81 0.81 0.8 0.63 0.82 0.84 0.76 ...
##  $ Wind            : num  3.9 4.1 5.1 4.9 4.5 3.2 3.3 4.3 4.6 4.7 ...
##  $ Max             : num  9 10.7 9.7 8.6 7.8 7.6 7.2 8.2 8.2 8.2 ...
##  $ Air.Temperature : num  15 15.6 16.9 18.5 19.8 21 21.1 20.7 20.2 18.8 ...
##  $ Soil.Temperature: num  18.9 18.8 18.7 18.8 19 19.3 19.8 20.4 21 21.5 ...
##  $ Humidity        : int  43 42 38 32 29 27 26 26 26 25 ...
##  $ Dew             : num  2.4 2.6 2.4 1.7 1.4 1.1 1.1 0.8 -0.1 -1.6 ...
##  $ Wet             : num  8.2 8.6 9.1 9.5 9.9 10.3 10.3 10 9.5 8.5 ...
##  $ Baro.           : int  873 873 873 873 872 872 872 872 871 871 ...
##  $ Total           : int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<pre class="r"><code>weather.av &lt;- weather %&gt;% group_by(., date) %&gt;% summarise(., mean.Solar = mean(Solar), mean.Wind = mean(Wind), mean.MaxWind = mean(Max), mean.Temp = mean(Air.Temperature))
metadata &lt;- right_join(weather.av, metadata, by = &quot;date&quot;)</code></pre>
<pre><code>## Warning: Column `date` joining factors with different levels, coercing to
## character vector</code></pre>
<pre class="r"><code>metadata$abun &lt;- apply(insects, 1, sum)
#check for total
sum(metadata$abun)</code></pre>
<pre><code>## [1] 1243</code></pre>
<pre class="r"><code>H &lt;- diversity(insects)
simp &lt;- diversity(insects, &quot;simpson&quot;)
S &lt;- specnumber(insects)
J &lt;- H/log(S)
metadata$H &lt;- H
metadata$Simpson &lt;- simp
metadata$Species &lt;- S
metadata$Even &lt;- J


summary(metadata)</code></pre>
<pre><code>##      date             mean.Solar       mean.Wind      mean.MaxWind   
##  Length:228         Min.   :0.5737   Min.   :3.525   Min.   : 9.238  
##  Class :character   1st Qu.:0.6663   1st Qu.:4.787   1st Qu.: 9.625  
##  Mode  :character   Median :0.7688   Median :5.175   Median :10.050  
##                     Mean   :0.7419   Mean   :5.241   Mean   :10.184  
##                     3rd Qu.:0.7987   3rd Qu.:6.025   3rd Qu.:10.512  
##                     Max.   :0.8125   Max.   :6.662   Max.   :11.537  
##    mean.Temp       plant.id             species    treatment   blooming  
##  Min.   :17.16   Length:228         buckhorn:  0   open :114   post:120  
##  1st Qu.:17.40   Class :character   larrea  :228   shrub:114   pre :108  
##  Median :17.86   Mode  :character                                        
##  Mean   :18.46                                                           
##  3rd Qu.:18.56                                                           
##  Max.   :28.51                                                           
##  percent.cover        rich      perennial 
##  Min.   : 1.00   Min.   :1.00       :223  
##  1st Qu.: 2.00   1st Qu.:2.00   1   :  4  
##  Median :10.00   Median :3.00   2   :  1  
##  Mean   :18.82   Mean   :3.25   3   :  0  
##  3rd Qu.:30.00   3rd Qu.:4.00   east:  0  
##  Max.   :80.00   Max.   :8.00             
##                            X          uniID                abun       
##                             :227   Length:228         Min.   : 0.000  
##  blue and white knocked over:  1   Class :character   1st Qu.: 1.750  
##  east                       :  0   Mode  :character   Median : 4.000  
##  east side                  :  0                      Mean   : 5.452  
##  north                      :  0                      3rd Qu.: 7.000  
##  yellow knocked over        :  0                      Max.   :46.000  
##        H            Simpson          Species            Even    
##  Min.   :4.908   Min.   :0.9899   Min.   :0.0000   Min.   :  0  
##  1st Qu.:4.908   1st Qu.:0.9899   1st Qu.:1.0000   1st Qu.:Inf  
##  Median :4.908   Median :0.9899   Median :1.0000   Median :Inf  
##  Mean   :4.908   Mean   :0.9899   Mean   :0.8553   Mean   :Inf  
##  3rd Qu.:4.908   3rd Qu.:0.9899   3rd Qu.:1.0000   3rd Qu.:Inf  
##  Max.   :4.908   Max.   :0.9899   Max.   :1.0000   Max.   :Inf</code></pre>
<pre class="r"><code>#no beetle output
write.csv(metadata, &quot;Output Data/metadata_onlybeetle.csv&quot;)
write.csv(insects, &quot;Output Data/wide_onlybeetle.csv&quot;)</code></pre>
<hr />
</div>
</div>
<div id="statistics-and-modelling" class="section level1">
<h1>Statistics and modelling</h1>
<div id="visitation-and-pollen-deposition" class="section level2">
<h2>Visitation and pollen deposition</h2>
<div id="visitation-modelling" class="section level3">
<h3>Visitation modelling</h3>
<p>Hypothesis testing for visitation. GLMM are computationally difficult so workflow is: Base hypothesis model to test for additive vs. interactive effects of predictors. Then add each covariate the best base model. RTU specific responses require a different dataframe so those analyses are done separately. Very full models are not tractable. AllFit.R started throwing an error so moving from lme4 to glmmTMBB. Support for car::Anova in glmmTMB is in the development version.</p>
<pre class="r"><code>byrep &lt;- read.csv(&quot;Output Data/byrep_cleaned.csv&quot;)
byrep$repID &lt;- paste(byrep$PlantID, byrep$treatment)
byrep$treatment &lt;- relevel(byrep$treatment, &quot;open&quot;)
byrep$flowering &lt;- relevel(byrep$flowering, &quot;pre&quot;)

#calculate mean video length
mean(byrep$dec.Length)</code></pre>
<pre><code>## [1] 1.324978</code></pre>
<pre class="r"><code>#calculate total flower visits and total foraging instances
sum(byrep$total.flowers)</code></pre>
<pre><code>## [1] 925</code></pre>
<pre class="r"><code>sum(byrep$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#should be 925 and 697 - not 930 and 701.</code></pre>
<p>Flower visits</p>
<pre class="r"><code>#base hypothesis testing model
#additive
m1 &lt;- glmmTMB(total.flowers ~ treatment + flowering + flowers.pot + offset(log(dec.Length)) + (1|repID), family = &quot;nbinom2&quot;, data = byrep)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment + flowering + flowers.pot + offset(log(dec.Length)) +  
##     (1 | repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1111.4   1132.2   -549.7   1099.4      229 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.1137   0.3372  
## Number of obs: 235, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 1.03 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     0.99295    0.28935   3.432  0.00060 ***
## treatmentshrub -0.35032    0.16682  -2.100  0.03573 *  
## floweringbloom -1.25514    0.16057  -7.817 5.41e-15 ***
## flowers.pot     0.06992    0.02667   2.622  0.00874 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>plot(residuals(m1)~predict(m1))</code></pre>
<p><img src="index_files/figure-html/visitation%20models%20base-1.png" width="672" /></p>
<pre class="r"><code>car::Anova(m1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.flowers
##               Chisq Df Pr(&gt;Chisq)    
## treatment    4.4102  1   0.035726 *  
## flowering   61.1040  1  5.414e-15 ***
## flowers.pot  6.8749  1   0.008742 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#interactive model

m2 &lt;- glmmTMB(total.flowers ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) + (1|repID),  family = &quot;nbinom2&quot;, data = byrep)
summary(m2)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) +  
##     (1 | repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1113.4   1137.6   -549.7   1099.4      228 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.1117   0.3343  
## Number of obs: 235, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 1.03 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    1.00505    0.29862   3.366 0.000764 ***
## treatmentshrub                -0.37412    0.22063  -1.696 0.089950 .  
## floweringbloom                -1.27990    0.22004  -5.817 6.01e-09 ***
## flowers.pot                    0.06994    0.02666   2.623 0.008705 ** 
## treatmentshrub:floweringbloom  0.05186    0.31483   0.165 0.869158    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m2, type =3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: total.flowers
##                       Chisq Df Pr(&gt;Chisq)    
## (Intercept)         11.3275  1  0.0007637 ***
## treatment            2.8753  1  0.0899499 .  
## flowering           33.8324  1  6.007e-09 ***
## flowers.pot          6.8823  1  0.0087051 ** 
## treatment:flowering  0.0271  1  0.8691580    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>null &lt;- glmmTMB(total.flowers ~ flowers.pot + offset(log(dec.Length)) + (1|repID),  family = &quot;nbinom2&quot;, data = byrep)
summary(null)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ flowers.pot + offset(log(dec.Length)) + (1 |      repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1164.4   1178.2   -578.2   1156.4      231 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.1149   0.339   
## Number of obs: 235, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 0.702 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  0.78311    0.31030   2.524   0.0116 *
## flowers.pot  0.02793    0.02943   0.949   0.3425  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(m1,m2, null)</code></pre>
<pre><code>## Data: byrep
## Models:
## null: total.flowers ~ flowers.pot + offset(log(dec.Length)) + (1 | , zi=~0, disp=~1
## null:     repID), zi=~0, disp=~1
## m1: total.flowers ~ treatment + flowering + flowers.pot + offset(log(dec.Length)) + , zi=~0, disp=~1
## m1:     (1 | repID), zi=~0, disp=~1
## m2: total.flowers ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) + , zi=~0, disp=~1
## m2:     (1 | repID), zi=~0, disp=~1
##      Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## null  4 1164.4 1178.2 -578.20   1156.4                              
## m1    6 1111.4 1132.2 -549.71   1099.4 56.9782      2   4.24e-13 ***
## m2    7 1113.4 1137.6 -549.69   1099.4  0.0271      1     0.8691    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(m1,m2, null)</code></pre>
<pre><code>##      df      AIC
## m1    6 1111.414
## m2    7 1113.387
## null  4 1164.392</code></pre>
<pre class="r"><code>car::Anova(m2, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: total.flowers
##                       Chisq Df Pr(&gt;Chisq)    
## (Intercept)         11.3275  1  0.0007637 ***
## treatment            2.8753  1  0.0899499 .  
## flowering           33.8324  1  6.007e-09 ***
## flowers.pot          6.8823  1  0.0087051 ** 
## treatment:flowering  0.0271  1  0.8691580    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#model 1 is best fit</code></pre>
<p>Foraging instances</p>
<pre class="r"><code>#base additive model foraging instances
m3 &lt;- glmmTMB(total.visits ~ treatment + flowering + flowers.pot + offset(log(dec.Length)) + (1|repID), family = &quot;nbinom2&quot;, data = byrep)
summary(m3)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ treatment + flowering + flowers.pot + offset(log(dec.Length)) +  
##     (1 | repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1000.7   1021.5   -494.4    988.7      229 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.04312  0.2077  
## Number of obs: 235, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 1.48 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     0.96725    0.25551   3.786 0.000153 ***
## treatmentshrub -0.32818    0.14497  -2.264 0.023586 *  
## floweringbloom -1.25629    0.14367  -8.744  &lt; 2e-16 ***
## flowers.pot     0.04757    0.02351   2.024 0.043005 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m3, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.visits
##               Chisq Df Pr(&gt;Chisq)    
## treatment    5.1248  1    0.02359 *  
## flowering   76.4608  1    &lt; 2e-16 ***
## flowers.pot  4.0952  1    0.04301 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#base interactive model
m5 &lt;- glmmTMB(total.visits ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) + (1|repID), family = &quot;nbinom2&quot;, data = byrep)
summary(m5)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) +  
##     (1 | repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1002.7   1026.9   -494.3    988.7      228 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.04251  0.2062  
## Number of obs: 235, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 1.48 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.97521    0.26277   3.711 0.000206 ***
## treatmentshrub                -0.34375    0.18777  -1.831 0.067146 .  
## floweringbloom                -1.27368    0.19603  -6.497 8.17e-11 ***
## flowers.pot                    0.04755    0.02351   2.023 0.043085 *  
## treatmentshrub:floweringbloom  0.03680    0.28188   0.131 0.896131    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m5, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: total.visits
##                       Chisq Df Pr(&gt;Chisq)    
## (Intercept)         13.7732  1  0.0002063 ***
## treatment            3.3514  1  0.0671465 .  
## flowering           42.2157  1  8.174e-11 ***
## flowers.pot          4.0921  1  0.0430849 *  
## treatment:flowering  0.0170  1  0.8961310    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#null model
null &lt;- glmmTMB(total.visits ~ flowers.pot + offset(log(dec.Length)) + (1|repID), family = &quot;nbinom2&quot;, data = byrep)


anova(m3,m5, null)</code></pre>
<pre><code>## Data: byrep
## Models:
## null: total.visits ~ flowers.pot + offset(log(dec.Length)) + (1 | repID), zi=~0, disp=~1
## m3: total.visits ~ treatment + flowering + flowers.pot + offset(log(dec.Length)) + , zi=~0, disp=~1
## m3:     (1 | repID), zi=~0, disp=~1
## m5: total.visits ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) + , zi=~0, disp=~1
## m5:     (1 | repID), zi=~0, disp=~1
##      Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)    
## null  4 1066.0 1079.8 -528.98  1057.95                             
## m3    6 1000.7 1021.5 -494.35   988.70 69.251      2   9.17e-16 ***
## m5    7 1002.7 1026.9 -494.34   988.69  0.017      1     0.8961    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(m3, m5, null)</code></pre>
<pre><code>##      df      AIC
## m3    6 1000.704
## m5    7 1002.687
## null  4 1065.955</code></pre>
<pre class="r"><code>ggplot(byrep, aes(flowering, flowers.per.hour)) + geom_boxplot() + facet_grid(~treatment)</code></pre>
<p><img src="index_files/figure-html/visitation%20models%20(foraging)-1.png" width="672" /> ###Testing importance of covariates using TMB because glmer will not coverge. Choosing family:</p>
<pre class="r"><code>c1 &lt;- glmmTMB(total.flowers ~ treatment + flowering + flowers.pot + understory.richness+ offset(log(dec.Length)) + (1|repID), family = &quot;nbinom2&quot;, data = byrep)
summary(c1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment + flowering + flowers.pot + understory.richness +  
##     offset(log(dec.Length)) + (1 | repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1092.6   1116.7   -539.3   1078.6      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.1321   0.3635  
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family ():  1.1 
## 
## Conditional model:
##                     Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)          0.50760    0.35732   1.421   0.1554    
## treatmentshrub      -0.38831    0.16723  -2.322   0.0202 *  
## floweringbloom      -1.19232    0.16523  -7.216 5.35e-13 ***
## flowers.pot          0.06941    0.02695   2.576   0.0100 *  
## understory.richness  0.18934    0.09021   2.099   0.0358 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>c1.1 &lt;- glmmTMB(total.flowers ~ treatment + flowering + flowers.pot + understory.richness+ offset(log(dec.Length)) + (1|repID), family = &quot;nbinom1&quot;, data = byrep)
summary(c1.1)</code></pre>
<pre><code>##  Family: nbinom1  ( log )
## Formula:          
## total.flowers ~ treatment + flowering + flowers.pot + understory.richness +  
##     offset(log(dec.Length)) + (1 | repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1098.1   1122.2   -542.0   1084.1      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev. 
##  repID  (Intercept) 5.185e-09 7.201e-05
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom1 family (): 4.26 
## 
## Conditional model:
##                     Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)          0.46139    0.32209   1.433  0.15200    
## treatmentshrub      -0.28933    0.13231  -2.187  0.02876 *  
## floweringbloom      -0.96031    0.14132  -6.795 1.08e-11 ***
## flowers.pot          0.05704    0.02185   2.611  0.00904 ** 
## understory.richness  0.24002    0.07824   3.068  0.00216 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(c1, c1.1)</code></pre>
<pre><code>##      df      AIC
## c1    7 1092.593
## c1.1  7 1098.089</code></pre>
<pre class="r"><code>#nbinom2 is better</code></pre>
<p>Annual floral density</p>
<pre class="r"><code>c2 &lt;- glmmTMB(total.flowers ~ treatment + flowering + flowers.pot + het.annual.floral.density + offset(log(dec.Length)) + (1|repID), family = nbinom2(link = &quot;log&quot;), data = byrep)
summary(c2)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment + flowering + flowers.pot + het.annual.floral.density +  
##     offset(log(dec.Length)) + (1 | repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1093.7   1117.8   -539.9   1079.7      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.1308   0.3616  
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 1.09 
## 
## Conditional model:
##                           Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                0.82562    0.29777   2.773  0.00556 ** 
## treatmentshrub            -0.37743    0.16820  -2.244  0.02484 *  
## floweringbloom            -1.22703    0.16269  -7.542 4.62e-14 ***
## flowers.pot                0.08029    0.02705   2.969  0.00299 ** 
## het.annual.floral.density  0.03988    0.02334   1.709  0.08749 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(c2, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.flowers
##                             Chisq Df Pr(&gt;Chisq)    
## treatment                  5.0352  1   0.024838 *  
## flowering                 56.8850  1  4.621e-14 ***
## flowers.pot                8.8120  1   0.002993 ** 
## het.annual.floral.density  2.9200  1   0.087488 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>c2.nest &lt;- glmmTMB(total.flowers ~ treatment + flowering + flowers.pot + het.annual.floral.density + offset(log(dec.Length)) + (1|PlantID/repID), family = nbinom2(link = &quot;log&quot;), data = byrep)

summary(c2.nest)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment + flowering + flowers.pot + het.annual.floral.density +  
##     offset(log(dec.Length)) + (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1095.7   1123.3   -539.9   1079.7      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.12228  0.34969 
##  PlantID       (Intercept) 0.00987  0.09935 
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.09 
## 
## Conditional model:
##                           Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                0.82490    0.29852   2.763  0.00572 ** 
## treatmentshrub            -0.37733    0.16732  -2.255  0.02412 *  
## floweringbloom            -1.22713    0.16283  -7.536 4.84e-14 ***
## flowers.pot                0.08032    0.02714   2.960  0.00308 ** 
## het.annual.floral.density  0.03984    0.02334   1.707  0.08789 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>c2.v &lt;- glmmTMB(total.visits ~ treatment + flowering + het.annual.floral.density + flowers.pot + offset(log(dec.Length)) + (1|repID), family = nbinom2(link = &quot;log&quot;), data = byrep)
summary(c2.v)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ treatment + flowering + het.annual.floral.density +  
##     flowers.pot + offset(log(dec.Length)) + (1 | repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##    982.6   1006.7   -484.3    968.6      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.06451  0.254   
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 1.62 
## 
## Conditional model:
##                           Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                0.78267    0.26236   2.983  0.00285 ** 
## treatmentshrub            -0.34469    0.14616  -2.358  0.01836 *  
## floweringbloom            -1.22921    0.14464  -8.498  &lt; 2e-16 ***
## het.annual.floral.density  0.04049    0.01981   2.044  0.04097 *  
## flowers.pot                0.05874    0.02371   2.477  0.01325 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(c2.v, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.visits
##                             Chisq Df Pr(&gt;Chisq)    
## treatment                  5.5618  1    0.01836 *  
## flowering                 72.2217  1    &lt; 2e-16 ***
## het.annual.floral.density  4.1772  1    0.04097 *  
## flowers.pot                6.1351  1    0.01325 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>q &lt;- glmmTMB(total.visits ~ treatment + flowering + flowers.pot + het.annual.floral.density + offset(log(dec.Length)) + (1|repID), family = nbinom1(link = &quot;log&quot;), data = byrep)
car::Anova(q, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.visits
##                             Chisq Df Pr(&gt;Chisq)    
## treatment                  2.3015  1    0.12925    
## flowering                 57.8924  1  2.769e-14 ***
## flowers.pot                6.5441  1    0.01052 *  
## het.annual.floral.density 10.1798  1    0.00142 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(c2.v, q)</code></pre>
<pre><code>##      df      AIC
## c2.v  7 982.5998
## q     7 988.4092</code></pre>
<pre class="r"><code>c2.vnest &lt;- glmmTMB(total.visits ~ treatment + flowering + flowers.pot + het.annual.floral.density + offset(log(dec.Length)) + (1|PlantID/repID), family = nbinom2(link = &quot;log&quot;), data = byrep)
summary(c2.vnest)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ treatment + flowering + flowers.pot + het.annual.floral.density +  
##     offset(log(dec.Length)) + (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##    984.6   1012.1   -484.3    968.6      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.04899  0.2213  
##  PlantID       (Intercept) 0.01753  0.1324  
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.62 
## 
## Conditional model:
##                           Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                0.78251    0.26356   2.969  0.00299 ** 
## treatmentshrub            -0.34480    0.14425  -2.390  0.01684 *  
## floweringbloom            -1.22826    0.14485  -8.479  &lt; 2e-16 ***
## flowers.pot                0.05863    0.02389   2.455  0.01410 *  
## het.annual.floral.density  0.04069    0.01984   2.051  0.04029 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Number of blooming shrub neighbours</p>
<pre class="r"><code>c3 &lt;- glmmTMB(total.flowers ~ treatment + flowering + flowers.pot + het.shrub.blooming.neighbours + offset(log(dec.Length)) + (1|repID), family = &quot;nbinom2&quot;, data = byrep)
summary(c3)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment + flowering + flowers.pot + het.shrub.blooming.neighbours +  
##     offset(log(dec.Length)) + (1 | repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1095.5   1119.6   -540.8   1081.5      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.1183   0.344   
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 1.06 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.94775    0.29061   3.261  0.00111 ** 
## treatmentshrub                -0.32888    0.16998  -1.935  0.05301 .  
## floweringbloom                -1.16615    0.18601  -6.269 3.63e-10 ***
## flowers.pot                    0.07598    0.02703   2.811  0.00494 ** 
## het.shrub.blooming.neighbours -0.04940    0.04093  -1.207  0.22744    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(c3, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.flowers
##                                 Chisq Df Pr(&gt;Chisq)    
## treatment                      3.7437  1   0.053008 .  
## flowering                     39.3038  1  3.627e-10 ***
## flowers.pot                    7.9027  1   0.004936 ** 
## het.shrub.blooming.neighbours  1.4568  1   0.227438    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>c2.v &lt;- glmmTMB(total.visits ~ treatment + flowering + flowers.pot + het.shrub.blooming.neighbours + offset(log(dec.Length)) + (1|repID), family = &quot;nbinom2&quot;, data = byrep)
summary(c2.v)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ treatment + flowering + flowers.pot + het.shrub.blooming.neighbours +  
##     offset(log(dec.Length)) + (1 | repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##    986.5   1010.6   -486.2    972.5      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.0557   0.236   
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 1.53 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.92071    0.25682   3.585 0.000337 ***
## treatmentshrub                -0.31539    0.14829  -2.127 0.033435 *  
## floweringbloom                -1.20875    0.16707  -7.235 4.66e-13 ***
## flowers.pot                    0.05296    0.02376   2.229 0.025799 *  
## het.shrub.blooming.neighbours -0.03124    0.03744  -0.835 0.403997    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(c2.v)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.visits
##                                 Chisq Df Pr(&gt;Chisq)    
## treatment                      4.5234  1    0.03343 *  
## flowering                     52.3453  1  4.655e-13 ***
## flowers.pot                    4.9695  1    0.02580 *  
## het.shrub.blooming.neighbours  0.6964  1    0.40400    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="rtu-visitation-modelling" class="section level3">
<h3>RTU visitation modelling</h3>
<p>Models for testing RTU-specificity</p>
<pre class="r"><code>byrtu &lt;- read.csv(&quot;Output Data/rtu_by_rep.csv&quot;)
byrtu$repID &lt;- paste(byrtu$PlantID, byrtu$treatment)
byrtu$treatment &lt;- relevel(byrtu$treatment, &quot;open&quot;)
byrtu$flowering &lt;- relevel(byrtu$flowering, &quot;pre&quot;)

#Full model (foraging instances)
mFullPQ &lt;- MASS::glmmPQL(total.visits~flowering * rtu * treatment + flowers.pot + het.annual.floral.density + het.shrub.blooming.neighbours + offset(log(dec.Length)), random = ~1|repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>car::Anova(mFullPQ, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III tests)
## 
## Response: total.visits
##                                  Chisq Df Pr(&gt;Chisq)    
## (Intercept)                    19.8681  1  8.297e-06 ***
## flowering                       9.7626  1   0.001781 ** 
## rtu                           130.6380  5  &lt; 2.2e-16 ***
## treatment                       3.5703  1   0.058821 .  
## flowers.pot                     6.9279  1   0.008486 ** 
## het.annual.floral.density       5.9225  1   0.014949 *  
## het.shrub.blooming.neighbours   1.4649  1   0.226158    
## flowering:rtu                  51.4774  5  6.904e-10 ***
## flowering:treatment             2.5109  1   0.113063    
## rtu:treatment                   3.8084  5   0.577314    
## flowering:rtu:treatment         4.4364  5   0.488432    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>mP1 &lt;- MASS::glmmPQL(total.visits~flowering * rtu + treatment + flowers.pot + het.annual.floral.density + het.shrub.blooming.neighbours + offset(log(dec.Length)), random = ~1|repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>car::Anova(mP1, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III tests)
## 
## Response: total.visits
##                                  Chisq Df Pr(&gt;Chisq)    
## (Intercept)                    25.3323  1  4.825e-07 ***
## flowering                       9.5228  1   0.002029 ** 
## rtu                           214.8311  5  &lt; 2.2e-16 ***
## treatment                       4.1070  1   0.042707 *  
## flowers.pot                     6.1402  1   0.013214 *  
## het.annual.floral.density       5.3897  1   0.020256 *  
## het.shrub.blooming.neighbours   1.2050  1   0.272315    
## flowering:rtu                  67.1419  5  4.026e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>mPt &lt;- MASS::glmmPQL(total.visits~ flowering * rtu +  treatment + flowers.pot + het.annual.floral.density + offset(log(dec.Length)), random = ~1|repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>summary(mPt)</code></pre>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##  Data: byrtu 
##   AIC BIC logLik
##    NA  NA     NA
## 
## Random effects:
##  Formula: ~1 | repID
##         (Intercept) Residual
## StdDev:   0.4850369 1.447393
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~invwt 
## Fixed effects: total.visits ~ flowering * rtu + treatment + flowers.pot + het.annual.floral.density +      offset(log(dec.Length)) 
##                                 Value Std.Error   DF   t-value p-value
## (Intercept)                 -1.588635      0.32 1251 -4.966677  0.0000
## floweringbloom              -1.620187      0.49 1251 -3.297275  0.0010
## rtubombylid                 -0.251314      0.33 1251 -0.766237  0.4437
## rtuhoneybee                 -2.197225      0.69 1251 -3.202810  0.0014
## rtulep                      -3.113515      1.05 1251 -2.960560  0.0031
## rtuother                     0.725937      0.26 1251  2.746994  0.0061
## rtusyrphid                   1.986351      0.23 1251  8.586087  0.0000
## treatmentshrub              -0.314510      0.15  120 -2.147471  0.0338
## flowers.pot                  0.052119      0.02 1251  2.386102  0.0172
## het.annual.floral.density    0.035599      0.02 1251  2.231026  0.0259
## floweringbloom:rtubombylid   1.254617      0.61 1251  2.060619  0.0395
## floweringbloom:rtuhoneybee -22.688568  67450.81 1251 -0.000336  0.9997
## floweringbloom:rtulep        3.660059      1.19 1251  3.082328  0.0021
## floweringbloom:rtuother      1.510897      0.53 1251  2.840494  0.0046
## floweringbloom:rtusyrphid   -1.439807      0.60 1251 -2.407984  0.0162
##  Correlation: 
##                            (Intr) flwrng rtbmby rthnyb rtulep rtuthr
## floweringbloom             -0.265                                   
## rtubombylid                -0.449  0.292                            
## rtuhoneybee                -0.214  0.140  0.209                     
## rtulep                     -0.140  0.091  0.136  0.065              
## rtuother                   -0.557  0.362  0.543  0.260  0.169       
## rtusyrphid                 -0.636  0.414  0.620  0.297  0.193  0.770
## treatmentshrub             -0.222 -0.001  0.000  0.000  0.000  0.000
## flowers.pot                -0.682 -0.059  0.000  0.000  0.000  0.000
## het.annual.floral.density  -0.207  0.039  0.000  0.000  0.000  0.000
## floweringbloom:rtubombylid  0.242 -0.801 -0.539 -0.113 -0.074 -0.293
## floweringbloom:rtuhoneybee  0.000  0.000  0.000  0.000  0.000  0.000
## floweringbloom:rtulep       0.124 -0.411 -0.121 -0.058 -0.886 -0.150
## floweringbloom:rtuother     0.277 -0.917 -0.270 -0.129 -0.084 -0.497
## floweringbloom:rtusyrphid   0.246 -0.815 -0.240 -0.115 -0.075 -0.298
##                            rtsyrp trtmnt flwrs. ht.n.. flwrngblm:rtb
## floweringbloom                                                      
## rtubombylid                                                         
## rtuhoneybee                                                         
## rtulep                                                              
## rtuother                                                            
## rtusyrphid                                                          
## treatmentshrub              0.000                                   
## flowers.pot                 0.000  0.022                            
## het.annual.floral.density   0.000  0.012  0.167                     
## floweringbloom:rtubombylid -0.334  0.000  0.000  0.000              
## floweringbloom:rtuhoneybee  0.000  0.000  0.000  0.000  0.000       
## floweringbloom:rtulep      -0.171  0.000  0.000  0.000  0.331       
## floweringbloom:rtuother    -0.382  0.000  0.000  0.000  0.740       
## floweringbloom:rtusyrphid  -0.387  0.000  0.000  0.000  0.658       
##                            flwrngblm:rth flwrngblm:rtl flwrngblm:rtt
## floweringbloom                                                      
## rtubombylid                                                         
## rtuhoneybee                                                         
## rtulep                                                              
## rtuother                                                            
## rtusyrphid                                                          
## treatmentshrub                                                      
## flowers.pot                                                         
## het.annual.floral.density                                           
## floweringbloom:rtubombylid                                          
## floweringbloom:rtuhoneybee                                          
## floweringbloom:rtulep       0.000                                   
## floweringbloom:rtuother     0.000         0.379                     
## floweringbloom:rtusyrphid   0.000         0.337         0.753       
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -2.0571160 -0.3624978 -0.2266572 -0.0598081 15.5262260 
## 
## Number of Observations: 1386
## Number of Groups: 122</code></pre>
<pre class="r"><code>car::Anova(mPt, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III tests)
## 
## Response: total.visits
##                              Chisq Df Pr(&gt;Chisq)    
## (Intercept)                24.9378  1  5.921e-07 ***
## flowering                  10.9910  1  0.0009156 ***
## rtu                       211.6795  5  &lt; 2.2e-16 ***
## treatment                   4.6621  1  0.0308357 *  
## flowers.pot                 5.7558  1  0.0164346 *  
## het.annual.floral.density   5.0319  1  0.0248841 *  
## flowering:rtu              66.1569  5  6.448e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>lsmeans(mPt, pairwise~flowering|rtu)</code></pre>
<pre><code>## $lsmeans
## rtu = bee:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre        -0.9079822 2.229065e-01 120 -1.349322e+00 -4.666429e-01
##  bloom      -2.5281696 4.422209e-01 120 -3.403736e+00 -1.652603e+00
## 
## rtu = bombylid:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre        -1.1592967 2.512650e-01 120 -1.656784e+00 -6.618095e-01
##  bloom      -1.5248674 2.713327e-01 120 -2.062087e+00 -9.876476e-01
## 
## rtu = honeybee:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre        -3.1052068 6.528378e-01 120 -4.397780e+00 -1.812633e+00
##  bloom     -27.4139624 6.745081e+04 120 -1.335753e+05  1.335205e+05
## 
## rtu = lep:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre        -4.0214975 1.030319e+00 120 -6.061458e+00 -1.981537e+00
##  bloom      -1.9816259 3.383675e-01 120 -2.651570e+00 -1.311682e+00
## 
## rtu = other:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre        -0.1820452 1.593623e-01 120 -4.975715e-01  1.334810e-01
##  bloom      -0.2913358 1.535827e-01 120 -5.954189e-01  1.274719e-02
## 
## rtu = syrphid:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre         1.0783689 9.529154e-02 120  8.896983e-01  1.267039e+00
##  bloom      -1.9816259 3.383675e-01 120 -2.651570e+00 -1.311682e+00
## 
## Results are averaged over the levels of: treatment 
## Results are given on the log (not the response) scale. 
## Confidence level used: 0.95 
## 
## $contrasts
## rtu = bee:
##  contrast      estimate           SE   df t.ratio p.value
##  pre - bloom  1.6201873 4.913716e-01 1251   3.297  0.0010
## 
## rtu = bombylid:
##  contrast      estimate           SE   df t.ratio p.value
##  pre - bloom  0.3655708 3.646299e-01 1251   1.003  0.3163
## 
## rtu = honeybee:
##  contrast      estimate           SE   df t.ratio p.value
##  pre - bloom 24.3087556 6.745081e+04 1251   0.000  0.9997
## 
## rtu = lep:
##  contrast      estimate           SE   df t.ratio p.value
##  pre - bloom -2.0398717 1.082705e+00 1251  -1.884  0.0598
## 
## rtu = other:
##  contrast      estimate           SE   df t.ratio p.value
##  pre - bloom  0.1092906 2.125640e-01 1251   0.514  0.6072
## 
## rtu = syrphid:
##  contrast      estimate           SE   df t.ratio p.value
##  pre - bloom  3.0599947 3.460817e-01 1251   8.842  &lt;.0001
## 
## Results are averaged over the levels of: treatment 
## Results are given on the log (not the response) scale.</code></pre>
<pre class="r"><code>#full model flower visits
mFullPQv &lt;- MASS::glmmPQL(total.flowers~flowering * rtu * treatment + flowers.pot + het.annual.floral.density + het.shrub.blooming.neighbours + offset(log(dec.Length)), random = ~1|repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>summary(mFullPQv)</code></pre>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##  Data: byrtu 
##   AIC BIC logLik
##    NA  NA     NA
## 
## Random effects:
##  Formula: ~1 | repID
##         (Intercept) Residual
## StdDev:   0.6254456 1.557716
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~invwt 
## Fixed effects: total.flowers ~ flowering * rtu * treatment + flowers.pot + het.annual.floral.density +      het.shrub.blooming.neighbours + offset(log(dec.Length)) 
##                                                Value Std.Error   DF
## (Intercept)                                -0.979401      0.31 1239
## floweringbloom                             -2.170939      0.60 1239
## rtubombylid                                -1.386294      0.44 1239
## rtuhoneybee                               -27.099837  91448.63 1239
## rtulep                                     -4.158883      1.59 1239
## rtuother                                   -0.115832      0.29 1239
## rtusyrphid                                  1.435828      0.22 1239
## treatmentshrub                             -1.087439      0.43  120
## flowers.pot                                 0.074602      0.02 1239
## het.annual.floral.density                   0.028843      0.02 1239
## het.shrub.blooming.neighbours              -0.073878      0.04 1239
## floweringbloom:rtubombylid                  2.772589      0.76 1239
## floweringbloom:rtuhoneybee                  2.045460 130440.74 1239
## floweringbloom:rtulep                       4.969813      1.72 1239
## floweringbloom:rtuother                     2.255898      0.65 1239
## floweringbloom:rtusyrphid                  -0.424227      0.69 1239
## floweringbloom:treatmentshrub               1.620544      0.83 1239
## rtubombylid:treatmentshrub                  1.486378      0.66 1239
## rtuhoneybee:treatmentshrub                 26.457983  91448.63 1239
## rtulep:treatmentshrub                       1.214444      2.26 1239
## rtuother:treatmentshrub                     0.834954      0.53 1239
## rtusyrphid:treatmentshrub                   0.749631      0.44 1239
## floweringbloom:rtubombylid:treatmentshrub  -2.718522      1.10 1239
## floweringbloom:rtuhoneybee:treatmentshrub -26.999103 164084.54 1239
## floweringbloom:rtulep:treatmentshrub       -2.207696      2.45 1239
## floweringbloom:rtuother:treatmentshrub     -1.349053      0.93 1239
## floweringbloom:rtusyrphid:treatmentshrub   -2.454380      1.11 1239
##                                             t-value p-value
## (Intercept)                               -3.188597  0.0015
## floweringbloom                            -3.628790  0.0003
## rtubombylid                               -3.152829  0.0017
## rtuhoneybee                               -0.000296  0.9998
## rtulep                                    -2.623312  0.0088
## rtuother                                  -0.404299  0.6861
## rtusyrphid                                 6.562759  0.0000
## treatmentshrub                            -2.529903  0.0127
## flowers.pot                                3.431012  0.0006
## het.annual.floral.density                  1.726618  0.0845
## het.shrub.blooming.neighbours             -1.771301  0.0768
## floweringbloom:rtubombylid                 3.640573  0.0003
## floweringbloom:rtuhoneybee                 0.000016  1.0000
## floweringbloom:rtulep                      2.888562  0.0039
## floweringbloom:rtuother                    3.449004  0.0006
## floweringbloom:rtusyrphid                 -0.619005  0.5360
## floweringbloom:treatmentshrub              1.953852  0.0509
## rtubombylid:treatmentshrub                 2.237183  0.0255
## rtuhoneybee:treatmentshrub                 0.000289  0.9998
## rtulep:treatmentshrub                      0.536803  0.5915
## rtuother:treatmentshrub                    1.589935  0.1121
## rtusyrphid:treatmentshrub                  1.707432  0.0880
## floweringbloom:rtubombylid:treatmentshrub -2.470281  0.0136
## floweringbloom:rtuhoneybee:treatmentshrub -0.000165  0.9999
## floweringbloom:rtulep:treatmentshrub      -0.899880  0.3684
## floweringbloom:rtuother:treatmentshrub    -1.447750  0.1479
## floweringbloom:rtusyrphid:treatmentshrub  -2.210122  0.0273
##  Correlation: 
##                                           (Intr) flwrng rtbmby rthnyb
## floweringbloom                            -0.182                     
## rtubombylid                               -0.286  0.147              
## rtuhoneybee                                0.000  0.000  0.000       
## rtulep                                    -0.079  0.041  0.055  0.000
## rtuother                                  -0.439  0.226  0.307  0.000
## rtusyrphid                                -0.575  0.295  0.402  0.000
## treatmentshrub                            -0.357  0.157  0.205  0.000
## flowers.pot                               -0.702 -0.045  0.000  0.000
## het.annual.floral.density                 -0.211  0.048  0.000  0.000
## het.shrub.blooming.neighbours              0.017 -0.135  0.000  0.000
## floweringbloom:rtubombylid                 0.165 -0.764 -0.577  0.000
## floweringbloom:rtuhoneybee                 0.000  0.000  0.000 -0.701
## floweringbloom:rtulep                      0.073 -0.338 -0.051  0.000
## floweringbloom:rtuother                    0.192 -0.889 -0.134  0.000
## floweringbloom:rtusyrphid                  0.184 -0.849 -0.128  0.000
## floweringbloom:treatmentshrub              0.150 -0.702 -0.106  0.000
## rtubombylid:treatmentshrub                 0.189 -0.097 -0.662  0.000
## rtuhoneybee:treatmentshrub                 0.000  0.000  0.000 -1.000
## rtulep:treatmentshrub                      0.056 -0.029 -0.039  0.000
## rtuother:treatmentshrub                    0.240 -0.123 -0.167  0.000
## rtusyrphid:treatmentshrub                  0.287 -0.147 -0.200  0.000
## floweringbloom:rtubombylid:treatmentshrub -0.114  0.529  0.400  0.000
## floweringbloom:rtuhoneybee:treatmentshrub  0.000  0.000  0.000  0.557
## floweringbloom:rtulep:treatmentshrub      -0.051  0.237  0.036  0.000
## floweringbloom:rtuother:treatmentshrub    -0.135  0.624  0.094  0.000
## floweringbloom:rtusyrphid:treatmentshrub  -0.113  0.524  0.079  0.000
##                                           rtulep rtuthr rtsyrp trtmnt
## floweringbloom                                                       
## rtubombylid                                                          
## rtuhoneybee                                                          
## rtulep                                                               
## rtuother                                   0.085                     
## rtusyrphid                                 0.111  0.617              
## treatmentshrub                             0.057  0.314  0.411       
## flowers.pot                                0.000  0.000  0.000  0.005
## het.annual.floral.density                  0.000  0.000  0.000  0.004
## het.shrub.blooming.neighbours              0.000  0.000  0.000 -0.022
## floweringbloom:rtubombylid                -0.032 -0.177 -0.232 -0.118
## floweringbloom:rtuhoneybee                 0.000  0.000  0.000  0.000
## floweringbloom:rtulep                     -0.921 -0.078 -0.103 -0.052
## floweringbloom:rtuother                   -0.037 -0.438 -0.270 -0.138
## floweringbloom:rtusyrphid                 -0.036 -0.197 -0.319 -0.131
## floweringbloom:treatmentshrub             -0.029 -0.163 -0.213 -0.478
## rtubombylid:treatmentshrub                -0.037 -0.203 -0.266 -0.591
## rtuhoneybee:treatmentshrub                 0.000  0.000  0.000  0.000
## rtulep:treatmentshrub                     -0.701 -0.060 -0.078 -0.174
## rtuother:treatmentshrub                   -0.046 -0.546 -0.337 -0.748
## rtusyrphid:treatmentshrub                 -0.056 -0.307 -0.498 -0.895
## floweringbloom:rtubombylid:treatmentshrub  0.022  0.123  0.161  0.357
## floweringbloom:rtuhoneybee:treatmentshrub  0.000  0.000  0.000  0.000
## floweringbloom:rtulep:treatmentshrub       0.646  0.055  0.072  0.160
## floweringbloom:rtuother:treatmentshrub     0.026  0.307  0.190  0.422
## floweringbloom:rtusyrphid:treatmentshrub   0.022  0.122  0.197  0.354
##                                           flwrs. ht.n.. ht.s..
## floweringbloom                                                
## rtubombylid                                                   
## rtuhoneybee                                                   
## rtulep                                                        
## rtuother                                                      
## rtusyrphid                                                    
## treatmentshrub                                                
## flowers.pot                                                   
## het.annual.floral.density                  0.170              
## het.shrub.blooming.neighbours             -0.087 -0.098       
## floweringbloom:rtubombylid                 0.000  0.000  0.000
## floweringbloom:rtuhoneybee                 0.000  0.000  0.000
## floweringbloom:rtulep                      0.000  0.000  0.000
## floweringbloom:rtuother                    0.000  0.000  0.000
## floweringbloom:rtusyrphid                  0.000  0.000  0.000
## floweringbloom:treatmentshrub              0.009  0.005 -0.021
## rtubombylid:treatmentshrub                 0.000  0.000  0.000
## rtuhoneybee:treatmentshrub                 0.000  0.000  0.000
## rtulep:treatmentshrub                      0.000  0.000  0.000
## rtuother:treatmentshrub                    0.000  0.000  0.000
## rtusyrphid:treatmentshrub                  0.000  0.000  0.000
## floweringbloom:rtubombylid:treatmentshrub  0.000  0.000  0.000
## floweringbloom:rtuhoneybee:treatmentshrub  0.000  0.000  0.000
## floweringbloom:rtulep:treatmentshrub       0.000  0.000  0.000
## floweringbloom:rtuother:treatmentshrub     0.000  0.000  0.000
## floweringbloom:rtusyrphid:treatmentshrub   0.000  0.000  0.000
##                                           flwrngblm:rtb flwrngblm:rth
## floweringbloom                                                       
## rtubombylid                                                          
## rtuhoneybee                                                          
## rtulep                                                               
## rtuother                                                             
## rtusyrphid                                                           
## treatmentshrub                                                       
## flowers.pot                                                          
## het.annual.floral.density                                            
## het.shrub.blooming.neighbours                                        
## floweringbloom:rtubombylid                                           
## floweringbloom:rtuhoneybee                 0.000                     
## floweringbloom:rtulep                      0.266         0.000       
## floweringbloom:rtuother                    0.699         0.000       
## floweringbloom:rtusyrphid                  0.667         0.000       
## floweringbloom:treatmentshrub              0.551         0.000       
## rtubombylid:treatmentshrub                 0.382         0.000       
## rtuhoneybee:treatmentshrub                 0.000         0.701       
## rtulep:treatmentshrub                      0.022         0.000       
## rtuother:treatmentshrub                    0.097         0.000       
## rtusyrphid:treatmentshrub                  0.116         0.000       
## floweringbloom:rtubombylid:treatmentshrub -0.692         0.000       
## floweringbloom:rtuhoneybee:treatmentshrub  0.000        -0.795       
## floweringbloom:rtulep:treatmentshrub      -0.186         0.000       
## floweringbloom:rtuother:treatmentshrub    -0.490         0.000       
## floweringbloom:rtusyrphid:treatmentshrub  -0.411         0.000       
##                                           flwrngblm:rtl flwrngblm:rtt
## floweringbloom                                                       
## rtubombylid                                                          
## rtuhoneybee                                                          
## rtulep                                                               
## rtuother                                                             
## rtusyrphid                                                           
## treatmentshrub                                                       
## flowers.pot                                                          
## het.annual.floral.density                                            
## het.shrub.blooming.neighbours                                        
## floweringbloom:rtubombylid                                           
## floweringbloom:rtuhoneybee                                           
## floweringbloom:rtulep                                                
## floweringbloom:rtuother                    0.309                     
## floweringbloom:rtusyrphid                  0.295         0.776       
## floweringbloom:treatmentshrub              0.244         0.641       
## rtubombylid:treatmentshrub                 0.034         0.089       
## rtuhoneybee:treatmentshrub                 0.000         0.000       
## rtulep:treatmentshrub                      0.646         0.026       
## rtuother:treatmentshrub                    0.043         0.239       
## rtusyrphid:treatmentshrub                  0.051         0.135       
## floweringbloom:rtubombylid:treatmentshrub -0.184        -0.483       
## floweringbloom:rtuhoneybee:treatmentshrub  0.000         0.000       
## floweringbloom:rtulep:treatmentshrub      -0.701        -0.217       
## floweringbloom:rtuother:treatmentshrub    -0.217        -0.702       
## floweringbloom:rtusyrphid:treatmentshrub  -0.182        -0.479       
##                                           flwrngblm:rts flwrngblm:t rtbmb:
## floweringbloom                                                            
## rtubombylid                                                               
## rtuhoneybee                                                               
## rtulep                                                                    
## rtuother                                                                  
## rtusyrphid                                                                
## treatmentshrub                                                            
## flowers.pot                                                               
## het.annual.floral.density                                                 
## het.shrub.blooming.neighbours                                             
## floweringbloom:rtubombylid                                                
## floweringbloom:rtuhoneybee                                                
## floweringbloom:rtulep                                                     
## floweringbloom:rtuother                                                   
## floweringbloom:rtusyrphid                                                 
## floweringbloom:treatmentshrub              0.612                          
## rtubombylid:treatmentshrub                 0.085         0.307            
## rtuhoneybee:treatmentshrub                 0.000         0.000       0.000
## rtulep:treatmentshrub                      0.025         0.090       0.112
## rtuother:treatmentshrub                    0.107         0.388       0.484
## rtusyrphid:treatmentshrub                  0.159         0.464       0.579
## floweringbloom:rtubombylid:treatmentshrub -0.461        -0.750      -0.604
## floweringbloom:rtuhoneybee:treatmentshrub  0.000         0.000       0.000
## floweringbloom:rtulep:treatmentshrub      -0.207        -0.336      -0.104
## floweringbloom:rtuother:treatmentshrub    -0.545        -0.886      -0.273
## floweringbloom:rtusyrphid:treatmentshrub  -0.617        -0.743      -0.229
##                                           rthny: rtlp:t rtthr: rtsyr:
## floweringbloom                                                       
## rtubombylid                                                          
## rtuhoneybee                                                          
## rtulep                                                               
## rtuother                                                             
## rtusyrphid                                                           
## treatmentshrub                                                       
## flowers.pot                                                          
## het.annual.floral.density                                            
## het.shrub.blooming.neighbours                                        
## floweringbloom:rtubombylid                                           
## floweringbloom:rtuhoneybee                                           
## floweringbloom:rtulep                                                
## floweringbloom:rtuother                                              
## floweringbloom:rtusyrphid                                            
## floweringbloom:treatmentshrub                                        
## rtubombylid:treatmentshrub                                           
## rtuhoneybee:treatmentshrub                                           
## rtulep:treatmentshrub                      0.000                     
## rtuother:treatmentshrub                    0.000  0.142              
## rtusyrphid:treatmentshrub                  0.000  0.170  0.733       
## floweringbloom:rtubombylid:treatmentshrub  0.000 -0.068 -0.292 -0.350
## floweringbloom:rtuhoneybee:treatmentshrub -0.557  0.000  0.000  0.000
## floweringbloom:rtulep:treatmentshrub       0.000 -0.922 -0.131 -0.157
## floweringbloom:rtuother:treatmentshrub     0.000 -0.080 -0.564 -0.413
## floweringbloom:rtusyrphid:treatmentshrub   0.000 -0.067 -0.290 -0.395
##                                           flwrngblm:rtb: flwrngblm:rth:
## floweringbloom                                                         
## rtubombylid                                                            
## rtuhoneybee                                                            
## rtulep                                                                 
## rtuother                                                               
## rtusyrphid                                                             
## treatmentshrub                                                         
## flowers.pot                                                            
## het.annual.floral.density                                              
## het.shrub.blooming.neighbours                                          
## floweringbloom:rtubombylid                                             
## floweringbloom:rtuhoneybee                                             
## floweringbloom:rtulep                                                  
## floweringbloom:rtuother                                                
## floweringbloom:rtusyrphid                                              
## floweringbloom:treatmentshrub                                          
## rtubombylid:treatmentshrub                                             
## rtuhoneybee:treatmentshrub                                             
## rtulep:treatmentshrub                                                  
## rtuother:treatmentshrub                                                
## rtusyrphid:treatmentshrub                                              
## floweringbloom:rtubombylid:treatmentshrub                              
## floweringbloom:rtuhoneybee:treatmentshrub  0.000                       
## floweringbloom:rtulep:treatmentshrub       0.254          0.000        
## floweringbloom:rtuother:treatmentshrub     0.667          0.000        
## floweringbloom:rtusyrphid:treatmentshrub   0.560          0.000        
##                                           flwrngblm:rtl: flwrngblm:rtt:
## floweringbloom                                                         
## rtubombylid                                                            
## rtuhoneybee                                                            
## rtulep                                                                 
## rtuother                                                               
## rtusyrphid                                                             
## treatmentshrub                                                         
## flowers.pot                                                            
## het.annual.floral.density                                              
## het.shrub.blooming.neighbours                                          
## floweringbloom:rtubombylid                                             
## floweringbloom:rtuhoneybee                                             
## floweringbloom:rtulep                                                  
## floweringbloom:rtuother                                                
## floweringbloom:rtusyrphid                                              
## floweringbloom:treatmentshrub                                          
## rtubombylid:treatmentshrub                                             
## rtuhoneybee:treatmentshrub                                             
## rtulep:treatmentshrub                                                  
## rtuother:treatmentshrub                                                
## rtusyrphid:treatmentshrub                                              
## floweringbloom:rtubombylid:treatmentshrub                              
## floweringbloom:rtuhoneybee:treatmentshrub                              
## floweringbloom:rtulep:treatmentshrub                                   
## floweringbloom:rtuother:treatmentshrub     0.299                       
## floweringbloom:rtusyrphid:treatmentshrub   0.251          0.661        
## 
## Standardized Within-Group Residuals:
##           Min            Q1           Med            Q3           Max 
## -3.094915e+00 -3.957152e-01 -2.342040e-01 -1.979457e-13  1.295935e+01 
## 
## Number of Observations: 1386
## Number of Groups: 122</code></pre>
<pre class="r"><code>car::Anova(mFullPQv, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III tests)
## 
## Response: total.flowers
##                                  Chisq Df Pr(&gt;Chisq)    
## (Intercept)                    10.3691  1  0.0012814 ** 
## flowering                      13.4297  1  0.0002477 ***
## rtu                           122.2774  5  &lt; 2.2e-16 ***
## treatment                       6.5276  1  0.0106215 *  
## flowers.pot                    12.0057  1  0.0005304 ***
## het.annual.floral.density       3.0404  1  0.0812140 .  
## het.shrub.blooming.neighbours   3.1998  1  0.0736454 .  
## flowering:rtu                  56.2173  5  7.331e-11 ***
## flowering:treatment             3.8934  1  0.0484767 *  
## rtu:treatment                   5.5265  5  0.3550496    
## flowering:rtu:treatment         8.0131  5  0.1555130    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>mQ &lt;- MASS::glmmPQL(total.flowers~flowering * rtu + treatment + flowers.pot + offset(log(dec.Length)), random = ~1|repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>summary(mQ)</code></pre>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##  Data: byrtu 
##   AIC BIC logLik
##    NA  NA     NA
## 
## Random effects:
##  Formula: ~1 | repID
##         (Intercept) Residual
## StdDev:   0.5928136 1.756631
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~invwt 
## Fixed effects: total.flowers ~ flowering * rtu + treatment + flowers.pot + offset(log(dec.Length)) 
##                                 Value Std.Error   DF   t-value p-value
## (Intercept)                 -1.065088      0.31 1276 -3.402195  0.0007
## floweringbloom              -1.729417      0.44 1276 -3.913995  0.0001
## rtubombylid                 -0.807923      0.35 1276 -2.315110  0.0208
## rtuhoneybee                 -2.116256      0.59 1276 -3.581115  0.0004
## rtulep                      -3.725693      1.26 1276 -2.949200  0.0032
## rtuother                     0.145508      0.26 1276  0.549903  0.5825
## rtusyrphid                   1.663378      0.21 1276  7.870473  0.0000
## treatmentshrub              -0.337480      0.17  120 -2.036839  0.0439
## flowers.pot                  0.064325      0.02 1276  2.792144  0.0053
## floweringbloom:rtubombylid   1.683391      0.59 1276  2.876219  0.0041
## floweringbloom:rtuhoneybee -23.267473  77838.03 1276 -0.000299  0.9998
## floweringbloom:rtulep        4.131159      1.36 1276  3.032681  0.0025
## floweringbloom:rtuother      1.749109      0.50 1276  3.503232  0.0005
## floweringbloom:rtusyrphid   -1.326906      0.56 1276 -2.376259  0.0176
##  Correlation: 
##                            (Intr) flwrng rtbmby rthnyb rtulep rtuthr
## floweringbloom             -0.216                                   
## rtubombylid                -0.344  0.244                            
## rtuhoneybee                -0.203  0.144  0.182                     
## rtulep                     -0.095  0.067  0.085  0.050              
## rtuother                   -0.453  0.321  0.407  0.240  0.112       
## rtusyrphid                 -0.568  0.402  0.509  0.301  0.141  0.671
## treatmentshrub             -0.257 -0.003  0.000  0.000  0.000  0.000
## flowers.pot                -0.723 -0.080  0.000  0.000  0.000  0.000
## floweringbloom:rtubombylid  0.205 -0.748 -0.596 -0.109 -0.051 -0.242
## floweringbloom:rtuhoneybee  0.000  0.000  0.000  0.000  0.000  0.000
## floweringbloom:rtulep       0.088 -0.321 -0.079 -0.047 -0.927 -0.104
## floweringbloom:rtuother     0.240 -0.877 -0.216 -0.127 -0.060 -0.530
## floweringbloom:rtusyrphid   0.215 -0.784 -0.193 -0.114 -0.053 -0.254
##                            rtsyrp trtmnt flwrs. flwrngblm:rtb
## floweringbloom                                               
## rtubombylid                                                  
## rtuhoneybee                                                  
## rtulep                                                       
## rtuother                                                     
## rtusyrphid                                                   
## treatmentshrub              0.000                            
## flowers.pot                 0.000  0.024                     
## floweringbloom:rtubombylid -0.304  0.000  0.000              
## floweringbloom:rtuhoneybee  0.000  0.000  0.000  0.000       
## floweringbloom:rtulep      -0.130  0.000  0.000  0.243       
## floweringbloom:rtuother    -0.356  0.000  0.000  0.662       
## floweringbloom:rtusyrphid  -0.378  0.000  0.000  0.592       
##                            flwrngblm:rth flwrngblm:rtl flwrngblm:rtt
## floweringbloom                                                      
## rtubombylid                                                         
## rtuhoneybee                                                         
## rtulep                                                              
## rtuother                                                            
## rtusyrphid                                                          
## treatmentshrub                                                      
## flowers.pot                                                         
## floweringbloom:rtubombylid                                          
## floweringbloom:rtuhoneybee                                          
## floweringbloom:rtulep       0.000                                   
## floweringbloom:rtuother     0.000         0.284                     
## floweringbloom:rtusyrphid   0.000         0.254         0.694       
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -2.58297328 -0.35124351 -0.22054878 -0.04730295 16.81942078 
## 
## Number of Observations: 1410
## Number of Groups: 122</code></pre>
<pre class="r"><code>lsmeans(mQ, pairwise~flowering|rtu, adjust = &quot;Tukey&quot;)</code></pre>
<pre><code>## $lsmeans
## rtu = bee:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre        -0.3116507 2.030589e-01 120 -7.136932e-01  9.039172e-02
##  bloom      -2.0410676 4.003113e-01 120 -2.833656e+00 -1.248479e+00
## 
## rtu = bombylid:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre        -1.1195734 2.965087e-01 120 -1.706640e+00 -5.325068e-01
##  bloom      -1.1655989 2.633352e-01 120 -1.686984e+00 -6.442135e-01
## 
## rtu = honeybee:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre        -2.4279062 5.615623e-01 120 -3.539761e+00 -1.316052e+00
##  bloom     -27.4247964 7.783803e+04 120 -1.541413e+05  1.540865e+05
## 
## rtu = lep:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre        -4.0373442 1.249813e+00 120 -6.511886e+00 -1.562802e+00
##  bloom      -1.6356025 3.290960e-01 120 -2.287190e+00 -9.840153e-01
## 
## rtu = other:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre        -0.1661432 1.901261e-01 120 -5.425796e-01  2.102933e-01
##  bloom      -0.1464508 1.668773e-01 120 -4.768563e-01  1.839547e-01
## 
## rtu = syrphid:
##  flowering      lsmean           SE  df      lower.CL      upper.CL
##  pre         1.3517276 1.039138e-01 120  1.145986e+00  1.557470e+00
##  bloom      -1.7045954 3.401836e-01 120 -2.378135e+00 -1.031055e+00
## 
## Results are averaged over the levels of: treatment 
## Results are given on the log (not the response) scale. 
## Confidence level used: 0.95 
## 
## $contrasts
## rtu = bee:
##  contrast       estimate           SE   df t.ratio p.value
##  pre - bloom  1.72941690 4.418547e-01 1276   3.914  0.0001
## 
## rtu = bombylid:
##  contrast       estimate           SE   df t.ratio p.value
##  pre - bloom  0.04602546 3.886082e-01 1276   0.118  0.9057
## 
## rtu = honeybee:
##  contrast       estimate           SE   df t.ratio p.value
##  pre - bloom 24.99689016 7.783803e+04 1276   0.000  0.9997
## 
## rtu = lep:
##  contrast       estimate           SE   df t.ratio p.value
##  pre - bloom -2.40174164 1.289996e+00 1276  -1.862  0.0629
## 
## rtu = other:
##  contrast       estimate           SE   df t.ratio p.value
##  pre - bloom -0.01969237 2.403112e-01 1276  -0.082  0.9347
## 
## rtu = syrphid:
##  contrast       estimate           SE   df t.ratio p.value
##  pre - bloom  3.05632296 3.468089e-01 1276   8.813  &lt;.0001
## 
## Results are averaged over the levels of: treatment 
## Results are given on the log (not the response) scale.</code></pre>
<pre class="r"><code>car::Anova(mQ, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III tests)
## 
## Response: total.flowers
##                  Chisq Df Pr(&gt;Chisq)    
## (Intercept)    11.6910  1   0.000628 ***
## flowering      15.4730  1  8.369e-05 ***
## rtu           197.0575  5  &lt; 2.2e-16 ***
## treatment       4.1903  1   0.040655 *  
## flowers.pot     7.8743  1   0.005014 ** 
## flowering:rtu  70.0222  5  1.014e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>mQt &lt;- MASS::glmmPQL(total.flowers~treatment * rtu + flowering + flowers.pot + offset(log(dec.Length)), random = ~1|repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>summary(mQt)</code></pre>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##  Data: byrtu 
##   AIC BIC logLik
##    NA  NA     NA
## 
## Random effects:
##  Formula: ~1 | repID
##         (Intercept) Residual
## StdDev:   0.5750516 1.846181
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~invwt 
## Fixed effects: total.flowers ~ treatment * rtu + flowering + flowers.pot + offset(log(dec.Length)) 
##                                 Value Std.Error   DF   t-value p-value
## (Intercept)                 -1.013293      0.33 1276 -3.048126  0.0024
## treatmentshrub              -0.768393      0.41  120 -1.855772  0.0659
## rtubombylid                 -0.405465      0.35 1276 -1.172759  0.2411
## rtuhoneybee                -26.651751  81279.74 1276 -0.000328  0.9997
## rtulep                      -1.280934      0.47 1276 -2.731322  0.0064
## rtuother                     0.567521      0.27 1276  2.073396  0.0383
## rtusyrphid                   1.396657      0.24 1276  5.718842  0.0000
## floweringbloom              -1.247982      0.14 1276 -8.751229  0.0000
## flowers.pot                  0.063954      0.02 1276  2.693338  0.0072
## treatmentshrub:rtubombylid   0.582396      0.57 1276  1.023756  0.3061
## treatmentshrub:rtuhoneybee  25.520349  81279.74 1276  0.000314  0.9997
## treatmentshrub:rtulep        0.331853      0.79 1276  0.422179  0.6730
## treatmentshrub:rtuother      0.623465      0.47 1276  1.330074  0.1837
## treatmentshrub:rtusyrphid    0.334142      0.44 1276  0.765836  0.4439
##  Correlation: 
##                            (Intr) trtmnt rtbmby rthnyb rtulep rtuthr
## treatmentshrub             -0.401                                   
## rtubombylid                -0.416  0.334                            
## rtuhoneybee                 0.000  0.000  0.000                     
## rtulep                     -0.307  0.246  0.295  0.000              
## rtuother                   -0.525  0.422  0.505  0.000  0.372       
## rtusyrphid                 -0.589  0.473  0.566  0.000  0.417  0.715
## floweringbloom              0.060 -0.004  0.000  0.000  0.000  0.000
## flowers.pot                -0.703  0.010  0.000  0.000  0.000  0.000
## treatmentshrub:rtubombylid  0.253 -0.674 -0.608  0.000 -0.179 -0.307
## treatmentshrub:rtuhoneybee  0.000  0.000  0.000 -1.000  0.000  0.000
## treatmentshrub:rtulep       0.183 -0.488 -0.176  0.000 -0.597 -0.222
## treatmentshrub:rtuother     0.307 -0.819 -0.295  0.000 -0.218 -0.584
## treatmentshrub:rtusyrphid   0.330 -0.879 -0.317  0.000 -0.234 -0.400
##                            rtsyrp flwrng flwrs. trtmntshrb:rtb
## treatmentshrub                                                
## rtubombylid                                                   
## rtuhoneybee                                                   
## rtulep                                                        
## rtuother                                                      
## rtusyrphid                                                    
## floweringbloom              0.000                             
## flowers.pot                 0.000 -0.250                      
## treatmentshrub:rtubombylid -0.344  0.000  0.000               
## treatmentshrub:rtuhoneybee  0.000  0.000  0.000  0.000        
## treatmentshrub:rtulep      -0.249  0.000  0.000  0.355        
## treatmentshrub:rtuother    -0.418  0.000  0.000  0.596        
## treatmentshrub:rtusyrphid  -0.560  0.000  0.000  0.640        
##                            trtmntshrb:rth trtmntshrb:rtl trtmntshrb:rtt
## treatmentshrub                                                         
## rtubombylid                                                            
## rtuhoneybee                                                            
## rtulep                                                                 
## rtuother                                                               
## rtusyrphid                                                             
## floweringbloom                                                         
## flowers.pot                                                            
## treatmentshrub:rtubombylid                                             
## treatmentshrub:rtuhoneybee                                             
## treatmentshrub:rtulep       0.000                                      
## treatmentshrub:rtuother     0.000          0.431                       
## treatmentshrub:rtusyrphid   0.000          0.463          0.777        
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -2.1365223 -0.3818842 -0.2169337 -0.0918830 13.5691480 
## 
## Number of Observations: 1410
## Number of Groups: 122</code></pre>
<pre class="r"><code>#RTU by microsite not significant



#treatment not significant, pairwaise constrast for syrphids is</code></pre>
<pre class="r"><code>str(byrtu)</code></pre>
<pre><code>## &#39;data.frame&#39;:    1410 obs. of  23 variables:
##  $ X                             : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ PlantID                       : Factor w/ 61 levels &quot;104&quot;,&quot;114&quot;,&quot;146&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ treatment                     : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 1 1 1 1 1 1 2 2 2 2 ...
##  $ flowering                     : Factor w/ 2 levels &quot;pre&quot;,&quot;bloom&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Date                          : Factor w/ 20 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ TimeOut                       : Factor w/ 99 levels &quot;&quot;,&quot;10:48&quot;,&quot;10:57&quot;,..: 58 58 58 58 58 58 58 58 58 58 ...
##  $ flowers.shrub                 : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ flowers.pot                   : int  18 18 18 18 18 18 11 11 11 11 ...
##  $ het.shrub.blooming.neighbours : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ het.cactus.blooming.neighbours: int  0 0 0 0 0 0 0 0 0 0 ...
##  $ understory.richness           : int  5 5 5 5 5 5 3 3 3 3 ...
##  $ het.annual.floral.density     : int  0 0 0 0 0 0 1 1 1 1 ...
##  $ understory.assoc              : Factor w/ 11 levels &quot;&quot;,&quot;?&quot;,&quot;acamp&quot;,..: 8 8 8 8 8 8 8 8 8 8 ...
##  $ uniID                         : Factor w/ 235 levels &quot;LO14.10.2017&quot;,..: 1 1 1 1 1 1 117 117 117 117 ...
##  $ rtu                           : Factor w/ 6 levels &quot;bee&quot;,&quot;bombylid&quot;,..: 6 1 5 2 4 3 6 1 5 2 ...
##  $ total.visits                  : int  18 2 0 0 0 0 6 1 0 0 ...
##  $ total.flowers                 : int  35 5 0 0 0 0 8 2 0 0 ...
##  $ Length                        : Factor w/ 225 levels &quot;0:31:34&quot;,&quot;0:32:53&quot;,..: 120 120 120 120 120 120 185 185 185 185 ...
##  $ pos.Length                    : Factor w/ 225 levels &quot;2019-02-28 00:31:34&quot;,..: 120 120 120 120 120 120 185 185 185 185 ...
##  $ dec.Length                    : num  1.38 1.38 1.38 1.38 1.38 ...
##  $ visits.per.hour               : num  13.04 1.45 0 0 0 ...
##  $ flowers.per.hour              : num  25.35 3.62 0 0 0 ...
##  $ repID                         : chr  &quot;146 open&quot; &quot;146 open&quot; &quot;146 open&quot; &quot;146 open&quot; ...</code></pre>
<pre class="r"><code>p &lt;- byrtu %&gt;% group_by(treatment, flowering, rtu) %&gt;% dplyr::summarise(visits = sum(flowers.per.hour))

ggplot(p, aes(treatment, visits)) + geom_bar(aes(fill = rtu), stat = &quot;identity&quot;, colour = &quot;black&quot;) + facet_grid(~flowering, labeller=labeller(flowering = labels))+ theme_Publication() + xlab(&quot;Microsite&quot;) + ylab(&quot;Total Flowers Visited&quot;) + labs(fill=&quot;&quot;) + theme(legend.text = element_text(size = 16))  + scale_fill_brewer(palette= &quot;Spectral&quot;) + scale_fill_manual(&quot;&quot;, values = c(&quot;bee&quot; =&quot;#D53E4F&quot;, &quot;bombylid&quot;= &quot;#FC8D59&quot;, &quot;honeybee&quot;= &quot;#FEE08B&quot;, &quot;lep&quot;= &quot;#D3D3D3&quot;, &quot;other&quot;= &quot;#99D594&quot;, &quot;syrphid&quot; = &quot;#3288BD&quot;), labels = c(&quot;Solitary Bee&quot;, &quot;Bombyliidae&quot;, &quot;Honeybee&quot;, &quot;Lepidoptera&quot;, &quot;Other&quot;, &quot;Syrphidae&quot;))</code></pre>
<pre><code>## 
## Attaching package: &#39;ggthemes&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:cowplot&#39;:
## 
##     theme_map</code></pre>
<pre><code>## Scale for &#39;fill&#39; is already present. Adding another scale for &#39;fill&#39;,
## which will replace the existing scale.</code></pre>
<p><img src="index_files/figure-html/rtu%20plots-1.png" width="672" /></p>
</div>
<div id="visit-duration" class="section level3">
<h3>Visit duration</h3>
<pre class="r"><code>byobs &lt;- read.csv(&quot;Output Data/byobs_cleaned.csv&quot;)

#observation level rtu data. Need to join simplified rtu to data sheet
cov &lt;- read.csv(&quot;Clean Data/video_cov.csv&quot;)
#rtu.key &lt;- read.csv(&quot;Clean Data/video_rtu_key.csv&quot;)
cov$uniID &lt;- paste(cov$Cam, cov$Date)
cov$uniID &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, cov$uniID)

rtu.data &lt;- right_join(cov, byobs, by = &quot;uniID&quot;)</code></pre>
<pre><code>## Warning: Column `uniID` joining character vector and factor, coercing into
## character vector</code></pre>
<pre class="r"><code>rtu.data &lt;- dplyr::select(rtu.data, plant.id, microsite, flowering.x, video.date, video.length, flower.fov, flowers.pot, total.time, flowers.visits, unique.fl.visited, uniID, dec.total.time)                    
rtu.data$repID &lt;- paste(rtu.data$plant.id, rtu.data$microsite)
rtu.data$microsite &lt;-as.factor(rtu.data$microsite)
rtu.data$microsite &lt;- relevel(rtu.data$microsite, &quot;open&quot;)
rtu.data$flowering &lt;- relevel(rtu.data$flowering, &quot;pre&quot;)
rtu.data$flowers.pot &lt;- as.numeric(as.character(rtu.data$flowers.pot))
#count.rtu.fl &lt;- rtu.data %&gt;% group_by(uniID, rtu.ag) %&gt;% summarise(total.flowers = sum(flowers.visits), total.visits = n()) 

#viz. dec.total.time is the visit duration
ggplot(rtu.data, aes(microsite, dec.total.time)) + geom_boxplot() + facet_grid(~flowering)</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="index_files/figure-html/duration%20models-1.png" width="672" /></p>
<pre class="r"><code>ggplot(rtu.data, aes(flowering, dec.total.time)) + geom_boxplot() + facet_grid(~microsite)</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="index_files/figure-html/duration%20models-2.png" width="672" /></p>
<pre class="r"><code>ggplot(rtu.data, aes(dec.total.time)) + geom_density()</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/duration%20models-3.png" width="672" /></p>
<pre class="r"><code>#using gamma because continuous and positive, looks like it fits 

m1 &lt;- glmmTMB(dec.total.time ~ flowering + microsite + flowers.pot + (1|repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)
summary(m1)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          
## dec.total.time ~ flowering + microsite + flowers.pot + (1 | repID)
## Data: rtu.data
## 
##      AIC      BIC   logLik deviance df.resid 
##  -3615.5  -3588.2   1813.7  -3627.5      690 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.9557   0.9776  
## Number of obs: 696, groups:  repID, 118
## 
## Dispersion estimate for Gamma family (sigma^2): 2.02 
## 
## Conditional model:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -3.266345   0.338994  -9.635  &lt; 2e-16 ***
## floweringbloom -0.762337   0.173090  -4.404 1.06e-05 ***
## micrositeshrub -0.023523   0.234480  -0.100    0.920    
## flowers.pot    -0.001618   0.030370  -0.053    0.958    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type =2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: dec.total.time
##               Chisq Df Pr(&gt;Chisq)    
## flowering   19.3976  1  1.061e-05 ***
## microsite    0.0101  1     0.9201    
## flowers.pot  0.0028  1     0.9575    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(dec.total.time ~ flowering * microsite + flowers.pot + (1|repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)
car::Anova(m2, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: dec.total.time
##                       Chisq Df Pr(&gt;Chisq)    
## (Intercept)         93.9928  1    &lt; 2e-16 ***
## flowering            5.9349  1    0.01484 *  
## microsite            0.2376  1    0.62593    
## flowers.pot          0.0005  1    0.98279    
## flowering:microsite  2.0966  1    0.14762    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m3 &lt;- glmmTMB(dec.total.time ~ flowering + microsite + (1|repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)
car::Anova(m3, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: dec.total.time
##            Chisq Df Pr(&gt;Chisq)    
## flowering 20.143  1  7.187e-06 ***
## microsite  0.010  1     0.9204    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>null &lt;- glmmTMB(dec.total.time ~(1|repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)
anova(m1, m2, m3, null)</code></pre>
<pre><code>## Data: rtu.data
## Models:
## null: dec.total.time ~ (1 | repID), zi=~0, disp=~1
## m3: dec.total.time ~ flowering + microsite + (1 | repID), zi=~0, disp=~1
## m1: dec.total.time ~ flowering + microsite + flowers.pot + (1 | repID), zi=~0, disp=~1
## m2: dec.total.time ~ flowering * microsite + flowers.pot + (1 | repID), zi=~0, disp=~1
##      Df     AIC     BIC logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## null  3 -3602.4 -3588.7 1804.2  -3608.4                              
## m3    5 -3617.5 -3594.8 1813.7  -3627.5 19.1225      2   7.04e-05 ***
## m1    6 -3615.5 -3588.2 1813.7  -3627.5  0.0028      1     0.9575    
## m2    7 -3615.6 -3583.8 1814.8  -3629.6  2.0965      1     0.1476    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(m1, m2, m3, null)</code></pre>
<pre><code>##      df       AIC
## m1    6 -3615.485
## m2    7 -3615.581
## m3    5 -3617.482
## null  3 -3602.359</code></pre>
<pre class="r"><code>#t1 &lt;- glmmTMB(dec.total.time ~ flowering * rtu.ag  + (1|repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)
#summary(t1)
#convergence issues, not including rtu anyways

#ggplot(rtu.data, aes(microsite, dec.total.time, fill = rtu.ag)) + geom_boxplot() + facet_grid(~flowering)

labels &lt;- c(pre = &quot;Pre-blooming&quot;, post = &quot;Blooming&quot;, bloom = &quot;Blooming&quot;)

#filter(rtu.data, dec.total.time&lt;1.5) %&gt;% ggplot(aes(microsite, dec.total.time, fill = rtu.ag)) + geom_boxplot() + facet_grid(~flowering, labeller=labeller(flowering = labels)) + scale_fill_brewer(palette= &quot;Spectral&quot;) + theme_Publication() + xlab(&quot;Microsite&quot;) + ylab(&quot;Duration of visit (decimal time)&quot;) + labs(fill=&quot;&quot;) + theme(legend.text = element_text(size = 16)) + scale_fill_manual(&quot;&quot;, values = c(&quot;bee&quot; =&quot;#D53E4F&quot;, &quot;bombylid&quot;= &quot;#FC8D59&quot;, &quot;honeybee&quot;= &quot;#FEE08B&quot;, &quot;lep&quot;= &quot;#D3D3D3&quot;, &quot;other&quot;= &quot;#99D594&quot;, &quot;syrphid&quot; = &quot;#3288BD&quot;), labels = c(&quot;Solitary Bee&quot;, &quot;Bombyliidae&quot;, &quot;Honeybee&quot;, &quot;Lepidoptera&quot;, &quot;Other&quot;, &quot;Syrphidae&quot;))</code></pre>
</div>
<div id="proportion-of-unique-flowers-visited-per-foraging-instance" class="section level3">
<h3>Proportion of unique flowers visited per foraging instance</h3>
<pre class="r"><code>rtu.data &lt;- mutate(rtu.data, prop.visited = unique.fl.visited/flower.fov)

ggplot(rtu.data, aes(prop.visited, color = flowering)) + geom_density()</code></pre>
<p><img src="index_files/figure-html/proportion-1.png" width="672" /></p>
<pre class="r"><code>source(system.file(&quot;other_methods&quot;,&quot;lsmeans_methods.R&quot;,package=&quot;glmmTMB&quot;))
m1 &lt;- glmmTMB(prop.visited ~ flowering * microsite + flowers.pot + (1|repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)
summary(m1)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          
## prop.visited ~ flowering * microsite + flowers.pot + (1 | repID)
## Data: rtu.data
## 
##      AIC      BIC   logLik deviance df.resid 
##  -2211.9  -2180.1   1113.0  -2225.9      690 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.04317  0.2078  
## Number of obs: 697, groups:  repID, 118
## 
## Dispersion estimate for Gamma family (sigma^2): 0.121 
## 
## Conditional model:
##                                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   -1.455082   0.074087 -19.640   &lt;2e-16 ***
## floweringbloom                 0.015428   0.047902   0.322    0.747    
## micrositeshrub                 0.029692   0.055144   0.538    0.590    
## flowers.pot                   -0.055854   0.006584  -8.483   &lt;2e-16 ***
## floweringbloom:micrositeshrub -0.092542   0.074141  -1.248    0.212    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: prop.visited
##                        Chisq Df Pr(&gt;Chisq)    
## (Intercept)         385.7399  1     &lt;2e-16 ***
## flowering             0.1037  1     0.7474    
## microsite             0.2899  1     0.5903    
## flowers.pot          71.9668  1     &lt;2e-16 ***
## flowering:microsite   1.5580  1     0.2120    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>lsmeans(m1, pairwise~flowering*microsite)</code></pre>
<pre><code>## $lsmeans
##  flowering microsite    lsmean         SE df asymp.LCL asymp.UCL
##  pre       open      -2.023315 0.03805395 NA -2.097900 -1.948731
##  bloom     open      -2.007888 0.04700111 NA -2.100008 -1.915767
##  pre       shrub     -1.993624 0.04022685 NA -2.072467 -1.914781
##  bloom     shrub     -2.070738 0.05395316 NA -2.176485 -1.964992
## 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast                    estimate         SE df z.ratio p.value
##  pre,open - bloom,open    -0.01542768 0.04790249 NA  -0.322  0.9885
##  pre,open - pre,shrub     -0.02969173 0.05514448 NA  -0.538  0.9496
##  pre,open - bloom,shrub    0.04742293 0.06629350 NA   0.715  0.8910
##  bloom,open - pre,shrub   -0.01426404 0.06229601 NA  -0.229  0.9958
##  bloom,open - bloom,shrub  0.06285061 0.07090418 NA   0.886  0.8119
##  pre,shrub - bloom,shrub   0.07711465 0.05839133 NA   1.321  0.5497
## 
## P value adjustment: tukey method for comparing a family of 4 estimates</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(prop.visited ~ flowering + microsite + flowers.pot + (1|repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)
summary(m2)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          
## prop.visited ~ flowering + microsite + flowers.pot + (1 | repID)
## Data: rtu.data
## 
##      AIC      BIC   logLik deviance df.resid 
##  -2212.4  -2185.1   1112.2  -2224.4      691 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.04177  0.2044  
## Number of obs: 697, groups:  repID, 118
## 
## Dispersion estimate for Gamma family (sigma^2): 0.122 
## 
## Conditional model:
##                  Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -1.4354689  0.0719549 -19.950   &lt;2e-16 ***
## floweringbloom -0.0212773  0.0376365  -0.565    0.572    
## micrositeshrub  0.0002944  0.0493337   0.006    0.995    
## flowers.pot    -0.0565629  0.0065215  -8.673   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m2, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: prop.visited
##                Chisq Df Pr(&gt;Chisq)    
## (Intercept) 397.9857  1     &lt;2e-16 ***
## flowering     0.3196  1     0.5718    
## microsite     0.0000  1     0.9952    
## flowers.pot  75.2265  1     &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m2null &lt;- glmmTMB(prop.visited ~(1|repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)

anova(m1, m2, m2null)</code></pre>
<pre><code>## Data: rtu.data
## Models:
## m2null: prop.visited ~ (1 | repID), zi=~0, disp=~1
## m2: prop.visited ~ flowering + microsite + flowers.pot + (1 | repID), zi=~0, disp=~1
## m1: prop.visited ~ flowering * microsite + flowers.pot + (1 | repID), zi=~0, disp=~1
##        Df     AIC     BIC logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## m2null  3 -2142.5 -2128.9 1074.3  -2148.5                              
## m2      6 -2212.3 -2185.1 1112.2  -2224.3 75.8206      3  2.417e-16 ***
## m1      7 -2211.9 -2180.1 1113.0  -2225.9  1.5582      1     0.2119    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(m1, m2, m2null)</code></pre>
<pre><code>##        df       AIC
## m1      7 -2211.912
## m2      6 -2212.354
## m2null  3 -2142.533</code></pre>
<pre class="r"><code>ggplot(rtu.data, aes(microsite, prop.visited)) + geom_boxplot() + facet_grid(~flowering)</code></pre>
<p><img src="index_files/figure-html/proportion-2.png" width="672" /></p>
<pre class="r"><code>#ggplot(rtu.data, aes(microsite, prop.visited, fill = rtu.ag)) + geom_boxplot() + facet_grid(~flowering, labeller=labeller(flowering = labels)) + scale_fill_brewer(palette= &quot;Spectral&quot;) + theme_Publication() + xlab(&quot;Microsite&quot;) + ylab(&quot;Proportion of flowers visited&quot;) + labs(fill=&quot;&quot;) + theme(legend.text = element_text(size = 16)) + scale_fill_manual(&quot;&quot;, values = c(&quot;bee&quot; =&quot;#D53E4F&quot;, &quot;bombylid&quot;= &quot;#FC8D59&quot;, &quot;honeybee&quot;= &quot;#FEE08B&quot;, &quot;lep&quot;= &quot;#D3D3D3&quot;, &quot;other&quot;= &quot;#99D594&quot;, &quot;syrphid&quot; = &quot;#3288BD&quot;), labels = c(&quot;Solitary Bee&quot;, &quot;Bombyliidae&quot;, &quot;Honeybee&quot;, &quot;Lepidoptera&quot;, &quot;Other&quot;, &quot;Syrphidae&quot;))</code></pre>
</div>
<div id="pollen-deposition" class="section level3">
<h3>Pollen Deposition</h3>
<pre class="r"><code>counts &lt;- read.csv(&quot;Clean Data/Pollen_Corrected.csv&quot;)
cov &lt;- read.csv(&quot;Clean Data/pollen_cov.csv&quot;)
counts$X &lt;- as.numeric(as.character(counts$X))   </code></pre>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre class="r"><code>counts &lt;- counts %&gt;% replace(is.na(.), 0)
counts &lt;- counts %&gt;% mutate(all.con = rowSums(.[5:18]))
counts &lt;- select(counts, Rep:Het.Grains, all.con)                
counts.ag &lt;- counts %&gt;% group_by(Rep, Slide) %&gt;% summarise(Het = sum(Het.Grains), Con = sum(all.con))             
counts.ag &lt;- counts.ag %&gt;% mutate(., microsite = ifelse(substr(Rep,start = 1, stop = 1) == &quot;S&quot;, &quot;shrub&quot;, &quot;open&quot;))
counts.ag$Flower &lt;- substr(counts.ag$Slide, 1, 1)

sum(counts.ag$Con)</code></pre>
<pre><code>## [1] 16209</code></pre>
<pre class="r"><code>sum(counts.ag$Het)</code></pre>
<pre><code>## [1] 1719</code></pre>
<pre class="r"><code>counts.ag &lt;- right_join(counts.ag, cov, by = &quot;Rep&quot;)

#ag by flower
count.fl &lt;- counts.ag %&gt;% group_by(., Flower) %&gt;% summarise(con = sum(Con))
count.fl$f2 &lt;- count.fl$Flower

count.fl &lt;- count.fl %&gt;%
  separate(Flower, c(&quot;Rep&quot;, &quot;no&quot;), &quot; &quot;)</code></pre>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [1,
## 2, 3].</code></pre>
<pre class="r"><code>counts.fl &lt;- right_join(count.fl, cov, by = &quot;Rep&quot;)</code></pre>
<pre><code>## Warning: Column `Rep` joining character vector and factor, coercing into
## character vector</code></pre>
<pre class="r"><code>#m1 &lt;- MASS::glmmPQL(con~ d.flowers + microsite + dN1, ~1|Rep, family = quasipoisson, data = counts.fl)
#summary(m1)

ggplot(data =counts.ag,(aes(microsite.x, Con))) + geom_boxplot()</code></pre>
<p><img src="index_files/figure-html/pollen%20deposition-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data =counts.ag,(aes(microsite.x, Het))) + geom_boxplot()</code></pre>
<p><img src="index_files/figure-html/pollen%20deposition-2.png" width="672" /></p>
<pre class="r"><code>t.test(counts.ag$Con ~ counts.ag$microsite.x)</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  counts.ag$Con by counts.ag$microsite.x
## t = 1.5147, df = 221.36, p-value = 0.1313
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -3.308033 25.285395
## sample estimates:
##  mean in group open mean in group shrub 
##            75.68696            64.69828</code></pre>
<pre class="r"><code>ggplot(data = counts.ag, (aes(Con))) + geom_freqpoly()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/pollen%20deposition-3.png" width="672" /></p>
<pre class="r"><code>shapiro.test(counts.ag$Con)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  counts.ag$Con
## W = 0.82636, p-value = 2.363e-15</code></pre>
<pre class="r"><code>counts.ag$Flower &lt;- paste(counts.ag$Rep, counts.ag$Flower)
counts.ag$Sample &lt;- paste(counts.ag$Slide, counts.ag$Rep)
counts.ag$d.S &lt;- counts.ag$d.S %&gt;% replace(is.na(.), 0)

cor.test(counts.ag$Con, counts.ag$Het)</code></pre>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  counts.ag$Con and counts.ag$Het
## t = 2.3967, df = 229, p-value = 0.01735
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.02791644 0.27985733
## sample estimates:
##       cor 
## 0.1564304</code></pre>
<pre class="r"><code>mean(counts.ag$d.S)</code></pre>
<pre><code>## [1] 183.2857</code></pre>
<pre class="r"><code>mean(counts.ag$dN1)</code></pre>
<pre><code>## [1] 79.37229</code></pre>
<pre class="r"><code>mean(counts.ag$d.flowers)</code></pre>
<pre><code>## [1] 7.025974</code></pre>
<pre class="r"><code>m1 &lt;- glmmTMB(Con ~ d.flowers + dN1 + d.S + (1|Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          Con ~ d.flowers + dN1 + d.S + (1 | Rep/Flower)
## Data: counts.ag
## 
##      AIC      BIC   logLik deviance df.resid 
##   2381.5   2405.6  -1183.7   2367.5      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups     Name        Variance  Std.Dev. 
##  Flower:Rep (Intercept) 5.976e-08 0.0002445
##  Rep        (Intercept) 6.696e-02 0.2587597
## Number of obs: 231, groups:  Flower:Rep, 78; Rep, 26
## 
## Overdispersion parameter for nbinom2 family (): 2.22 
## 
## Conditional model:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) 3.9655244  0.1382528  28.683   &lt;2e-16 ***
## d.flowers   0.0080175  0.0101089   0.793    0.428    
## dN1         0.0018651  0.0012219   1.526    0.127    
## d.S         0.0001934  0.0003475   0.557    0.578    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: Con
##            Chisq Df Pr(&gt;Chisq)
## d.flowers 0.6290  1     0.4277
## dN1       2.3299  1     0.1269
## d.S       0.3099  1     0.5777</code></pre>
<pre class="r"><code>#try microsites instead

m2 &lt;- glmmTMB(Con ~ d.flowers + dN1 + (1|Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)
summary(m2)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          Con ~ d.flowers + dN1 + (1 | Rep/Flower)
## Data: counts.ag
## 
##      AIC      BIC   logLik deviance df.resid 
##   2379.8   2400.5  -1183.9   2367.8      225 
## 
## Random effects:
## 
## Conditional model:
##  Groups     Name        Variance  Std.Dev. 
##  Flower:Rep (Intercept) 9.961e-08 0.0003156
##  Rep        (Intercept) 6.877e-02 0.2622419
## Number of obs: 231, groups:  Flower:Rep, 78; Rep, 26
## 
## Overdispersion parameter for nbinom2 family (): 2.22 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) 3.993236   0.130002  30.717   &lt;2e-16 ***
## d.flowers   0.009251   0.009935   0.931    0.352    
## dN1         0.001852   0.001230   1.506    0.132    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m3 &lt;- glmmTMB(Con ~ dN1 + (1|Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)
summary(m3)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          Con ~ dN1 + (1 | Rep/Flower)
## Data: counts.ag
## 
##      AIC      BIC   logLik deviance df.resid 
##   2378.7   2395.9  -1184.3   2368.7      226 
## 
## Random effects:
## 
## Conditional model:
##  Groups     Name        Variance  Std.Dev. 
##  Flower:Rep (Intercept) 2.212e-08 0.0001487
##  Rep        (Intercept) 7.262e-02 0.2694890
## Number of obs: 231, groups:  Flower:Rep, 78; Rep, 26
## 
## Overdispersion parameter for nbinom2 family (): 2.22 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) 4.043609   0.119945   33.71   &lt;2e-16 ***
## dN1         0.002043   0.001234    1.66   0.0978 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>null &lt;- glmmTMB(Con ~ (1|Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)

AIC(m1, m2, m3, null)</code></pre>
<pre><code>##      df      AIC
## m1    7 2381.494
## m2    6 2379.803
## m3    5 2378.664
## null  4 2379.284</code></pre>
<pre class="r"><code>anova(m1, m2, m3, null)</code></pre>
<pre><code>## Data: counts.ag
## Models:
## null: Con ~ (1 | Rep/Flower), zi=~0, disp=~1
## m3: Con ~ dN1 + (1 | Rep/Flower), zi=~0, disp=~1
## m2: Con ~ d.flowers + dN1 + (1 | Rep/Flower), zi=~0, disp=~1
## m1: Con ~ d.flowers + dN1 + d.S + (1 | Rep/Flower), zi=~0, disp=~1
##      Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)
## null  4 2379.3 2393.1 -1185.6   2371.3                         
## m3    5 2378.7 2395.9 -1184.3   2368.7 2.6199      1     0.1055
## m2    6 2379.8 2400.5 -1183.9   2367.8 0.8609      1     0.3535
## m1    7 2381.5 2405.6 -1183.8   2367.5 0.3090      1     0.5783</code></pre>
<pre class="r"><code>m4 &lt;- glmmTMB(Het ~ d.flowers + dN1 + d.S + (1|Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)
summary(m4)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          Het ~ d.flowers + dN1 + d.S + (1 | Rep/Flower)
## Data: counts.ag
## 
##      AIC      BIC   logLik deviance df.resid 
##   1368.7   1392.8   -677.3   1354.7      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups     Name        Variance  Std.Dev. 
##  Flower:Rep (Intercept) 1.356e-08 0.0001164
##  Rep        (Intercept) 1.852e-01 0.4303889
## Number of obs: 231, groups:  Flower:Rep, 78; Rep, 26
## 
## Overdispersion parameter for nbinom2 family (): 2.01 
## 
## Conditional model:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.8080370  0.2068332   8.742   &lt;2e-16 ***
## d.flowers   -0.0204246  0.0150484  -1.357   0.1747    
## dN1         -0.0006012  0.0018279  -0.329   0.7422    
## d.S          0.0012235  0.0005063   2.416   0.0157 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m4, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: Het
##            Chisq Df Pr(&gt;Chisq)  
## d.flowers 1.8422  1    0.17470  
## dN1       0.1082  1    0.74223  
## d.S       5.8389  1    0.01568 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m5 &lt;- glmmTMB(Het ~ d.flowers + d.S + (1|Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)
summary(m5)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          Het ~ d.flowers + d.S + (1 | Rep/Flower)
## Data: counts.ag
## 
##      AIC      BIC   logLik deviance df.resid 
##   1366.8   1387.4   -677.4   1354.8      225 
## 
## Random effects:
## 
## Conditional model:
##  Groups     Name        Variance  Std.Dev. 
##  Flower:Rep (Intercept) 1.063e-08 0.0001031
##  Rep        (Intercept) 1.874e-01 0.4328477
## Number of obs: 231, groups:  Flower:Rep, 78; Rep, 26
## 
## Overdispersion parameter for nbinom2 family (): 2.01 
## 
## Conditional model:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.7651369  0.1611814  10.951   &lt;2e-16 ***
## d.flowers   -0.0212779  0.0148847  -1.430   0.1529    
## d.S          0.0012303  0.0005079   2.422   0.0154 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m6 &lt;- glmmTMB(Het ~ d.S + (1|Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)
summary(m6)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          Het ~ d.S + (1 | Rep/Flower)
## Data: counts.ag
## 
##      AIC      BIC   logLik deviance df.resid 
##   1366.7   1384.0   -678.4   1356.7      226 
## 
## Random effects:
## 
## Conditional model:
##  Groups     Name        Variance  Std.Dev. 
##  Flower:Rep (Intercept) 9.622e-09 9.809e-05
##  Rep        (Intercept) 2.062e-01 4.541e-01
## Number of obs: 231, groups:  Flower:Rep, 78; Rep, 26
## 
## Overdispersion parameter for nbinom2 family ():    2 
## 
## Conditional model:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) 1.6426285  0.1415421  11.605   &lt;2e-16 ***
## d.S         0.0010773  0.0005149   2.092   0.0364 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>null &lt;- glmmTMB(Het ~ (1|Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)

AIC(m4, m5, m6, null)</code></pre>
<pre><code>##      df      AIC
## m4    7 1368.661
## m5    6 1366.769
## m6    5 1366.740
## null  4 1368.697</code></pre>
<pre class="r"><code>anova(m4, m5, m6, null)</code></pre>
<pre><code>## Data: counts.ag
## Models:
## null: Het ~ (1 | Rep/Flower), zi=~0, disp=~1
## m6: Het ~ d.S + (1 | Rep/Flower), zi=~0, disp=~1
## m5: Het ~ d.flowers + d.S + (1 | Rep/Flower), zi=~0, disp=~1
## m4: Het ~ d.flowers + dN1 + d.S + (1 | Rep/Flower), zi=~0, disp=~1
##      Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)  
## null  4 1368.7 1382.5 -680.35   1360.7                           
## m6    5 1366.7 1384.0 -678.37   1356.7 3.9573      1    0.04667 *
## m5    6 1366.8 1387.4 -677.38   1354.8 1.9710      1    0.16034  
## m4    7 1368.7 1392.8 -677.33   1354.7 0.1075      1    0.74301  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>p3 &lt;- ggplot(counts.ag, aes(d.S, Con)) + geom_point(shape = 1) + geom_smooth(colour = &quot;black&quot;, size = 0.5) + geom_jitter(shape = 1) + theme_Publication() + xlab(&quot;Distance to Larrea tridentata&quot;) + ylab(&quot;Conspecific Pollen Deposition&quot;)


p4 &lt;- ggplot(counts.ag, aes(d.S, Het)) + geom_point(shape = 1) + geom_smooth(colour = &quot;black&quot;, size = 0.5) + geom_jitter(shape = 1) + theme_Publication() + xlab(&quot;Distance to Larrea tridentata&quot;) + ylab(&quot;Heterospecific Pollen Deposition&quot;)

plot_grid(p3, p4, labels = c(&quot;A&quot;, &quot;B&quot;), align = &quot;h&quot;)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="index_files/figure-html/pollen%20plots-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="community-level-effects" class="section level2">
<h2>Community level effects</h2>
<hr />
<div id="vegetation-modelling" class="section level3">
<h3>Vegetation Modelling</h3>
<p>GLMM for vegetation covariates to test for direct shrub facilitation/background flowering levels</p>
<hr />
<p>Annual Percent Cover</p>
<pre class="r"><code>visits &lt;- read.csv(&quot;Output Data/byrep_cleaned.csv&quot;)
metadata &lt;- read.csv(&quot;Output Data/metadata_nobeetle.csv&quot;)

#only care about the veg
visits &lt;- dplyr::select(visits, uniID, treatment, flowering, het.shrub.blooming.neighbours, het.cactus.blooming.neighbours, understory.richness, het.annual.floral.density, PlantID)
visits$flowering &lt;- relevel(visits$flowering, &quot;pre&quot;)
metadata$blooming &lt;- relevel(metadata$blooming, &quot;pre&quot;)

metadata &lt;- dplyr::select(metadata, uniID, plant.id, treatment, blooming, percent.cover, date)
metadata$repID &lt;- paste(metadata$plant.id, metadata$treatment)
visits$repID &lt;- paste(visits$PlantID, visits$treatment)


#percent.cover
shapiro.test(metadata$percent.cover)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  metadata$percent.cover
## W = 0.84516, p-value = 2.406e-14</code></pre>
<pre class="r"><code>mean(metadata$percent.cover)</code></pre>
<pre><code>## [1] 18.82456</code></pre>
<pre class="r"><code>sd(metadata$percent.cover)</code></pre>
<pre><code>## [1] 19.50229</code></pre>
<pre class="r"><code>ggplot(metadata, aes(percent.cover)) + geom_density()</code></pre>
<p><img src="index_files/figure-html/percent%20cover-1.png" width="672" /></p>
<pre class="r"><code>g1.nb &lt;- glmmTMB(percent.cover ~ treatment + blooming + (1|repID), family = &quot;nbinom2&quot;, data = metadata)
g1.nb1 &lt;- glmmTMB(percent.cover ~ treatment * blooming + (1|repID), family = &quot;nbinom2&quot;, data = metadata)
g1.nb.null &lt;- glmmTMB(percent.cover ~ 1 + (1|repID), family = &quot;nbinom2&quot;, data = metadata)

g1.ps &lt;- glmmTMB(percent.cover ~ treatment * blooming + (1|repID), family = &quot;poisson&quot;, data = metadata)
summary(g1.ps)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          percent.cover ~ treatment * blooming + (1 | repID)
## Data: metadata
## 
##      AIC      BIC   logLik deviance df.resid 
##   1732.7   1749.8   -861.3   1722.7      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.3482   0.5901  
## Number of obs: 228, groups:  repID, 126
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                  1.63127    0.09872  16.524   &lt;2e-16 ***
## treatmentshrub               1.70620    0.12616  13.524   &lt;2e-16 ***
## bloomingpost                -0.87124    0.10046  -8.673   &lt;2e-16 ***
## treatmentshrub:bloomingpost  0.92105    0.10597   8.691   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#overdisp_fun(g1.ps)
summary(g1.nb)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          percent.cover ~ treatment + blooming + (1 | repID)
## Data: metadata
## 
##      AIC      BIC   logLik deviance df.resid 
##   1553.7   1570.9   -771.9   1543.7      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.1603   0.4004  
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom2 family (): 3.76 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     1.45974    0.09829  14.852  &lt; 2e-16 ***
## treatmentshrub  2.15367    0.11501  18.726  &lt; 2e-16 ***
## bloomingpost   -0.28135    0.08611  -3.267  0.00109 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g1.nb1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          percent.cover ~ treatment * blooming + (1 | repID)
## Data: metadata
## 
##      AIC      BIC   logLik deviance df.resid 
##   1534.0   1554.6   -761.0   1522.0      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.1757   0.4192  
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom2 family (): 4.66 
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   1.6794     0.1073  15.650  &lt; 2e-16 ***
## treatmentshrub                1.7641     0.1379  12.793  &lt; 2e-16 ***
## bloomingpost                 -0.8027     0.1377  -5.831 5.52e-09 ***
## treatmentshrub:bloomingpost   0.8048     0.1684   4.779 1.76e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g1.nb.null)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          percent.cover ~ 1 + (1 | repID)
## Data: metadata
## 
##      AIC      BIC   logLik deviance df.resid 
##   1730.3   1740.6   -862.1   1724.3      225 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 1.379    1.174   
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom2 family (): 3.76 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   2.3677     0.1164   20.35   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(g1.ps, g1.nb1)</code></pre>
<pre><code>##        df      AIC
## g1.ps   5 1732.656
## g1.nb1  6 1533.999</code></pre>
<pre class="r"><code>anova(g1.nb, g1.nb1, g1.nb.null)</code></pre>
<pre><code>## Data: metadata
## Models:
## g1.nb.null: percent.cover ~ 1 + (1 | repID), zi=~0, disp=~1
## g1.nb: percent.cover ~ treatment + blooming + (1 | repID), zi=~0, disp=~1
## g1.nb1: percent.cover ~ treatment * blooming + (1 | repID), zi=~0, disp=~1
##            Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)    
## g1.nb.null  3 1730.3 1740.6 -862.15   1724.3                             
## g1.nb       5 1553.7 1570.9 -771.86   1543.7 180.57      2  &lt; 2.2e-16 ***
## g1.nb1      6 1534.0 1554.6 -761.00   1522.0  21.72      1  3.154e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(g1.nb, g1.nb1, g1.nb.null)</code></pre>
<pre><code>##            df      AIC
## g1.nb       5 1553.720
## g1.nb1      6 1533.999
## g1.nb.null  3 1730.291</code></pre>
<pre class="r"><code>car::Anova(g1.nb, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: percent.cover
##             Chisq Df Pr(&gt;Chisq)    
## treatment 350.646  1  &lt; 2.2e-16 ***
## blooming   10.675  1   0.001086 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(g1.nb1, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: percent.cover
##                      Chisq Df Pr(&gt;Chisq)    
## (Intercept)        244.911  1  &lt; 2.2e-16 ***
## treatment          163.649  1  &lt; 2.2e-16 ***
## blooming            33.998  1  5.517e-09 ***
## treatment:blooming  22.837  1  1.764e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#negative binomail with interaction is best fitting model

#posthoc in interaction
ph &lt;- lsmeans(g1.nb1, pairwise~treatment*blooming, adjust=&quot;tukey&quot;)
summary(ph)</code></pre>
<pre><code>## $lsmeans
##  treatment blooming    lsmean         SE df asymp.LCL asymp.UCL
##  open      pre      1.6794342 0.10731453 NA 1.4691016  1.889767
##  shrub     pre      3.4435446 0.08926464 NA 3.2685891  3.618500
##  open      post     0.8767639 0.11933038 NA 0.6428807  1.110647
##  shrub     post     3.4456306 0.08753168 NA 3.2740717  3.617190
## 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast                   estimate        SE df z.ratio p.value
##  open,pre - shrub,pre   -1.764110325 0.1379015 NA -12.793  &lt;.0001
##  open,pre - open,post    0.802670345 0.1376610 NA   5.831  &lt;.0001
##  open,pre - shrub,post  -1.766196362 0.1352613 NA -13.058  &lt;.0001
##  shrub,pre - open,post   2.566780670 0.1471588 NA  17.442  &lt;.0001
##  shrub,pre - shrub,post -0.002086037 0.0974135 NA  -0.021  1.0000
##  open,post - shrub,post -2.568866707 0.1444090 NA -17.789  &lt;.0001
## 
## P value adjustment: tukey method for comparing a family of 4 estimates</code></pre>
<pre class="r"><code>ggplot(metadata, aes(treatment, percent.cover)) + geom_boxplot() + facet_grid(~blooming)</code></pre>
<p><img src="index_files/figure-html/percent%20cover-2.png" width="672" /></p>
<pre class="r"><code>ggplot(metadata, aes(treatment, percent.cover)) + geom_boxplot() + theme_Publication() + ylab(&quot;Percent Annual Vegetation Cover&quot;) + xlab(&quot;Microsite&quot;)</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<p><img src="index_files/figure-html/percent%20cover-3.png" width="672" /></p>
<pre class="r"><code>ggplot(metadata, aes(treatment, percent.cover)) + geom_boxplot() + theme_Publication() + ylab(&quot;Percent Annual Vegetation Cover&quot;) + xlab(&quot;Microsite&quot;) + facet_grid(~blooming,labeller=labeller(blooming = labels))</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<p><img src="index_files/figure-html/percent%20cover-4.png" width="672" /></p>
<hr />
<p>Annual Richness</p>
<pre class="r"><code>mean(visits$understory.richness, na.rm = TRUE)</code></pre>
<pre><code>## [1] 2.376623</code></pre>
<pre class="r"><code>sd(visits$understory.richness, na.rm = TRUE)</code></pre>
<pre><code>## [1] 0.8703667</code></pre>
<pre class="r"><code>shapiro.test(visits$understory.richness)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  visits$understory.richness
## W = 0.88912, p-value = 5.431e-12</code></pre>
<pre class="r"><code>ggplot(visits, aes(understory.richness)) + geom_density()</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/annual%20richness-1.png" width="672" /></p>
<pre class="r"><code>g2 &lt;- glmmTMB(understory.richness ~ treatment + flowering + (1|repID), family = poisson(link=&quot;log&quot;), data = visits)
g2.2 &lt;- glmmTMB(understory.richness ~ treatment * flowering + (1|repID), family = poisson(link=&quot;log&quot;), data = visits)
g2.null &lt;- glmmTMB(understory.richness ~ 1 + (1|repID), family = poisson(link=&quot;log&quot;), data = visits)
g2b &lt;- glmmTMB(understory.richness ~ treatment + flowering + (1|repID), family = nbinom2, data = visits)</code></pre>
<pre><code>## Warning in fitTMB(TMBStruc): Model convergence problem; false convergence
## (8). See vignette(&#39;troubleshooting&#39;)</code></pre>
<pre class="r"><code>summary(g2)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          
## understory.richness ~ treatment + flowering + (1 | repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    707.6    721.3   -349.8    699.6      227 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev. 
##  repID  (Intercept) 1.589e-10 1.261e-05
## Number of obs: 231, groups:  repID, 122
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     0.89619    0.07359  12.179   &lt;2e-16 ***
## treatmentshrub  0.07186    0.08546   0.841      0.4    
## floweringbloom -0.14068    0.08560  -1.643      0.1    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g2.2)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          
## understory.richness ~ treatment * flowering + (1 | repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    709.6    726.8   -349.8    699.6      226 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev. 
##  repID  (Intercept) 1.729e-10 1.315e-05
## Number of obs: 231, groups:  repID, 122
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.89142    0.08482  10.510   &lt;2e-16 ***
## treatmentshrub                 0.08090    0.11664   0.694    0.488    
## floweringbloom                -0.13045    0.12406  -1.052    0.293    
## treatmentshrub:floweringbloom -0.01951    0.17140  -0.114    0.909    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g2.null)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          understory.richness ~ 1 + (1 | repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    707.0    713.9   -351.5    703.0      229 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev. 
##  repID  (Intercept) 2.005e-10 1.416e-05
## Number of obs: 231, groups:  repID, 122
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.86568    0.04268   20.28   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(g2, g2.null, g2.2, g2b, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Data: visits
## Models:
## g2.null: understory.richness ~ 1 + (1 | repID), zi=~0, disp=~1
## g2: understory.richness ~ treatment + flowering + (1 | repID), zi=~0, disp=~1
## g2.2: understory.richness ~ treatment * flowering + (1 | repID), zi=~0, disp=~1
## g2b: understory.richness ~ treatment + flowering + (1 | repID), zi=~0, disp=~1
##         Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)
## g2.null  2 707.01 713.89 -351.50   703.01                         
## g2       4 707.58 721.35 -349.79   699.58 3.4279      2     0.1802
## g2.2     5 709.56 726.78 -349.78   699.56 0.0130      1     0.9094
## g2b      5 709.58 726.79 -349.79   699.58 0.0000      0     1.0000</code></pre>
<pre class="r"><code>AIC(g2, g2.2, g2.null, g2b)</code></pre>
<pre><code>##         df      AIC
## g2       4 707.5776
## g2.2     5 709.5646
## g2.null  2 707.0055
## g2b      5 709.5776</code></pre>
<pre class="r"><code>car::Anova(g2, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: understory.richness
##            Chisq Df Pr(&gt;Chisq)
## treatment 0.7071  1     0.4004
## flowering 2.7010  1     0.1003</code></pre>
<pre class="r"><code>#null model is the best fit
shapiro.test(residuals(g2))</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  residuals(g2)
## W = 0.9774, p-value = 0.0009409</code></pre>
<pre class="r"><code>ggplot(visits, aes(treatment, understory.richness)) + geom_boxplot() + facet_grid(~flowering, labeller=labeller(flowering = labels)) + theme_Publication() + xlab(&quot;Microsite&quot;) + ylab(&quot;Annual Species Richness&quot;)</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<p><img src="index_files/figure-html/annual%20richness-2.png" width="672" /></p>
<hr />
<p>Annual Floral Density number of all blooms in quadrat</p>
<pre class="r"><code>mean(visits$het.annual.floral.density, na.rm = TRUE)</code></pre>
<pre><code>## [1] 0.965368</code></pre>
<pre class="r"><code>sd(visits$het.annual.floral.density, na.rm = TRUE)</code></pre>
<pre><code>## [1] 3.114987</code></pre>
<pre class="r"><code>ggplot(visits, aes(het.annual.floral.density)) + geom_density()</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/annual%20floral%20density-1.png" width="672" /></p>
<pre class="r"><code>g3.nb &lt;- glmmTMB(het.annual.floral.density ~ flowering * treatment + (1|repID), family = &quot;nbinom2&quot;, data = visits)

g3.nb.1 &lt;- glmmTMB(het.annual.floral.density ~ flowering + treatment + (1|repID), family = &quot;nbinom2&quot;, data = visits)

g3.nb.null &lt;- glmmTMB(het.annual.floral.density ~ 1 + (1|repID), family = &quot;nbinom2&quot;, data = visits)

g3.p &lt;- glmmTMB(het.annual.floral.density ~ 1 + (1|repID), family = &quot;poisson&quot;, data = visits)

g3.nb.type1 &lt;- glmmTMB(het.annual.floral.density ~ 1 + (1|repID), family = &quot;nbinom1&quot;, data = visits) 

summary(g3.nb)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## het.annual.floral.density ~ flowering * treatment + (1 | repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    496.9    517.6   -242.4    484.9      225 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev. 
##  repID  (Intercept) 1.802e-08 0.0001342
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 0.161 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)                    0.45676    0.34682   1.317   0.1878  
## floweringbloom                -1.13251    0.51375  -2.204   0.0275 *
## treatmentshrub                -0.06839    0.48708  -0.140   0.8883  
## floweringbloom:treatmentshrub -0.48309    0.73961  -0.653   0.5136  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g3.nb.1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## het.annual.floral.density ~ flowering + treatment + (1 | repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    495.3    512.5   -242.7    485.3      226 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev. 
##  repID  (Intercept) 4.096e-08 0.0002024
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 0.16 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)      0.5679     0.3174   1.789 0.073560 .  
## floweringbloom  -1.3664     0.3714  -3.680 0.000234 ***
## treatmentshrub  -0.2787     0.3686  -0.756 0.449489    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g3.nb.null)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          het.annual.floral.density ~ 1 + (1 | repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    502.0    512.4   -248.0    496.0      228 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.6587   0.8116  
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 0.172 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)  -0.3425     0.2834  -1.209    0.227</code></pre>
<pre class="r"><code>anova(g3.nb, g3.nb.null, g3.nb.1, g3.p, g3.nb.type1, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Data: visits
## Models:
## g3.p: het.annual.floral.density ~ 1 + (1 | repID), zi=~0, disp=~1
## g3.nb.null: het.annual.floral.density ~ 1 + (1 | repID), zi=~0, disp=~1
## g3.nb.type1: het.annual.floral.density ~ 1 + (1 | repID), zi=~0, disp=~1
## g3.nb.1: het.annual.floral.density ~ flowering + treatment + (1 | repID), zi=~0, disp=~1
## g3.nb: het.annual.floral.density ~ flowering * treatment + (1 | repID), zi=~0, disp=~1
##             Df    AIC    BIC  logLik deviance    Chisq Chi Df Pr(&gt;Chisq)
## g3.p         2 656.25 663.14 -326.13   652.25                           
## g3.nb.null   3 502.04 512.37 -248.02   496.04 156.2088      1  &lt; 2.2e-16
## g3.nb.type1  3 503.76 514.08 -248.88   497.76   0.0000      0   1.000000
## g3.nb.1      5 495.32 512.53 -242.66   485.32  12.4342      2   0.001995
## g3.nb        6 496.90 517.55 -242.45   484.90   0.4255      1   0.514183
##                
## g3.p           
## g3.nb.null  ***
## g3.nb.type1    
## g3.nb.1     ** 
## g3.nb          
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(g3.nb.1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: het.annual.floral.density
##             Chisq Df Pr(&gt;Chisq)    
## flowering 13.5397  1  0.0002336 ***
## treatment  0.5719  1  0.4494890    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(g3.nb, g3.nb.1, g3.p, g3.nb.type1, g3.nb.null)</code></pre>
<pre><code>##             df      AIC
## g3.nb        6 496.8968
## g3.nb.1      5 495.3223
## g3.p         2 656.2507
## g3.nb.type1  3 503.7565
## g3.nb.null   3 502.0419</code></pre>
<pre class="r"><code>#negative binomial type 2, additive model

ggplot(visits, aes(treatment, het.annual.floral.density)) + geom_boxplot() + facet_grid(~flowering, labeller=labeller(flowering = labels)) + theme_Publication() + xlab(&quot;Microsite&quot;) + ylab(&quot;Heterospecific Annual Floral Density&quot;)</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<p><img src="index_files/figure-html/annual%20floral%20density-2.png" width="672" /></p>
<hr />
<p>Blooming shrub density</p>
<pre class="r"><code>mean(visits$het.shrub.blooming.neighbours, na.rm = TRUE)</code></pre>
<pre><code>## [1] 1.744589</code></pre>
<pre class="r"><code>sd(visits$het.shrub.blooming.neighbours, na.rm = TRUE)</code></pre>
<pre><code>## [1] 2.375537</code></pre>
<pre class="r"><code>ggplot(visits, aes(het.shrub.blooming.neighbours)) + geom_density(kernel = &quot;gaussian&quot;)</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/shrub%20density-1.png" width="672" /></p>
<pre class="r"><code>g4.nb &lt;- glmmTMB(het.shrub.blooming.neighbours ~ flowering * treatment + (1|repID), family = &quot;nbinom2&quot;, data = visits)</code></pre>
<pre><code>## Warning in fitTMB(TMBStruc): Model convergence problem; non-positive-
## definite Hessian matrix. See vignette(&#39;troubleshooting&#39;)</code></pre>
<pre><code>## Warning in fitTMB(TMBStruc): Model convergence problem; false convergence
## (8). See vignette(&#39;troubleshooting&#39;)</code></pre>
<pre class="r"><code>g4.nb.1 &lt;- glmmTMB(het.shrub.blooming.neighbours ~ flowering + treatment + (1|repID), family = &quot;nbinom2&quot;,data = visits)</code></pre>
<pre><code>## Warning in fitTMB(TMBStruc): Model convergence problem; false convergence
## (8). See vignette(&#39;troubleshooting&#39;)</code></pre>
<pre class="r"><code>g4.nb.null &lt;- glmmTMB(het.shrub.blooming.neighbours ~ 1 + (1|repID), family = &quot;nbinom2&quot;,data = visits)
summary(g4.nb)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## het.shrub.blooming.neighbours ~ flowering * treatment + (1 |      repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##       NA       NA       NA       NA      225 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.575    0.7583  
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 4.71e+06 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   -1.02649    0.22277  -4.608 4.07e-06 ***
## floweringbloom                 1.62654    0.20924   7.774 7.62e-15 ***
## treatmentshrub                 0.30524    0.29057   1.050    0.293    
## floweringbloom:treatmentshrub  0.07431    0.27527   0.270    0.787    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g4.nb.1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## het.shrub.blooming.neighbours ~ flowering + treatment + (1 |      repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    738.0    755.3   -364.0    728.0      226 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.5751   0.7584  
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 1.04e+07 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     -1.0623     0.1807  -5.880  4.1e-09 ***
## floweringbloom   1.6699     0.1360  12.278  &lt; 2e-16 ***
## treatmentshrub   0.3666     0.1813   2.022   0.0432 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g4.nb.null)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          het.shrub.blooming.neighbours ~ 1 + (1 | repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    832.8    843.1   -413.4    826.8      228 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev. 
##  repID  (Intercept) 3.744e-09 6.119e-05
## Number of obs: 231, groups:  repID, 122
## 
## Overdispersion parameter for nbinom2 family (): 0.695 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.55652    0.09332   5.963 2.47e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(g4.nb, g4.nb.null, g4.nb.1, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Data: visits
## Models:
## g4.nb.null: het.shrub.blooming.neighbours ~ 1 + (1 | repID), zi=~0, disp=~1
## g4.nb.1: het.shrub.blooming.neighbours ~ flowering + treatment + (1 | , zi=~0, disp=~1
## g4.nb.1:     repID), zi=~0, disp=~1
## g4.nb: het.shrub.blooming.neighbours ~ flowering * treatment + (1 | , zi=~0, disp=~1
## g4.nb:     repID), zi=~0, disp=~1
##            Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)    
## g4.nb.null  3 832.76 843.09 -413.38   826.76                             
## g4.nb.1     5 738.04 755.25 -364.02   728.04 98.721      2  &lt; 2.2e-16 ***
## g4.nb       6                                            1               
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(g4.nb.1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: het.shrub.blooming.neighbours
##              Chisq Df Pr(&gt;Chisq)    
## flowering 150.7484  1    &lt; 2e-16 ***
## treatment   4.0892  1    0.04316 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(g4.nb, g4.nb.1, g4.nb.null)</code></pre>
<pre><code>##            df      AIC
## g4.nb       6       NA
## g4.nb.1     5 738.0419
## g4.nb.null  3 832.7629</code></pre>
<pre class="r"><code>ggplot(visits, aes(treatment, het.shrub.blooming.neighbours)) + geom_boxplot() + theme_Publication() + ylab(&quot;Blooming Shrubs within 2 m&quot;) + xlab(&quot;Microsite&quot;)   </code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<p><img src="index_files/figure-html/shrub%20density-2.png" width="672" /></p>
<pre class="r"><code>ggplot(visits, aes(treatment, het.shrub.blooming.neighbours)) + geom_boxplot() + theme_Publication() + ylab(&quot;Blooming Shrubs within 2 m&quot;) + xlab(&quot;Microsite&quot;) + facet_grid(~flowering,labeller=labeller(flowering = labels)) </code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<p><img src="index_files/figure-html/shrub%20density-3.png" width="672" /></p>
<hr />
<p>Blooming cactus density</p>
<pre class="r"><code>mean(visits$het.cactus.blooming.neighbours, na.rm = TRUE)</code></pre>
<pre><code>## [1] 0.1341991</code></pre>
<pre class="r"><code>sd(visits$het.cactus.blooming.neighbours, na.rm = TRUE)</code></pre>
<pre><code>## [1] 0.6214983</code></pre>
<pre class="r"><code>ggplot(visits, aes(het.cactus.blooming.neighbours)) + geom_density(kernel = &quot;gaussian&quot;)</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/cactus%20density-1.png" width="672" /></p>
<pre class="r"><code>g5.nb &lt;- glmmTMB(het.cactus.blooming.neighbours ~ flowering * treatment + (1|repID), family = &quot;nbinom2&quot;, data = visits)</code></pre>
<pre><code>## Warning in fitTMB(TMBStruc): Model convergence problem; false convergence
## (8). See vignette(&#39;troubleshooting&#39;)</code></pre>
<pre class="r"><code>g5.ps &lt;- glmmTMB(het.cactus.blooming.neighbours ~ flowering * treatment + (1|repID), family = poisson(link = &quot;log&quot;), data = visits)
g5.ps.1 &lt;- glmmTMB(het.cactus.blooming.neighbours ~ flowering + treatment + (1|repID), family = poisson(link = &quot;log&quot;), data = visits)
g5.ps.null &lt;- glmmTMB(het.cactus.blooming.neighbours ~ 1 + (1|repID), family = poisson(link =&quot;log&quot;), data = visits)


summary(g5.ps)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          
## het.cactus.blooming.neighbours ~ flowering * treatment + (1 |      repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    157.5    174.7    -73.7    147.5      226 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 3.831    1.957   
## Number of obs: 231, groups:  repID, 122
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    -5.8452     1.2449  -4.695 2.66e-06 ***
## floweringbloom                  2.8423     1.0296   2.761  0.00577 ** 
## treatmentshrub                  0.3961     1.4973   0.265  0.79136    
## floweringbloom:treatmentshrub  -0.3329     1.4649  -0.227  0.82024    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g5.ps.1)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          
## het.cactus.blooming.neighbours ~ flowering + treatment + (1 |      repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    155.5    169.3    -73.8    147.5      227 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 3.83     1.957   
## Number of obs: 231, groups:  repID, 122
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -5.70199    1.03652  -5.501 3.77e-08 ***
## floweringbloom  2.68982    0.73167   3.676 0.000237 ***
## treatmentshrub  0.08604    0.61835   0.139 0.889333    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g5.ps.null)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          het.cactus.blooming.neighbours ~ 1 + (1 | repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    180.0    186.9    -88.0    176.0      229 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 3.847    1.961   
## Number of obs: 231, groups:  repID, 122
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -3.6166     0.6807  -5.313 1.08e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(g5.nb, g5.ps, g5.ps.null, g5.ps.1, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Data: visits
## Models:
## g5.ps.null: het.cactus.blooming.neighbours ~ 1 + (1 | repID), zi=~0, disp=~1
## g5.ps.1: het.cactus.blooming.neighbours ~ flowering + treatment + (1 | , zi=~0, disp=~1
## g5.ps.1:     repID), zi=~0, disp=~1
## g5.ps: het.cactus.blooming.neighbours ~ flowering * treatment + (1 | , zi=~0, disp=~1
## g5.ps:     repID), zi=~0, disp=~1
## g5.nb: het.cactus.blooming.neighbours ~ flowering * treatment + (1 | , zi=~0, disp=~1
## g5.nb:     repID), zi=~0, disp=~1
##            Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## g5.ps.null  2 179.99 186.87 -87.993   175.99                              
## g5.ps.1     4 155.55 169.32 -73.773   147.55 28.4391      2  6.676e-07 ***
## g5.ps       5 157.50 174.71 -73.747   147.50  0.0515      1     0.8206    
## g5.nb       6 159.49 180.15 -73.747   147.49  0.0006      1     0.9805    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(g5.ps.1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: het.cactus.blooming.neighbours
##             Chisq Df Pr(&gt;Chisq)    
## flowering 13.5150  1  0.0002367 ***
## treatment  0.0194  1  0.8893330    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(g5.nb, g5.ps, g5.ps.1, g5.ps.null)</code></pre>
<pre><code>##            df      AIC
## g5.nb       6 159.4941
## g5.ps       5 157.4947
## g5.ps.1     4 155.5462
## g5.ps.null  2 179.9853</code></pre>
<pre class="r"><code>#poisson additive is best


ggplot(visits, aes(treatment, het.cactus.blooming.neighbours)) + geom_boxplot() + facet_grid(~flowering, labeller=labeller(flowering = labels)) + theme_Publication() + xlab(&quot;Microsite&quot;) + ylab(&quot;Blooming Cactus Density within 2m&quot;)</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<p><img src="index_files/figure-html/cactus%20density-2.png" width="672" /></p>
<hr />
</div>
<div id="pan-traps" class="section level3">
<h3>Pan traps</h3>
<p>These are models for abundance, species richness, bee abundance and bee richness from pan traps.</p>
<hr />
<p>Arthropod abundance - Melyridae beetles excluded</p>
<pre class="r"><code>metadata &lt;- read.csv(&quot;Output Data/metadata_nobeetle.csv&quot;)
metadata$repID &lt;- paste(metadata$plant.id, metadata$treatment)
metadata$blooming &lt;- relevel(metadata$blooming, &quot;pre&quot;)
sum(metadata$abun)</code></pre>
<pre><code>## [1] 2144</code></pre>
<pre class="r"><code>str(metadata)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  21 variables:
##  $ X.1          : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ date         : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ mean.Solar   : num  0.762 0.762 0.762 0.762 0.762 ...
##  $ mean.Wind    : num  5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 ...
##  $ mean.MaxWind : num  9.78 9.78 9.78 9.78 9.78 ...
##  $ mean.Temp    : num  18.4 18.4 18.4 18.4 18.4 ...
##  $ plant.id     : int  184 184 189 189 192 192 194 194 275 275 ...
##  $ species      : Factor w/ 1 level &quot;larrea&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##  $ blooming     : Factor w/ 2 levels &quot;pre&quot;,&quot;post&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  10 70 2 25 15 40 3 40 2 20 ...
##  $ rich         : int  4 3 6 6 3 1 2 3 5 4 ...
##  $ perennial    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ X            : Factor w/ 2 levels &quot;&quot;,&quot;blue and white knocked over&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ uniID        : Factor w/ 228 levels &quot;4.10.2017 184 open&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ abun         : int  12 14 18 16 21 30 13 11 0 27 ...
##  $ H            : num  1.31 1.22 2.43 1.75 1.72 ...
##  $ Simpson      : num  0.667 0.612 0.895 0.773 0.789 ...
##  $ Species      : int  5 5 13 8 7 12 6 6 0 10 ...
##  $ Even         : num  0.817 0.755 0.947 0.844 0.886 ...
##  $ repID        : chr  &quot;184 open&quot; &quot;184 shrub&quot; &quot;189 open&quot; &quot;189 shrub&quot; ...</code></pre>
<pre class="r"><code>ggplot(data = metadata, aes(abun)) + geom_freqpoly()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/arthropod%20abundance%20m%20excluded-1.png" width="672" /></p>
<pre class="r"><code>mean(metadata$abun)</code></pre>
<pre><code>## [1] 9.403509</code></pre>
<pre class="r"><code>sd(metadata$abun)</code></pre>
<pre><code>## [1] 5.939073</code></pre>
<pre class="r"><code>shapiro.test(metadata$abun)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  metadata$abun
## W = 0.9356, p-value = 1.843e-08</code></pre>
<pre class="r"><code>ggplot(data = metadata, aes(treatment, abun)) + geom_boxplot() + facet_grid(~blooming)</code></pre>
<p><img src="index_files/figure-html/arthropod%20abundance%20m%20excluded-2.png" width="672" /></p>
<pre class="r"><code>m1 &lt;- glmmTMB(abun ~ treatment * blooming + (1|repID), family = &quot;nbinom2&quot;, data = metadata)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ treatment * blooming + (1 | repID)
## Data: metadata
## 
##      AIC      BIC   logLik deviance df.resid 
##   1370.7   1391.3   -679.4   1358.7      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev. 
##  repID  (Intercept) 3.076e-09 5.546e-05
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom2 family (): 4.97 
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                  2.27060    0.07511  30.230  &lt; 2e-16 ***
## treatmentshrub               0.40610    0.10317   3.936 8.28e-05 ***
## bloomingpost                -0.39623    0.10750  -3.686 0.000228 ***
## treatmentshrub:bloomingpost -0.27674    0.14887  -1.859 0.063043 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#lsmeans(m1, pairwise~blooming*treatment)
car::Anova(m1, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: abun
##                       Chisq Df Pr(&gt;Chisq)    
## (Intercept)        913.8679  1  &lt; 2.2e-16 ***
## treatment           15.4928  1  8.282e-05 ***
## blooming            13.5866  1  0.0002278 ***
## treatment:blooming   3.4555  1  0.0630428 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(abun ~ treatment + blooming + (1|repID), family = &quot;nbinom2&quot;, data = metadata)
summary(m2)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ treatment + blooming + (1 | repID)
## Data: metadata
## 
##      AIC      BIC   logLik deviance df.resid 
##   1372.2   1389.3   -681.1   1362.2      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev. 
##  repID  (Intercept) 2.635e-09 5.133e-05
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom2 family (): 4.83 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.34192    0.06597   35.50  &lt; 2e-16 ***
## treatmentshrub  0.27310    0.07508    3.64 0.000275 ***
## bloomingpost   -0.54087    0.07504   -7.21 5.68e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m3 &lt;- glmmTMB(abun ~ (1|repID), family = &quot;nbinom2&quot;, data = metadata)

m4.nb1 &lt;- glmmTMB(abun ~ treatment + blooming + (1|repID), family = &quot;nbinom1&quot;, data = metadata)

m4.nb1.int &lt;- glmmTMB(abun ~ treatment * blooming + (1|repID), family = &quot;nbinom1&quot;, data = metadata)

anova(m1, m2, m3, m4.nb1, m4.nb1.int, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Data: metadata
## Models:
## m3: abun ~ (1 | repID), zi=~0, disp=~1
## m2: abun ~ treatment + blooming + (1 | repID), zi=~0, disp=~1
## m4.nb1: abun ~ treatment + blooming + (1 | repID), zi=~0, disp=~1
## m1: abun ~ treatment * blooming + (1 | repID), zi=~0, disp=~1
## m4.nb1.int: abun ~ treatment * blooming + (1 | repID), zi=~0, disp=~1
##            Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## m3          3 1426.5 1436.8 -710.27   1420.5                              
## m2          5 1372.2 1389.3 -681.08   1362.2 58.3768      2  2.107e-13 ***
## m4.nb1      5 1370.3 1387.5 -680.15   1360.3  1.8557      0  &lt; 2.2e-16 ***
## m1          6 1370.7 1391.3 -679.37   1358.7  1.5697      1     0.2103    
## m4.nb1.int  6 1368.7 1389.2 -678.33   1356.7  2.0728      0  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(m1, m2, m3, m4.nb1, m4.nb1.int)</code></pre>
<pre><code>##            df      AIC
## m1          6 1370.733
## m2          5 1372.159
## m3          3 1426.535
## m4.nb1      5 1370.303
## m4.nb1.int  6 1368.660</code></pre>
<pre class="r"><code>#looks like nbinom1 (negative binomial type one, additive model)

anova(m4.nb1, m4.nb1.int)</code></pre>
<pre><code>## Data: metadata
## Models:
## m4.nb1: abun ~ treatment + blooming + (1 | repID), zi=~0, disp=~1
## m4.nb1.int: abun ~ treatment * blooming + (1 | repID), zi=~0, disp=~1
##            Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)  
## m4.nb1      5 1370.3 1387.5 -680.15   1360.3                           
## m4.nb1.int  6 1368.7 1389.2 -678.33   1356.7 3.6425      1    0.05632 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#additive and interactive models are not different - using simpler model

summary(m4.nb1)</code></pre>
<pre><code>##  Family: nbinom1  ( log )
## Formula:          abun ~ treatment + blooming + (1 | repID)
## Data: metadata
## 
##      AIC      BIC   logLik deviance df.resid 
##   1370.3   1387.4   -680.2   1360.3      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.01365  0.1168  
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom1 family (): 1.81 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.33246    0.06313   36.95  &lt; 2e-16 ***
## treatmentshrub  0.28835    0.07460    3.87 0.000111 ***
## bloomingpost   -0.54964    0.07340   -7.49 6.95e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m4.nb1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: abun
##            Chisq Df Pr(&gt;Chisq)    
## treatment 14.940  1   0.000111 ***
## blooming  56.082  1   6.95e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<hr />
<p>Including Melyridae beetles</p>
<pre class="r"><code>beetle &lt;- read.csv(&quot;Output Data/metadata_yesbeetle.csv&quot;)
beetle$repID &lt;- paste(beetle$plant.id, beetle$treatment)
beetle$blooming &lt;- relevel(beetle$blooming, &quot;pre&quot;)
sum(beetle$abun)</code></pre>
<pre><code>## [1] 3387</code></pre>
<pre class="r"><code>str(beetle)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  21 variables:
##  $ X.1          : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ date         : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ mean.Solar   : num  0.762 0.762 0.762 0.762 0.762 ...
##  $ mean.Wind    : num  5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 ...
##  $ mean.MaxWind : num  9.78 9.78 9.78 9.78 9.78 ...
##  $ mean.Temp    : num  18.4 18.4 18.4 18.4 18.4 ...
##  $ plant.id     : int  184 184 189 189 192 192 194 194 275 275 ...
##  $ species      : Factor w/ 1 level &quot;larrea&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##  $ blooming     : Factor w/ 2 levels &quot;pre&quot;,&quot;post&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  10 70 2 25 15 40 3 40 2 20 ...
##  $ rich         : int  4 3 6 6 3 1 2 3 5 4 ...
##  $ perennial    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ X            : Factor w/ 2 levels &quot;&quot;,&quot;blue and white knocked over&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ uniID        : Factor w/ 228 levels &quot;4.10.2017 184 open&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ abun         : int  18 16 20 18 22 30 20 11 0 29 ...
##  $ H            : num  1.51 1.44 2.51 1.91 1.83 ...
##  $ Simpson      : num  0.741 0.688 0.905 0.809 0.806 ...
##  $ Species      : int  6 6 14 9 8 12 7 6 0 11 ...
##  $ Even         : num  0.844 0.804 0.951 0.868 0.88 ...
##  $ repID        : chr  &quot;184 open&quot; &quot;184 shrub&quot; &quot;189 open&quot; &quot;189 shrub&quot; ...</code></pre>
<pre class="r"><code>sum(beetle$H)</code></pre>
<pre><code>## [1] 357.8503</code></pre>
<pre class="r"><code>ggplot(data = beetle, aes(abun)) + geom_freqpoly()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/melyride%20included-1.png" width="672" /></p>
<pre class="r"><code>mean(beetle$abun)</code></pre>
<pre><code>## [1] 14.85526</code></pre>
<pre class="r"><code>sd(beetle$abun)</code></pre>
<pre><code>## [1] 8.305357</code></pre>
<pre class="r"><code>m1 &lt;- glmmTMB(abun ~ blooming + treatment + (1|repID), family = &quot;nbinom2&quot;, data = beetle)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ blooming + treatment + (1 | repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1560.1   1577.2   -775.0   1550.1      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.02625  0.162   
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom2 family (): 5.39 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.92260    0.06280   46.54  &lt; 2e-16 ***
## bloomingpost   -0.39360    0.06822   -5.77 7.95e-09 ***
## treatmentshrub -0.09887    0.07367   -1.34     0.18    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(abun ~ blooming * treatment + (1|repID), family = &quot;nbinom2&quot;, data = beetle)
summary(m2)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ blooming * treatment + (1 | repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1561.8   1582.4   -774.9   1549.8      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.02622  0.1619  
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom2 family ():  5.4 
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                  2.90434    0.07104   40.88  &lt; 2e-16 ***
## bloomingpost                -0.35767    0.09558   -3.74 0.000183 ***
## treatmentshrub              -0.06233    0.10016   -0.62 0.533761    
## bloomingpost:treatmentshrub -0.07273    0.13537   -0.54 0.591111    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m3 &lt;- glmmTMB(abun ~  (1|repID),family = &quot;nbinom2&quot;,  data = beetle)
summary(m3)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ (1 | repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1586.9   1597.2   -790.5   1580.9      225 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev. 
##  repID  (Intercept) 8.308e-09 9.115e-05
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom2 family (): 3.91 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  2.69835    0.03764   71.69   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m4 &lt;-  glmmTMB(abun ~ blooming + treatment + (1|repID), family = &quot;nbinom1&quot;, data = beetle)
summary(m4)  </code></pre>
<pre><code>##  Family: nbinom1  ( log )
## Formula:          abun ~ blooming + treatment + (1 | repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1556.6   1573.8   -773.3   1546.6      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.04362  0.2088  
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom1 family (): 2.45 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.90596    0.05872   49.48  &lt; 2e-16 ***
## bloomingpost   -0.39826    0.06402   -6.22 4.93e-10 ***
## treatmentshrub -0.07724    0.07354   -1.05    0.294    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(m1, m2, m3, m4)</code></pre>
<pre><code>## Data: beetle
## Models:
## m3: abun ~ (1 | repID), zi=~0, disp=~1
## m1: abun ~ blooming + treatment + (1 | repID), zi=~0, disp=~1
## m4: abun ~ blooming + treatment + (1 | repID), zi=~0, disp=~1
## m2: abun ~ blooming * treatment + (1 | repID), zi=~0, disp=~1
##    Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## m3  3 1586.9 1597.2 -790.46   1580.9                              
## m1  5 1560.1 1577.2 -775.04   1550.1 30.8357      2  2.014e-07 ***
## m4  5 1556.6 1573.8 -773.30   1546.6  3.4774      0  &lt; 2.2e-16 ***
## m2  6 1561.8 1582.4 -774.90   1549.8  0.0000      1          1    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(m1, m2, m3, m4)</code></pre>
<pre><code>##    df      AIC
## m1  5 1560.081
## m2  6 1561.792
## m3  3 1586.917
## m4  5 1556.603</code></pre>
<pre class="r"><code>#one and two are pretty much the same, going with simpler, #4 is best (nbinom1)
car::Anova(m4, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: abun
##             Chisq Df Pr(&gt;Chisq)    
## blooming  38.7043  1  4.931e-10 ***
## treatment  1.1031  1     0.2936    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<hr />
<p>Melyridae only</p>
<pre class="r"><code>onlybeetle &lt;- read.csv(&quot;Output Data/metadata_onlybeetle.csv&quot;)
onlybeetle$repID &lt;- paste(onlybeetle$plant.id, onlybeetle$treatment)
onlybeetle$blooming &lt;- relevel(onlybeetle$blooming, &quot;pre&quot;)
sum(onlybeetle$abun)</code></pre>
<pre><code>## [1] 1243</code></pre>
<pre class="r"><code>str(beetle)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  21 variables:
##  $ X.1          : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ date         : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ mean.Solar   : num  0.762 0.762 0.762 0.762 0.762 ...
##  $ mean.Wind    : num  5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 ...
##  $ mean.MaxWind : num  9.78 9.78 9.78 9.78 9.78 ...
##  $ mean.Temp    : num  18.4 18.4 18.4 18.4 18.4 ...
##  $ plant.id     : int  184 184 189 189 192 192 194 194 275 275 ...
##  $ species      : Factor w/ 1 level &quot;larrea&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##  $ blooming     : Factor w/ 2 levels &quot;pre&quot;,&quot;post&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  10 70 2 25 15 40 3 40 2 20 ...
##  $ rich         : int  4 3 6 6 3 1 2 3 5 4 ...
##  $ perennial    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ X            : Factor w/ 2 levels &quot;&quot;,&quot;blue and white knocked over&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ uniID        : Factor w/ 228 levels &quot;4.10.2017 184 open&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ abun         : int  18 16 20 18 22 30 20 11 0 29 ...
##  $ H            : num  1.51 1.44 2.51 1.91 1.83 ...
##  $ Simpson      : num  0.741 0.688 0.905 0.809 0.806 ...
##  $ Species      : int  6 6 14 9 8 12 7 6 0 11 ...
##  $ Even         : num  0.844 0.804 0.951 0.868 0.88 ...
##  $ repID        : chr  &quot;184 open&quot; &quot;184 shrub&quot; &quot;189 open&quot; &quot;189 shrub&quot; ...</code></pre>
<pre class="r"><code>ggplot(data = onlybeetle, aes(abun)) + geom_freqpoly()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/melyridae%20abundance%20only-1.png" width="672" /></p>
<pre class="r"><code>mean(onlybeetle$abun)</code></pre>
<pre><code>## [1] 5.451754</code></pre>
<pre class="r"><code>sd(onlybeetle$abun)</code></pre>
<pre><code>## [1] 6.256088</code></pre>
<pre class="r"><code>m1 &lt;- glmmTMB(abun ~ blooming * treatment + (1|repID), family = &quot;nbinom2&quot;, data = onlybeetle)

summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ blooming * treatment + (1 | repID)
## Data: onlybeetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1233.7   1254.3   -610.9   1221.7      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.154    0.3924  
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom2 family (): 1.77 
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   2.1046     0.1302  16.170  &lt; 2e-16 ***
## bloomingpost                 -0.3004     0.1652  -1.819  0.06894 .  
## treatmentshrub               -1.2018     0.1960  -6.132 8.67e-10 ***
## bloomingpost:treatmentshrub   0.6585     0.2476   2.660  0.00781 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(abun ~ blooming + treatment + (1|repID), family = &quot;nbinom2&quot;, data = onlybeetle)

m3 &lt;- glmmTMB(abun ~ (1|repID), family = &quot;nbinom2&quot;,data = onlybeetle)


AIC(m1, m2, m3)</code></pre>
<pre><code>##    df      AIC
## m1  6 1233.725
## m2  5 1238.643
## m3  3 1266.804</code></pre>
<pre class="r"><code>anova(m1, m2, m3)</code></pre>
<pre><code>## Data: onlybeetle
## Models:
## m3: abun ~ (1 | repID), zi=~0, disp=~1
## m2: abun ~ blooming + treatment + (1 | repID), zi=~0, disp=~1
## m1: abun ~ blooming * treatment + (1 | repID), zi=~0, disp=~1
##    Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## m3  3 1266.8 1277.1 -630.40   1260.8                              
## m2  5 1238.6 1255.8 -614.32   1228.6 32.1613      2  1.038e-07 ***
## m1  6 1233.7 1254.3 -610.86   1221.7  6.9176      1   0.008535 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ blooming * treatment + (1 | repID)
## Data: onlybeetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1233.7   1254.3   -610.9   1221.7      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.154    0.3924  
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom2 family (): 1.77 
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   2.1046     0.1302  16.170  &lt; 2e-16 ***
## bloomingpost                 -0.3004     0.1652  -1.819  0.06894 .  
## treatmentshrub               -1.2018     0.1960  -6.132 8.67e-10 ***
## bloomingpost:treatmentshrub   0.6585     0.2476   2.660  0.00781 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: abun
##                       Chisq Df Pr(&gt;Chisq)    
## (Intercept)        261.4755  1  &lt; 2.2e-16 ***
## blooming             3.3081  1   0.068938 .  
## treatment           37.6021  1  8.675e-10 ***
## blooming:treatment   7.0759  1   0.007813 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>lsmeans(m1, pairwise~blooming*treatment)</code></pre>
<pre><code>## $lsmeans
##  blooming treatment    lsmean        SE df asymp.LCL asymp.UCL
##  pre      open      2.1045883 0.1301522 NA 1.8494946  2.359682
##  post     open      1.8041446 0.1273282 NA 1.5545860  2.053703
##  pre      shrub     0.9028025 0.1520713 NA 0.6047482  1.200857
##  post     shrub     1.2608839 0.1370103 NA 0.9923487  1.529419
## 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast                 estimate        SE df z.ratio p.value
##  pre,open - post,open    0.3004437 0.1651855 NA   1.819  0.2644
##  pre,open - pre,shrub    1.2017858 0.1959841 NA   6.132  &lt;.0001
##  pre,open - post,shrub   0.8437044 0.1849410 NA   4.562  &lt;.0001
##  post,open - pre,shrub   0.9013421 0.1933146 NA   4.663  &lt;.0001
##  post,open - post,shrub  0.5432607 0.1822078 NA   2.982  0.0152
##  pre,shrub - post,shrub -0.3580813 0.1842929 NA  -1.943  0.2101
## 
## P value adjustment: tukey method for comparing a family of 4 estimates</code></pre>
<pre class="r"><code>ggplot(metadata, aes(blooming, abun)) + geom_boxplot() + facet_grid(~treatment)</code></pre>
<p><img src="index_files/figure-html/melyridae%20abundance%20only-2.png" width="672" /></p>
<hr />
<p>Arthropod Richness</p>
<pre class="r"><code>s1 &lt;- glmmTMB(Species ~ blooming + treatment + (1|repID), family = poisson, data = beetle)
summary(s1)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          Species ~ blooming + treatment + (1 | repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1142.5   1156.2   -567.2   1134.5      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.02127  0.1458  
## Number of obs: 228, groups:  repID, 126
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.00415    0.04739   42.29  &lt; 2e-16 ***
## bloomingpost   -0.25442    0.05030   -5.06 4.24e-07 ***
## treatmentshrub  0.14540    0.05652    2.57   0.0101 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>s1.nb &lt;- glmmTMB(Species ~ blooming + treatment + (1|repID), family = &quot;nbinom1&quot;, data = beetle)
summary(s1.nb)</code></pre>
<pre><code>##  Family: nbinom1  ( log )
## Formula:          Species ~ blooming + treatment + (1 | repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1144.1   1161.3   -567.1   1134.1      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.01633  0.1278  
## Number of obs: 228, groups:  repID, 126
## 
## Overdispersion parameter for nbinom1 family (): 0.0795 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.00597    0.04813   41.68  &lt; 2e-16 ***
## bloomingpost   -0.25487    0.05213   -4.89 1.01e-06 ***
## treatmentshrub  0.14564    0.05679    2.56   0.0103 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>s2 &lt;- glmmTMB(Species ~ blooming * treatment + (1|repID), family = poisson, data = beetle)
summary(s2)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          Species ~ blooming * treatment + (1 | repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1143.0   1160.2   -566.5   1133.0      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.02112  0.1453  
## Number of obs: 228, groups:  repID, 126
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                  1.97358    0.05438   36.29  &lt; 2e-16 ***
## bloomingpost                -0.19014    0.07365   -2.58  0.00983 ** 
## treatmentshrub               0.20177    0.07371    2.74  0.00619 ** 
## bloomingpost:treatmentshrub -0.12001    0.10062   -1.19  0.23296    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>s3 &lt;- glmmTMB(Species ~ (1|repID), family = poisson, data = beetle)
summary(s3)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          Species ~ (1 | repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1170.9   1177.7   -583.4   1166.9      226 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  repID  (Intercept) 0.02362  0.1537  
## Number of obs: 228, groups:  repID, 126
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.95137    0.02897   67.35   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(s1, s1.nb, s2, s3)</code></pre>
<pre><code>##       df      AIC
## s1     4 1142.469
## s1.nb  5 1144.141
## s2     5 1143.046
## s3     2 1170.885</code></pre>
<pre class="r"><code>#poisson best here
anova(s1,s2, s3)</code></pre>
<pre><code>## Data: beetle
## Models:
## s3: Species ~ (1 | repID), zi=~0, disp=~1
## s1: Species ~ blooming + treatment + (1 | repID), zi=~0, disp=~1
## s2: Species ~ blooming * treatment + (1 | repID), zi=~0, disp=~1
##    Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## s3  2 1170.9 1177.7 -583.44   1166.9                              
## s1  4 1142.5 1156.2 -567.23   1134.5 32.4159      2  9.141e-08 ***
## s2  5 1143.0 1160.2 -566.52   1133.0  1.4229      1     0.2329    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(s1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: Species
##             Chisq Df Pr(&gt;Chisq)    
## blooming  25.5826  1  4.239e-07 ***
## treatment  6.6195  1    0.01009 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>ggplot(beetle, aes(blooming, Species)) + geom_boxplot() + facet_grid(~treatment)</code></pre>
<p><img src="index_files/figure-html/arthropod%20richness-1.png" width="672" /></p>
<pre class="r"><code>ggplot(beetle, aes(treatment, Species)) + geom_boxplot() + facet_grid(~blooming)</code></pre>
<p><img src="index_files/figure-html/arthropod%20richness-2.png" width="672" /></p>
<pre class="r"><code>#species accumulation
insects &lt;- read.csv(&quot;Output Data/wide_yesbeetle.csv&quot;)
row.names(insects) &lt;- insects$X
insects &lt;- select(insects, -X)
plot(specaccum(insects), xlab = &quot;# of samples&quot;, ylab = &quot;# of species&quot;)</code></pre>
<p><img src="index_files/figure-html/species%20accumulation-1.png" width="672" /></p>
<pre class="r"><code>insects &lt;- read.csv(&quot;Output Data/wide_yesbeetle.csv&quot;)
bees &lt;- select(insects, 5:7,12,14,16,36,37,42,43,49,50,61,64,65,67,72,73,75,87,92,96)


metadata &lt;- read.csv(&quot;Clean Data/pantraps_cov.csv&quot;, header = TRUE)
metadata &lt;- filter(metadata, species != &quot;buckhorn&quot;)
metadata$plant.id &lt;- as.character(metadata$plant.id)
str(metadata)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  9 variables:
##  $ plant.id     : chr  &quot;296&quot; &quot;296&quot; &quot;189&quot; &quot;189&quot; ...
##  $ species      : Factor w/ 2 levels &quot;buckhorn&quot;,&quot;larrea&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ blooming     : Factor w/ 2 levels &quot;post&quot;,&quot;pre&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ date         : Factor w/ 21 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  15 3 25 2 40 15 40 3 70 10 ...
##  $ rich         : int  3 3 6 6 1 3 3 2 3 4 ...
##  $ perennial    : Factor w/ 5 levels &quot;&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X            : Factor w/ 6 levels &quot;&quot;,&quot;blue and white knocked over&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>metadata$uniID &lt;- paste(metadata$date, metadata$plant.id, metadata$treatment)
row.names(metadata) &lt;- metadata$uniID


beemeta &lt;- metadata

beemeta$abun &lt;- apply(bees, 1, sum)
#check for total
sum(beemeta$abun)</code></pre>
<pre><code>## [1] 144</code></pre>
<pre class="r"><code>H &lt;- diversity(bees)
simp &lt;- diversity(bees, &quot;simpson&quot;)
S &lt;- specnumber(bees)
J &lt;- H/log(S)
beemeta$H &lt;- H
beemeta$Simpson &lt;- simp
beemeta$Species &lt;- S
beemeta$Even &lt;- J


t.test(beemeta$Species ~ beemeta$blooming)</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  beemeta$Species by beemeta$blooming
## t = 0.30599, df = 224.71, p-value = 0.7599
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.1662234  0.2273345
## sample estimates:
## mean in group post  mean in group pre 
##          0.5583333          0.5277778</code></pre>
<pre class="r"><code>library(glmmTMB)
m1 &lt;- glmmTMB(Species ~ treatment + blooming + (1|plant.id), family = &quot;nbinom2&quot;, beemeta)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          Species ~ treatment + blooming + (1 | plant.id)
## Data: beemeta
## 
##      AIC      BIC   logLik deviance df.resid 
##    454.3    471.5   -222.2    444.3      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups   Name        Variance  Std.Dev. 
##  plant.id (Intercept) 2.836e-08 0.0001684
## Number of obs: 228, groups:  plant.id, 63
## 
## Overdispersion parameter for nbinom2 family (): 15.7 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -0.55101    0.15266  -3.610 0.000307 ***
## treatmentshrub -0.06457    0.18278  -0.353 0.723867    
## bloomingpre    -0.05632    0.18327  -0.307 0.758605    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: Species
##            Chisq Df Pr(&gt;Chisq)
## treatment 0.1248  1     0.7239
## blooming  0.0944  1     0.7586</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(Species ~ treatment + blooming + (1|plant.id), family = &quot;poisson&quot;, beemeta)

summary(m2)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          Species ~ treatment + blooming + (1 | plant.id)
## Data: beemeta
## 
##      AIC      BIC   logLik deviance df.resid 
##    452.4    466.2   -222.2    444.4      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups   Name        Variance Std.Dev.
##  plant.id (Intercept) 0.01397  0.1182  
## Number of obs: 228, groups:  plant.id, 63
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -0.55806    0.15905  -3.509  0.00045 ***
## treatmentshrub -0.06454    0.17970  -0.359  0.71948    
## bloomingpre    -0.05522    0.18050  -0.306  0.75966    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m3 &lt;- glmmTMB(Species ~ treatment * blooming + (1|plant.id), family = &quot;poisson&quot;, beemeta)

null &lt;- glmmTMB(Species ~  (1|plant.id), family = &quot;poisson&quot;, beemeta)

#poisson is best
AIC(m1, m2, m3, null)</code></pre>
<pre><code>##      df      AIC
## m1    5 454.3296
## m2    4 452.4455
## m3    5 454.4016
## null  2 448.6682</code></pre>
<pre class="r"><code>#null model has lowest AIC
car::Anova(m2, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: Species
##            Chisq Df Pr(&gt;Chisq)
## treatment 0.1290  1     0.7195
## blooming  0.0936  1     0.7597</code></pre>
<pre class="r"><code>#bee abundance

m1 &lt;- glmmTMB(abun ~ treatment + blooming + (1|plant.id), family = &quot;nbinom2&quot;, beemeta)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ treatment + blooming + (1 | plant.id)
## Data: beemeta
## 
##      AIC      BIC   logLik deviance df.resid 
##    503.7    520.9   -246.9    493.7      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups   Name        Variance Std.Dev.
##  plant.id (Intercept) 0.005254 0.07249 
## Number of obs: 228, groups:  plant.id, 63
## 
## Overdispersion parameter for nbinom2 family (): 1.86 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)    -0.47282    0.17801  -2.656   0.0079 **
## treatmentshrub -0.05412    0.19352  -0.280   0.7797   
## bloomingpre     0.07755    0.19354   0.401   0.6886   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: abun
##            Chisq Df Pr(&gt;Chisq)
## treatment 0.0782  1     0.7797
## blooming  0.1606  1     0.6886</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(abun ~ treatment + blooming + (1|plant.id), family = &quot;poisson&quot;, beemeta)

summary(m2)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          abun ~ treatment + blooming + (1 | plant.id)
## Data: beemeta
## 
##      AIC      BIC   logLik deviance df.resid 
##    507.6    521.3   -249.8    499.6      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups   Name        Variance Std.Dev.
##  plant.id (Intercept) 0.1509   0.3884  
## Number of obs: 228, groups:  plant.id, 63
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -0.54750    0.15925  -3.438 0.000586 ***
## treatmentshrub -0.05558    0.16673  -0.333 0.738882    
## bloomingpre     0.09348    0.16864   0.554 0.579347    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m3 &lt;- glmmTMB(abun ~ treatment * blooming + (1|plant.id), family = &quot;poisson&quot;, beemeta)

null &lt;- glmmTMB(abun ~  (1|plant.id), family = &quot;poisson&quot;, beemeta)

#poisson is best
AIC(m1, m2, m3, null)</code></pre>
<pre><code>##      df      AIC
## m1    5 503.7089
## m2    4 507.5898
## m3    5 509.3348
## null  2 504.0082</code></pre>
<pre class="r"><code>#null model has lowest AIC
car::Anova(m2, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: abun
##            Chisq Df Pr(&gt;Chisq)
## treatment 0.1111  1     0.7389
## blooming  0.3073  1     0.5793</code></pre>
<p>```</p>
<p>Need to add code for bee abundance and bee diversity. Bee abundance won’t change, diversity is unlikely.</p>
</div>
<div id="visitation-to-l.-tridentata" class="section level3">
<h3>Visitation to L. tridentata</h3>
<p>In-situ observation of visitation to L. tridentata, to determine which pollinators were visiting and if visitation was related to flower number and/or height</p>
<pre class="r"><code>larrea &lt;- read.csv(&quot;Clean Data/larreavisits.csv&quot;)
cov &lt;- read.csv(&quot;Clean Data/insitu_cov_larrea.csv&quot;)
sizes &lt;- read.csv(&quot;Clean Data/video_larreadimensions.csv&quot;)
cov &lt;- distinct(cov)
cov &lt;- select(cov, -date)
cov$repID &lt;- paste(cov$plant.id, &quot;post&quot;)

larrea$repID &lt;- paste(larrea$PlantID, larrea$pre.post)
cov &lt;- inner_join(cov, sizes, by = &quot;plant.id&quot;)</code></pre>
<pre><code>## Warning: Column `plant.id` joining factors with different levels, coercing
## to character vector</code></pre>
<pre class="r"><code>cov &lt;- select(cov, -plant.id)
larrea &lt;- left_join(larrea, cov, by = &quot;repID&quot;)

#N.FLOWER is only applicable to post. it was just easier to join this way!

count(larrea, pre.post)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   pre.post     n
##   &lt;fct&gt;    &lt;int&gt;
## 1 post       401
## 2 pre        138</code></pre>
<pre class="r"><code>#how does floral visitation relate to #flowers
fl &lt;- filter(larrea, part.used == &quot;flower&quot;)
fl.count &lt;- fl %&gt;% count(repID)

lar.all &lt;- left_join(cov, fl.count, by = &quot;repID&quot;)

#there are 58 because of the wind 

#attach neighbour density
pans &lt;- read.csv(&quot;Output Data/metadata_yesbeetle.csv&quot;)
pans$repID &lt;- paste(pans$plant.id, pans$blooming)
pans &lt;- filter(pans, blooming == &quot;post&quot; &amp; treatment == &quot;shrub&quot;)
lar.all &lt;- left_join(lar.all, pans, by = &quot;repID&quot;)

lar.all$n[is.na(lar.all$n)] &lt;- 0

#join video covariates
vid.cov &lt;- read.csv(&quot;Clean Data/video_cov.csv&quot;)
vid.cov$flowering &lt;- gsub(&quot;bloom&quot;, &quot;post&quot;, vid.cov$flowering)
vid.cov$repID &lt;- paste(vid.cov$PlantID, vid.cov$flowering)
lar.all &lt;- vid.cov %&gt;% filter(flowering == &quot;post&quot; &amp; treatment == &quot;shrub&quot;) %&gt;% left_join(lar.all, vid.cov, by = &quot;repID&quot;)

ggplot(lar.all, aes(n)) + geom_density()</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/larrea%20visitation-1.png" width="672" /></p>
<pre class="r"><code>visitors &lt;- fl %&gt;% group_by(., pre.post, part.used) %&gt;% count(., v.species)
sum(visitors$n)</code></pre>
<pre><code>## [1] 197</code></pre>
<pre class="r"><code>#modelling
cov &lt;- left_join(cov, fl.count, by = &quot;repID&quot;)
cov$n[is.na(cov$n)] &lt;- 0

m1 &lt;- glm(data = cov, family = &quot;quasipoisson&quot;(link=&quot;log&quot;), n ~ n.flowers)

summary(m1)</code></pre>
<pre><code>## 
## Call:
## glm(formula = n ~ n.flowers, family = quasipoisson(link = &quot;log&quot;), 
##     data = cov)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.6742  -1.5054  -0.4227   0.8007   5.2371  
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept) 0.7820540  0.2417340   3.235  0.00204 **
## n.flowers   0.0013408  0.0005728   2.341  0.02283 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 3.367143)
## 
##     Null deviance: 198.46  on 57  degrees of freedom
## Residual deviance: 182.84  on 56  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>car::Anova(m1)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: n
##           LR Chisq Df Pr(&gt;Chisq)  
## n.flowers   4.6383  1    0.03127 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m2 &lt;- glm(data = cov, family = &quot;quasipoisson&quot;(link=&quot;log&quot;), n ~ n.flowers + height)
m3 &lt;- glm(data = cov, family = &quot;quasipoisson&quot;(link=&quot;log&quot;), n ~ height)

summary(m2)</code></pre>
<pre><code>## 
## Call:
## glm(formula = n ~ n.flowers + height, family = quasipoisson(link = &quot;log&quot;), 
##     data = cov)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.8819  -1.5538  -0.3812   1.0401   4.7540  
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept) -8.865e-05  6.637e-01   0.000   0.9999  
## n.flowers    1.069e-03  6.084e-04   1.756   0.0847 .
## height       4.010e-03  3.087e-03   1.299   0.1995  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 3.265603)
## 
##     Null deviance: 197.77  on 56  degrees of freedom
## Residual deviance: 177.29  on 54  degrees of freedom
##   (1 observation deleted due to missingness)
## AIC: NA
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>summary(m3)</code></pre>
<pre><code>## 
## Call:
## glm(formula = n ~ height, family = quasipoisson(link = &quot;log&quot;), 
##     data = cov)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.1211  -1.6240  -0.5905   1.1983   4.6031  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept) 0.044102   0.638327   0.069    0.945  
## height      0.005400   0.002824   1.913    0.061 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 3.209795)
## 
##     Null deviance: 197.77  on 56  degrees of freedom
## Residual deviance: 186.19  on 55  degrees of freedom
##   (1 observation deleted due to missingness)
## AIC: NA
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>car::Anova(m3, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: n
##        LR Chisq Df Pr(&gt;Chisq)  
## height   3.6066  1    0.05755 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>ggplot(cov, aes(n.flowers, n)) + geom_point(shape = 1) + geom_smooth(color = &quot;black&quot;, size = 0.5) + theme_Publication() + xlab(&quot;Floral abundance&quot;) + ylab(&quot;Visits per 15 min&quot;)</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x
## $y, : font family not found in Windows font database</code></pre>
<p><img src="index_files/figure-html/larrea%20visitation-2.png" width="672" /></p>
<pre class="r"><code>#cor.test(repcounts.all$n.flowers, repcounts.all$width)
cor.test(lar.all$n.flowers, lar.all$height)</code></pre>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  lar.all$n.flowers and lar.all$height
## t = 2.6659, df = 56, p-value = 0.01002
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.08463171 0.54651435
## sample estimates:
##       cor 
## 0.3355914</code></pre>
<pre class="r"><code>#cor.test(repcounts.all$width, repcounts.all$height)</code></pre>
<hr />
</div>
</div>
</div>
<div id="abiotic-effects" class="section level1">
<h1>Abiotic effects</h1>
<p>16 data loggers were placed in shrub/open microsites (8 and 8).</p>
<pre class="r"><code>setwd(&quot;Clean Data/loggers&quot;)
temp &lt;- list.files(pattern=&quot;*.csv&quot;)
name &lt;- list.files(pattern=&quot;*.csv&quot;)
datalist &lt;- list()
for (i in 1:length(temp)) {
  ob &lt;- read.csv(temp[i], header = FALSE)    #read in csv
  ob &lt;- ob[-1,] #delete weird first row
  #colnames(ob) &lt;- as.character(unlist(ob[1,]))
  ob &lt;- ob[-1,]

  ob$loggername &lt;- name[i]
  datalist[[i]] &lt;- ob
}

allLoggers &lt;- bind_rows(datalist)
colnames(allLoggers) &lt;- c(&quot;1&quot;, &quot;date.time&quot;, &quot;temp&quot;, &quot;light.intensity&quot;, &quot;coupler.detached&quot;, &quot;coupler.attached&quot;, &quot;host.connected&quot;, &quot;stopped&quot;, &quot;logger.name&quot;, &quot;end.of.file&quot;, &quot;empty col&quot;)

#now for some wrangling
# split day and time column

 
allLoggers &lt;- dplyr::select(allLoggers, -11)  
allLoggers &lt;- separate(allLoggers, date.time, c(&quot;Date&quot;, &quot;time&quot;), sep = 9) %&gt;% dplyr::select(-1) %&gt;% separate(&quot;logger.name&quot;, c(&quot;plant.id&quot;, &quot;treatment&quot;, sep = &quot;-&quot;)) %&gt;% dplyr::select(Date:light.intensity, plant.id:treatment) %&gt;% separate(plant.id, c(&quot;species&quot;, &quot;id&quot;), sep = 1)

#delete rows from first days and last days
#delete rows from last day

allLoggers$Date &lt;- gsub(&quot; &quot;,&quot;&quot;, allLoggers$Date)
allLoggers &lt;- filter(allLoggers, Date != &quot;05/11/17&quot; &amp; Date != &quot;03/17/17&quot; &amp; Date != &quot;03/18/17&quot;) 
allLoggers &lt;- filter(allLoggers, Date != &quot;&quot;) 
                     
#convert time from 12 to 24 hours
allLoggers$time &lt;- format(strptime(allLoggers$time, &quot;%I:%M:%S %p&quot;), format=&quot;%H:%M:%S&quot;)

allLoggers$hour &lt;- substr(allLoggers$time,1,2)
allLoggers$temp &lt;- as.numeric(allLoggers$temp)
#EDA

str(allLoggers)</code></pre>
<pre><code>## &#39;data.frame&#39;:    81408 obs. of  8 variables:
##  $ Date           : chr  &quot;03/19/17&quot; &quot;03/19/17&quot; &quot;03/19/17&quot; &quot;03/19/17&quot; ...
##  $ time           : chr  &quot;00:00:00&quot; &quot;00:30:00&quot; &quot;01:00:00&quot; &quot;01:30:00&quot; ...
##  $ temp           : num  52.6 53.1 47.4 45.3 44.6 ...
##  $ light.intensity: chr  &quot;0.0&quot; &quot;0.0&quot; &quot;0.0&quot; &quot;0.0&quot; ...
##  $ species        : chr  &quot;B&quot; &quot;B&quot; &quot;B&quot; &quot;B&quot; ...
##  $ id             : chr  &quot;253&quot; &quot;253&quot; &quot;253&quot; &quot;253&quot; ...
##  $ treatment      : chr  &quot;Open&quot; &quot;Open&quot; &quot;Open&quot; &quot;Open&quot; ...
##  $ hour           : chr  &quot;00&quot; &quot;00&quot; &quot;01&quot; &quot;01&quot; ...</code></pre>
<pre class="r"><code>#larrea only

larrea &lt;- filter(allLoggers, species == &quot;L&quot;)
dailymax &lt;- larrea %&gt;% group_by(treatment, Date, id) %&gt;% summarise(maxTemp = max(temp))
ggplot(data = dailymax, aes(Date, maxTemp, color = treatment)) + geom_point() </code></pre>
<p><img src="index_files/figure-html/data%20loggers-1.png" width="672" /></p>
<pre class="r"><code>dailymin &lt;- larrea %&gt;% group_by(treatment, Date, id) %&gt;% summarise(minTemp = min(temp))
ggplot(data = dailymin, aes(Date, minTemp, color = treatment)) + geom_point() </code></pre>
<p><img src="index_files/figure-html/data%20loggers-2.png" width="672" /></p>
<pre class="r"><code>larrea$temp &lt;- as.numeric(larrea$temp)
larrea$hour &lt;- as.numeric(larrea$hour)
daytime &lt;- filter(larrea, hour &gt;= 9 &amp; hour&lt;21)
daytime &lt;- na.omit(daytime)
nighttime &lt;- filter(larrea, hour &gt;=21 | hour&lt;9)
nighttime &lt;-na.omit(nighttime)
all &lt;- larrea %&gt;% group_by(treatment, Date, id) %&gt;% summarise(meanTemp = mean(temp), varTemp = sd(temp))


meanday &lt;- daytime %&gt;% group_by(treatment, Date, id) %&gt;% summarise(meanTemp = mean(temp), varTemp = sd(temp))

meannight&lt;- nighttime %&gt;% group_by(treatment, Date, id) %&gt;% summarise(meanTemp = mean(temp), varTemp = sd(temp))

str(larrea)</code></pre>
<pre><code>## &#39;data.frame&#39;:    40704 obs. of  8 variables:
##  $ Date           : chr  &quot;03/19/17&quot; &quot;03/19/17&quot; &quot;03/19/17&quot; &quot;03/19/17&quot; ...
##  $ time           : chr  &quot;00:27:13&quot; &quot;00:57:13&quot; &quot;01:27:13&quot; &quot;01:57:13&quot; ...
##  $ temp           : num  46.9 44.4 42.7 42.4 41.4 ...
##  $ light.intensity: chr  &quot;0.0&quot; &quot;0.0&quot; &quot;0.0&quot; &quot;0.0&quot; ...
##  $ species        : chr  &quot;L&quot; &quot;L&quot; &quot;L&quot; &quot;L&quot; ...
##  $ id             : chr  &quot;104&quot; &quot;104&quot; &quot;104&quot; &quot;104&quot; ...
##  $ treatment      : chr  &quot;Open&quot; &quot;Open&quot; &quot;Open&quot; &quot;Open&quot; ...
##  $ hour           : num  0 0 1 1 2 2 3 3 4 4 ...</code></pre>
<pre class="r"><code>larrea$hour &lt;- as.factor(larrea$hour)

#figure for all
ggplot(data = larrea, aes(hour, ((temp-32)*0.5556))) + geom_boxplot(aes(fill = treatment)) + theme_Publication() + xlab(&quot;Hour&quot;) + ylab(&quot;Temperature in °C&quot;) + scale_fill_manual(values=c(&quot;#AF955A&quot;, &quot;darkgreen&quot;), name = &quot;Microsite&quot;)</code></pre>
<p><img src="index_files/figure-html/data%20loggers-3.png" width="672" /></p>
<pre class="r"><code>meannight$treatment &lt;- as.factor(meannight$treatment)
kruskal.test(meannight$meanTemp ~ meannight$treatment)</code></pre>
<pre><code>## 
##  Kruskal-Wallis rank sum test
## 
## data:  meannight$meanTemp by meannight$treatment
## Kruskal-Wallis chi-squared = 48.314, df = 1, p-value = 3.631e-12</code></pre>
<pre class="r"><code>ggplot(meannight, aes(meanTemp, fill = treatment)) + geom_density()       </code></pre>
<p><img src="index_files/figure-html/data%20loggers-4.png" width="672" /></p>
<pre class="r"><code>#mean nightime temps
meannight$id &lt;- as.factor(meannight$id)
m1 &lt;- glmmTMB(meanTemp ~ treatment + (1|id), family = Gamma(link = &quot;log&quot;), data = meannight)
shapiro.test(resid(m1))</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  resid(m1)
## W = 0.98423, p-value = 6.447e-08</code></pre>
<pre class="r"><code>summary(m1)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          meanTemp ~ treatment + (1 | id)
## Data: meannight
## 
##      AIC      BIC   logLik deviance df.resid 
##   5635.6   5654.5  -2813.8   5627.6      844 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  id     (Intercept) 0.001156 0.034   
## Number of obs: 848, groups:  id, 8
## 
## Dispersion estimate for Gamma family (sigma^2): 0.0149 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    3.968319   0.013402  296.09  &lt; 2e-16 ***
## treatmentShrub 0.059057   0.008383    7.05 1.85e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type =2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: meanTemp
##            Chisq Df Pr(&gt;Chisq)    
## treatment 49.635  1  1.852e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#mean daytime temps
m2 &lt;- glmmTMB(meanTemp ~ treatment + (1|id), family = Gamma(link = &quot;log&quot;), data = meanday)
summary(m2)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          meanTemp ~ treatment + (1 | id)
## Data: meanday
## 
##      AIC      BIC   logLik deviance df.resid 
##   6235.0   6253.9  -3113.5   6227.0      844 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev.
##  id     (Intercept) 0.0003273 0.01809 
## Number of obs: 848, groups:  id, 8
## 
## Dispersion estimate for Gamma family (sigma^2): 0.0104 
## 
## Conditional model:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     4.563877   0.008092   564.0   &lt;2e-16 ***
## treatmentShrub -0.064621   0.007011    -9.2   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m2, type =2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: meanTemp
##            Chisq Df Pr(&gt;Chisq)    
## treatment 84.959  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>meanAll &lt;- rbind(meanday, meannight)

#overal temperature variation
m3 &lt;- glmmTMB(varTemp ~ treatment + (1|id), family = Gamma(link = &quot;log&quot;), data = all)
summary(m3)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          varTemp ~ treatment + (1 | id)
## Data: all
## 
##      AIC      BIC   logLik deviance df.resid 
##   5063.6   5082.6  -2527.8   5055.6      844 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  id     (Intercept) 0.003514 0.05927 
## Number of obs: 848, groups:  id, 8
## 
## Dispersion estimate for Gamma family (sigma^2): 0.0317 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     3.42565    0.02268   151.1   &lt;2e-16 ***
## treatmentShrub -0.27953    0.01226   -22.8   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m3, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: varTemp
##           Chisq Df Pr(&gt;Chisq)    
## treatment 519.9  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="rii" class="section level1">
<h1>RII</h1>
<p>This code bootstraps 95% confidence intervals. Adapted from code written by Dr. Alex Filazzola <a href="https://github.com/afilazzola/CommEcolFunctions" class="uri">https://github.com/afilazzola/CommEcolFunctions</a></p>
<pre class="r"><code>rii.m &lt;- function(x, j, var)
{
  #parse out shrub and open
  s1 &lt;- subset(x, treatment == &quot;shrub&quot;, select=var)
  o1 &lt;- subset(x, treatment == &quot;open&quot;, select=var)
  return1 &lt;- (s1 - o1) / (s1+o1)  # Rii formula
  # attach factors
  x1 &lt;- x[seq(1, nrow(x), by = 2),]
  return2 &lt;- cbind(x1[j], return1)
  return2[is.na(return2)] &lt;- 0
  print(return2)
}

rii.b &lt;- function(x, j, var)
{
  #parse out shrub and open
  s1 &lt;- subset(x, flowering == &quot;bloom&quot;, select=var)
  o1 &lt;- subset(x, flowering == &quot;pre&quot;, select=var)
  return1 &lt;- (s1 - o1) / (s1+o1)  # Rii formula
  # attach factors
  x1 &lt;- x[seq(1, nrow(x), by = 2),]
  return2 &lt;- cbind(x1[j], return1)
  return2[is.na(return2)] &lt;- 0
  print(return2)
}


byrep &lt;- read.csv(&quot;Output Data/byrep_cleaned.csv&quot;)
metadata &lt;- read.csv(&quot;Output Data/metadata_nobeetle.csv&quot;)
yesbeetle &lt;- read.csv(&quot;Output Data/metadata_yesbeetle.csv&quot;)
pre &lt;- filter(byrep, flowering == &quot;pre&quot;)
pre &lt;- dplyr::select(pre, Date, mean.Solar, mean.Wind, mean.Temp, PlantID, treatment, flowering, understory.richness, visits.per.hour, flowers.per.hour)
#split into 2 dataframes, rename the visitation columns and then rbind
#there are 2 unmatched reps
pre &lt;- arrange(pre, PlantID)
pre &lt;- filter(pre, PlantID != 266 &amp; PlantID != 275 &amp; PlantID != 276 &amp; PlantID != 196)
pre.visits &lt;- rii.m(pre, c(1:7), 8:10)</code></pre>
<pre><code>##          Date mean.Solar mean.Wind mean.Temp PlantID treatment flowering
## 1   4.20.2017  0.7987500  6.125000  17.86250     104      open       pre
## 3   4.19.2017  0.7762500  6.025000  17.90000     114      open       pre
## 5   4.10.2017  0.7625000  5.150000  18.35000     146      open       pre
## 7   4.13.2017  0.7600000  6.112500  18.56250     180      open       pre
## 9   4.19.2017  0.7762500  6.025000  17.90000     181      open       pre
## 11  4.16.2017  0.7387500  5.175000  18.75000     182      open       pre
## 13  4.19.2017  0.7762500  6.025000  17.90000     183      open       pre
## 15  4.14.2017  0.7671429  6.242857  15.88571     184      open       pre
## 17  4.16.2017  0.7387500  5.175000  18.75000     185      open       pre
## 19  4.13.2017  0.7600000  6.112500  18.56250     186      open       pre
## 21  4.10.2017  0.7625000  5.150000  18.35000     187      open       pre
## 23  4.14.2017  0.7671429  6.242857  15.88571     188      open       pre
## 25  4.12.2017  0.7587500  6.662500  18.61250     189      open       pre
## 27  4.12.2017  0.7587500  6.662500  18.61250     190      open       pre
## 29  4.11.2017  0.6100000  6.325000  18.57500     191      open       pre
## 31  4.13.2017  0.7600000  6.112500  18.56250     192      open       pre
## 33  4.10.2017  0.7625000  5.150000  18.35000     193      open       pre
## 35  4.11.2017  0.6100000  6.325000  18.57500     194      open       pre
## 37  4.14.2017  0.7671429  6.242857  15.88571     195      open       pre
## 39  4.14.2017  0.7671429  6.242857  15.88571     197      open       pre
## 41  4.19.2017  0.7762500  6.025000  17.90000     198      open       pre
## 43  4.13.2017  0.7600000  6.112500  18.56250     199      open       pre
## 45  4.20.2017  0.7987500  6.125000  17.86250     261      open       pre
## 47  4.13.2017  0.7600000  6.112500  18.56250     262      open       pre
## 49  4.12.2017  0.7587500  6.662500  18.61250     263      open       pre
## 51  4.16.2017  0.7387500  5.175000  18.75000     264      open       pre
## 53  4.11.2017  0.6100000  6.325000  18.57500     265      open       pre
## 55  4.14.2017  0.7671429  6.242857  15.88571     268      open       pre
## 57  4.14.2017  0.7671429  6.242857  15.88571     269      open       pre
## 59  4.18.2017  0.6685714  6.014286  16.25714     270      open       pre
## 61  4.18.2017  0.6685714  6.014286  16.25714     271      open       pre
## 63  4.12.2017  0.7587500  6.662500  18.61250     272      open       pre
## 65  4.10.2017  0.7625000  5.150000  18.35000     273      open       pre
## 67  4.19.2017  0.7762500  6.025000  17.90000     274      open       pre
## 69  4.15.2017  0.7687500  5.175000  18.50000     278      open       pre
## 71  4.15.2017  0.7687500  5.175000  18.50000     280      open       pre
## 73  4.19.2017  0.7762500  6.025000  17.90000     281      open       pre
## 75  4.15.2017  0.7687500  5.175000  18.50000     282      open       pre
## 77  4.18.2017  0.6685714  6.014286  16.25714     283      open       pre
## 79  4.20.2017  0.7987500  6.125000  17.86250     285      open       pre
## 81  4.16.2017  0.7387500  5.175000  18.75000     286      open       pre
## 83  4.10.2017  0.7625000  5.150000  18.35000     288      open       pre
## 85  4.11.2017  0.6100000  6.325000  18.57500     289      open       pre
## 87  4.18.2017  0.6685714  6.014286  16.25714     290      open       pre
## 89  4.16.2017  0.7387500  5.175000  18.75000     291      open       pre
## 91  4.12.2017  0.7587500  6.662500  18.61250     293      open       pre
## 93  4.15.2017  0.7687500  5.175000  18.50000     294      open       pre
## 95  4.15.2017  0.7687500  5.175000  18.50000     295      open       pre
## 97  4.12.2017  0.7587500  6.662500  18.61250     296      open       pre
## 99  4.18.2017  0.6685714  6.014286  16.25714     297      open       pre
## 101 4.18.2017  0.6685714  6.014286  16.25714     298      open       pre
## 103 4.15.2017  0.7687500  5.175000  18.50000     299      open       pre
## 105 4.13.2017  0.7600000  6.112500  18.56250     300      open       pre
## 107 4.20.2017  0.7987500  6.125000  17.86250     301      open       pre
## 109 4.20.2017  0.7987500  6.125000  17.86250     302      open       pre
## 111 4.20.2017  0.7987500  6.125000  17.86250     303      open       pre
##     understory.richness visits.per.hour flowers.per.hour
## 1            -0.2000000      0.00000000       0.00000000
## 3             0.3333333     -0.32327375      -0.43086291
## 5            -0.2500000     -0.53995650      -0.64828245
## 7             0.1428571     -0.49268367      -0.37631269
## 9             0.2000000      0.09979235       0.09979235
## 11            0.2000000      0.09080377       0.41167651
## 13            0.0000000      1.00000000       1.00000000
## 15            0.2000000      1.00000000       1.00000000
## 17            0.0000000     -0.84112430      -0.84112430
## 19            0.0000000     -0.39470508      -0.44954263
## 21            0.0000000     -0.24053372      -0.39150535
## 23            0.0000000     -0.42573377      -0.53599233
## 25            0.3333333      0.07970170      -0.04068744
## 27            0.1428571     -0.01510029       0.07591301
## 29            0.3333333     -0.13339954      -0.32473562
## 31           -0.2000000     -0.85854322      -0.87413790
## 33            0.1428571     -0.53661648      -0.60419442
## 35            0.2000000     -0.16648570       0.02088555
## 37            0.2000000      0.06795422       0.06795422
## 39           -0.5000000      1.00000000       1.00000000
## 41           -0.1428571     -0.04021855      -0.04021855
## 43           -0.3333333      0.47209055       0.63381000
## 45            0.3333333      1.00000000       1.00000000
## 47           -0.2000000     -0.19191919      -0.19191919
## 49            0.0000000     -0.58408139      -0.70206837
## 51            0.3333333     -0.24078953      -0.15323474
## 53            0.0000000      0.36856445       0.31660500
## 55           -0.2000000     -0.86015705      -0.92754546
## 57            0.0000000     -0.46210327      -0.46210327
## 59            0.2000000      0.41789617       0.41789617
## 61            0.2000000     -0.06500618      -0.06500618
## 63            0.2000000     -0.38523645      -0.16953939
## 65            0.2000000     -0.49155244      -0.62027508
## 67            0.2000000      0.59512283       0.59512283
## 69            0.0000000      0.06763726       0.06763726
## 71           -0.2000000     -0.69652598      -0.38197977
## 73            0.0000000     -1.00000000      -1.00000000
## 75            0.2000000     -0.09849443      -0.09849443
## 77            0.3333333      0.21679413       0.21679413
## 79           -0.2000000      1.00000000       1.00000000
## 81           -0.3333333     -0.75099206      -0.75099206
## 83            0.0000000     -0.39427116      -0.39427116
## 85            0.4285714      1.00000000       1.00000000
## 87            0.0000000      0.00000000       0.00000000
## 89            0.0000000     -0.01779812      -0.01779812
## 91           -0.1428571     -1.00000000      -1.00000000
## 93            0.0000000      0.16324168       0.02087126
## 95            0.3333333      0.41225952       0.41225952
## 97            0.5000000      0.39944808       0.13930504
## 99           -0.5000000     -1.00000000      -1.00000000
## 101           0.0000000      0.00000000       0.00000000
## 103          -0.2000000      0.11282376      -0.16497997
## 105           0.0000000      0.06278348       0.06278348
## 107          -0.2000000     -1.00000000      -1.00000000
## 109           0.0000000      0.56896852       0.56896852
## 111           0.3333333     -0.33248225      -0.33248225</code></pre>
<pre class="r"><code>post &lt;- filter(byrep, flowering ==&quot;bloom&quot;)
post &lt;- dplyr::select(post, Date, mean.Solar, mean.Wind, mean.Temp, PlantID, treatment, flowering, understory.richness, visits.per.hour, flowers.per.hour)
post &lt;- arrange(post, PlantID)
post &lt;- filter(post, PlantID != 198)
post &lt;- distinct(post)
post.visits &lt;- rii.m(post, c(1:7), 8:10)</code></pre>
<pre><code>##          Date mean.Solar mean.Wind mean.Temp PlantID treatment flowering
## 1   4.27.2017  0.6600000  4.125000  17.36250     104      open     bloom
## 3   4.26.2017  0.6562500  5.187500  17.40000     114      open     bloom
## 5   4.22.2017  0.7737500  5.425000  17.20000     146      open     bloom
## 7   4.21.2017  0.7728571  7.128571  15.92857     180      open     bloom
## 9   4.27.2017  0.6600000  4.125000  17.36250     181      open     bloom
## 11  4.21.2017  0.7728571  7.128571  15.92857     182      open     bloom
## 13  4.30.2017  0.8087500  4.787500  17.52500     183      open     bloom
## 15  4.29.2017  0.8125000  5.000000  17.26250     184      open     bloom
## 17   5.2.2017  0.7971429  6.200000  16.20000     185      open     bloom
## 19  4.27.2017  0.6600000  4.125000  17.36250     186      open     bloom
## 21  4.30.2017  0.8087500  4.787500  17.52500     187      open     bloom
## 23  4.25.2017  0.7142857  5.985714  16.41429     188      open     bloom
## 25  4.21.2017  0.7728571  7.128571  15.92857     189     shrub     bloom
## 27  4.26.2017  0.6562500  5.187500  17.40000     190      open     bloom
## 29  4.29.2017  0.8125000  5.000000  17.26250     191      open     bloom
## 31  4.23.2017  0.7775000  4.575000  17.16250     192      open     bloom
## 33   5.2.2017  0.7971429  6.200000  16.20000     193      open     bloom
## 35  4.21.2017  0.7728571  7.128571  15.92857     194      open     bloom
## 37  4.22.2017  0.7737500  5.425000  17.20000     195      open     bloom
## 39  4.23.2017  0.7775000  4.575000  17.16250     196      open     bloom
## 41  4.22.2017  0.7737500  5.425000  17.20000     197      open     bloom
## 43  4.29.2017  0.8125000  5.000000  17.26250     199      open     bloom
## 45   5.1.2017  0.8025000  5.137500  17.43750     261      open     bloom
## 47  4.25.2017  0.7142857  5.985714  16.41429     262      open     bloom
## 49  4.30.2017  0.8087500  4.787500  17.52500     263      open     bloom
## 51  4.23.2017  0.7775000  4.575000  17.16250     264      open     bloom
## 53  4.27.2017  0.6600000  4.125000  17.36250     265      open     bloom
## 55  4.22.2017  0.7737500  5.425000  17.20000     266      open     bloom
## 57  4.27.2017  0.6600000  4.125000  17.36250     268      open     bloom
## 59  4.26.2017  0.6562500  5.187500  17.40000     269      open     bloom
## 61  4.26.2017  0.6562500  5.187500  17.40000     270      open     bloom
## 63  4.29.2017  0.8125000  5.000000  17.26250     271      open     bloom
## 65  4.27.2017  0.6600000  4.125000  17.36250     272      open     bloom
## 67   5.1.2017  0.8025000  5.137500  17.43750     273      open     bloom
## 69  4.30.2017  0.8087500  4.787500  17.52500     274      open     bloom
## 71  4.21.2017  0.7728571  7.128571  15.92857     275     shrub     bloom
## 73  4.21.2017  0.7728571  7.128571  15.92857     276     shrub     bloom
## 75  4.29.2017  0.8125000  5.000000  17.26250     278      open     bloom
## 77   5.1.2017  0.8025000  5.137500  17.43750     280      open     bloom
## 79   5.2.2017  0.7971429  6.200000  16.20000     281      open     bloom
## 81  4.25.2017  0.7142857  5.985714  16.41429     282      open     bloom
## 83   5.1.2017  0.8025000  5.137500  17.43750     283      open     bloom
## 85  4.30.2017  0.8087500  4.787500  17.52500     285      open     bloom
## 87  4.26.2017  0.6562500  5.187500  17.40000     286      open     bloom
## 89  4.26.2017  0.6562500  5.187500  17.40000     288      open     bloom
## 91  4.22.2017  0.7737500  5.425000  17.20000     289      open     bloom
## 93  4.30.2017  0.8087500  4.787500  17.52500     290      open     bloom
## 95   5.1.2017  0.8025000  5.137500  17.43750     291      open     bloom
## 97  4.25.2017  0.7142857  5.985714  16.41429     293      open     bloom
## 99  4.25.2017  0.7142857  5.985714  16.41429     294      open     bloom
## 101 4.23.2017  0.7775000  4.575000  17.16250     295      open     bloom
## 103 4.29.2017  0.8125000  5.000000  17.26250     296      open     bloom
## 105 4.25.2017  0.7142857  5.985714  16.41429     297      open     bloom
## 107 4.23.2017  0.7775000  4.575000  17.16250     298      open     bloom
## 109  5.2.2017  0.7971429  6.200000  16.20000     300      open     bloom
## 111 4.23.2017  0.7775000  4.575000  17.16250     301      open     bloom
## 113  5.2.2017  0.7971429  6.200000  16.20000     302      open     bloom
## 115 4.22.2017  0.7737500  5.425000  17.20000    new1      open     bloom
##     understory.richness visits.per.hour flowers.per.hour
## 1             0.0000000    -0.172437578     -0.114778289
## 3             0.0000000     0.350885157      0.350885157
## 5             0.0000000    -1.000000000     -1.000000000
## 7            -0.5000000    -0.073640483     -0.317789932
## 9             0.0000000     0.640607950      0.678306066
## 11            0.0000000     0.177209078      0.282752815
## 13            0.0000000    -0.388557468     -0.388557468
## 15            0.0000000    -1.000000000     -1.000000000
## 17            0.0000000     1.000000000      1.000000000
## 19            0.5000000     1.000000000      1.000000000
## 21            0.3333333    -0.773864865     -0.898115853
## 23            0.0000000     0.000000000      0.000000000
## 25            0.0000000     0.000000000      0.000000000
## 27            0.0000000     0.000000000      0.000000000
## 29            0.3333333    -1.000000000     -1.000000000
## 31           -0.2000000    -0.651570028     -0.519233414
## 33            0.2000000    -1.000000000     -1.000000000
## 35            0.0000000     0.000000000      0.000000000
## 37            0.2000000     0.466625175      0.466625175
## 39            0.2000000     0.423433376      0.470536847
## 41            0.0000000     0.008340693      0.008340693
## 43            0.0000000    -1.000000000     -1.000000000
## 45           -0.3333333     0.000000000      0.000000000
## 47            0.0000000     1.000000000      1.000000000
## 49           -0.3333333    -0.524814831     -0.621105492
## 51            0.0000000     0.021329726     -0.314237809
## 53            0.5000000     0.000000000      0.000000000
## 55            0.0000000     0.409843861      0.522130709
## 57            0.0000000    -1.000000000     -1.000000000
## 59            0.0000000    -1.000000000     -1.000000000
## 61            0.0000000    -1.000000000     -1.000000000
## 63            0.3333333    -0.317255435     -0.317255435
## 65            0.2000000     1.000000000      1.000000000
## 67            0.2000000     1.000000000      1.000000000
## 69            0.2000000     0.320395119      0.320395119
## 71            0.5000000     0.573656595      0.297142516
## 73            0.3333333    -0.736976563     -0.808321192
## 75            0.2000000     0.000000000      0.000000000
## 77           -0.2000000    -0.423767301     -0.423767301
## 79           -0.5000000    -0.476598960     -0.718805592
## 81            0.0000000     0.000000000      0.000000000
## 83            0.0000000     0.000000000      0.000000000
## 85           -0.2000000     0.295025406      0.295025406
## 87            0.3333333    -1.000000000     -1.000000000
## 89           -0.2000000    -1.000000000     -1.000000000
## 91           -0.5000000    -1.000000000     -1.000000000
## 93            0.0000000    -0.174879890     -0.537295050
## 95            0.0000000     1.000000000      1.000000000
## 97            0.2000000    -1.000000000     -1.000000000
## 99            0.2000000    -1.000000000     -1.000000000
## 101          -0.2000000    -0.255797854     -0.255797854
## 103          -0.2000000     1.000000000      1.000000000
## 105           0.3333333     0.000000000      0.000000000
## 107          -0.2000000     0.226579594      0.392238985
## 109           0.2000000    -1.000000000     -1.000000000
## 111           0.0000000    -1.000000000     -1.000000000
## 113          -0.2000000     1.000000000      1.000000000
## 115           0.0000000    -0.063314857      0.138438182</code></pre>
<pre class="r"><code>rii.visits &lt;- rbind(pre.visits, post.visits)

#from melyridae excluded pan traps

prepan &lt;- filter(metadata, blooming == &quot;pre&quot;)
prepan &lt;- dplyr::select(prepan, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, blooming, abun, percent.cover)
#split into 2 dataframes, rename the visitation columns and then rbind
#there are 2 unmatched reps
prepan &lt;- arrange(prepan, plant.id)

#prepan &lt;- filter(prepan, plant.id != 266 &amp; plant.id != 275 &amp; plant.id != 276 &amp; plant.id != 196)

pre.pan &lt;- rii.m(prepan, c(1:7), 8:9)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment blooming
## 1   4.16.2017    0.73875    5.1750   18.7500      146      open      pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180      open      pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181      open      pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183      open      pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184      open      pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185      open      pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186      open      pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187      open      pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188      open      pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189      open      pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190      open      pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191      open      pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192      open      pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193      open      pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194      open      pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195      open      pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196      open      pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197      open      pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198      open      pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199      open      pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262      open      pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264      open      pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265      open      pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266      open      pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267      open      pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268      open      pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269      open      pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270      open      pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271      open      pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272      open      pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273      open      pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274      open      pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275      open      pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276      open      pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278      open      pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280      open      pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281      open      pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282      open      pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283      open      pre
## 79  4.13.2017    0.76000    6.1125   18.5625      284      open      pre
## 81  4.19.2017    0.77625    6.0250   17.9000      286      open      pre
## 83  4.20.2017    0.79875    6.1250   17.8625      287      open      pre
## 85  4.11.2017    0.61000    6.3250   18.5750      288      open      pre
## 87  4.12.2017    0.75875    6.6625   18.6125      289      open      pre
## 89  4.19.2017    0.77625    6.0250   17.9000      290      open      pre
## 91  4.17.2017    0.57375    5.5375   18.4125      291      open      pre
## 93  4.13.2017    0.76000    6.1125   18.5625      293      open      pre
## 95  4.13.2017    0.76000    6.1125   18.5625      294      open      pre
## 97  4.17.2017    0.57375    5.5375   18.4125      295      open      pre
## 99  4.10.2017    0.76250    5.1500   18.3500      296      open      pre
## 101 4.19.2017    0.77625    6.0250   17.9000      297      open      pre
## 103 4.16.2017    0.73875    5.1750   18.7500      298      open      pre
## 105 4.17.2017    0.57375    5.5375   18.4125      299      open      pre
## 107 4.15.2017    0.76875    5.1750   18.5000      300      open      pre
##            abun percent.cover
## 1   -0.40000000     0.1428571
## 3   -0.08108108     0.7142857
## 5   -0.38461538     0.8918919
## 7    0.04761905     0.7500000
## 9    0.07692308     0.7500000
## 11   0.20000000     0.7333333
## 13   0.71428571     0.4285714
## 15   0.04347826     0.8181818
## 17   0.42857143     0.9718310
## 19  -0.05882353     0.8518519
## 21  -0.08571429     0.7777778
## 23   0.12000000     0.9047619
## 25   0.17647059     0.4545455
## 27   0.25000000     0.9444444
## 29  -0.08333333     0.8604651
## 31  -0.04347826     0.8181818
## 33  -0.08333333     0.8750000
## 35  -0.23809524     0.7777778
## 37   0.48148148     0.8181818
## 39   0.02325581     0.1578947
## 41   0.48717949     0.5555556
## 43   0.36842105     0.6363636
## 45   0.41176471     0.6666667
## 47   0.03225806     0.8750000
## 49   0.33333333     0.9047619
## 51   0.10000000     0.9230769
## 53   0.25000000     0.6923077
## 55   0.17647059     0.8518519
## 57   0.76470588     0.9230769
## 59   0.29411765     0.6666667
## 61   0.25000000     0.6000000
## 63   0.42857143     0.6000000
## 65   1.00000000     0.8181818
## 67   0.11111111     0.4285714
## 69   0.70000000    -0.2000000
## 71   0.46666667     0.5555556
## 73  -0.33333333     0.8750000
## 75   0.00000000    -0.1111111
## 77   0.42857143     0.7142857
## 79  -0.17647059     0.8750000
## 81   0.25000000     0.8750000
## 83  -0.06666667     0.8181818
## 85   0.42105263     0.9230769
## 87   0.04000000     0.9230769
## 89   0.37500000     0.6000000
## 91   0.21428571     0.9444444
## 93   0.35483871     0.6000000
## 95   0.47826087     0.9230769
## 97   0.30000000     0.7777778
## 99   0.04000000     0.6666667
## 101  0.00000000     0.8918919
## 103  0.45454545     0.4285714
## 105  0.33333333     0.2000000
## 107  0.05263158     0.8518519</code></pre>
<pre class="r"><code>postpan &lt;- filter(metadata, blooming ==&quot;post&quot;)
postpan &lt;- dplyr::select(postpan, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, blooming, abun, percent.cover)
postpan &lt;- arrange(postpan, plant.id)
#postpan &lt;- filter(post, PlantID != 198)
#postpan &lt;- distinct(postpan)
post.pan &lt;- rii.m(postpan, c(1:7), 8:9)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment blooming
## 1   4.30.2017    0.80875    4.7875   17.5250      104      open     post
## 3   4.29.2017    0.81250    5.0000   17.2625      114      open     post
## 5   4.23.2017    0.77750    4.5750   17.1625      146      open     post
## 7   4.22.2017    0.77375    5.4250   17.2000      180      open     post
## 9   4.30.2017    0.80875    4.7875   17.5250      181      open     post
## 11  4.22.2017    0.77375    5.4250   17.2000      182      open     post
## 13   5.3.2017    0.78625    4.4750   17.5500      183      open     post
## 15   5.1.2017    0.80250    5.1375   17.4375      184      open     post
## 17   5.5.2017    0.66625    3.5250   28.5125      185      open     post
## 19  4.30.2017    0.80875    4.7875   17.5250      186      open     post
## 21   5.3.2017    0.78625    4.4750   17.5500      187      open     post
## 23  4.27.2017    0.66000    4.1250   17.3625      188      open     post
## 25  4.22.2017    0.77375    5.4250   17.2000      189      open     post
## 27  4.29.2017    0.81250    5.0000   17.2625      190      open     post
## 29   5.1.2017    0.80250    5.1375   17.4375      191      open     post
## 31  4.26.2017    0.65625    5.1875   17.4000      192      open     post
## 33   5.5.2017    0.66625    3.5250   28.5125      193      open     post
## 35  4.22.2017    0.77375    5.4250   17.2000      194      open     post
## 37  4.23.2017    0.77750    4.5750   17.1625      195      open     post
## 39  4.26.2017    0.65625    5.1875   17.4000      196      open     post
## 41  4.23.2017    0.77750    4.5750   17.1625      197      open     post
## 43   5.4.2017    0.80500    5.0625   17.7875      198      open     post
## 45   5.1.2017    0.80250    5.1375   17.4375      199      open     post
## 47   5.4.2017    0.80500    5.0625   17.7875      261      open     post
## 49  4.27.2017    0.66000    4.1250   17.3625      262      open     post
## 51   5.3.2017    0.78625    4.4750   17.5500      263      open     post
## 53  4.26.2017    0.65625    5.1875   17.4000      264      open     post
## 55  4.30.2017    0.80875    4.7875   17.5250      265      open     post
## 57  4.23.2017    0.77750    4.5750   17.1625      266      open     post
## 59  4.23.2017    0.77750    4.5750   17.1625      267      open     post
## 61  4.30.2017    0.80875    4.7875   17.5250      268      open     post
## 63  4.29.2017    0.81250    5.0000   17.2625      269      open     post
## 65  4.29.2017    0.81250    5.0000   17.2625      270      open     post
## 67   5.1.2017    0.80250    5.1375   17.4375      271      open     post
## 69  4.30.2017    0.80875    4.7875   17.5250      272      open     post
## 71   5.4.2017    0.80500    5.0625   17.7875      273      open     post
## 73   5.3.2017    0.78625    4.4750   17.5500      274      open     post
## 75  4.22.2017    0.77375    5.4250   17.2000      275      open     post
## 77  4.22.2017    0.77375    5.4250   17.2000      276      open     post
## 79   5.1.2017    0.80250    5.1375   17.4375      278      open     post
## 81   5.4.2017    0.80500    5.0625   17.7875      280      open     post
## 83   5.5.2017    0.66625    3.5250   28.5125      281      open     post
## 85  4.27.2017    0.66000    4.1250   17.3625      282      open     post
## 87   5.4.2017    0.80500    5.0625   17.7875      283      open     post
## 89   5.3.2017    0.78625    4.4750   17.5500      285      open     post
## 91  4.29.2017    0.81250    5.0000   17.2625      286      open     post
## 93  4.29.2017    0.81250    5.0000   17.2625      288      open     post
## 95  4.23.2017    0.77750    4.5750   17.1625      289      open     post
## 97   5.3.2017    0.78625    4.4750   17.5500      290      open     post
## 99   5.4.2017    0.80500    5.0625   17.7875      291      open     post
## 101 4.27.2017    0.66000    4.1250   17.3625      293      open     post
## 103 4.27.2017    0.66000    4.1250   17.3625      294      open     post
## 105 4.26.2017    0.65625    5.1875   17.4000      295      open     post
## 107  5.1.2017    0.80250    5.1375   17.4375      296      open     post
## 109 4.27.2017    0.66000    4.1250   17.3625      297      open     post
## 111 4.26.2017    0.65625    5.1875   17.4000      298      open     post
## 113  5.5.2017    0.66625    3.5250   28.5125      300      open     post
## 115 4.26.2017    0.65625    5.1875   17.4000      301      open     post
## 117  5.5.2017    0.66625    3.5250   28.5125      302      open     post
## 119  5.5.2017    0.66625    3.5250   28.5125      303      open     post
##            abun percent.cover
## 1   -0.33333333     0.6000000
## 3    0.10000000     0.4285714
## 5    0.00000000     0.8000000
## 7    0.41176471     0.9230769
## 9    0.36000000     0.9230769
## 11  -0.28571429     0.8000000
## 13  -0.20000000     0.6666667
## 15   1.00000000     0.9230769
## 17  -0.36842105     0.9736842
## 19  -0.26315789     0.6666667
## 21   0.53846154     0.9607843
## 23   0.60000000     0.8750000
## 25   0.00000000     0.8644068
## 27   0.16666667     0.7391304
## 29   0.33333333     0.8867925
## 31   0.37500000     0.9696970
## 33  -0.04347826     0.9607843
## 35  -0.23076923     0.9753086
## 37   0.11111111     0.8518519
## 39   0.06666667     0.9047619
## 41  -0.60000000     0.9672131
## 43  -0.20000000     0.9565217
## 45  -1.00000000     0.7142857
## 47   0.17647059    -0.3333333
## 49   1.00000000     0.7777778
## 51  -0.13043478     0.6000000
## 53  -0.11111111     0.9512195
## 55  -0.25000000     0.8750000
## 57  -0.09090909     0.9047619
## 59   0.00000000     0.9444444
## 61  -0.05263158     0.8750000
## 63   0.41176471     0.9047619
## 65   0.27272727     0.8518519
## 67   0.33333333     0.9230769
## 69  -0.60000000     0.5789474
## 71   0.14285714     0.9047619
## 73  -0.25000000     0.8518519
## 75   0.38461538     0.9696970
## 77   0.18181818     0.9047619
## 79  -1.00000000     0.3333333
## 81   0.05263158     0.1111111
## 83   0.33333333     0.9565217
## 85  -0.27272727     0.7391304
## 87   0.30000000     0.6666667
## 89   0.21739130     0.5789474
## 91   0.23076923     0.8750000
## 93   0.76470588     0.9047619
## 95   0.06666667     0.9565217
## 97  -0.42857143     0.9047619
## 99   0.41176471     0.9047619
## 101  0.33333333     0.7777778
## 103  0.50000000     0.9047619
## 105  0.33333333     0.9565217
## 107 -1.00000000     0.6666667
## 109  1.00000000     0.9230769
## 111  0.14285714     0.5151515
## 113 -0.11111111     0.5789474
## 115 -0.11111111     0.9565217
## 117  0.00000000     0.8518519
## 119  0.00000000     0.8867925</code></pre>
<pre class="r"><code>rii.pan &lt;- rbind(pre.pan, post.pan)


pre.beetle &lt;- filter(yesbeetle, blooming == &quot;pre&quot;)
pre.beetle &lt;- dplyr::select(pre.beetle, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, blooming, Species)
#split into 2 dataframes, rename the visitation columns and then rbind
#there are 2 unmatched reps
pre.beetle &lt;- arrange(pre.beetle, plant.id)

#prepan &lt;- filter(prepan, plant.id != 266 &amp; plant.id != 275 &amp; plant.id != 276 &amp; plant.id != 196)
pre.beetle &lt;- rii.m(pre.beetle, c(1:7), 8)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment blooming
## 1   4.16.2017    0.73875    5.1750   18.7500      146      open      pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180      open      pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181      open      pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183      open      pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184      open      pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185      open      pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186      open      pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187      open      pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188      open      pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189      open      pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190      open      pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191      open      pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192      open      pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193      open      pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194      open      pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195      open      pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196      open      pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197      open      pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198      open      pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199      open      pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262      open      pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264      open      pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265      open      pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266      open      pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267      open      pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268      open      pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269      open      pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270      open      pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271      open      pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272      open      pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273      open      pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274      open      pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275      open      pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276      open      pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278      open      pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280      open      pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281      open      pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282      open      pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283      open      pre
## 79  4.13.2017    0.76000    6.1125   18.5625      284      open      pre
## 81  4.19.2017    0.77625    6.0250   17.9000      286      open      pre
## 83  4.20.2017    0.79875    6.1250   17.8625      287      open      pre
## 85  4.11.2017    0.61000    6.3250   18.5750      288      open      pre
## 87  4.12.2017    0.75875    6.6625   18.6125      289      open      pre
## 89  4.19.2017    0.77625    6.0250   17.9000      290      open      pre
## 91  4.17.2017    0.57375    5.5375   18.4125      291      open      pre
## 93  4.13.2017    0.76000    6.1125   18.5625      293      open      pre
## 95  4.13.2017    0.76000    6.1125   18.5625      294      open      pre
## 97  4.17.2017    0.57375    5.5375   18.4125      295      open      pre
## 99  4.10.2017    0.76250    5.1500   18.3500      296      open      pre
## 101 4.19.2017    0.77625    6.0250   17.9000      297      open      pre
## 103 4.16.2017    0.73875    5.1750   18.7500      298      open      pre
## 105 4.17.2017    0.57375    5.5375   18.4125      299      open      pre
## 107 4.15.2017    0.76875    5.1750   18.5000      300      open      pre
##         Species
## 1   -0.25000000
## 3   -0.04761905
## 5   -0.42857143
## 7   -0.17647059
## 9    0.00000000
## 11   0.09090909
## 13   0.38461538
## 15  -0.23076923
## 17   0.20000000
## 19  -0.21739130
## 21   0.00000000
## 23   0.00000000
## 25   0.20000000
## 27   0.22222222
## 29  -0.07692308
## 31  -0.05882353
## 33  -0.25000000
## 35   0.06666667
## 37   0.22222222
## 39   0.00000000
## 41   0.29411765
## 43   0.16666667
## 45   0.14285714
## 47   0.00000000
## 49   0.25000000
## 51   0.11111111
## 53   0.13043478
## 55   0.06666667
## 57   0.50000000
## 59   0.23076923
## 61   0.29411765
## 63   0.28000000
## 65   1.00000000
## 67   0.12500000
## 69   0.64705882
## 71   0.23809524
## 73  -0.42857143
## 75  -0.06666667
## 77   0.14285714
## 79  -0.07692308
## 81   0.06666667
## 83   0.00000000
## 85   0.20000000
## 87   0.15789474
## 89   0.33333333
## 91  -0.11111111
## 93   0.33333333
## 95   0.28571429
## 97   0.14285714
## 99  -0.04000000
## 101  0.00000000
## 103  0.33333333
## 105  0.28571429
## 107  0.00000000</code></pre>
<pre class="r"><code>post.beetle &lt;- filter(yesbeetle, blooming == &quot;post&quot;)
post.beetle &lt;- dplyr::select(post.beetle, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, blooming, Species)
#split into 2 dataframes, rename the visitation columns and then rbind
#there are 2 unmatched reps
post.beetle &lt;- arrange(post.beetle, plant.id)

#prepan &lt;- filter(prepan, plant.id != 266 &amp; plant.id != 275 &amp; plant.id != 276 &amp; plant.id != 196)
post.beetle &lt;- rii.m(post.beetle, c(1:7), 8)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment blooming
## 1   4.30.2017    0.80875    4.7875   17.5250      104      open     post
## 3   4.29.2017    0.81250    5.0000   17.2625      114      open     post
## 5   4.23.2017    0.77750    4.5750   17.1625      146      open     post
## 7   4.22.2017    0.77375    5.4250   17.2000      180      open     post
## 9   4.30.2017    0.80875    4.7875   17.5250      181      open     post
## 11  4.22.2017    0.77375    5.4250   17.2000      182      open     post
## 13   5.3.2017    0.78625    4.4750   17.5500      183      open     post
## 15   5.1.2017    0.80250    5.1375   17.4375      184      open     post
## 17   5.5.2017    0.66625    3.5250   28.5125      185      open     post
## 19  4.30.2017    0.80875    4.7875   17.5250      186      open     post
## 21   5.3.2017    0.78625    4.4750   17.5500      187      open     post
## 23  4.27.2017    0.66000    4.1250   17.3625      188      open     post
## 25  4.22.2017    0.77375    5.4250   17.2000      189      open     post
## 27  4.29.2017    0.81250    5.0000   17.2625      190      open     post
## 29   5.1.2017    0.80250    5.1375   17.4375      191      open     post
## 31  4.26.2017    0.65625    5.1875   17.4000      192      open     post
## 33   5.5.2017    0.66625    3.5250   28.5125      193      open     post
## 35  4.22.2017    0.77375    5.4250   17.2000      194      open     post
## 37  4.23.2017    0.77750    4.5750   17.1625      195      open     post
## 39  4.26.2017    0.65625    5.1875   17.4000      196      open     post
## 41  4.23.2017    0.77750    4.5750   17.1625      197      open     post
## 43   5.4.2017    0.80500    5.0625   17.7875      198      open     post
## 45   5.1.2017    0.80250    5.1375   17.4375      199      open     post
## 47   5.4.2017    0.80500    5.0625   17.7875      261      open     post
## 49  4.27.2017    0.66000    4.1250   17.3625      262      open     post
## 51   5.3.2017    0.78625    4.4750   17.5500      263      open     post
## 53  4.26.2017    0.65625    5.1875   17.4000      264      open     post
## 55  4.30.2017    0.80875    4.7875   17.5250      265      open     post
## 57  4.23.2017    0.77750    4.5750   17.1625      266      open     post
## 59  4.23.2017    0.77750    4.5750   17.1625      267      open     post
## 61  4.30.2017    0.80875    4.7875   17.5250      268      open     post
## 63  4.29.2017    0.81250    5.0000   17.2625      269      open     post
## 65  4.29.2017    0.81250    5.0000   17.2625      270      open     post
## 67   5.1.2017    0.80250    5.1375   17.4375      271      open     post
## 69  4.30.2017    0.80875    4.7875   17.5250      272      open     post
## 71   5.4.2017    0.80500    5.0625   17.7875      273      open     post
## 73   5.3.2017    0.78625    4.4750   17.5500      274      open     post
## 75  4.22.2017    0.77375    5.4250   17.2000      275      open     post
## 77  4.22.2017    0.77375    5.4250   17.2000      276      open     post
## 79   5.1.2017    0.80250    5.1375   17.4375      278      open     post
## 81   5.4.2017    0.80500    5.0625   17.7875      280      open     post
## 83   5.5.2017    0.66625    3.5250   28.5125      281      open     post
## 85  4.27.2017    0.66000    4.1250   17.3625      282      open     post
## 87   5.4.2017    0.80500    5.0625   17.7875      283      open     post
## 89   5.3.2017    0.78625    4.4750   17.5500      285      open     post
## 91  4.29.2017    0.81250    5.0000   17.2625      286      open     post
## 93  4.29.2017    0.81250    5.0000   17.2625      288      open     post
## 95  4.23.2017    0.77750    4.5750   17.1625      289      open     post
## 97   5.3.2017    0.78625    4.4750   17.5500      290      open     post
## 99   5.4.2017    0.80500    5.0625   17.7875      291      open     post
## 101 4.27.2017    0.66000    4.1250   17.3625      293      open     post
## 103 4.27.2017    0.66000    4.1250   17.3625      294      open     post
## 105 4.26.2017    0.65625    5.1875   17.4000      295      open     post
## 107  5.1.2017    0.80250    5.1375   17.4375      296      open     post
## 109 4.27.2017    0.66000    4.1250   17.3625      297      open     post
## 111 4.26.2017    0.65625    5.1875   17.4000      298      open     post
## 113  5.5.2017    0.66625    3.5250   28.5125      300      open     post
## 115 4.26.2017    0.65625    5.1875   17.4000      301      open     post
## 117  5.5.2017    0.66625    3.5250   28.5125      302      open     post
## 119  5.5.2017    0.66625    3.5250   28.5125      303      open     post
##         Species
## 1   -0.06666667
## 3   -0.05263158
## 5   -0.06666667
## 7    0.29411765
## 9   -0.07692308
## 11  -0.07692308
## 13  -0.14285714
## 15   0.50000000
## 17  -0.30000000
## 19   0.00000000
## 21   0.33333333
## 23  -0.20000000
## 25   0.23809524
## 27   0.14285714
## 29   0.20000000
## 31   0.23076923
## 33  -0.04761905
## 35  -0.33333333
## 37   0.11111111
## 39  -0.06666667
## 41  -0.33333333
## 43  -0.06666667
## 45  -0.71428571
## 47   0.17647059
## 49   0.50000000
## 51  -0.12500000
## 53   0.00000000
## 55  -0.06666667
## 57  -0.07692308
## 59  -0.11111111
## 61   0.05882353
## 63   0.37500000
## 65   0.16666667
## 67   0.14285714
## 69  -0.33333333
## 71   0.20000000
## 73  -0.25000000
## 75   0.09090909
## 77   0.15789474
## 79  -0.33333333
## 81   0.15789474
## 83   0.33333333
## 85  -0.33333333
## 87   0.25000000
## 89   0.11111111
## 91   0.09090909
## 93   0.71428571
## 95   0.07692308
## 97  -0.50000000
## 99   0.28571429
## 101  0.20000000
## 103  0.60000000
## 105  0.16666667
## 107 -0.33333333
## 109  1.00000000
## 111  0.07692308
## 113 -0.20000000
## 115 -0.33333333
## 117  0.14285714
## 119  0.00000000</code></pre>
<pre class="r"><code>rii.beetle &lt;- rbind(pre.beetle, post.beetle)

#bootstrapping
bootmean &lt;- function(d, i) mean(d[i])

flowers.rii &lt;- boot(rii.visits$flowers.per.hour, bootmean, R=1000, stype=&quot;i&quot;, strata = rii.visits$PlantID)

rich.rii &lt;- boot(rii.visits$understory.richness, bootmean, R=1000, stype=&quot;i&quot;, strata = rii.visits$PlantID)
abun.rii &lt;- boot(rii.pan$abun, bootmean, R=1000, stype=&quot;i&quot;, strata = rii.pan$plant.id)
percent.rii &lt;- boot(rii.pan$percent.cover, bootmean, R=1000, stype=&quot;i&quot;, strata = rii.pan$plant.id)
rich.arth.rii &lt;- boot(rii.beetle$Species, bootmean, R=1000, stype=&quot;i&quot;, strata = rii.beetle$plant.id)

ci.flowers &lt;- boot.ci(flowers.rii)
bca.flowers &lt;- ci.flowers$bca

ci.rich &lt;- boot.ci(rich.rii)
bca.rich &lt;- ci.rich$bca

ci.abun &lt;- boot.ci(abun.rii)
bca.abun &lt;- ci.abun$bca

ci.percent &lt;- boot.ci(percent.rii)
bca.percent &lt;- ci.percent$bca

ci.arth &lt;- boot.ci(rich.arth.rii)
bca.arth &lt;- ci.arth$bca

ci &lt;- rbind(bca.flowers, bca.rich, bca.abun, bca.percent, bca.arth)



means &lt;- rbind(flowers.rii$t0, rich.rii$t0, abun.rii$t0, percent.rii$t0, rich.arth.rii$t0)
colnames(means) &lt;- c(&quot;means&quot;)
row.names(means) &lt;- c(&quot;visits&quot;, &quot;annual.richness&quot;, &quot;abundance&quot;, &quot;percent.cover&quot;, &quot;arth.rich&quot;)

all.boot &lt;- cbind(means, ci )
all.boot &lt;- as.data.frame(all.boot)
all.boot$treatment &lt;- c(&quot;microsite&quot;)


#blooming contrast
shrub.visits &lt;- filter(byrep, treatment == &quot;shrub&quot;)
shrub.visits &lt;- dplyr::select(shrub.visits, Date, mean.Solar, mean.Wind, mean.Temp, PlantID, treatment, flowering, understory.richness, visits.per.hour, flowers.per.hour)
#split into 2 dataframes, rename the visitation columns and then rbind
#there are 2 unmatched reps
shrub.visits &lt;- arrange(shrub.visits, PlantID)
shrub.visits &lt;- filter(shrub.visits, PlantID != 196 &amp; PlantID != &quot;new1&quot; &amp; PlantID != 303 &amp; PlantID != 299)
shrub.visits &lt;- subset(shrub.visits[-43,])

open.visits &lt;- filter(byrep, treatment == &quot;open&quot;)
open.visits &lt;- dplyr::select(open.visits, Date, mean.Solar, mean.Wind, mean.Temp, PlantID, treatment, flowering, understory.richness, visits.per.hour, flowers.per.hour)
open.visits &lt;- arrange(open.visits, PlantID)
open.visits &lt;- filter(open.visits, PlantID != 266 &amp; PlantID != &quot;new1&quot; &amp; PlantID != 303 &amp; PlantID != 299 &amp; PlantID != 275 &amp; PlantID != 276)
#open.visits &lt;- subset(open.visits[-43,]) 

rii.shrub.visits &lt;- rii.b(shrub.visits, c(1:7), 8:10)</code></pre>
<pre><code>##          Date mean.Solar mean.Wind mean.Temp PlantID treatment flowering
## 1   4.20.2017  0.7987500  6.125000  17.86250     104     shrub       pre
## 3   4.19.2017  0.7762500  6.025000  17.90000     114     shrub       pre
## 5   4.10.2017  0.7625000  5.150000  18.35000     146     shrub       pre
## 7   4.13.2017  0.7600000  6.112500  18.56250     180     shrub       pre
## 9   4.19.2017  0.7762500  6.025000  17.90000     181     shrub       pre
## 11  4.16.2017  0.7387500  5.175000  18.75000     182     shrub       pre
## 13  4.19.2017  0.7762500  6.025000  17.90000     183     shrub       pre
## 15  4.14.2017  0.7671429  6.242857  15.88571     184     shrub       pre
## 17  4.16.2017  0.7387500  5.175000  18.75000     185     shrub       pre
## 19  4.13.2017  0.7600000  6.112500  18.56250     186     shrub       pre
## 21  4.10.2017  0.7625000  5.150000  18.35000     187     shrub       pre
## 23  4.14.2017  0.7671429  6.242857  15.88571     188     shrub       pre
## 25  4.12.2017  0.7587500  6.662500  18.61250     189     shrub       pre
## 27  4.12.2017  0.7587500  6.662500  18.61250     190     shrub       pre
## 29  4.11.2017  0.6100000  6.325000  18.57500     191     shrub       pre
## 31  4.13.2017  0.7600000  6.112500  18.56250     192     shrub       pre
## 33  4.10.2017  0.7625000  5.150000  18.35000     193     shrub       pre
## 35  4.11.2017  0.6100000  6.325000  18.57500     194     shrub       pre
## 37  4.14.2017  0.7671429  6.242857  15.88571     195     shrub       pre
## 39  4.14.2017  0.7671429  6.242857  15.88571     197     shrub       pre
## 41  4.19.2017  0.7762500  6.025000  17.90000     198     shrub       pre
## 44  4.13.2017  0.7600000  6.112500  18.56250     199     shrub       pre
## 46  4.20.2017  0.7987500  6.125000  17.86250     261     shrub       pre
## 48  4.13.2017  0.7600000  6.112500  18.56250     262     shrub       pre
## 50  4.12.2017  0.7587500  6.662500  18.61250     263     shrub       pre
## 52  4.16.2017  0.7387500  5.175000  18.75000     264     shrub       pre
## 54  4.11.2017  0.6100000  6.325000  18.57500     265     shrub       pre
## 56  4.10.2017  0.7625000  5.150000  18.35000     266     shrub       pre
## 58  4.14.2017  0.7671429  6.242857  15.88571     268     shrub       pre
## 60  4.14.2017  0.7671429  6.242857  15.88571     269     shrub       pre
## 62  4.18.2017  0.6685714  6.014286  16.25714     270     shrub       pre
## 64  4.18.2017  0.6685714  6.014286  16.25714     271     shrub       pre
## 66  4.12.2017  0.7587500  6.662500  18.61250     272     shrub       pre
## 68  4.10.2017  0.7625000  5.150000  18.35000     273     shrub       pre
## 70  4.19.2017  0.7762500  6.025000  17.90000     274     shrub       pre
## 72  4.11.2017  0.6100000  6.325000  18.57500     275     shrub       pre
## 74  4.16.2017  0.7387500  5.175000  18.75000     276     shrub       pre
## 76  4.15.2017  0.7687500  5.175000  18.50000     278     shrub       pre
## 78  4.15.2017  0.7687500  5.175000  18.50000     280     shrub       pre
## 80  4.19.2017  0.7762500  6.025000  17.90000     281     shrub       pre
## 82  4.15.2017  0.7687500  5.175000  18.50000     282     shrub       pre
## 84  4.18.2017  0.6685714  6.014286  16.25714     283     shrub       pre
## 86  4.20.2017  0.7987500  6.125000  17.86250     285     shrub       pre
## 88  4.16.2017  0.7387500  5.175000  18.75000     286     shrub       pre
## 90  4.10.2017  0.7625000  5.150000  18.35000     288     shrub       pre
## 92  4.11.2017  0.6100000  6.325000  18.57500     289     shrub       pre
## 94  4.18.2017  0.6685714  6.014286  16.25714     290     shrub       pre
## 96  4.16.2017  0.7387500  5.175000  18.75000     291     shrub       pre
## 98  4.12.2017  0.7587500  6.662500  18.61250     293     shrub       pre
## 100 4.15.2017  0.7687500  5.175000  18.50000     294     shrub       pre
## 102 4.15.2017  0.7687500  5.175000  18.50000     295     shrub       pre
## 104 4.12.2017  0.7587500  6.662500  18.61250     296     shrub       pre
## 106 4.18.2017  0.6685714  6.014286  16.25714     297     shrub       pre
## 108 4.18.2017  0.6685714  6.014286  16.25714     298     shrub       pre
## 110 4.13.2017  0.7600000  6.112500  18.56250     300     shrub       pre
## 112 4.20.2017  0.7987500  6.125000  17.86250     301     shrub       pre
## 114 4.20.2017  0.7987500  6.125000  17.86250     302     shrub       pre
##     understory.richness visits.per.hour flowers.per.hour
## 1             0.0000000     1.000000000       1.00000000
## 3            -0.3333333    -0.280883780      -0.28088378
## 5            -0.2000000    -1.000000000      -1.00000000
## 7            -0.6000000     0.037331753      -0.10609119
## 9             0.0000000     0.301857273       0.52343548
## 11            0.0000000     0.468538012       0.26659404
## 13           -0.2000000    -0.501320720      -0.50132072
## 15           -0.2000000    -1.000000000      -1.00000000
## 17           -0.3333333     0.130513870       0.32210601
## 19           -0.1428571    -0.255636837      -0.11705447
## 21           -0.3333333    -0.837710332      -0.83771033
## 23            0.2000000    -1.000000000      -1.00000000
## 25            0.0000000    -1.000000000      -1.00000000
## 27           -0.3333333    -1.000000000      -1.00000000
## 29           -0.3333333    -1.000000000      -1.00000000
## 31            0.0000000     0.005522209       0.20529547
## 33           -0.1428571    -1.000000000      -1.00000000
## 35           -0.2000000    -1.000000000      -1.00000000
## 37            0.0000000     0.065558130       0.06555813
## 39            0.3333333    -0.673317328      -0.82213207
## 41            0.0000000    -1.000000000      -1.00000000
## 44            0.5000000    -1.000000000      -1.00000000
## 46           -0.6000000    -1.000000000      -1.00000000
## 48            0.2000000    -0.666190422      -0.66619042
## 50            0.0000000    -0.368031515      -0.52908735
## 52           -0.3333333    -0.601130290      -0.65618030
## 54            0.0000000    -1.000000000      -1.00000000
## 56            0.2000000     0.210141084       0.21014108
## 58            0.0000000    -1.000000000      -1.00000000
## 60            0.5000000    -1.000000000      -1.00000000
## 62           -0.2000000    -1.000000000      -1.00000000
## 64           -0.2000000     0.017896336       0.01789634
## 66            0.0000000    -0.314693295      -0.31469330
## 68            0.0000000    -0.487906315      -0.48790631
## 70            0.0000000    -0.442881816      -0.44288182
## 72            0.0000000    -0.092159662      -0.09215966
## 74            0.0000000    -0.465366451      -0.46536645
## 76            0.0000000    -1.000000000      -1.00000000
## 78            0.0000000    -0.195342820      -0.57571623
## 80            0.0000000     1.000000000       1.00000000
## 82            0.0000000    -1.000000000      -1.00000000
## 84            0.0000000    -1.000000000      -1.00000000
## 86            0.0000000     0.033123978       0.03312398
## 88            0.3333333    -1.000000000      -1.00000000
## 90           -0.2000000    -1.000000000      -1.00000000
## 92           -0.6666667    -1.000000000      -1.00000000
## 94           -0.2000000     1.000000000       1.00000000
## 96            0.0000000    -0.327678871      -0.13663324
## 98            0.0000000     0.000000000       0.00000000
## 100           0.0000000    -1.000000000      -1.00000000
## 102          -0.3333333    -0.091718825      -0.09171883
## 104          -0.2000000    -0.896781141      -0.91531520
## 106           0.6000000     0.000000000       0.00000000
## 108           0.0000000     1.000000000       1.00000000
## 110           0.2000000    -1.000000000      -1.00000000
## 112          -1.0000000     0.000000000       0.00000000
## 114           0.3333333    -0.242510699      -0.24251070</code></pre>
<pre class="r"><code>rii.open.visits &lt;- rii.b(open.visits, c(1:7), 8:10)</code></pre>
<pre><code>##          Date mean.Solar mean.Wind mean.Temp PlantID treatment flowering
## 1   4.20.2017  0.7987500  6.125000  17.86250     104      open       pre
## 3   4.19.2017  0.7762500  6.025000  17.90000     114      open       pre
## 5   4.10.2017  0.7625000  5.150000  18.35000     146      open       pre
## 7   4.13.2017  0.7600000  6.112500  18.56250     180      open       pre
## 9   4.19.2017  0.7762500  6.025000  17.90000     181      open       pre
## 11  4.16.2017  0.7387500  5.175000  18.75000     182      open       pre
## 13  4.19.2017  0.7762500  6.025000  17.90000     183      open       pre
## 15  4.14.2017  0.7671429  6.242857  15.88571     184      open       pre
## 17  4.16.2017  0.7387500  5.175000  18.75000     185      open       pre
## 19  4.13.2017  0.7600000  6.112500  18.56250     186      open       pre
## 21  4.10.2017  0.7625000  5.150000  18.35000     187      open       pre
## 23  4.14.2017  0.7671429  6.242857  15.88571     188      open       pre
## 25  4.12.2017  0.7587500  6.662500  18.61250     189      open       pre
## 27  4.12.2017  0.7587500  6.662500  18.61250     190      open       pre
## 29  4.11.2017  0.6100000  6.325000  18.57500     191      open       pre
## 31  4.13.2017  0.7600000  6.112500  18.56250     192      open       pre
## 33  4.10.2017  0.7625000  5.150000  18.35000     193      open       pre
## 35  4.11.2017  0.6100000  6.325000  18.57500     194      open       pre
## 37  4.14.2017  0.7671429  6.242857  15.88571     195      open       pre
## 39  4.11.2017  0.6100000  6.325000  18.57500     196      open       pre
## 41  4.14.2017  0.7671429  6.242857  15.88571     197      open       pre
## 43  4.19.2017  0.7762500  6.025000  17.90000     198      open       pre
## 45  4.13.2017  0.7600000  6.112500  18.56250     199      open       pre
## 47  4.20.2017  0.7987500  6.125000  17.86250     261      open       pre
## 49  4.13.2017  0.7600000  6.112500  18.56250     262      open       pre
## 51  4.12.2017  0.7587500  6.662500  18.61250     263      open       pre
## 53  4.16.2017  0.7387500  5.175000  18.75000     264      open       pre
## 55  4.11.2017  0.6100000  6.325000  18.57500     265      open       pre
## 57  4.14.2017  0.7671429  6.242857  15.88571     268      open       pre
## 59  4.14.2017  0.7671429  6.242857  15.88571     269      open       pre
## 61  4.18.2017  0.6685714  6.014286  16.25714     270      open       pre
## 63  4.18.2017  0.6685714  6.014286  16.25714     271      open       pre
## 65  4.12.2017  0.7587500  6.662500  18.61250     272      open       pre
## 67  4.10.2017  0.7625000  5.150000  18.35000     273      open       pre
## 69  4.19.2017  0.7762500  6.025000  17.90000     274      open       pre
## 71  4.15.2017  0.7687500  5.175000  18.50000     278      open       pre
## 73  4.15.2017  0.7687500  5.175000  18.50000     280      open       pre
## 75  4.19.2017  0.7762500  6.025000  17.90000     281      open       pre
## 77  4.15.2017  0.7687500  5.175000  18.50000     282      open       pre
## 79  4.18.2017  0.6685714  6.014286  16.25714     283      open       pre
## 81  4.20.2017  0.7987500  6.125000  17.86250     285      open       pre
## 83  4.16.2017  0.7387500  5.175000  18.75000     286      open       pre
## 85  4.10.2017  0.7625000  5.150000  18.35000     288      open       pre
## 87  4.11.2017  0.6100000  6.325000  18.57500     289      open       pre
## 89  4.18.2017  0.6685714  6.014286  16.25714     290      open       pre
## 91  4.16.2017  0.7387500  5.175000  18.75000     291      open       pre
## 93  4.12.2017  0.7587500  6.662500  18.61250     293      open       pre
## 95  4.15.2017  0.7687500  5.175000  18.50000     294      open       pre
## 97  4.15.2017  0.7687500  5.175000  18.50000     295      open       pre
## 99  4.12.2017  0.7587500  6.662500  18.61250     296      open       pre
## 101 4.18.2017  0.6685714  6.014286  16.25714     297      open       pre
## 103 4.18.2017  0.6685714  6.014286  16.25714     298      open       pre
## 105 4.13.2017  0.7600000  6.112500  18.56250     300      open       pre
## 107 4.20.2017  0.7987500  6.125000  17.86250     301      open       pre
## 109 4.20.2017  0.7987500  6.125000  17.86250     302      open       pre
##     understory.richness visits.per.hour flowers.per.hour
## 1            -0.2000000       1.0000000        1.0000000
## 3             0.0000000      -0.7575297       -0.8061906
## 5            -0.4285714      -0.5638517       -0.7133025
## 7             0.0000000      -0.4040460       -0.1713548
## 9             0.2000000      -0.3341714       -0.1437809
## 11            0.0000000       0.3970570        0.3970570
## 13           -0.2000000       1.0000000        1.0000000
## 15            0.0000000       1.0000000        1.0000000
## 17           -0.3333333      -1.0000000       -1.0000000
## 19           -0.6000000      -1.0000000       -1.0000000
## 21           -0.6000000      -0.4043977       -0.1631613
## 23            0.2000000      -1.0000000       -1.0000000
## 25            0.0000000      -1.0000000       -1.0000000
## 27           -0.2000000      -1.0000000       -1.0000000
## 29           -0.3333333      -0.6440033       -0.7476991
## 31            0.0000000      -0.4654393       -0.5130157
## 33           -0.2000000      -0.8421419       -0.8826684
## 35            0.0000000      -1.0000000       -1.0000000
## 37            0.0000000      -0.3557713       -0.3557713
## 39           -0.2000000      -0.5858139       -0.3137462
## 41           -0.2000000       1.0000000        1.0000000
## 43           -0.3333333      -1.0000000       -1.0000000
## 45            0.2000000      -0.8271642       -0.8271642
## 47            0.0000000       0.0000000        0.0000000
## 49            0.0000000      -1.0000000       -1.0000000
## 51            0.3333333      -0.4396668       -0.6251664
## 53            0.0000000      -0.7451054       -0.5478377
## 55           -0.5000000      -1.0000000       -1.0000000
## 57           -0.2000000      -0.9221091       -0.9221091
## 59            0.5000000       0.2934029        0.2934029
## 61            0.0000000      -0.3061285       -0.3061285
## 63           -0.3333333       0.2741935        0.2741935
## 65            0.0000000      -1.0000000       -1.0000000
## 67            0.0000000      -1.0000000       -1.0000000
## 69            0.0000000      -0.1217297       -0.1217297
## 71           -0.2000000      -1.0000000       -1.0000000
## 73            0.0000000      -0.5413985       -0.5413985
## 75            0.5000000       0.5861390        0.7850350
## 77            0.2000000      -1.0000000       -1.0000000
## 79            0.3333333      -1.0000000       -1.0000000
## 81            0.0000000       1.0000000        1.0000000
## 83           -0.3333333      -0.6559877       -0.5248462
## 85            0.0000000      -0.6121301       -0.5375824
## 87            0.2000000       1.0000000        1.0000000
## 89           -0.2000000       1.0000000        1.0000000
## 91            0.0000000      -1.0000000       -1.0000000
## 93           -0.3333333      -0.5878263       -0.5878263
## 95           -0.2000000      -0.6436425       -0.7202714
## 97            0.2000000       0.5426894        0.5426894
## 99            0.5000000      -1.0000000       -1.0000000
## 101          -0.2000000      -1.0000000       -1.0000000
## 103           0.2000000       1.0000000        1.0000000
## 105           0.0000000      -0.6793431       -0.6793431
## 107          -1.0000000       0.2686780        0.2686780
## 109           0.5000000      -1.0000000       -1.0000000</code></pre>
<pre class="r"><code>rii.bloom.visits &lt;- rbind(rii.shrub.visits, rii.open.visits)

t.test(rii.bloom.visits$flowers.per.hour ~ rii.bloom.visits$treatment)</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  rii.bloom.visits$flowers.per.hour by rii.bloom.visits$treatment
## t = 0.79629, df = 105.71, p-value = 0.4277
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.1502562  0.3519582
## sample estimates:
##  mean in group open mean in group shrub 
##           -0.348928           -0.449779</code></pre>
<pre class="r"><code>#from melyridae excluded pan traps

shrub.pan &lt;- filter(metadata, treatment == &quot;shrub&quot;)
shrub.pan$flowering &lt;- shrub.pan$blooming
shrub.pan$flowering &lt;- gsub(&quot;post&quot;, &quot;bloom&quot;, shrub.pan$flowering)
shrub.pan &lt;- dplyr::select(shrub.pan, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, flowering, abun, percent.cover)
#split into 2 dataframes, rename the visitation columns and then rbind
#there are 2 unmatched reps
shrub.pan &lt;- arrange(shrub.pan, plant.id)
#at least six mismatches
shrub.pan &lt;- filter(shrub.pan, plant.id != 104 &amp; plant.id != 114 &amp; plant.id != 182 &amp; plant.id != 261 &amp; plant.id != 263 &amp; plant.id != 284 &amp; plant.id != 285&amp; plant.id != 287&amp; plant.id != 301&amp; plant.id != 302&amp; plant.id != 303&amp; plant.id != 299)




open.pan &lt;- filter(metadata, treatment ==&quot;open&quot;)
open.pan$flowering &lt;- open.pan$blooming
open.pan$flowering &lt;- gsub(&quot;post&quot;, &quot;bloom&quot;, open.pan$flowering)
open.pan &lt;- dplyr::select(open.pan, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, flowering, abun, percent.cover)
open.pan &lt;- arrange(open.pan, plant.id)
#postpan &lt;- filter(post, PlantID != 198)
#postpan &lt;- distinct(postpan)

open.pan &lt;- filter(open.pan, plant.id != 104 &amp; plant.id != 114 &amp; plant.id != 182 &amp; plant.id != 261 &amp; plant.id != 263 &amp; plant.id != 284 &amp; plant.id != 285&amp; plant.id != 287&amp; plant.id != 301&amp; plant.id != 302&amp; plant.id != 303&amp; plant.id != 299)



rii.open.pan &lt;- rii.b(open.pan, c(1:7), 8:9)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment flowering
## 1   4.16.2017    0.73875    5.1750   18.7500      146      open       pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180      open       pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181      open       pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183      open       pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184      open       pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185      open       pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186      open       pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187      open       pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188      open       pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189      open       pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190      open       pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191      open       pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192      open       pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193      open       pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194      open       pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195      open       pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196      open       pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197      open       pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198      open       pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199      open       pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262      open       pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264      open       pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265      open       pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266      open       pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267      open       pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268      open       pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269      open       pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270      open       pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271      open       pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272      open       pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273      open       pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274      open       pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275      open       pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276      open       pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278      open       pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280      open       pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281      open       pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282      open       pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283      open       pre
## 79  4.19.2017    0.77625    6.0250   17.9000      286      open       pre
## 81  4.11.2017    0.61000    6.3250   18.5750      288      open       pre
## 83  4.12.2017    0.75875    6.6625   18.6125      289      open       pre
## 85  4.19.2017    0.77625    6.0250   17.9000      290      open       pre
## 87  4.17.2017    0.57375    5.5375   18.4125      291      open       pre
## 89  4.13.2017    0.76000    6.1125   18.5625      293      open       pre
## 91  4.13.2017    0.76000    6.1125   18.5625      294      open       pre
## 93  4.17.2017    0.57375    5.5375   18.4125      295      open       pre
## 95  4.10.2017    0.76250    5.1500   18.3500      296      open       pre
## 97  4.19.2017    0.77625    6.0250   17.9000      297      open       pre
## 99  4.16.2017    0.73875    5.1750   18.7500      298      open       pre
## 101 4.15.2017    0.76875    5.1750   18.5000      300      open       pre
##            abun percent.cover
## 1   -0.33333333    -0.5000000
## 3   -0.60000000    -0.2500000
## 5   -0.05882353     0.0000000
## 7   -0.53846154    -0.6666667
## 9   -1.00000000    -0.8181818
## 11   0.52941176    -0.8181818
## 13   0.41176471    -0.7777778
## 15  -0.57142857    -0.3333333
## 17  -0.14285714     0.6000000
## 19  -0.16129032     0.3333333
## 21  -0.31034483    -0.2500000
## 23  -0.83333333     0.2000000
## 25  -0.61538462    -0.8750000
## 27   0.00000000     0.0000000
## 29  -0.23809524    -0.5000000
## 31  -0.50000000    -0.1111111
## 33  -0.30000000     0.0000000
## 35  -0.23809524    -0.6666667
## 37   0.26315789    -0.3333333
## 39  -0.55555556    -0.7777778
## 41  -1.00000000    -0.3333333
## 43   0.25000000    -0.6666667
## 45   0.33333333    -0.3333333
## 47  -0.42857143     0.3333333
## 49  -0.27272727    -0.3333333
## 51   0.05263158     0.3333333
## 53  -0.41176471    -0.8181818
## 55  -0.27272727     0.0000000
## 57   0.00000000    -0.3333333
## 59   0.33333333    -0.1111111
## 61  -0.20000000    -0.6666667
## 63   0.00000000    -0.6666667
## 65   1.00000000    -0.3333333
## 67  -0.14285714    -0.8181818
## 69  -0.50000000    -0.8750000
## 71   0.05882353     0.3333333
## 73  -0.14285714    -0.3333333
## 75  -0.30000000    -0.7857143
## 77   0.55555556    -0.1111111
## 79  -0.09090909     0.0000000
## 81  -0.69230769     0.0000000
## 83  -0.26315789     0.0000000
## 85   0.00000000    -0.8181818
## 87  -0.37500000     0.3333333
## 89  -0.81818182    -0.8181818
## 91  -0.71428571    -0.3333333
## 93  -0.16666667    -0.6666667
## 95  -0.92000000     0.0000000
## 97  -1.00000000    -0.3333333
## 99   0.33333333    -0.1111111
## 101 -0.28571429     0.3333333</code></pre>
<pre class="r"><code>rii.shrub.pan &lt;- rii.b(shrub.pan, c(1:7), 8:9)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment flowering
## 1   4.16.2017    0.73875    5.1750   18.7500      146     shrub       pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180     shrub       pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181     shrub       pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183     shrub       pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184     shrub       pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185     shrub       pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186     shrub       pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187     shrub       pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188     shrub       pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189     shrub       pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190     shrub       pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191     shrub       pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192     shrub       pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193     shrub       pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194     shrub       pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195     shrub       pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196     shrub       pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197     shrub       pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198     shrub       pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199     shrub       pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262     shrub       pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264     shrub       pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265     shrub       pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266     shrub       pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267     shrub       pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268     shrub       pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269     shrub       pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270     shrub       pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271     shrub       pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272     shrub       pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273     shrub       pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274     shrub       pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275     shrub       pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276     shrub       pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278     shrub       pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280     shrub       pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281     shrub       pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282     shrub       pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283     shrub       pre
## 79  4.19.2017    0.77625    6.0250   17.9000      286     shrub       pre
## 81  4.11.2017    0.61000    6.3250   18.5750      288     shrub       pre
## 83  4.12.2017    0.75875    6.6625   18.6125      289     shrub       pre
## 85  4.19.2017    0.77625    6.0250   17.9000      290     shrub       pre
## 87  4.17.2017    0.57375    5.5375   18.4125      291     shrub       pre
## 89  4.13.2017    0.76000    6.1125   18.5625      293     shrub       pre
## 91  4.13.2017    0.76000    6.1125   18.5625      294     shrub       pre
## 93  4.17.2017    0.57375    5.5375   18.4125      295     shrub       pre
## 95  4.10.2017    0.76250    5.1500   18.3500      296     shrub       pre
## 97  4.19.2017    0.77625    6.0250   17.9000      297     shrub       pre
## 99  4.16.2017    0.73875    5.1750   18.7500      298     shrub       pre
## 101 4.15.2017    0.76875    5.1750   18.5000      300     shrub       pre
##            abun percent.cover
## 1    0.07692308    0.38461538
## 3   -0.17241379    0.42857143
## 5    0.61904762    0.17647059
## 7   -0.69230769   -0.75000000
## 9   -0.75000000   -0.47368421
## 11   0.00000000    0.07142857
## 13  -0.62162162   -0.60000000
## 15  -0.09090909    0.42857143
## 17   0.09090909   -0.07692308
## 19  -0.10344828    0.37500000
## 21  -0.06666667   -0.33333333
## 23  -0.75000000    0.11111111
## 25  -0.46341463    0.23809524
## 27  -0.29032258    0.17647059
## 29  -0.37500000    0.33333333
## 31  -0.37500000    0.00000000
## 33  -0.15789474    0.14285714
## 35  -0.60000000    0.20000000
## 37  -0.42857143    0.38461538
## 39  -1.00000000   -0.29411765
## 41  -0.70588235    0.06666667
## 43  -0.23809524    0.28000000
## 45  -0.33333333    0.20000000
## 47  -0.52380952    0.45454545
## 49  -0.55555556   -0.06666667
## 51  -0.10000000    0.09090909
## 53  -0.25000000   -0.46666667
## 55  -0.17647059    0.00000000
## 57  -0.57894737   -0.33333333
## 59  -0.57142857   -0.25000000
## 61  -0.30434783    0.00000000
## 63  -0.61290323   -0.23076923
## 65  -0.50000000    0.52941176
## 67  -0.07142857   -0.11111111
## 69  -1.00000000   -0.66666667
## 71  -0.37500000   -0.16666667
## 73   0.50000000    0.20000000
## 75  -0.52941176    0.00000000
## 77   0.44444444   -0.20000000
## 79  -0.11111111    0.00000000
## 81  -0.28571429   -0.11111111
## 83  -0.23809524    0.28571429
## 85  -0.69230769   -0.33333333
## 87  -0.17241379    0.06666667
## 89  -0.82608696   -0.66666667
## 91  -0.70000000   -0.42857143
## 93  -0.13043478    0.05882353
## 95  -1.00000000    0.00000000
## 97  -0.55555556   -0.16666667
## 99   0.00000000    0.00000000
## 101 -0.42857143   -0.25000000</code></pre>
<pre class="r"><code>rii.bloom.pan &lt;- rbind(rii.open.pan, rii.shrub.pan)

#species richness
shrub.beet.pan &lt;- filter(yesbeetle, treatment == &quot;shrub&quot;)
shrub.beet.pan$flowering &lt;- shrub.beet.pan$blooming
shrub.beet.pan$flowering &lt;- gsub(&quot;post&quot;, &quot;bloom&quot;, shrub.beet.pan$flowering)
shrub.beet.pan &lt;- dplyr::select(shrub.beet.pan, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, flowering, Species)
#split into 2 dataframes, rename the visitation columns and then rbind
#there are 2 unmatched reps
shrub.beet.pan &lt;- arrange(shrub.beet.pan, plant.id)
#at least six mismatches
shrub.beet.pan &lt;- filter(shrub.beet.pan, plant.id != 104 &amp; plant.id != 114 &amp; plant.id != 182 &amp; plant.id != 261 &amp; plant.id != 263 &amp; plant.id != 284 &amp; plant.id != 285&amp; plant.id != 287&amp; plant.id != 301&amp; plant.id != 302&amp; plant.id != 303&amp; plant.id != 299)


open.beet.pan &lt;- filter(yesbeetle, treatment ==&quot;open&quot;)
open.beet.pan$flowering &lt;- open.beet.pan$blooming
open.beet.pan$flowering &lt;- gsub(&quot;post&quot;, &quot;bloom&quot;, open.beet.pan$flowering)
open.beet.pan &lt;- dplyr::select(open.beet.pan, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, flowering, Species)
open.beet.pan &lt;- arrange(open.beet.pan, plant.id)
#postpan &lt;- filter(post, PlantID != 198)
#postpan &lt;- distinct(postpan)

open.beet.pan &lt;- filter(open.beet.pan, plant.id != 104 &amp; plant.id != 114 &amp; plant.id != 182 &amp; plant.id != 261 &amp; plant.id != 263 &amp; plant.id != 284 &amp; plant.id != 285&amp; plant.id != 287&amp; plant.id != 301&amp; plant.id != 302&amp; plant.id != 303&amp; plant.id != 299)

rii.open.beet.pan &lt;- rii.b(open.beet.pan, c(1:7), 8)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment flowering
## 1   4.16.2017    0.73875    5.1750   18.7500      146      open       pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180      open       pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181      open       pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183      open       pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184      open       pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185      open       pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186      open       pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187      open       pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188      open       pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189      open       pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190      open       pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191      open       pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192      open       pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193      open       pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194      open       pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195      open       pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196      open       pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197      open       pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198      open       pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199      open       pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262      open       pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264      open       pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265      open       pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266      open       pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267      open       pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268      open       pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269      open       pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270      open       pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271      open       pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272      open       pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273      open       pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274      open       pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275      open       pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276      open       pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278      open       pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280      open       pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281      open       pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282      open       pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283      open       pre
## 79  4.19.2017    0.77625    6.0250   17.9000      286      open       pre
## 81  4.11.2017    0.61000    6.3250   18.5750      288      open       pre
## 83  4.12.2017    0.75875    6.6625   18.6125      289      open       pre
## 85  4.19.2017    0.77625    6.0250   17.9000      290      open       pre
## 87  4.17.2017    0.57375    5.5375   18.4125      291      open       pre
## 89  4.13.2017    0.76000    6.1125   18.5625      293      open       pre
## 91  4.13.2017    0.76000    6.1125   18.5625      294      open       pre
## 93  4.17.2017    0.57375    5.5375   18.4125      295      open       pre
## 95  4.10.2017    0.76250    5.1500   18.3500      296      open       pre
## 97  4.19.2017    0.77625    6.0250   17.9000      297      open       pre
## 99  4.16.2017    0.73875    5.1750   18.7500      298      open       pre
## 101 4.15.2017    0.76875    5.1750   18.5000      300      open       pre
##         Species
## 1   -0.11111111
## 3   -0.29411765
## 5   -0.17647059
## 7   -0.42857143
## 9   -0.71428571
## 11   0.44444444
## 13   0.27272727
## 15  -0.33333333
## 17  -0.14285714
## 19  -0.27272727
## 21  -0.10000000
## 23  -0.66666667
## 25  -0.23076923
## 27   0.22222222
## 29  -0.07692308
## 31  -0.38461538
## 33  -0.11111111
## 35  -0.07692308
## 37   0.06666667
## 39  -0.20000000
## 41  -0.71428571
## 43   0.28571429
## 45   0.14285714
## 47  -0.17647059
## 49  -0.09090909
## 51   0.00000000
## 53  -0.33333333
## 55  -0.16666667
## 57   0.00000000
## 59   0.23076923
## 61   0.00000000
## 63   0.05263158
## 65   1.00000000
## 67   0.06666667
## 69  -0.20000000
## 71   0.00000000
## 73  -0.25000000
## 75   0.00000000
## 77   0.33333333
## 79  -0.16666667
## 81  -0.66666667
## 83  -0.14285714
## 85   0.09090909
## 87  -0.33333333
## 89  -0.42857143
## 91  -0.66666667
## 93  -0.09090909
## 95  -0.73333333
## 97  -1.00000000
## 99   0.20000000
## 101 -0.20000000</code></pre>
<pre class="r"><code>rii.shrub.beet.pan &lt;- rii.b(shrub.beet.pan, c(1:7), 8)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment flowering
## 1   4.16.2017    0.73875    5.1750   18.7500      146     shrub       pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180     shrub       pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181     shrub       pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183     shrub       pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184     shrub       pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185     shrub       pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186     shrub       pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187     shrub       pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188     shrub       pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189     shrub       pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190     shrub       pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191     shrub       pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192     shrub       pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193     shrub       pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194     shrub       pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195     shrub       pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196     shrub       pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197     shrub       pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198     shrub       pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199     shrub       pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262     shrub       pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264     shrub       pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265     shrub       pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266     shrub       pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267     shrub       pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268     shrub       pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269     shrub       pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270     shrub       pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271     shrub       pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272     shrub       pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273     shrub       pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274     shrub       pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275     shrub       pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276     shrub       pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278     shrub       pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280     shrub       pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281     shrub       pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282     shrub       pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283     shrub       pre
## 79  4.19.2017    0.77625    6.0250   17.9000      286     shrub       pre
## 81  4.11.2017    0.61000    6.3250   18.5750      288     shrub       pre
## 83  4.12.2017    0.75875    6.6625   18.6125      289     shrub       pre
## 85  4.19.2017    0.77625    6.0250   17.9000      290     shrub       pre
## 87  4.17.2017    0.57375    5.5375   18.4125      291     shrub       pre
## 89  4.13.2017    0.76000    6.1125   18.5625      293     shrub       pre
## 91  4.13.2017    0.76000    6.1125   18.5625      294     shrub       pre
## 93  4.17.2017    0.57375    5.5375   18.4125      295     shrub       pre
## 95  4.10.2017    0.76250    5.1500   18.3500      296     shrub       pre
## 97  4.19.2017    0.77625    6.0250   17.9000      297     shrub       pre
## 99  4.16.2017    0.73875    5.1750   18.7500      298     shrub       pre
## 101 4.15.2017    0.76875    5.1750   18.5000      300     shrub       pre
##         Species
## 1    0.07692308
## 3    0.04761905
## 5    0.20000000
## 7   -0.40000000
## 9   -0.33333333
## 11   0.07692308
## 13  -0.12500000
## 15   0.23076923
## 17  -0.50000000
## 19   0.18181818
## 21   0.04347826
## 23  -0.53846154
## 25  -0.20000000
## 27  -0.04761905
## 29  -0.33333333
## 31  -0.23076923
## 33   0.07692308
## 35  -0.45454545
## 37  -0.22222222
## 39  -0.80000000
## 41  -0.57142857
## 43   0.12500000
## 45  -0.06666667
## 47  -0.25000000
## 49  -0.42857143
## 51  -0.05263158
## 53  -0.08333333
## 55  -0.06666667
## 57  -0.38461538
## 59  -0.33333333
## 61  -0.10000000
## 63  -0.45454545
## 65  -0.29411765
## 67   0.10000000
## 69  -0.86666667
## 71  -0.08333333
## 73   0.50000000
## 75  -0.27272727
## 77   0.42857143
## 79  -0.14285714
## 81  -0.11111111
## 83  -0.22222222
## 85  -0.66666667
## 87   0.05882353
## 89  -0.53846154
## 91  -0.38461538
## 93  -0.06666667
## 95  -0.84615385
## 97  -0.50000000
## 99  -0.06666667
## 101 -0.38461538</code></pre>
<pre class="r"><code>rii.bloom.species &lt;- rbind(rii.open.beet.pan, rii.shrub.beet.pan)


#flowers.rii &lt;- boot(rii.bloom.visits$flowers.per.hour, bootmean, R=1000, stype=&quot;i&quot;, strata = rii.bloom.visits$PlantID)

#rich.rii &lt;- boot(rii.bloom.visits$understory.richness, bootmean, R=1000, stype=&quot;i&quot;, strata = rii.bloom.visits$PlantID)
#abun.rii &lt;- boot(rii.bloom.pan$abun, bootmean, R=1000, stype=&quot;i&quot;, strata = rii.bloom.pan$plant.id)
#percent.rii &lt;- boot(rii.bloom.pan$percent.cover, bootmean, R=1000, stype=&quot;i&quot;, strata = rii.bloom.pan$plant.id)
#rich.arth.rii &lt;- boot(rii.bloom.species$Species, bootmean, R=1000, stype=&quot;i&quot;, strata = rii.bloom.species$plant.id)

#ci.flowers &lt;- boot.ci(flowers.rii)
#bca.flowers &lt;- ci.flowers$bca

#ci.rich &lt;- boot.ci(rich.rii)
#bca.rich &lt;- ci.rich$bca

#ci.abun &lt;- boot.ci(abun.rii)
#bca.abun &lt;- ci.abun$bca

#ci.percent &lt;- boot.ci(percent.rii)
#bca.percent &lt;- ci.percent$bca
#ci.arth &lt;- boot.ci(rich.arth.rii)
#bca.arth &lt;- ci.arth$bca

#ci &lt;- rbind(bca.flowers, bca.rich, bca.abun, bca.percent, bca.arth)



#means.bloom &lt;- rbind(flowers.rii$t0, rich.rii$t0, abun.rii$t0, percent.rii$t0, rich.arth.rii$t0)
#colnames(means.bloom) &lt;- c(&quot;means&quot;)
#row.names(means.bloom) &lt;- c(&quot;visits&quot;, &quot;annual.richness&quot;, &quot;abundance&quot;, &quot;percent.cover&quot;, &quot;arth.rich&quot;)

#all.boot.bloom &lt;- cbind(means.bloom, ci )
#all.boot.bloom &lt;- as.data.frame(all.boot.bloom)
#all.boot.bloom$treatment &lt;- c(&quot;bloom&quot;)

#all.boot &lt;- rbind(all.boot, all.boot.bloom)

all.boot$metric &lt;- c(&quot;visits&quot;, &quot;annual.richness&quot;, &quot;abundance&quot;, &quot;percent.cover&quot;, &quot;arth.rich&quot;)# &quot;visits&quot;, &quot;annual.richness&quot;, &quot;abundance&quot;, &quot;percent.cover&quot;, &quot;arth.rich&quot;)

#all.boot$treatment &lt;- as.factor(all.boot$treatment)
#all.boot$treatment &lt;- relevel(all.boot$treatment, &quot;microsite&quot;, &quot;bloom&quot;)

all.boot$metric &lt;- as.factor(all.boot$metric)
all.boot$metric &lt;- relevel(all.boot$metric, &quot;visits&quot;, &quot;abundance&quot;, &quot;arth.rich&quot;, &quot;percent.cover&quot;, &quot;annual.richness&quot;)

#labels
metrics &lt;- c(&quot;Floral Visits \n per Hour&quot;, &quot;Arthropod \n Abundance&quot;, &quot;Arthropod \n Richness&quot;, &quot;Percent\n Annual Cover&quot;, &quot;Annual Species \n Richness&quot;)
labels &lt;- c(&quot;microsite&quot; = &quot;Microsite&quot;,&quot;bloom&quot; =&quot;Blooming&quot;)



## calculate separate visitation pre/post by microsite bootstrapped


shrub.visits.rii &lt;- boot(rii.shrub.visits$flowers.per.hour, bootmean, R=10000, stype=&quot;i&quot;)
open.visits.rii &lt;- boot(rii.open.visits$flowers.per.hour, bootmean, R=10000, stype=&quot;i&quot;)


shrub.cover.rii &lt;- boot(rii.shrub.pan$percent.cover, bootmean, R=10000, stype=&quot;i&quot;)
open.cover.rii &lt;- boot(rii.open.pan$percent.cover, bootmean, R=10000, stype=&quot;i&quot;)

shrub.rich.rii &lt;- boot(rii.shrub.visits$understory.richness, bootmean, R=10000, stype=&quot;i&quot;)
open.rich.rii &lt;- boot(rii.open.visits$understory.richness, bootmean, R=10000, stype=&quot;i&quot;)

shrub.abun.rii &lt;- boot(rii.shrub.pan$abun, bootmean, R=10000, stype=&quot;i&quot;)
open.abun.rii &lt;- boot(rii.open.pan$abun, bootmean, R=10000, stype=&quot;i&quot;)

shrub.arth.rich.rii &lt;- boot(rii.shrub.beet.pan$Species, bootmean, R=10000, stype=&quot;i&quot;)
open.arth.rich.rii &lt;- boot(rii.open.beet.pan$Species, bootmean, R=10000, stype=&quot;i&quot;)


ci.shrub.visits &lt;- boot.ci(shrub.visits.rii)
bca.shrub.visits &lt;- ci.shrub.visits$bca

ci.open.visits &lt;- boot.ci(open.visits.rii)
bca.open.visits &lt;- ci.open.visits$bca

ci.shrub.cover &lt;- boot.ci(shrub.cover.rii)
bca.shrub.cover &lt;- ci.shrub.cover$bca
ci.open.cover &lt;- boot.ci(open.cover.rii)
bca.open.cover &lt;- ci.open.cover$bca

ci.shrub.rich &lt;- boot.ci(shrub.rich.rii)
bca.shrub.rich &lt;- ci.shrub.rich$bca
ci.open.rich &lt;- boot.ci(open.rich.rii)
bca.open.rich &lt;- ci.open.rich$bca

ci.shrub.abun &lt;- boot.ci(shrub.abun.rii)
bca.shrub.abun &lt;- ci.shrub.abun$bca
ci.open.abun &lt;- boot.ci(open.abun.rii)
bca.open.abun &lt;- ci.open.abun$bca

ci.shrub.arth.rich &lt;- boot.ci(shrub.arth.rich.rii)
bca.shrub.arth.rich &lt;- ci.shrub.arth.rich$bca
ci.open.arth.rich &lt;- boot.ci(open.arth.rich.rii)
bca.open.arth.rich &lt;- ci.open.arth.rich$bca


means.all &lt;- rbind(shrub.visits.rii$t0, open.visits.rii$t0,shrub.cover.rii$t0, open.cover.rii$t0, shrub.rich.rii$t0, open.rich.rii$t0, shrub.abun.rii$t0, open.abun.rii$t0, shrub.arth.rich.rii$t0, open.arth.rich.rii$t0)
colnames(means.all) &lt;- c(&quot;means&quot;)
ci.all &lt;- rbind(bca.shrub.visits, bca.open.visits, bca.shrub.cover, bca.open.cover, bca.shrub.rich, bca.open.rich, bca.shrub.abun, bca.open.abun, bca.shrub.arth.rich, bca.open.arth.rich)


all.new &lt;- cbind(means.all, ci.all)
all.new &lt;- as.data.frame(all.new)

all.new$Microsite &lt;- c(&quot;shrub&quot;, &quot;open&quot;, &quot;shrub&quot;, &quot;open&quot;,&quot;shrub&quot;, &quot;open&quot;,&quot;shrub&quot;, &quot;open&quot;,&quot;shrub&quot;, &quot;open&quot;)
all.new$metric &lt;- c(&quot;visits&quot;, &quot;visits&quot;, &quot;percent.cover&quot;, &quot;percent.cover&quot;, &quot;annual.richness&quot;, &quot;annual.richness&quot;, &quot;arth.abundance&quot;, &quot;arth.abundance&quot;, &quot;arth.richness&quot;, &quot;arth.richness&quot;)


all.new$metric &lt;- as.factor(all.new$metric)
all.new$metric &lt;- relevel(all.new$metric, &quot;visits&quot;, &quot;arth.abundance&quot;, &quot;arth.richness&quot;, &quot;percent.cover&quot;, &quot;annual.richness&quot;)

metrics &lt;- c(&quot;Floral Visits \n per Hour&quot;, &quot;Arthropod \n Abundance&quot;, &quot;Arthropod \n Richness&quot;, &quot;Annual Cover&quot;, &quot;Annual Species \n Richness&quot;)

#summary(a1)
#plot this
library(cowplot)
p1 &lt;- ggplot(all.boot, aes(x=metric, y=means)) + 
  geom_errorbar(aes(ymin=V5, ymax=V6), width=.1) +
  geom_line() +
  geom_point() + scale_x_discrete(limits=c(&quot;visits&quot;, &quot;abundance&quot;, &quot;arth.rich&quot;, &quot;percent.cover&quot;, &quot;annual.richness&quot;), labels = metrics) + theme_Publication() + theme(axis.text.x=element_text(angle=90, vjust=.5)) + ylab(&quot;Relative Interation Index&quot;) + xlab(&quot;&quot;) + geom_hline(aes(yintercept=0))



p2 &lt;- ggplot(all.new, aes(x=metric, y=means, linetype = Microsite)) + geom_errorbar(aes(ymin=V5, ymax=V6), width=.1, position=position_dodge(width=0.3)) + geom_line(position=position_dodge(width=0.3)) + geom_point(position=position_dodge(width=0.3)) + scale_linetype_manual(values=c(&quot;twodash&quot;, &quot;solid&quot;)) + scale_x_discrete(limits=c(&quot;visits&quot;, &quot;arth.abundance&quot;, &quot;arth.richness&quot;, &quot;percent.cover&quot;, &quot;annual.richness&quot;), labels = metrics) + theme_Publication() + theme(axis.text.x=element_text(angle=90, vjust=.5)) + ylab(&quot;&quot;) + xlab(&quot;&quot;) + geom_hline(aes(yintercept=0)) + scale_color_manual(values = c(&quot;black&quot;, &quot;gray&quot;)) + theme(legend.position = c(0.8, 0.05))

plot_grid(p1, p2, labels = c(&quot;A&quot;, &quot;B&quot;), align = &quot;h&quot;)</code></pre>
<pre><code>## geom_path: Each group consists of only one observation. Do you need to
## adjust the group aesthetic?
## geom_path: Each group consists of only one observation. Do you need to
## adjust the group aesthetic?</code></pre>
<p><img src="index_files/figure-html/rii-1.png" width="672" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
