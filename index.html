<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Title</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Pollinator Mediated Interactions of Foundation Plants in the Mojave Desert</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown-header">by Jenna L. Braun</li>
<li>
  <a href="index.html">Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Title</h1>

</div>


<div id="disentangling-the-drivers-and-trade-offs-of-pollinator-mediated-interactions-between-the-foundation-shrub-creosote-bush-larrea-tridentata-and-the-annual-desert-dandelion-malacothrix-glabrata" class="section level1">
<h1>Disentangling the drivers and trade-offs of pollinator-mediated interactions between the foundation shrub Creosote bush (Larrea tridentata) and the annual desert dandelion (Malacothrix glabrata)</h1>

<hr />

<div id="overview" class="section level2">
<h2>Overview</h2>
<p>In arid ecosystems shrub facilitation is a critical process driving plant community structure and assembly, which leads to concentrations of annuals beneath the shrub canopies. Pollinator-mediated interactions have fitness consequences for their participants but are a largely unexplored indirect consequence of shrub-annual facilitation. We tested the capacity of the geographically widespread Creosote bush Larrea tridentata to influence the pollination of its annual understory during its phenological shift into spring flowering. In this system, we found that L. tridentata had a positive ecological effect on annual plant cover, as well as the abundance and richness of the arthropod community but that it also had indirect negative effects on pollinator visitation to a representative flowering annual plant which intensified when L. tridentata bloomed. These finding suggest that the net outcome of association with foundation plant species can be positive or negative depending on both the life-history stage of the protégé species tested and on the phenology of the foundation species. There is the capacity for these trade-offs to be widespread and an increasing focus on further documenting these trade-offs will advance both facilitation theory and assessment of selection processes that can drive co-evolutionary relationships between shrubs, annual plants, and pollinators.</p>

<hr />

<p><img src="Images/site.jpg" /><!-- --></p>
<hr />
<p>#Statistics and modelling</p>
</div>
<div id="pollinator-visitation" class="section level2">
<h2>Pollinator visitation</h2>
<div id="visitation-modelling" class="section level3">
<h3>Visitation modelling</h3>
<p>Hypothesis testing for visitation. GLMM are computationally difficult so workflow is: Base hypothesis model to test for additive vs. interactive effects of predictors. Then add each covariate the best base model. RTU specific responses require a different dataframe so those analyses are done separately. Very full models are not tractable. AllFit.R started throwing an error so moving from lme4 to glmmTMBB. Support for car::Anova in glmmTMB is in the development version.</p>
<pre class="r"><code>byrep &lt;- read.csv(&quot;Output Data/byrep_cleaned.csv&quot;)
byrep$repID &lt;- paste(byrep$PlantID, byrep$treatment)
byrep$treatment &lt;- relevel(byrep$treatment, &quot;open&quot;)
byrep$flowering &lt;- relevel(byrep$flowering, &quot;pre&quot;)

count(byrep, Date)</code></pre>
<pre><code>## # A tibble: 20 x 2
##    Date          n
##    &lt;fct&gt;     &lt;int&gt;
##  1 4.10.2017    11
##  2 4.11.2017    10
##  3 4.12.2017    12
##  4 4.13.2017    12
##  5 4.14.2017    12
##  6 4.15.2017    12
##  7 4.16.2017    11
##  8 4.18.2017    12
##  9 4.19.2017    12
## 10 4.20.2017    12
## 11 4.21.2017    12
## 12 4.22.2017    12
## 13 4.23.2017    12
## 14 4.25.2017    12
## 15 4.26.2017    12
## 16 4.27.2017    12
## 17 4.29.2017    12
## 18 4.30.2017    12
## 19 5.1.2017     12
## 20 5.2.2017     11</code></pre>
<pre class="r"><code>dates &lt;- read.csv(&quot;Clean Data/dates.csv&quot;)
dates$Dates &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, dates$Dates)


dates$Date &lt;- dates$Dates
byrep &lt;- left_join(byrep, dates, by = &quot;Date&quot;)</code></pre>
<pre><code>## Warning: Column `Date` joining factor and character vector, coercing into
## character vector</code></pre>
<pre class="r"><code>#calculate mean video length
mean(byrep$dec.Length)</code></pre>
<pre><code>## [1] 1.324978</code></pre>
<pre class="r"><code>#calculate total flower visits and total foraging instances
sum(byrep$total.flowers)</code></pre>
<pre><code>## [1] 925</code></pre>
<pre class="r"><code>sum(byrep$total.visits)</code></pre>
<pre><code>## [1] 697</code></pre>
<pre class="r"><code>#should be 925 and 697 - not 930 and 701.

pt &lt;- byrep %&gt;% filter(.,flowering == &quot;pre&quot; &amp; treatment == &quot;shrub&quot;) 
f &lt;- pt %&gt;% filter(flowers.shrub &gt; 0)
f &lt;- pt$flowers.shrub
sd(pt$flowers.shrub, na.rm = TRUE)</code></pre>
<pre><code>## [1] 1.534524</code></pre>
<p>Flower visits</p>
<pre class="r"><code>#base hypothesis testing model
#additive
m1 &lt;- glmmTMB(total.flowers ~ treatment + flowering + flowers.pot +  offset(log(dec.Length)) + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = byrep)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment + flowering + flowers.pot + offset(log(dec.Length)) +  
##     (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1113.4   1137.6   -549.7   1099.4      228 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.110000 0.33166 
##  PlantID       (Intercept) 0.004306 0.06562 
## Number of obs: 235, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.03 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     0.99231    0.29018   3.420 0.000627 ***
## treatmentshrub -0.35025    0.16645  -2.104 0.035355 *  
## floweringbloom -1.25518    0.16064  -7.813 5.56e-15 ***
## flowers.pot     0.06996    0.02673   2.617 0.008863 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type = 2)</code></pre>
<pre><code>## Registered S3 methods overwritten by &#39;car&#39;:
##   method                          from
##   influence.merMod                lme4
##   cooks.distance.influence.merMod lme4
##   dfbeta.influence.merMod         lme4
##   dfbetas.influence.merMod        lme4</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.flowers
##               Chisq Df Pr(&gt;Chisq)    
## treatment    4.4279  1   0.035355 *  
## flowering   61.0499  1  5.565e-15 ***
## flowers.pot  6.8503  1   0.008863 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#interactive model

m2 &lt;- glmmTMB(total.flowers ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) + (1|PlantID/repID),  family = &quot;nbinom2&quot;, data = byrep)
summary(m2)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) +  
##     (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1115.4   1143.1   -549.7   1099.4      227 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.108109 0.32880 
##  PlantID       (Intercept) 0.004266 0.06532 
## Number of obs: 235, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.03 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    1.00441    0.29943   3.354 0.000795 ***
## treatmentshrub                -0.37402    0.22030  -1.698 0.089545 .  
## floweringbloom                -1.27992    0.22004  -5.817    6e-09 ***
## flowers.pot                    0.06998    0.02672   2.619 0.008827 ** 
## treatmentshrub:floweringbloom  0.05182    0.31469   0.165 0.869195    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m2, type =3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: total.flowers
##                       Chisq Df Pr(&gt;Chisq)    
## (Intercept)         11.2521  1  0.0007953 ***
## treatment            2.8825  1  0.0895451 .  
## flowering           33.8337  1  6.003e-09 ***
## flowers.pot          6.8575  1  0.0088268 ** 
## treatment:flowering  0.0271  1  0.8691947    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>null &lt;- glmmTMB(total.flowers ~ flowers.pot + offset(log(dec.Length)) + (1|PlantID/repID),  family = &quot;nbinom2&quot;, data = byrep)
summary(null)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          total.flowers ~ flowers.pot + offset(log(dec.Length)) + (1 |  
##     PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1166.2   1183.5   -578.1   1156.2      230 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.06257  0.2501  
##  PlantID       (Intercept) 0.05976  0.2445  
## Number of obs: 235, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 0.705 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  0.79243    0.31602   2.507   0.0122 *
## flowers.pot  0.02672    0.03001   0.890   0.3733  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(null, m1,m2)</code></pre>
<pre><code>## Data: byrep
## Models:
## null: total.flowers ~ flowers.pot + offset(log(dec.Length)) + (1 | , zi=~0, disp=~1
## null:     PlantID/repID), zi=~0, disp=~1
## m1: total.flowers ~ treatment + flowering + flowers.pot + offset(log(dec.Length)) + , zi=~0, disp=~1
## m1:     (1 | PlantID/repID), zi=~0, disp=~1
## m2: total.flowers ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) + , zi=~0, disp=~1
## m2:     (1 | PlantID/repID), zi=~0, disp=~1
##      Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## null  5 1166.2 1183.5 -578.12   1156.2                              
## m1    7 1113.4 1137.6 -549.71   1099.4 56.8240      2   4.58e-13 ***
## m2    8 1115.4 1143.1 -549.69   1099.4  0.0271      1     0.8692    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(m1,m2, null)</code></pre>
<pre><code>##      df      AIC
## m1    7 1113.413
## m2    8 1115.385
## null  5 1166.237</code></pre>
<pre class="r"><code>car::Anova(m2, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: total.flowers
##                       Chisq Df Pr(&gt;Chisq)    
## (Intercept)         11.2521  1  0.0007953 ***
## treatment            2.8825  1  0.0895451 .  
## flowering           33.8337  1  6.003e-09 ***
## flowers.pot          6.8575  1  0.0088268 ** 
## treatment:flowering  0.0271  1  0.8691947    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#model 1 is best fit</code></pre>
<p>Foraging bouts</p>
<pre class="r"><code>#base additive model foraging instances
m3 &lt;- glmmTMB(total.visits ~ treatment + flowering + flowers.pot + offset(log(dec.Length)) + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = byrep)
summary(m3)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ treatment + flowering + flowers.pot + offset(log(dec.Length)) +  
##     (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1002.7   1026.9   -494.4    988.7      228 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.040467 0.20116 
##  PlantID       (Intercept) 0.003019 0.05494 
## Number of obs: 235, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.48 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     0.96727    0.25574   3.782 0.000155 ***
## treatmentshrub -0.32815    0.14465  -2.269 0.023291 *  
## floweringbloom -1.25617    0.14375  -8.739  &lt; 2e-16 ***
## flowers.pot     0.04755    0.02355   2.020 0.043428 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m3, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.visits
##               Chisq Df Pr(&gt;Chisq)    
## treatment    5.1467  1    0.02329 *  
## flowering   76.3670  1    &lt; 2e-16 ***
## flowers.pot  4.0786  1    0.04343 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#base interactive model
m5 &lt;- glmmTMB(total.visits ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = byrep)
summary(m5)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) +  
##     (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1004.7   1032.4   -494.3    988.7      227 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.039793 0.19948 
##  PlantID       (Intercept) 0.003084 0.05553 
## Number of obs: 235, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.48 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.97525    0.26300   3.708 0.000209 ***
## treatmentshrub                -0.34374    0.18748  -1.834 0.066723 .  
## floweringbloom                -1.27358    0.19604  -6.496 8.22e-11 ***
## flowers.pot                    0.04753    0.02355   2.019 0.043519 *  
## treatmentshrub:floweringbloom  0.03685    0.28178   0.131 0.895960    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m5, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: total.visits
##                       Chisq Df Pr(&gt;Chisq)    
## (Intercept)         13.7509  1  0.0002087 ***
## treatment            3.3619  1  0.0667227 .  
## flowering           42.2045  1  8.221e-11 ***
## flowers.pot          4.0751  1  0.0435193 *  
## treatment:flowering  0.0171  1  0.8959596    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#null model
null &lt;- glmmTMB(total.visits ~ flowers.pot + offset(log(dec.Length)) + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = byrep)


anova(null, m3,m5)</code></pre>
<pre><code>## Data: byrep
## Models:
## null: total.visits ~ flowers.pot + offset(log(dec.Length)) + (1 | PlantID/repID), zi=~0, disp=~1
## m3: total.visits ~ treatment + flowering + flowers.pot + offset(log(dec.Length)) + , zi=~0, disp=~1
## m3:     (1 | PlantID/repID), zi=~0, disp=~1
## m5: total.visits ~ treatment * flowering + flowers.pot + offset(log(dec.Length)) + , zi=~0, disp=~1
## m5:     (1 | PlantID/repID), zi=~0, disp=~1
##      Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## null  5 1067.8 1085.1 -528.90  1057.80                              
## m3    7 1002.7 1026.9 -494.35   988.70 69.0982      2  9.897e-16 ***
## m5    8 1004.7 1032.4 -494.34   988.69  0.0171      1     0.8959    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(m3, m5, null)</code></pre>
<pre><code>##      df      AIC
## m3    7 1002.703
## m5    8 1004.686
## null  5 1067.801</code></pre>
<pre class="r"><code>ggplot(byrep, aes(flowering, flowers.per.hour)) + geom_boxplot() + facet_grid(~treatment)</code></pre>
<p><img src="index_files/figure-html/visitation%20models%20(foraging)-1.png" width="672" /> ###Testing importance of covariates using TMB because glmer will not coverge.</p>
<p>Annual floral density</p>
<pre class="r"><code>c2 &lt;- glmmTMB(total.visits ~ treatment * flowering + flowers.pot + het.annual.floral.density + het.shrub.blooming.neighbours + offset(log(dec.Length)) + (1|PlantID/repID), family = nbinom2(link = &quot;log&quot;), data = byrep)
summary(c2)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ treatment * flowering + flowers.pot + het.annual.floral.density +  
##     het.shrub.blooming.neighbours + offset(log(dec.Length)) +  
##     (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##    987.7   1022.1   -483.8    967.7      221 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.05936  0.24363 
##  PlantID       (Intercept) 0.00229  0.04785 
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.62 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.79991    0.26915   2.972  0.00296 ** 
## treatmentshrub                -0.35523    0.18596  -1.910  0.05610 .  
## floweringbloom                -1.18660    0.20485  -5.792 6.94e-09 ***
## flowers.pot                    0.05948    0.02374   2.506  0.01221 *  
## het.annual.floral.density      0.04136    0.01986   2.082  0.03730 *  
## het.shrub.blooming.neighbours -0.03560    0.03825  -0.931  0.35205    
## treatmentshrub:floweringbloom  0.08055    0.28402   0.284  0.77672    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(c2, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: total.visits
##                                 Chisq Df Pr(&gt;Chisq)    
## (Intercept)                    8.8330  1   0.002958 ** 
## treatment                      3.6490  1   0.056103 .  
## flowering                     33.5521  1  6.938e-09 ***
## flowers.pot                    6.2802  1   0.012209 *  
## het.annual.floral.density      4.3366  1   0.037301 *  
## het.shrub.blooming.neighbours  0.8661  1   0.352046    
## treatment:flowering            0.0804  1   0.776719    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>c2.v &lt;- glmmTMB(total.visits ~ treatment + flowering + het.annual.floral.density + flowers.pot + offset(log(dec.Length)) + (1|PlantID/repID), family = nbinom2(link = &quot;log&quot;), data = byrep)
summary(c2.v)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ treatment + flowering + het.annual.floral.density +  
##     flowers.pot + offset(log(dec.Length)) + (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##    984.6   1012.1   -484.3    968.6      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.04899  0.2213  
##  PlantID       (Intercept) 0.01753  0.1324  
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.62 
## 
## Conditional model:
##                           Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                0.78251    0.26356   2.969  0.00299 ** 
## treatmentshrub            -0.34480    0.14425  -2.390  0.01684 *  
## floweringbloom            -1.22826    0.14485  -8.479  &lt; 2e-16 ***
## het.annual.floral.density  0.04069    0.01984   2.051  0.04029 *  
## flowers.pot                0.05863    0.02389   2.455  0.01410 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(c2.v, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.visits
##                             Chisq Df Pr(&gt;Chisq)    
## treatment                  5.7134  1    0.01684 *  
## flowering                 71.9003  1    &lt; 2e-16 ***
## het.annual.floral.density  4.2057  1    0.04029 *  
## flowers.pot                6.0255  1    0.01410 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>q &lt;- glmmTMB(total.visits ~ treatment + flowering + flowers.pot + het.annual.floral.density + offset(log(dec.Length)) + (1|PlantID/repID), family = nbinom1(link = &quot;log&quot;), data = byrep)
car::Anova(q, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.visits
##                             Chisq Df Pr(&gt;Chisq)    
## treatment                  2.3549  1    0.12489    
## flowering                 53.4209  1  2.692e-13 ***
## flowers.pot                6.2274  1    0.01258 *  
## het.annual.floral.density  9.5405  1    0.00201 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(c2.v, q)</code></pre>
<pre><code>##      df      AIC
## c2.v  8 984.5580
## q     8 990.3342</code></pre>
<pre class="r"><code>#nbinom2 better

#flowers
c2.f &lt;- glmmTMB(total.flowers ~ treatment * flowering + het.annual.floral.density + flowers.pot + offset(log(dec.Length)) + (1|PlantID/repID), family = nbinom2(link = &quot;log&quot;), data = byrep)
summary(c2.f)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment * flowering + het.annual.floral.density +  
##     flowers.pot + offset(log(dec.Length)) + (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1097.7   1128.7   -539.9   1079.7      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.120279 0.34681 
##  PlantID       (Intercept) 0.009982 0.09991 
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.08 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.83530    0.30654   2.725  0.00643 ** 
## treatmentshrub                -0.39868    0.21963  -1.815  0.06949 .  
## floweringbloom                -1.24944    0.22058  -5.664 1.48e-08 ***
## het.annual.floral.density      0.04004    0.02339   1.712  0.08691 .  
## flowers.pot                    0.08036    0.02713   2.961  0.00306 ** 
## treatmentshrub:floweringbloom  0.04730    0.31517   0.150  0.88071    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(c2.f, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: total.flowers
##                             Chisq Df Pr(&gt;Chisq)    
## (Intercept)                7.4252  1   0.006432 ** 
## treatment                  3.2950  1   0.069491 .  
## flowering                 32.0858  1  1.475e-08 ***
## het.annual.floral.density  2.9306  1   0.086913 .  
## flowers.pot                8.7695  1   0.003063 ** 
## treatment:flowering        0.0225  1   0.880707    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>c2.flowers &lt;- glmmTMB(total.flowers ~ treatment + flowering + flowers.pot + het.annual.floral.density + offset(log(dec.Length)) + (1|PlantID/repID), family = nbinom2(link = &quot;log&quot;), data = byrep)
summary(c2.flowers)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment + flowering + flowers.pot + het.annual.floral.density +  
##     offset(log(dec.Length)) + (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1095.7   1123.3   -539.9   1079.7      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.12228  0.34969 
##  PlantID       (Intercept) 0.00987  0.09935 
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.09 
## 
## Conditional model:
##                           Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                0.82490    0.29852   2.763  0.00572 ** 
## treatmentshrub            -0.37733    0.16732  -2.255  0.02412 *  
## floweringbloom            -1.22713    0.16283  -7.536 4.84e-14 ***
## flowers.pot                0.08032    0.02714   2.960  0.00308 ** 
## het.annual.floral.density  0.03984    0.02334   1.707  0.08789 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(c2.flowers, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.flowers
##                             Chisq Df Pr(&gt;Chisq)    
## treatment                  5.0857  1    0.02412 *  
## flowering                 56.7922  1  4.844e-14 ***
## flowers.pot                8.7595  1    0.00308 ** 
## het.annual.floral.density  2.9125  1    0.08789 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Number of blooming shrub neighbours</p>
<pre class="r"><code>c3 &lt;- glmmTMB(total.flowers ~ treatment + flowering + flowers.pot + het.shrub.blooming.neighbours + offset(log(dec.Length)) + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = byrep)
summary(c3)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment + flowering + flowers.pot + het.shrub.blooming.neighbours +  
##     offset(log(dec.Length)) + (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1097.5   1125.1   -540.8   1081.5      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance  Std.Dev. 
##  repID:PlantID (Intercept) 1.183e-01 0.3440086
##  PlantID       (Intercept) 2.552e-08 0.0001598
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.06 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.94775    0.29061   3.261  0.00111 ** 
## treatmentshrub                -0.32888    0.16998  -1.935  0.05301 .  
## floweringbloom                -1.16615    0.18601  -6.269 3.63e-10 ***
## flowers.pot                    0.07598    0.02703   2.811  0.00494 ** 
## het.shrub.blooming.neighbours -0.04940    0.04093  -1.207  0.22744    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(c3, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.flowers
##                                 Chisq Df Pr(&gt;Chisq)    
## treatment                      3.7437  1   0.053008 .  
## flowering                     39.3038  1  3.627e-10 ***
## flowers.pot                    7.9027  1   0.004936 ** 
## het.shrub.blooming.neighbours  1.4568  1   0.227438    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>c2.v &lt;- glmmTMB(total.visits ~ treatment + flowering + flowers.pot + het.shrub.blooming.neighbours + offset(log(dec.Length)) + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = byrep)
summary(c2.v)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ treatment + flowering + flowers.pot + het.shrub.blooming.neighbours +  
##     offset(log(dec.Length)) + (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##    988.5   1016.0   -486.2    972.5      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance  Std.Dev. 
##  repID:PlantID (Intercept) 5.570e-02 0.2360056
##  PlantID       (Intercept) 8.077e-08 0.0002842
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.53 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.92071    0.25682   3.585 0.000337 ***
## treatmentshrub                -0.31539    0.14829  -2.127 0.033434 *  
## floweringbloom                -1.20875    0.16707  -7.235 4.66e-13 ***
## flowers.pot                    0.05296    0.02376   2.229 0.025799 *  
## het.shrub.blooming.neighbours -0.03124    0.03744  -0.835 0.403996    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(c2.v)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.visits
##                                 Chisq Df Pr(&gt;Chisq)    
## treatment                      4.5234  1    0.03343 *  
## flowering                     52.3453  1  4.655e-13 ***
## flowers.pot                    4.9695  1    0.02580 *  
## het.shrub.blooming.neighbours  0.6964  1    0.40400    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#each model with both covariates added
c.visits &lt;- glmmTMB(total.visits ~ treatment + flowering + flowers.pot + het.annual.floral.density + het.shrub.blooming.neighbours +  offset(log(dec.Length)) + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = byrep)
summary(c.visits)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ treatment + flowering + flowers.pot + het.annual.floral.density +  
##     het.shrub.blooming.neighbours + offset(log(dec.Length)) +  
##     (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##    985.8   1016.7   -483.9    967.8      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.060672 0.24632 
##  PlantID       (Intercept) 0.002709 0.05205 
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.62 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.78353    0.26268   2.983  0.00286 ** 
## treatmentshrub                -0.32315    0.14741  -2.192  0.02837 *  
## floweringbloom                -1.15297    0.16688  -6.909 4.88e-12 ***
## flowers.pot                    0.05945    0.02374   2.504  0.01227 *  
## het.annual.floral.density      0.04108    0.01982   2.072  0.03823 *  
## het.shrub.blooming.neighbours -0.03383    0.03778  -0.895  0.37055    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(c.visits, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: total.visits
##                                 Chisq Df Pr(&gt;Chisq)    
## treatment                      4.8054  1    0.02837 *  
## flowering                     47.7336  1  4.882e-12 ***
## flowers.pot                    6.2713  1    0.01227 *  
## het.annual.floral.density      4.2948  1    0.03823 *  
## het.shrub.blooming.neighbours  0.8018  1    0.37055    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>c.flowers &lt;- glmmTMB(total.flowers ~ treatment * flowering + flowers.pot + het.annual.floral.density + het.shrub.blooming.neighbours +  offset(log(dec.Length)) + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = byrep)
summary(c.flowers)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ treatment * flowering + flowers.pot + het.annual.floral.density +  
##     het.shrub.blooming.neighbours + offset(log(dec.Length)) +  
##     (1 | PlantID/repID)
## Data: byrep
## 
##      AIC      BIC   logLik deviance df.resid 
##   1097.9   1132.3   -539.0   1077.9      221 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance  Std.Dev. 
##  repID:PlantID (Intercept) 1.165e-01 0.3413310
##  PlantID       (Intercept) 3.278e-08 0.0001811
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.08 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.84650    0.30540   2.772  0.00557 ** 
## treatmentshrub                -0.39633    0.21933  -1.807  0.07077 .  
## floweringbloom                -1.16105    0.22987  -5.051  4.4e-07 ***
## flowers.pot                    0.08231    0.02705   3.043  0.00234 ** 
## het.annual.floral.density      0.04162    0.02332   1.785  0.07426 .  
## het.shrub.blooming.neighbours -0.05571    0.04125  -1.350  0.17687    
## treatmentshrub:floweringbloom  0.12553    0.32018   0.392  0.69502    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>t &lt;- car::Anova(c.flowers, type = 2)</code></pre>
</div>
<div id="number-of-larrea-flowers" class="section level3">
<h3>Number of larrea flowers</h3>
<pre class="r"><code>shr &lt;- byrep %&gt;% filter(treatment == &quot;shrub&quot;)

s1 &lt;- glmmTMB(total.flowers ~ flowers.shrub*flowering + flowers.pot + het.annual.floral.density  +  offset(log(dec.Length)) + (1|PlantID), family = &quot;nbinom2&quot;, data = shr)
summary(s1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.flowers ~ flowers.shrub * flowering + flowers.pot + het.annual.floral.density +  
##     offset(log(dec.Length)) + (1 | PlantID)
## Data: shr
## 
##      AIC      BIC   logLik deviance df.resid 
##    513.5    535.6   -248.8    497.5      109 
## 
## Random effects:
## 
## Conditional model:
##  Groups  Name        Variance Std.Dev.
##  PlantID (Intercept) 0.1381   0.3716  
## Number of obs: 117, groups:  PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 1.55 
## 
## Conditional model:
##                              Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)                   0.42794    0.41222   1.038  0.29921   
## flowers.shrub                -0.22586    0.10827  -2.086  0.03697 * 
## floweringbloom               -1.24068    0.38533  -3.220  0.00128 **
## flowers.pot                   0.09614    0.03728   2.579  0.00991 **
## het.annual.floral.density     0.06536    0.03064   2.133  0.03290 * 
## flowers.shrub:floweringbloom  0.22535    0.10828   2.081  0.03742 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>kable(car::Anova(s1, type = 3))</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">Chisq</th>
<th align="right">Df</th>
<th align="right">Pr(&gt;Chisq)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">1.077702</td>
<td align="right">1</td>
<td align="right">0.2992123</td>
</tr>
<tr class="even">
<td>flowers.shrub</td>
<td align="right">4.351898</td>
<td align="right">1</td>
<td align="right">0.0369677</td>
</tr>
<tr class="odd">
<td>flowering</td>
<td align="right">10.366824</td>
<td align="right">1</td>
<td align="right">0.0012830</td>
</tr>
<tr class="even">
<td>flowers.pot</td>
<td align="right">6.651522</td>
<td align="right">1</td>
<td align="right">0.0099071</td>
</tr>
<tr class="odd">
<td>het.annual.floral.density</td>
<td align="right">4.551021</td>
<td align="right">1</td>
<td align="right">0.0328991</td>
</tr>
<tr class="even">
<td>flowers.shrub:flowering</td>
<td align="right">4.331218</td>
<td align="right">1</td>
<td align="right">0.0374195</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#library(performance)
#check_overdispersion(s1)
library(emmeans)

l &lt;- emtrends(s1,  pairwise ~ flowering, var = &quot;flowers.shrub&quot;)
l</code></pre>
<pre><code>## $emtrends
##  flowering flowers.shrub.trend       SE  df lower.CL upper.CL
##  pre                 -0.225862 0.108269 109 -0.44045 -0.01128
##  bloom               -0.000508 0.000988 109 -0.00247  0.00145
## 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast    estimate    SE  df t.ratio p.value
##  pre - bloom   -0.225 0.108 109 -2.081  0.0398</code></pre>
<pre class="r"><code>s2 &lt;- glmmTMB(total.visits ~ flowers.shrub*flowering + flowers.pot + het.annual.floral.density  +  offset(log(dec.Length)) + (1|PlantID), family = &quot;nbinom2&quot;, data = shr)
summary(s2)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## total.visits ~ flowers.shrub * flowering + flowers.pot + het.annual.floral.density +  
##     offset(log(dec.Length)) + (1 | PlantID)
## Data: shr
## 
##      AIC      BIC   logLik deviance df.resid 
##    458.1    480.1   -221.0    442.1      109 
## 
## Random effects:
## 
## Conditional model:
##  Groups  Name        Variance Std.Dev.
##  PlantID (Intercept) 0.03758  0.1939  
## Number of obs: 117, groups:  PlantID, 61
## 
## Overdispersion parameter for nbinom2 family ():  2.6 
## 
## Conditional model:
##                              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   0.26369    0.34678   0.760 0.447017    
## flowers.shrub                -0.16469    0.09027  -1.824 0.068082 .  
## floweringbloom               -1.30747    0.33917  -3.855 0.000116 ***
## flowers.pot                   0.08807    0.03116   2.826 0.004709 ** 
## het.annual.floral.density     0.06153    0.02431   2.531 0.011358 *  
## flowers.shrub:floweringbloom  0.16448    0.09027   1.822 0.068420 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>kable(car::Anova(s2, type = 3))</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">Chisq</th>
<th align="right">Df</th>
<th align="right">Pr(&gt;Chisq)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">0.5782034</td>
<td align="right">1</td>
<td align="right">0.4470174</td>
</tr>
<tr class="even">
<td>flowers.shrub</td>
<td align="right">3.3286581</td>
<td align="right">1</td>
<td align="right">0.0680824</td>
</tr>
<tr class="odd">
<td>flowering</td>
<td align="right">14.8598599</td>
<td align="right">1</td>
<td align="right">0.0001158</td>
</tr>
<tr class="even">
<td>flowers.pot</td>
<td align="right">7.9878789</td>
<td align="right">1</td>
<td align="right">0.0047092</td>
</tr>
<tr class="odd">
<td>het.annual.floral.density</td>
<td align="right">6.4084479</td>
<td align="right">1</td>
<td align="right">0.0113579</td>
</tr>
<tr class="even">
<td>flowers.shrub:flowering</td>
<td align="right">3.3205344</td>
<td align="right">1</td>
<td align="right">0.0684196</td>
</tr>
<tr class="odd">
<td>### RTU visitation modelling</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td>Models for testing RTU-speci</td>
<td align="right">ficity</td>
<td align="right"></td>
<td align="right"></td>
</tr>
</tbody>
</table>
<pre class="r"><code>byrtu &lt;- read.csv(&quot;Output Data/rtu_by_rep.csv&quot;)
byrtu$repID &lt;- paste(byrtu$PlantID, byrtu$treatment)
byrtu$treatment &lt;- relevel(byrtu$treatment, &quot;open&quot;)
byrtu$flowering &lt;- relevel(byrtu$flowering, &quot;pre&quot;)

#Full model (foraging instances)
mFullPQ &lt;- MASS::glmmPQL(total.visits~flowering * rtu * treatment + flowers.pot + het.annual.floral.density + het.shrub.blooming.neighbours + offset(log(dec.Length)), random = ~1|PlantID/repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>summary(mFullPQ)</code></pre>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##  Data: byrtu 
##   AIC BIC logLik
##    NA  NA     NA
## 
## Random effects:
##  Formula: ~1 | PlantID
##         (Intercept)
## StdDev:   0.2203551
## 
##  Formula: ~1 | repID %in% PlantID
##         (Intercept) Residual
## StdDev:   0.4733597 1.324489
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~invwt 
## Fixed effects: total.visits ~ flowering * rtu * treatment + flowers.pot + het.annual.floral.density +      het.shrub.blooming.neighbours + offset(log(dec.Length)) 
##                                                Value Std.Error   DF   t-value
## (Intercept)                                -1.415959      0.33 1239 -4.352760
## floweringbloom                             -2.200581      0.71 1239 -3.078653
## rtubombylid                                -0.757686      0.42 1239 -1.810258
## rtuhoneybee                               -27.611509 142023.57 1239 -0.000194
## rtulep                                     -3.465736      1.36 1239 -2.551486
## rtuother                                    0.523248      0.30 1239  1.753517
## rtusyrphid                                  1.822531      0.25 1239  7.151519
## treatmentshrub                             -0.844208      0.45   60 -1.875363
## flowers.pot                                 0.053632      0.02 1239  2.541848
## het.annual.floral.density                   0.037148      0.02 1239  2.398246
## het.shrub.blooming.neighbours              -0.044494      0.04 1239 -1.137575
## floweringbloom:rtubombylid                  2.315830      0.85 1239  2.735640
## floweringbloom:rtuhoneybee                  2.077398 200954.54 1239  0.000010
## floweringbloom:rtulep                       4.564348      1.56 1239  2.921181
## floweringbloom:rtuother                     2.133509      0.75 1239  2.831591
## floweringbloom:rtusyrphid                  -0.643876      0.81 1239 -0.798721
## floweringbloom:treatmentshrub               1.476754      0.95 1239  1.557598
## rtubombylid:treatmentshrub                  1.188469      0.63 1239  1.873833
## rtuhoneybee:treatmentshrub                 26.655998 142023.57 1239  0.000188
## rtulep:treatmentshrub                       0.900787      1.94 1239  0.463819
## rtuother:treatmentshrub                     0.575364      0.52 1239  1.102113
## rtusyrphid:treatmentshrub                   0.480054      0.47 1239  1.032115
## floweringbloom:rtubombylid:treatmentshrub  -2.294628      1.17 1239 -1.966219
## floweringbloom:rtuhoneybee:treatmentshrub -27.253683 247747.94 1239 -0.000110
## floweringbloom:rtulep:treatmentshrub       -1.999399      2.21 1239 -0.905147
## floweringbloom:rtuother:treatmentshrub     -1.349390      1.02 1239 -1.319578
## floweringbloom:rtusyrphid:treatmentshrub   -1.812860      1.16 1239 -1.557370
##                                           p-value
## (Intercept)                                0.0000
## floweringbloom                             0.0021
## rtubombylid                                0.0705
## rtuhoneybee                                0.9998
## rtulep                                     0.0108
## rtuother                                   0.0798
## rtusyrphid                                 0.0000
## treatmentshrub                             0.0656
## flowers.pot                                0.0111
## het.annual.floral.density                  0.0166
## het.shrub.blooming.neighbours              0.2555
## floweringbloom:rtubombylid                 0.0063
## floweringbloom:rtuhoneybee                 1.0000
## floweringbloom:rtulep                      0.0036
## floweringbloom:rtuother                    0.0047
## floweringbloom:rtusyrphid                  0.4246
## floweringbloom:treatmentshrub              0.1196
## rtubombylid:treatmentshrub                 0.0612
## rtuhoneybee:treatmentshrub                 0.9999
## rtulep:treatmentshrub                      0.6429
## rtuother:treatmentshrub                    0.2706
## rtusyrphid:treatmentshrub                  0.3022
## floweringbloom:rtubombylid:treatmentshrub  0.0495
## floweringbloom:rtuhoneybee:treatmentshrub  0.9999
## floweringbloom:rtulep:treatmentshrub       0.3656
## floweringbloom:rtuother:treatmentshrub     0.1872
## floweringbloom:rtusyrphid:treatmentshrub   0.1196
##  Correlation: 
##                                           (Intr) flwrng rtbmby rthnyb rtulep
## floweringbloom                            -0.218                            
## rtubombylid                               -0.411  0.187                     
## rtuhoneybee                                0.000  0.000  0.000              
## rtulep                                    -0.127  0.058  0.098  0.000       
## rtuother                                  -0.576  0.262  0.448  0.000  0.138
## rtusyrphid                                -0.674  0.307  0.524  0.000  0.162
## treatmentshrub                            -0.416  0.177  0.297  0.000  0.091
## flowers.pot                               -0.641 -0.035  0.000  0.000  0.000
## het.annual.floral.density                 -0.193  0.031  0.000  0.000  0.000
## het.shrub.blooming.neighbours             -0.004 -0.102  0.000  0.000  0.000
## floweringbloom:rtubombylid                 0.203 -0.832 -0.494  0.000 -0.049
## floweringbloom:rtuhoneybee                 0.000  0.000  0.000 -0.707  0.000
## floweringbloom:rtulep                      0.110 -0.451 -0.085  0.000 -0.869
## floweringbloom:rtuother                    0.228 -0.934 -0.177  0.000 -0.055
## floweringbloom:rtusyrphid                  0.213 -0.873 -0.166  0.000 -0.051
## floweringbloom:treatmentshrub              0.181 -0.741 -0.141  0.000 -0.043
## rtubombylid:treatmentshrub                 0.271 -0.123 -0.660  0.000 -0.065
## rtuhoneybee:treatmentshrub                 0.000  0.000  0.000 -1.000  0.000
## rtulep:treatmentshrub                      0.088 -0.040 -0.069  0.000 -0.699
## rtuother:treatmentshrub                    0.329 -0.150 -0.256  0.000 -0.079
## rtusyrphid:treatmentshrub                  0.370 -0.168 -0.287  0.000 -0.088
## floweringbloom:rtubombylid:treatmentshrub -0.147  0.603  0.359  0.000  0.035
## floweringbloom:rtuhoneybee:treatmentshrub  0.000  0.000  0.000  0.573  0.000
## floweringbloom:rtulep:treatmentshrub      -0.078  0.319  0.060  0.000  0.615
## floweringbloom:rtuother:treatmentshrub    -0.168  0.688  0.131  0.000  0.040
## floweringbloom:rtusyrphid:treatmentshrub  -0.148  0.605  0.115  0.000  0.035
##                                           rtuthr rtsyrp trtmnt flwrs. ht.n..
## floweringbloom                                                              
## rtubombylid                                                                 
## rtuhoneybee                                                                 
## rtulep                                                                      
## rtuother                                                                    
## rtusyrphid                                 0.735                            
## treatmentshrub                             0.416  0.487                     
## flowers.pot                                0.000  0.000  0.006              
## het.annual.floral.density                  0.000  0.000  0.001  0.173       
## het.shrub.blooming.neighbours              0.000  0.000 -0.017 -0.067 -0.080
## floweringbloom:rtubombylid                -0.221 -0.259 -0.147  0.000  0.000
## floweringbloom:rtuhoneybee                 0.000  0.000  0.000  0.000  0.000
## floweringbloom:rtulep                     -0.120 -0.140 -0.079  0.000  0.000
## floweringbloom:rtuother                   -0.396 -0.291 -0.165  0.000  0.000
## floweringbloom:rtusyrphid                 -0.232 -0.316 -0.154  0.000  0.000
## floweringbloom:treatmentshrub             -0.198 -0.231 -0.455  0.005  0.008
## rtubombylid:treatmentshrub                -0.295 -0.346 -0.678  0.000  0.000
## rtuhoneybee:treatmentshrub                 0.000  0.000  0.000  0.000  0.000
## rtulep:treatmentshrub                     -0.096 -0.113 -0.221  0.000  0.000
## rtuother:treatmentshrub                   -0.572 -0.420 -0.824  0.000  0.000
## rtusyrphid:treatmentshrub                 -0.403 -0.548 -0.924  0.000  0.000
## floweringbloom:rtubombylid:treatmentshrub  0.161  0.188  0.368  0.000  0.000
## floweringbloom:rtuhoneybee:treatmentshrub  0.000  0.000  0.000  0.000  0.000
## floweringbloom:rtulep:treatmentshrub       0.085  0.099  0.195  0.000  0.000
## floweringbloom:rtuother:treatmentshrub     0.292  0.215  0.420  0.000  0.000
## floweringbloom:rtusyrphid:treatmentshrub   0.161  0.219  0.369  0.000  0.000
##                                           ht.s.. flwrngblm:rtb flwrngblm:rth
## floweringbloom                                                              
## rtubombylid                                                                 
## rtuhoneybee                                                                 
## rtulep                                                                      
## rtuother                                                                    
## rtusyrphid                                                                  
## treatmentshrub                                                              
## flowers.pot                                                                 
## het.annual.floral.density                                                   
## het.shrub.blooming.neighbours                                               
## floweringbloom:rtubombylid                 0.000                            
## floweringbloom:rtuhoneybee                 0.000  0.000                     
## floweringbloom:rtulep                      0.000  0.380         0.000       
## floweringbloom:rtuother                    0.000  0.789         0.000       
## floweringbloom:rtusyrphid                  0.000  0.737         0.000       
## floweringbloom:treatmentshrub             -0.028  0.627         0.000       
## rtubombylid:treatmentshrub                 0.000  0.326         0.000       
## rtuhoneybee:treatmentshrub                 0.000  0.000         0.707       
## rtulep:treatmentshrub                      0.000  0.034         0.000       
## rtuother:treatmentshrub                    0.000  0.127         0.000       
## rtusyrphid:treatmentshrub                  0.000  0.142         0.000       
## floweringbloom:rtubombylid:treatmentshrub  0.000 -0.725         0.000       
## floweringbloom:rtuhoneybee:treatmentshrub  0.000  0.000        -0.811       
## floweringbloom:rtulep:treatmentshrub       0.000 -0.269         0.000       
## floweringbloom:rtuother:treatmentshrub     0.000 -0.581         0.000       
## floweringbloom:rtusyrphid:treatmentshrub   0.000 -0.511         0.000       
##                                           flwrngblm:rtl flwrngblm:rtt
## floweringbloom                                                       
## rtubombylid                                                          
## rtuhoneybee                                                          
## rtulep                                                               
## rtuother                                                             
## rtusyrphid                                                           
## treatmentshrub                                                       
## flowers.pot                                                          
## het.annual.floral.density                                            
## het.shrub.blooming.neighbours                                        
## floweringbloom:rtubombylid                                           
## floweringbloom:rtuhoneybee                                           
## floweringbloom:rtulep                                                
## floweringbloom:rtuother                    0.427                     
## floweringbloom:rtusyrphid                  0.399         0.828       
## floweringbloom:treatmentshrub              0.340         0.704       
## rtubombylid:treatmentshrub                 0.056         0.117       
## rtuhoneybee:treatmentshrub                 0.000         0.000       
## rtulep:treatmentshrub                      0.608         0.038       
## rtuother:treatmentshrub                    0.069         0.226       
## rtusyrphid:treatmentshrub                  0.077         0.160       
## floweringbloom:rtubombylid:treatmentshrub -0.276        -0.572       
## floweringbloom:rtuhoneybee:treatmentshrub  0.000         0.000       
## floweringbloom:rtulep:treatmentshrub      -0.707        -0.302       
## floweringbloom:rtuother:treatmentshrub    -0.315        -0.737       
## floweringbloom:rtusyrphid:treatmentshrub  -0.277        -0.574       
##                                           flwrngblm:rts flwrngblm:t rtbmb:
## floweringbloom                                                            
## rtubombylid                                                               
## rtuhoneybee                                                               
## rtulep                                                                    
## rtuother                                                                  
## rtusyrphid                                                                
## treatmentshrub                                                            
## flowers.pot                                                               
## het.annual.floral.density                                                 
## het.shrub.blooming.neighbours                                             
## floweringbloom:rtubombylid                                                
## floweringbloom:rtuhoneybee                                                
## floweringbloom:rtulep                                                     
## floweringbloom:rtuother                                                   
## floweringbloom:rtusyrphid                                                 
## floweringbloom:treatmentshrub              0.658                          
## rtubombylid:treatmentshrub                 0.109         0.322            
## rtuhoneybee:treatmentshrub                 0.000         0.000       0.000
## rtulep:treatmentshrub                      0.036         0.105       0.157
## rtuother:treatmentshrub                    0.133         0.391       0.585
## rtusyrphid:treatmentshrub                  0.173         0.439       0.656
## floweringbloom:rtubombylid:treatmentshrub -0.535        -0.810      -0.543
## floweringbloom:rtuhoneybee:treatmentshrub  0.000         0.000       0.000
## floweringbloom:rtulep:treatmentshrub      -0.283        -0.428      -0.138
## floweringbloom:rtuother:treatmentshrub    -0.610        -0.925      -0.298
## floweringbloom:rtusyrphid:treatmentshrub  -0.693        -0.812      -0.262
##                                           rthny: rtlp:t rtthr: rtsyr:
## floweringbloom                                                       
## rtubombylid                                                          
## rtuhoneybee                                                          
## rtulep                                                               
## rtuother                                                             
## rtusyrphid                                                           
## treatmentshrub                                                       
## flowers.pot                                                          
## het.annual.floral.density                                            
## het.shrub.blooming.neighbours                                        
## floweringbloom:rtubombylid                                           
## floweringbloom:rtuhoneybee                                           
## floweringbloom:rtulep                                                
## floweringbloom:rtuother                                              
## floweringbloom:rtusyrphid                                            
## floweringbloom:treatmentshrub                                        
## rtubombylid:treatmentshrub                                           
## rtuhoneybee:treatmentshrub                                           
## rtulep:treatmentshrub                      0.000                     
## rtuother:treatmentshrub                    0.000  0.191              
## rtusyrphid:treatmentshrub                  0.000  0.214  0.797       
## floweringbloom:rtubombylid:treatmentshrub  0.000 -0.085 -0.318 -0.357
## floweringbloom:rtuhoneybee:treatmentshrub -0.573  0.000  0.000  0.000
## floweringbloom:rtulep:treatmentshrub       0.000 -0.879 -0.168 -0.188
## floweringbloom:rtuother:treatmentshrub     0.000 -0.097 -0.511 -0.407
## floweringbloom:rtusyrphid:treatmentshrub   0.000 -0.086 -0.318 -0.400
##                                           flwrngblm:rtb: flwrngblm:rth:
## floweringbloom                                                         
## rtubombylid                                                            
## rtuhoneybee                                                            
## rtulep                                                                 
## rtuother                                                               
## rtusyrphid                                                             
## treatmentshrub                                                         
## flowers.pot                                                            
## het.annual.floral.density                                              
## het.shrub.blooming.neighbours                                          
## floweringbloom:rtubombylid                                             
## floweringbloom:rtuhoneybee                                             
## floweringbloom:rtulep                                                  
## floweringbloom:rtuother                                                
## floweringbloom:rtusyrphid                                              
## floweringbloom:treatmentshrub                                          
## rtubombylid:treatmentshrub                                             
## rtuhoneybee:treatmentshrub                                             
## rtulep:treatmentshrub                                                  
## rtuother:treatmentshrub                                                
## rtusyrphid:treatmentshrub                                              
## floweringbloom:rtubombylid:treatmentshrub                              
## floweringbloom:rtuhoneybee:treatmentshrub  0.000                       
## floweringbloom:rtulep:treatmentshrub       0.348          0.000        
## floweringbloom:rtuother:treatmentshrub     0.751          0.000        
## floweringbloom:rtusyrphid:treatmentshrub   0.660          0.000        
##                                           flwrngblm:rtl: flwrngblm:rtt:
## floweringbloom                                                         
## rtubombylid                                                            
## rtuhoneybee                                                            
## rtulep                                                                 
## rtuother                                                               
## rtusyrphid                                                             
## treatmentshrub                                                         
## flowers.pot                                                            
## het.annual.floral.density                                              
## het.shrub.blooming.neighbours                                          
## floweringbloom:rtubombylid                                             
## floweringbloom:rtuhoneybee                                             
## floweringbloom:rtulep                                                  
## floweringbloom:rtuother                                                
## floweringbloom:rtusyrphid                                              
## floweringbloom:treatmentshrub                                          
## rtubombylid:treatmentshrub                                             
## rtuhoneybee:treatmentshrub                                             
## rtulep:treatmentshrub                                                  
## rtuother:treatmentshrub                                                
## rtusyrphid:treatmentshrub                                              
## floweringbloom:rtubombylid:treatmentshrub                              
## floweringbloom:rtuhoneybee:treatmentshrub                              
## floweringbloom:rtulep:treatmentshrub                                   
## floweringbloom:rtuother:treatmentshrub     0.397                       
## floweringbloom:rtusyrphid:treatmentshrub   0.349          0.753        
## 
## Standardized Within-Group Residuals:
##           Min            Q1           Med            Q3           Max 
## -2.414212e+00 -3.939256e-01 -2.404337e-01 -5.006376e-15  1.430014e+01 
## 
## Number of Observations: 1386
## Number of Groups: 
##            PlantID repID %in% PlantID 
##                 61                122</code></pre>
<pre class="r"><code>t &lt;- car::Anova(mFullPQ, type = 3)

mP1 &lt;- MASS::glmmPQL(total.visits~flowering * rtu + treatment + flowers.pot + het.annual.floral.density + het.shrub.blooming.neighbours + offset(log(dec.Length)), random = ~1|PlantID/repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>car::Anova(mP1, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III tests)
## 
## Response: zz
##                                  Chisq Df Pr(&gt;Chisq)    
## (Intercept)                    24.5018  1  7.424e-07 ***
## flowering                       9.3810  1   0.002192 ** 
## rtu                           210.6638  5  &lt; 2.2e-16 ***
## treatment                       4.5105  1   0.033687 *  
## flowers.pot                     5.8299  1   0.015756 *  
## het.annual.floral.density       5.3384  1   0.020860 *  
## het.shrub.blooming.neighbours   1.0849  1   0.297602    
## flowering:rtu                  65.8395  5  7.504e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>mPt &lt;- MASS::glmmPQL(total.visits~ flowering * rtu +  treatment + flowers.pot + het.annual.floral.density + offset(log(dec.Length)), random = ~1|PlantID/repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>summary(mPt)</code></pre>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##  Data: byrtu 
##   AIC BIC logLik
##    NA  NA     NA
## 
## Random effects:
##  Formula: ~1 | PlantID
##         (Intercept)
## StdDev:     0.22884
## 
##  Formula: ~1 | repID %in% PlantID
##         (Intercept) Residual
## StdDev:   0.4255542 1.464069
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~invwt 
## Fixed effects: total.visits ~ flowering * rtu + treatment + flowers.pot + het.annual.floral.density +      offset(log(dec.Length)) 
##                                 Value Std.Error   DF   t-value p-value
## (Intercept)                 -1.582497      0.33 1251 -4.866918  0.0000
## floweringbloom              -1.620995      0.50 1251 -3.260774  0.0011
## rtubombylid                 -0.251314      0.33 1251 -0.757510  0.4489
## rtuhoneybee                 -2.197225      0.69 1251 -3.166330  0.0016
## rtulep                      -3.113515      1.06 1251 -2.926839  0.0035
## rtuother                     0.725937      0.27 1251  2.715705  0.0067
## rtusyrphid                   1.986351      0.23 1251  8.488291  0.0000
## treatmentshrub              -0.318826      0.14   60 -2.261107  0.0274
## flowers.pot                  0.051805      0.02 1251  2.312699  0.0209
## het.annual.floral.density    0.035700      0.02 1251  2.219892  0.0266
## floweringbloom:rtubombylid   1.254617      0.62 1251  2.037149  0.0418
## floweringbloom:rtuhoneybee -22.688602  68229.09 1251 -0.000333  0.9997
## floweringbloom:rtulep        3.660059      1.20 1251  3.047220  0.0024
## floweringbloom:rtuother      1.510897      0.54 1251  2.808141  0.0051
## floweringbloom:rtusyrphid   -1.439807      0.60 1251 -2.380557  0.0174
##  Correlation: 
##                            (Intr) flwrng rtbmby rthnyb rtulep rtuthr rtsyrp
## floweringbloom             -0.262                                          
## rtubombylid                -0.446  0.292                                   
## rtuhoneybee                -0.213  0.140  0.209                            
## rtulep                     -0.139  0.091  0.136  0.065                     
## rtuother                   -0.554  0.362  0.543  0.260  0.169              
## rtusyrphid                 -0.633  0.414  0.620  0.297  0.193  0.770       
## treatmentshrub             -0.212 -0.002  0.000  0.000  0.000  0.000  0.000
## flowers.pot                -0.687 -0.061  0.000  0.000  0.000  0.000  0.000
## het.annual.floral.density  -0.208  0.039  0.000  0.000  0.000  0.000  0.000
## floweringbloom:rtubombylid  0.240 -0.801 -0.539 -0.113 -0.074 -0.293 -0.334
## floweringbloom:rtuhoneybee  0.000  0.000  0.000  0.000  0.000  0.000  0.000
## floweringbloom:rtulep       0.123 -0.411 -0.121 -0.058 -0.886 -0.150 -0.171
## floweringbloom:rtuother     0.275 -0.917 -0.270 -0.129 -0.084 -0.497 -0.382
## floweringbloom:rtusyrphid   0.245 -0.815 -0.240 -0.115 -0.075 -0.298 -0.387
##                            trtmnt flwrs. ht.n.. flwrngblm:rtb flwrngblm:rth
## floweringbloom                                                             
## rtubombylid                                                                
## rtuhoneybee                                                                
## rtulep                                                                     
## rtuother                                                                   
## rtusyrphid                                                                 
## treatmentshrub                                                             
## flowers.pot                 0.027                                          
## het.annual.floral.density   0.011  0.168                                   
## floweringbloom:rtubombylid  0.000  0.000  0.000                            
## floweringbloom:rtuhoneybee  0.000  0.000  0.000  0.000                     
## floweringbloom:rtulep       0.000  0.000  0.000  0.331         0.000       
## floweringbloom:rtuother     0.000  0.000  0.000  0.740         0.000       
## floweringbloom:rtusyrphid   0.000  0.000  0.000  0.658         0.000       
##                            flwrngblm:rtl flwrngblm:rtt
## floweringbloom                                        
## rtubombylid                                           
## rtuhoneybee                                           
## rtulep                                                
## rtuother                                              
## rtusyrphid                                            
## treatmentshrub                                        
## flowers.pot                                           
## het.annual.floral.density                             
## floweringbloom:rtubombylid                            
## floweringbloom:rtuhoneybee                            
## floweringbloom:rtulep                                 
## floweringbloom:rtuother     0.379                     
## floweringbloom:rtusyrphid   0.337         0.753       
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -2.0026759 -0.3594501 -0.2237711 -0.0585066 15.6102117 
## 
## Number of Observations: 1386
## Number of Groups: 
##            PlantID repID %in% PlantID 
##                 61                122</code></pre>
<pre class="r"><code>car::Anova(mPt, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III tests)
## 
## Response: zz
##                              Chisq Df Pr(&gt;Chisq)    
## (Intercept)                23.9461  1  9.907e-07 ***
## flowering                  10.7490  1   0.001043 ** 
## rtu                       206.8849  5  &lt; 2.2e-16 ***
## treatment                   5.1685  1   0.023000 *  
## flowers.pot                 5.4071  1   0.020055 *  
## het.annual.floral.density   4.9818  1   0.025615 *  
## flowering:rtu              64.6584  5  1.319e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>lsmeans(mPt, pairwise~flowering|rtu)</code></pre>
<pre><code>## $lsmeans
## rtu = bee:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre        -0.907     0.23 60 -1.36e+00     -0.45
##  bloom      -2.528     0.45 60 -3.42e+00     -1.63
## 
## rtu = bombylid:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre        -1.158     0.25 60 -1.67e+00     -0.65
##  bloom      -1.525     0.28 60 -2.08e+00     -0.97
## 
## rtu = honeybee:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre        -3.104     0.66 60 -4.43e+00     -1.78
##  bloom     -27.414 68229.09 60 -1.37e+05 136451.08
## 
## rtu = lep:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre        -4.021     1.04 60 -6.11e+00     -1.94
##  bloom      -1.981     0.34 60 -2.67e+00     -1.30
## 
## rtu = other:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre        -0.181     0.16 60 -5.10e-01      0.14
##  bloom      -0.291     0.16 60 -6.00e-01      0.02
## 
## rtu = syrphid:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre         1.079     0.10 60  8.80e-01      1.28
##  bloom      -1.981     0.34 60 -2.67e+00     -1.30
## 
## Results are averaged over the levels of: treatment 
## Degrees-of-freedom method: containment 
## Results are given on the log (not the response) scale. 
## Confidence level used: 0.95 
## 
## $contrasts
## rtu = bee:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom    1.621     0.50 1251  3.261  0.0011 
## 
## rtu = bombylid:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom    0.366     0.37 1251  0.993  0.3209 
## 
## rtu = honeybee:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom   24.310 68229.09 1251  0.000  0.9997 
## 
## rtu = lep:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom   -2.039     1.10 1251 -1.862  0.0629 
## 
## rtu = other:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom    0.110     0.22 1251  0.512  0.6090 
## 
## rtu = syrphid:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom    3.061     0.35 1251  8.740  &lt;.0001 
## 
## Results are averaged over the levels of: treatment 
## Degrees-of-freedom method: containment 
## Results are given on the log (not the response) scale.</code></pre>
<pre class="r"><code>#full model flower visits
mFullPQv &lt;- MASS::glmmPQL(total.flowers~flowering * rtu * treatment + flowers.pot + het.annual.floral.density + het.shrub.blooming.neighbours + offset(log(dec.Length)), random = ~1|PlantID/repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>summary(mFullPQv)</code></pre>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##  Data: byrtu 
##   AIC BIC logLik
##    NA  NA     NA
## 
## Random effects:
##  Formula: ~1 | PlantID
##         (Intercept)
## StdDev:   0.2393515
## 
##  Formula: ~1 | repID %in% PlantID
##         (Intercept) Residual
## StdDev:   0.5789797 1.566556
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~invwt 
## Fixed effects: total.flowers ~ flowering * rtu * treatment + flowers.pot + het.annual.floral.density +      het.shrub.blooming.neighbours + offset(log(dec.Length)) 
##                                                Value Std.Error   DF   t-value
## (Intercept)                                -0.979717      0.31 1239 -3.154788
## floweringbloom                             -2.175786      0.60 1239 -3.615551
## rtubombylid                                -1.386294      0.44 1239 -3.135036
## rtuhoneybee                               -27.099692  91960.98 1239 -0.000295
## rtulep                                     -4.158883      1.59 1239 -2.608508
## rtuother                                   -0.115832      0.29 1239 -0.402017
## rtusyrphid                                  1.435828      0.22 1239  6.525723
## treatmentshrub                             -1.090591      0.43   60 -2.537207
## flowers.pot                                 0.074787      0.02 1239  3.375247
## het.annual.floral.density                   0.028520      0.02 1239  1.697634
## het.shrub.blooming.neighbours              -0.072448      0.04 1239 -1.711431
## floweringbloom:rtubombylid                  2.772589      0.77 1239  3.620028
## floweringbloom:rtuhoneybee                  2.045259 131178.26 1239  0.000016
## floweringbloom:rtulep                       4.969813      1.73 1239  2.872260
## floweringbloom:rtuother                     2.255898      0.66 1239  3.429539
## floweringbloom:rtusyrphid                  -0.424227      0.69 1239 -0.615511
## floweringbloom:treatmentshrub               1.620281      0.83 1239  1.942756
## rtubombylid:treatmentshrub                  1.486378      0.67 1239  2.224557
## rtuhoneybee:treatmentshrub                 26.457838  91960.98 1239  0.000288
## rtulep:treatmentshrub                       1.214444      2.28 1239  0.533774
## rtuother:treatmentshrub                     0.834954      0.53 1239  1.580962
## rtusyrphid:treatmentshrub                   0.749631      0.44 1239  1.697797
## floweringbloom:rtubombylid:treatmentshrub  -2.718522      1.11 1239 -2.456340
## floweringbloom:rtuhoneybee:treatmentshrub -26.998537 165002.50 1239 -0.000164
## floweringbloom:rtulep:treatmentshrub       -2.207696      2.47 1239 -0.894801
## floweringbloom:rtuother:treatmentshrub     -1.349053      0.94 1239 -1.439579
## floweringbloom:rtusyrphid:treatmentshrub   -2.454380      1.12 1239 -2.197650
##                                           p-value
## (Intercept)                                0.0016
## floweringbloom                             0.0003
## rtubombylid                                0.0018
## rtuhoneybee                                0.9998
## rtulep                                     0.0092
## rtuother                                   0.6877
## rtusyrphid                                 0.0000
## treatmentshrub                             0.0138
## flowers.pot                                0.0008
## het.annual.floral.density                  0.0898
## het.shrub.blooming.neighbours              0.0873
## floweringbloom:rtubombylid                 0.0003
## floweringbloom:rtuhoneybee                 1.0000
## floweringbloom:rtulep                      0.0041
## floweringbloom:rtuother                    0.0006
## floweringbloom:rtusyrphid                  0.5383
## floweringbloom:treatmentshrub              0.0523
## rtubombylid:treatmentshrub                 0.0263
## rtuhoneybee:treatmentshrub                 0.9998
## rtulep:treatmentshrub                      0.5936
## rtuother:treatmentshrub                    0.1141
## rtusyrphid:treatmentshrub                  0.0898
## floweringbloom:rtubombylid:treatmentshrub  0.0142
## floweringbloom:rtuhoneybee:treatmentshrub  0.9999
## floweringbloom:rtulep:treatmentshrub       0.3711
## floweringbloom:rtuother:treatmentshrub     0.1502
## floweringbloom:rtusyrphid:treatmentshrub   0.0282
##  Correlation: 
##                                           (Intr) flwrng rtbmby rthnyb rtulep
## floweringbloom                            -0.180                            
## rtubombylid                               -0.285  0.147                     
## rtuhoneybee                                0.000  0.000  0.000              
## rtulep                                    -0.079  0.041  0.055  0.000       
## rtuother                                  -0.437  0.226  0.307  0.000  0.085
## rtusyrphid                                -0.572  0.295  0.402  0.000  0.111
## treatmentshrub                            -0.349  0.157  0.206  0.000  0.057
## flowers.pot                               -0.706 -0.045  0.000  0.000  0.000
## het.annual.floral.density                 -0.212  0.049  0.000  0.000  0.000
## het.shrub.blooming.neighbours              0.022 -0.136  0.000  0.000  0.000
## floweringbloom:rtubombylid                 0.164 -0.764 -0.577  0.000 -0.032
## floweringbloom:rtuhoneybee                 0.000  0.000  0.000 -0.701  0.000
## floweringbloom:rtulep                      0.073 -0.338 -0.051  0.000 -0.921
## floweringbloom:rtuother                    0.191 -0.889 -0.134  0.000 -0.037
## floweringbloom:rtusyrphid                  0.183 -0.849 -0.128  0.000 -0.036
## floweringbloom:treatmentshrub              0.149 -0.701 -0.106  0.000 -0.029
## rtubombylid:treatmentshrub                 0.188 -0.097 -0.662  0.000 -0.037
## rtuhoneybee:treatmentshrub                 0.000  0.000  0.000 -1.000  0.000
## rtulep:treatmentshrub                      0.055 -0.029 -0.039  0.000 -0.701
## rtuother:treatmentshrub                    0.238 -0.123 -0.167  0.000 -0.046
## rtusyrphid:treatmentshrub                  0.285 -0.147 -0.200  0.000 -0.056
## floweringbloom:rtubombylid:treatmentshrub -0.114  0.528  0.400  0.000  0.022
## floweringbloom:rtuhoneybee:treatmentshrub  0.000  0.000  0.000  0.557  0.000
## floweringbloom:rtulep:treatmentshrub      -0.051  0.237  0.036  0.000  0.646
## floweringbloom:rtuother:treatmentshrub    -0.134  0.624  0.094  0.000  0.026
## floweringbloom:rtusyrphid:treatmentshrub  -0.113  0.524  0.079  0.000  0.022
##                                           rtuthr rtsyrp trtmnt flwrs. ht.n..
## floweringbloom                                                              
## rtubombylid                                                                 
## rtuhoneybee                                                                 
## rtulep                                                                      
## rtuother                                                                    
## rtusyrphid                                 0.617                            
## treatmentshrub                             0.316  0.414                     
## flowers.pot                                0.000  0.000  0.006              
## het.annual.floral.density                  0.000  0.000  0.003  0.172       
## het.shrub.blooming.neighbours              0.000  0.000 -0.023 -0.093 -0.102
## floweringbloom:rtubombylid                -0.177 -0.232 -0.119  0.000  0.000
## floweringbloom:rtuhoneybee                 0.000  0.000  0.000  0.000  0.000
## floweringbloom:rtulep                     -0.078 -0.103 -0.053  0.000  0.000
## floweringbloom:rtuother                   -0.438 -0.270 -0.138  0.000  0.000
## floweringbloom:rtusyrphid                 -0.197 -0.319 -0.132  0.000  0.000
## floweringbloom:treatmentshrub             -0.163 -0.213 -0.480  0.009  0.006
## rtubombylid:treatmentshrub                -0.203 -0.266 -0.595  0.000  0.000
## rtuhoneybee:treatmentshrub                 0.000  0.000  0.000  0.000  0.000
## rtulep:treatmentshrub                     -0.060 -0.078 -0.175  0.000  0.000
## rtuother:treatmentshrub                   -0.546 -0.337 -0.753  0.000  0.000
## rtusyrphid:treatmentshrub                 -0.307 -0.498 -0.900  0.000  0.000
## floweringbloom:rtubombylid:treatmentshrub  0.123  0.161  0.359  0.000  0.000
## floweringbloom:rtuhoneybee:treatmentshrub  0.000  0.000  0.000  0.000  0.000
## floweringbloom:rtulep:treatmentshrub       0.055  0.072  0.161  0.000  0.000
## floweringbloom:rtuother:treatmentshrub     0.307  0.190  0.424  0.000  0.000
## floweringbloom:rtusyrphid:treatmentshrub   0.122  0.197  0.356  0.000  0.000
##                                           ht.s.. flwrngblm:rtb flwrngblm:rth
## floweringbloom                                                              
## rtubombylid                                                                 
## rtuhoneybee                                                                 
## rtulep                                                                      
## rtuother                                                                    
## rtusyrphid                                                                  
## treatmentshrub                                                              
## flowers.pot                                                                 
## het.annual.floral.density                                                   
## het.shrub.blooming.neighbours                                               
## floweringbloom:rtubombylid                 0.000                            
## floweringbloom:rtuhoneybee                 0.000  0.000                     
## floweringbloom:rtulep                      0.000  0.266         0.000       
## floweringbloom:rtuother                    0.000  0.699         0.000       
## floweringbloom:rtusyrphid                  0.000  0.667         0.000       
## floweringbloom:treatmentshrub             -0.021  0.551         0.000       
## rtubombylid:treatmentshrub                 0.000  0.382         0.000       
## rtuhoneybee:treatmentshrub                 0.000  0.000         0.701       
## rtulep:treatmentshrub                      0.000  0.022         0.000       
## rtuother:treatmentshrub                    0.000  0.097         0.000       
## rtusyrphid:treatmentshrub                  0.000  0.116         0.000       
## floweringbloom:rtubombylid:treatmentshrub  0.000 -0.692         0.000       
## floweringbloom:rtuhoneybee:treatmentshrub  0.000  0.000        -0.795       
## floweringbloom:rtulep:treatmentshrub       0.000 -0.186         0.000       
## floweringbloom:rtuother:treatmentshrub     0.000 -0.490         0.000       
## floweringbloom:rtusyrphid:treatmentshrub   0.000 -0.411         0.000       
##                                           flwrngblm:rtl flwrngblm:rtt
## floweringbloom                                                       
## rtubombylid                                                          
## rtuhoneybee                                                          
## rtulep                                                               
## rtuother                                                             
## rtusyrphid                                                           
## treatmentshrub                                                       
## flowers.pot                                                          
## het.annual.floral.density                                            
## het.shrub.blooming.neighbours                                        
## floweringbloom:rtubombylid                                           
## floweringbloom:rtuhoneybee                                           
## floweringbloom:rtulep                                                
## floweringbloom:rtuother                    0.309                     
## floweringbloom:rtusyrphid                  0.295         0.776       
## floweringbloom:treatmentshrub              0.244         0.642       
## rtubombylid:treatmentshrub                 0.034         0.089       
## rtuhoneybee:treatmentshrub                 0.000         0.000       
## rtulep:treatmentshrub                      0.646         0.026       
## rtuother:treatmentshrub                    0.043         0.239       
## rtusyrphid:treatmentshrub                  0.051         0.135       
## floweringbloom:rtubombylid:treatmentshrub -0.184        -0.483       
## floweringbloom:rtuhoneybee:treatmentshrub  0.000         0.000       
## floweringbloom:rtulep:treatmentshrub      -0.701        -0.217       
## floweringbloom:rtuother:treatmentshrub    -0.217        -0.702       
## floweringbloom:rtusyrphid:treatmentshrub  -0.182        -0.479       
##                                           flwrngblm:rts flwrngblm:t rtbmb:
## floweringbloom                                                            
## rtubombylid                                                               
## rtuhoneybee                                                               
## rtulep                                                                    
## rtuother                                                                  
## rtusyrphid                                                                
## treatmentshrub                                                            
## flowers.pot                                                               
## het.annual.floral.density                                                 
## het.shrub.blooming.neighbours                                             
## floweringbloom:rtubombylid                                                
## floweringbloom:rtuhoneybee                                                
## floweringbloom:rtulep                                                     
## floweringbloom:rtuother                                                   
## floweringbloom:rtusyrphid                                                 
## floweringbloom:treatmentshrub              0.612                          
## rtubombylid:treatmentshrub                 0.085         0.307            
## rtuhoneybee:treatmentshrub                 0.000         0.000       0.000
## rtulep:treatmentshrub                      0.025         0.090       0.112
## rtuother:treatmentshrub                    0.107         0.388       0.484
## rtusyrphid:treatmentshrub                  0.159         0.464       0.579
## floweringbloom:rtubombylid:treatmentshrub -0.461        -0.750      -0.604
## floweringbloom:rtuhoneybee:treatmentshrub  0.000         0.000       0.000
## floweringbloom:rtulep:treatmentshrub      -0.207        -0.336      -0.104
## floweringbloom:rtuother:treatmentshrub    -0.545        -0.886      -0.273
## floweringbloom:rtusyrphid:treatmentshrub  -0.617        -0.743      -0.229
##                                           rthny: rtlp:t rtthr: rtsyr:
## floweringbloom                                                       
## rtubombylid                                                          
## rtuhoneybee                                                          
## rtulep                                                               
## rtuother                                                             
## rtusyrphid                                                           
## treatmentshrub                                                       
## flowers.pot                                                          
## het.annual.floral.density                                            
## het.shrub.blooming.neighbours                                        
## floweringbloom:rtubombylid                                           
## floweringbloom:rtuhoneybee                                           
## floweringbloom:rtulep                                                
## floweringbloom:rtuother                                              
## floweringbloom:rtusyrphid                                            
## floweringbloom:treatmentshrub                                        
## rtubombylid:treatmentshrub                                           
## rtuhoneybee:treatmentshrub                                           
## rtulep:treatmentshrub                      0.000                     
## rtuother:treatmentshrub                    0.000  0.142              
## rtusyrphid:treatmentshrub                  0.000  0.170  0.733       
## floweringbloom:rtubombylid:treatmentshrub  0.000 -0.068 -0.292 -0.350
## floweringbloom:rtuhoneybee:treatmentshrub -0.557  0.000  0.000  0.000
## floweringbloom:rtulep:treatmentshrub       0.000 -0.922 -0.131 -0.157
## floweringbloom:rtuother:treatmentshrub     0.000 -0.080 -0.564 -0.413
## floweringbloom:rtusyrphid:treatmentshrub   0.000 -0.067 -0.290 -0.395
##                                           flwrngblm:rtb: flwrngblm:rth:
## floweringbloom                                                         
## rtubombylid                                                            
## rtuhoneybee                                                            
## rtulep                                                                 
## rtuother                                                               
## rtusyrphid                                                             
## treatmentshrub                                                         
## flowers.pot                                                            
## het.annual.floral.density                                              
## het.shrub.blooming.neighbours                                          
## floweringbloom:rtubombylid                                             
## floweringbloom:rtuhoneybee                                             
## floweringbloom:rtulep                                                  
## floweringbloom:rtuother                                                
## floweringbloom:rtusyrphid                                              
## floweringbloom:treatmentshrub                                          
## rtubombylid:treatmentshrub                                             
## rtuhoneybee:treatmentshrub                                             
## rtulep:treatmentshrub                                                  
## rtuother:treatmentshrub                                                
## rtusyrphid:treatmentshrub                                              
## floweringbloom:rtubombylid:treatmentshrub                              
## floweringbloom:rtuhoneybee:treatmentshrub  0.000                       
## floweringbloom:rtulep:treatmentshrub       0.254          0.000        
## floweringbloom:rtuother:treatmentshrub     0.667          0.000        
## floweringbloom:rtusyrphid:treatmentshrub   0.560          0.000        
##                                           flwrngblm:rtl: flwrngblm:rtt:
## floweringbloom                                                         
## rtubombylid                                                            
## rtuhoneybee                                                            
## rtulep                                                                 
## rtuother                                                               
## rtusyrphid                                                             
## treatmentshrub                                                         
## flowers.pot                                                            
## het.annual.floral.density                                              
## het.shrub.blooming.neighbours                                          
## floweringbloom:rtubombylid                                             
## floweringbloom:rtuhoneybee                                             
## floweringbloom:rtulep                                                  
## floweringbloom:rtuother                                                
## floweringbloom:rtusyrphid                                              
## floweringbloom:treatmentshrub                                          
## rtubombylid:treatmentshrub                                             
## rtuhoneybee:treatmentshrub                                             
## rtulep:treatmentshrub                                                  
## rtuother:treatmentshrub                                                
## rtusyrphid:treatmentshrub                                              
## floweringbloom:rtubombylid:treatmentshrub                              
## floweringbloom:rtuhoneybee:treatmentshrub                              
## floweringbloom:rtulep:treatmentshrub                                   
## floweringbloom:rtuother:treatmentshrub     0.299                       
## floweringbloom:rtusyrphid:treatmentshrub   0.251          0.661        
## 
## Standardized Within-Group Residuals:
##           Min            Q1           Med            Q3           Max 
## -3.063184e+00 -3.918256e-01 -2.324796e-01 -2.523448e-13  1.296016e+01 
## 
## Number of Observations: 1386
## Number of Groups: 
##            PlantID repID %in% PlantID 
##                 61                122</code></pre>
<pre class="r"><code>t &lt;- car::Anova(mFullPQv, type = 3)

m &lt;- MASS::glmmPQL(total.flowers~flowering * rtu + treatment*flowering + flowers.pot +offset(log(dec.Length)), random = ~1|PlantID/repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>car::Anova(m, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III tests)
## 
## Response: zz
##                        Chisq Df Pr(&gt;Chisq)    
## (Intercept)          11.0841  1  0.0008707 ***
## flowering            14.6807  1  0.0001273 ***
## rtu                 192.4197  5  &lt; 2.2e-16 ***
## treatment             4.0995  1  0.0428956 *  
## flowers.pot           7.5923  1  0.0058617 ** 
## flowering:rtu        68.3742  5  2.233e-13 ***
## flowering:treatment   0.0595  1  0.8073099    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>mQ &lt;- MASS::glmmPQL(total.flowers~flowering * rtu + treatment + flowers.pot + offset(log(dec.Length)), random = ~1|PlantID/repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>summary(mQ)</code></pre>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##  Data: byrtu 
##   AIC BIC logLik
##    NA  NA     NA
## 
## Random effects:
##  Formula: ~1 | PlantID
##         (Intercept)
## StdDev:   0.2505923
## 
##  Formula: ~1 | repID %in% PlantID
##         (Intercept) Residual
## StdDev:   0.5372871 1.775239
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~invwt 
## Fixed effects: total.flowers ~ flowering * rtu + treatment + flowers.pot + offset(log(dec.Length)) 
##                                 Value Std.Error   DF   t-value p-value
## (Intercept)                 -1.064369      0.32 1276 -3.349236  0.0008
## floweringbloom              -1.731231      0.45 1276 -3.876210  0.0001
## rtubombylid                 -0.807923      0.35 1276 -2.290844  0.0221
## rtuhoneybee                 -2.116256      0.60 1276 -3.543579  0.0004
## rtulep                      -3.725693      1.28 1276 -2.918288  0.0036
## rtuother                     0.145508      0.27 1276  0.544139  0.5864
## rtusyrphid                   1.663378      0.21 1276  7.787977  0.0000
## treatmentshrub              -0.340708      0.16   60 -2.128848  0.0374
## flowers.pot                  0.064550      0.02 1276  2.740821  0.0062
## floweringbloom:rtubombylid   1.683391      0.59 1276  2.846071  0.0045
## floweringbloom:rtuhoneybee -23.267822  78676.26 1276 -0.000296  0.9998
## floweringbloom:rtulep        4.131159      1.38 1276  3.000893  0.0027
## floweringbloom:rtuother      1.749109      0.50 1276  3.466512  0.0005
## floweringbloom:rtusyrphid   -1.326906      0.56 1276 -2.351352  0.0189
##  Correlation: 
##                            (Intr) flwrng rtbmby rthnyb rtulep rtuthr rtsyrp
## floweringbloom             -0.213                                          
## rtubombylid                -0.342  0.243                                   
## rtuhoneybee                -0.202  0.144  0.182                            
## rtulep                     -0.095  0.067  0.085  0.050                     
## rtuother                   -0.451  0.321  0.407  0.240  0.112              
## rtusyrphid                 -0.565  0.402  0.509  0.301  0.141  0.671       
## treatmentshrub             -0.246 -0.003  0.000  0.000  0.000  0.000  0.000
## flowers.pot                -0.727 -0.082  0.000  0.000  0.000  0.000  0.000
## floweringbloom:rtubombylid  0.204 -0.748 -0.596 -0.109 -0.051 -0.242 -0.304
## floweringbloom:rtuhoneybee  0.000  0.000  0.000  0.000  0.000  0.000  0.000
## floweringbloom:rtulep       0.088 -0.321 -0.079 -0.047 -0.927 -0.104 -0.130
## floweringbloom:rtuother     0.239 -0.876 -0.216 -0.127 -0.060 -0.530 -0.356
## floweringbloom:rtusyrphid   0.214 -0.784 -0.193 -0.114 -0.053 -0.254 -0.378
##                            trtmnt flwrs. flwrngblm:rtb flwrngblm:rth
## floweringbloom                                                      
## rtubombylid                                                         
## rtuhoneybee                                                         
## rtulep                                                              
## rtuother                                                            
## rtusyrphid                                                          
## treatmentshrub                                                      
## flowers.pot                 0.027                                   
## floweringbloom:rtubombylid  0.000  0.000                            
## floweringbloom:rtuhoneybee  0.000  0.000  0.000                     
## floweringbloom:rtulep       0.000  0.000  0.243         0.000       
## floweringbloom:rtuother     0.000  0.000  0.662         0.000       
## floweringbloom:rtusyrphid   0.000  0.000  0.592         0.000       
##                            flwrngblm:rtl flwrngblm:rtt
## floweringbloom                                        
## rtubombylid                                           
## rtuhoneybee                                           
## rtulep                                                
## rtuother                                              
## rtusyrphid                                            
## treatmentshrub                                        
## flowers.pot                                           
## floweringbloom:rtubombylid                            
## floweringbloom:rtuhoneybee                            
## floweringbloom:rtulep                                 
## floweringbloom:rtuother     0.284                     
## floweringbloom:rtusyrphid   0.254         0.694       
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -2.53323480 -0.35080887 -0.21658404 -0.04776788 17.09065961 
## 
## Number of Observations: 1410
## Number of Groups: 
##            PlantID repID %in% PlantID 
##                 61                122</code></pre>
<pre class="r"><code>lsmeans(mQ, pairwise~flowering|rtu, adjust = &quot;Tukey&quot;)</code></pre>
<pre><code>## $lsmeans
## rtu = bee:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre        -0.310     0.21 60 -7.80e-01      0.16
##  bloom      -2.042     0.41 60 -2.97e+00     -1.11
## 
## rtu = bombylid:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre        -1.118     0.30 60 -1.81e+00     -0.43
##  bloom      -1.166     0.27 60 -1.78e+00     -0.55
## 
## rtu = honeybee:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre        -2.427     0.57 60 -3.73e+00     -1.12
##  bloom     -27.426 78676.26 60 -1.80e+05 180438.41
## 
## rtu = lep:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre        -4.036     1.26 60 -6.93e+00     -1.14
##  bloom      -1.636     0.33 60 -2.40e+00     -0.87
## 
## rtu = other:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre        -0.165     0.19 60 -6.10e-01      0.28
##  bloom      -0.147     0.17 60 -5.40e-01      0.24
## 
## rtu = syrphid:
##  flowering  lsmean       SE df  lower.CL  upper.CL
##  pre         1.353     0.11 60  1.11e+00      1.60
##  bloom      -1.705     0.34 60 -2.50e+00     -0.91
## 
## Results are averaged over the levels of: treatment 
## Degrees-of-freedom method: containment 
## Results are given on the log (not the response) scale. 
## Confidence level used: 0.95 
## Conf-level adjustment: sidak method for 2 estimates 
## 
## $contrasts
## rtu = bee:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom   1.7312     0.45 1276  3.876  0.0001 
## 
## rtu = bombylid:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom   0.0478     0.39 1276  0.122  0.9031 
## 
## rtu = honeybee:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom  24.9991 78676.26 1276  0.000  0.9997 
## 
## rtu = lep:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom  -2.3999     1.30 1276 -1.841  0.0659 
## 
## rtu = other:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom  -0.0179     0.24 1276 -0.074  0.9414 
## 
## rtu = syrphid:
##  contrast    estimate       SE   df t.ratio p.value
##  pre - bloom   3.0581     0.35 1276  8.723  &lt;.0001 
## 
## Results are averaged over the levels of: treatment 
## Degrees-of-freedom method: containment 
## Results are given on the log (not the response) scale.</code></pre>
<pre class="r"><code>car::Anova(mQ, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III tests)
## 
## Response: zz
##                  Chisq Df Pr(&gt;Chisq)    
## (Intercept)    11.3299  1  0.0007627 ***
## flowering      15.1757  1  9.796e-05 ***
## rtu           192.9482  5  &lt; 2.2e-16 ***
## treatment       4.5774  1  0.0323955 *  
## flowers.pot     7.5874  1  0.0058776 ** 
## flowering:rtu  68.5620  5  2.041e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>mQt &lt;- MASS::glmmPQL(total.flowers~treatment * rtu + flowering + flowers.pot + offset(log(dec.Length)), random = ~1|PlantID/repID, family=&quot;quasipoisson&quot;, data = byrtu)</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<pre><code>## iteration 6</code></pre>
<pre><code>## iteration 7</code></pre>
<pre><code>## iteration 8</code></pre>
<pre><code>## iteration 9</code></pre>
<pre><code>## iteration 10</code></pre>
<pre class="r"><code>summary(mQt)</code></pre>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##  Data: byrtu 
##   AIC BIC logLik
##    NA  NA     NA
## 
## Random effects:
##  Formula: ~1 | PlantID
##         (Intercept)
## StdDev:   0.2433783
## 
##  Formula: ~1 | repID %in% PlantID
##         (Intercept) Residual
## StdDev:    0.522491 1.857319
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~invwt 
## Fixed effects: total.flowers ~ treatment * rtu + flowering + flowers.pot + offset(log(dec.Length)) 
##                                 Value Std.Error   DF   t-value p-value
## (Intercept)                 -1.013940      0.34 1276 -3.015931  0.0026
## treatmentshrub              -0.770960      0.41   60 -1.862202  0.0675
## rtubombylid                 -0.405465      0.35 1276 -1.165726  0.2439
## rtuhoneybee                -26.652111  81784.60 1276 -0.000326  0.9997
## rtulep                      -1.280934      0.47 1276 -2.714943  0.0067
## rtuother                     0.567521      0.28 1276  2.060963  0.0395
## rtusyrphid                   1.396657      0.25 1276  5.684548  0.0000
## floweringbloom              -1.249935      0.14 1276 -8.691456  0.0000
## flowers.pot                  0.064194      0.02 1276  2.653347  0.0081
## treatmentshrub:rtubombylid   0.582396      0.57 1276  1.017616  0.3091
## treatmentshrub:rtuhoneybee  25.520709  81784.60 1276  0.000312  0.9998
## treatmentshrub:rtulep        0.331853      0.79 1276  0.419647  0.6748
## treatmentshrub:rtuother      0.623465      0.47 1276  1.322098  0.1864
## treatmentshrub:rtusyrphid    0.334142      0.44 1276  0.761244  0.4467
##  Correlation: 
##                            (Intr) trtmnt rtbmby rthnyb rtulep rtuthr rtsyrp
## treatmentshrub             -0.395                                          
## rtubombylid                -0.414  0.336                                   
## rtuhoneybee                 0.000  0.000  0.000                            
## rtulep                     -0.305  0.248  0.295  0.000                     
## rtuother                   -0.523  0.424  0.505  0.000  0.372              
## rtusyrphid                 -0.586  0.476  0.566  0.000  0.417  0.715       
## floweringbloom              0.066 -0.004  0.000  0.000  0.000  0.000  0.000
## flowers.pot                -0.707  0.011  0.000  0.000  0.000  0.000  0.000
## treatmentshrub:rtubombylid  0.252 -0.679 -0.608  0.000 -0.179 -0.307 -0.344
## treatmentshrub:rtuhoneybee  0.000  0.000  0.000 -1.000  0.000  0.000  0.000
## treatmentshrub:rtulep       0.182 -0.491 -0.176  0.000 -0.597 -0.222 -0.249
## treatmentshrub:rtuother     0.305 -0.824 -0.295  0.000 -0.218 -0.584 -0.418
## treatmentshrub:rtusyrphid   0.328 -0.885 -0.317  0.000 -0.234 -0.400 -0.560
##                            flwrng flwrs. trtmntshrb:rtb trtmntshrb:rth
## treatmentshrub                                                        
## rtubombylid                                                           
## rtuhoneybee                                                           
## rtulep                                                                
## rtuother                                                              
## rtusyrphid                                                            
## floweringbloom                                                        
## flowers.pot                -0.256                                     
## treatmentshrub:rtubombylid  0.000  0.000                              
## treatmentshrub:rtuhoneybee  0.000  0.000  0.000                       
## treatmentshrub:rtulep       0.000  0.000  0.355          0.000        
## treatmentshrub:rtuother     0.000  0.000  0.596          0.000        
## treatmentshrub:rtusyrphid   0.000  0.000  0.640          0.000        
##                            trtmntshrb:rtl trtmntshrb:rtt
## treatmentshrub                                          
## rtubombylid                                             
## rtuhoneybee                                             
## rtulep                                                  
## rtuother                                                
## rtusyrphid                                              
## floweringbloom                                          
## flowers.pot                                             
## treatmentshrub:rtubombylid                              
## treatmentshrub:rtuhoneybee                              
## treatmentshrub:rtulep                                   
## treatmentshrub:rtuother     0.431                       
## treatmentshrub:rtusyrphid   0.463          0.777        
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -2.1079350 -0.3769598 -0.2163581 -0.0897138 13.6044704 
## 
## Number of Observations: 1410
## Number of Groups: 
##            PlantID repID %in% PlantID 
##                 61                122</code></pre>
<pre class="r"><code>#RTU by microsite not significant</code></pre>
</div>
<div id="visit-duration" class="section level3">
<h3>Visit duration</h3>
<pre class="r"><code>byobs &lt;- read.csv(&quot;Output Data/byobs_cleaned.csv&quot;)

#observation level rtu data. Need to join simplified rtu to data sheet
cov &lt;- read.csv(&quot;Clean Data/video_cov.csv&quot;)
#rtu.key &lt;- read.csv(&quot;Clean Data/video_rtu_key.csv&quot;)
cov$uniID &lt;- paste(cov$Cam, cov$Date)
cov$uniID &lt;- gsub(&#39;\\s+&#39;, &quot;&quot;, cov$uniID)

rtu.data &lt;- right_join(cov, byobs, by = &quot;uniID&quot;)</code></pre>
<pre><code>## Warning: Column `uniID` joining character vector and factor, coercing into
## character vector</code></pre>
<pre class="r"><code>rtu.data &lt;- dplyr::select(rtu.data, plant.id, microsite, flowering.x, video.date, video.length, flower.fov, flowers.pot, flowers.shrub, total.time, flowers.visits, unique.fl.visited, uniID, dec.total.time, het.annual.floral.density)                    
rtu.data$repID &lt;- paste(rtu.data$plant.id, rtu.data$microsite)
rtu.data$microsite &lt;-as.factor(rtu.data$microsite)
rtu.data$microsite &lt;- relevel(rtu.data$microsite, &quot;open&quot;)
rtu.data$flowering &lt;- relevel(rtu.data$flowering, &quot;pre&quot;)
rtu.data$flowers.pot &lt;- as.numeric(as.character(rtu.data$flowers.pot))
#count.rtu.fl &lt;- rtu.data %&gt;% group_by(uniID, rtu.ag) %&gt;% summarise(total.flowers = sum(flowers.visits), total.visits = n()) 

#viz. dec.total.time is the visit duration
ggplot(rtu.data, aes(microsite, dec.total.time)) + geom_boxplot() + facet_grid(~flowering)</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="index_files/figure-html/duration%20models-1.png" width="672" /></p>
<pre class="r"><code>ggplot(rtu.data, aes(flowering, dec.total.time)) + geom_boxplot() + facet_grid(~microsite)</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="index_files/figure-html/duration%20models-2.png" width="672" /></p>
<pre class="r"><code>ggplot(rtu.data, aes(dec.total.time)) + geom_density()</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/duration%20models-3.png" width="672" /></p>
<pre class="r"><code>#using gamma because continuous and positive with no zeros, looks like it fits 

m1 &lt;- glmmTMB(dec.total.time ~ flowering + microsite + flowers.pot + (1|plant.id/repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)
m2 &lt;- glmmTMB(dec.total.time ~ flowering * microsite + flowers.pot + (1|plant.id/repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)

null &lt;- glmmTMB(dec.total.time ~(1|plant.id/repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)
anova(m1, m2, null)</code></pre>
<pre><code>## Data: rtu.data
## Models:
## null: dec.total.time ~ (1 | plant.id/repID), zi=~0, disp=~1
## m1: dec.total.time ~ flowering + microsite + flowers.pot + (1 | plant.id/repID), zi=~0, disp=~1
## m2: dec.total.time ~ flowering * microsite + flowers.pot + (1 | plant.id/repID), zi=~0, disp=~1
##      Df     AIC     BIC logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## null  4 -3600.4 -3582.2 1804.2  -3608.4                              
## m1    7 -3613.5 -3581.7 1813.8  -3627.5 19.0737      3   0.000264 ***
## m2    8 -3613.6 -3577.2 1814.8  -3629.6  2.0831      1   0.148933    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(m2)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          
## dec.total.time ~ flowering * microsite + flowers.pot + (1 | plant.id/repID)
## Data: rtu.data
## 
##      AIC      BIC   logLik deviance df.resid 
##  -3613.6  -3577.2   1814.8  -3629.6      688 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 9.833e-01 0.9916197
##  plant.id       (Intercept) 7.129e-07 0.0008443
## Number of obs: 696, groups:  repID:plant.id, 118; plant.id, 61
## 
## Dispersion estimate for Gamma family (sigma^2): 2.01 
## 
## Conditional model:
##                                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   -3.3619362  0.3467711  -9.695   &lt;2e-16 ***
## floweringbloom                -0.5547675  0.2277226  -2.436   0.0148 *  
## micrositeshrub                 0.1260182  0.2585201   0.487   0.6259    
## flowers.pot                    0.0006601  0.0306149   0.022   0.9828    
## floweringbloom:micrositeshrub -0.4949722  0.3418373  -1.448   0.1476    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>knitr::kable(car::Anova(m2, type =2))</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">Chisq</th>
<th align="right">Df</th>
<th align="right">Pr(&gt;Chisq)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>flowering</td>
<td align="right">19.5272972</td>
<td align="right">1</td>
<td align="right">0.0000099</td>
</tr>
<tr class="even">
<td>microsite</td>
<td align="right">0.0118470</td>
<td align="right">1</td>
<td align="right">0.9133264</td>
</tr>
<tr class="odd">
<td>flowers.pot</td>
<td align="right">0.0004649</td>
<td align="right">1</td>
<td align="right">0.9827978</td>
</tr>
<tr class="even">
<td>flowering:microsite</td>
<td align="right">2.0966338</td>
<td align="right">1</td>
<td align="right">0.1476238</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#with covariates
m3 &lt;- glmmTMB(dec.total.time ~ flowering + microsite + flowers.pot + het.annual.floral.density + (1|plant.id/repID), family = Gamma(link = &quot;log&quot;), data = rtu.data)
summary(m3)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          
## dec.total.time ~ flowering + microsite + flowers.pot + het.annual.floral.density +  
##     (1 | plant.id/repID)
## Data: rtu.data
## 
##      AIC      BIC   logLik deviance df.resid 
##  -3583.9  -3547.6   1800.0  -3599.9      681 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance Std.Dev.
##  repID:plant.id (Intercept) 0.88927  0.9430  
##  plant.id       (Intercept) 0.01174  0.1083  
## Number of obs: 689, groups:  repID:plant.id, 118; plant.id, 61
## 
## Dispersion estimate for Gamma family (sigma^2): 2.03 
## 
## Conditional model:
##                            Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)               -3.085184   0.356193  -8.662  &lt; 2e-16 ***
## floweringbloom            -0.855040   0.178792  -4.782 1.73e-06 ***
## micrositeshrub            -0.045905   0.230861  -0.199    0.842    
## flowers.pot               -0.009357   0.031158  -0.300    0.764    
## het.annual.floral.density -0.046941   0.021494  -2.184    0.029 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m3, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: dec.total.time
##                             Chisq Df Pr(&gt;Chisq)    
## flowering                 22.8704  1  1.733e-06 ***
## microsite                  0.0395  1    0.84239    
## flowers.pot                0.0902  1    0.76393    
## het.annual.floral.density  4.7694  1    0.02897 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>shr.rtu &lt;- filter(rtu.data, microsite == &quot;shrub&quot;)
m4 &lt;- glmmTMB(dec.total.time ~ flowering*flowers.shrub + flowers.pot + het.annual.floral.density + (1|plant.id), family = Gamma(link = &quot;log&quot;), data = shr.rtu)</code></pre>
<pre><code>## Warning in (function (start, objective, gradient = NULL, hessian = NULL, : NA/
## NaN function evaluation</code></pre>
<pre class="r"><code>summary(m4)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          
## dec.total.time ~ flowering * flowers.shrub + flowers.pot + het.annual.floral.density +  
##     (1 | plant.id)
## Data: shr.rtu
## 
##      AIC      BIC   logLik deviance df.resid 
##  -1484.5  -1455.3    750.2  -1500.5      277 
## 
## Random effects:
## 
## Conditional model:
##  Groups   Name        Variance Std.Dev.
##  plant.id (Intercept) 1.282    1.132   
## Number of obs: 285, groups:  plant.id, 58
## 
## Dispersion estimate for Gamma family (sigma^2): 1.85 
## 
## Conditional model:
##                              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                  -2.88340    0.60799  -4.743 2.11e-06 ***
## floweringbloom               -1.46195    0.57833  -2.528  0.01147 *  
## flowers.shrub                 0.24797    0.16009   1.549  0.12141    
## flowers.pot                  -0.04103    0.05442  -0.754  0.45088    
## het.annual.floral.density    -0.09425    0.03619  -2.604  0.00921 ** 
## floweringbloom:flowers.shrub -0.24678    0.16005  -1.542  0.12310    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>kable(car::Anova(m4, type = 3))</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">Chisq</th>
<th align="right">Df</th>
<th align="right">Pr(&gt;Chisq)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">22.4916070</td>
<td align="right">1</td>
<td align="right">0.0000021</td>
</tr>
<tr class="even">
<td>flowering</td>
<td align="right">6.3902761</td>
<td align="right">1</td>
<td align="right">0.0114747</td>
</tr>
<tr class="odd">
<td>flowers.shrub</td>
<td align="right">2.3990411</td>
<td align="right">1</td>
<td align="right">0.1214097</td>
</tr>
<tr class="even">
<td>flowers.pot</td>
<td align="right">0.5684277</td>
<td align="right">1</td>
<td align="right">0.4508844</td>
</tr>
<tr class="odd">
<td>het.annual.floral.density</td>
<td align="right">6.7813947</td>
<td align="right">1</td>
<td align="right">0.0092113</td>
</tr>
<tr class="even">
<td>flowering:flowers.shrub</td>
<td align="right">2.3774694</td>
<td align="right">1</td>
<td align="right">0.1230968</td>
</tr>
</tbody>
</table>
</div>
<div id="pollen-deposition" class="section level3">
<h3>Pollen Deposition</h3>
<pre class="r"><code>counts &lt;- read.csv(&quot;Clean Data/Pollen_Corrected.csv&quot;)
cov &lt;- read.csv(&quot;Clean Data/pollen_cov.csv&quot;)
counts$X &lt;- as.numeric(as.character(counts$X))   </code></pre>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre class="r"><code>counts &lt;- counts %&gt;% replace(is.na(.), 0)
counts &lt;- counts %&gt;% mutate(all.con = rowSums(.[5:18]))
counts &lt;- select(counts, Rep:Het.Grains, all.con)                
counts.ag &lt;- counts %&gt;% group_by(Rep, Slide) %&gt;% summarise(Het = sum(Het.Grains), Con = sum(all.con))             
counts.ag &lt;- counts.ag %&gt;% mutate(., microsite = ifelse(substr(Rep,start = 1, stop = 1) == &quot;S&quot;, &quot;shrub&quot;, &quot;open&quot;))
counts.ag$Flower &lt;- substr(counts.ag$Slide, 1, 1)

sum(counts.ag$Con)</code></pre>
<pre><code>## [1] 16209</code></pre>
<pre class="r"><code>sum(counts.ag$Het)</code></pre>
<pre><code>## [1] 1719</code></pre>
<pre class="r"><code>counts.ag &lt;- right_join(counts.ag, cov, by = &quot;Rep&quot;)

#ag by flower
count.fl &lt;- counts.ag %&gt;% group_by(., Flower) %&gt;% summarise(con = sum(Con))
count.fl$f2 &lt;- count.fl$Flower

count.fl &lt;- count.fl %&gt;%
  separate(Flower, c(&quot;Rep&quot;, &quot;no&quot;), &quot; &quot;)</code></pre>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [1, 2, 3].</code></pre>
<pre class="r"><code>counts.fl &lt;- right_join(count.fl, cov, by = &quot;Rep&quot;)</code></pre>
<pre><code>## Warning: Column `Rep` joining character vector and factor, coercing into
## character vector</code></pre>
<pre class="r"><code>#m1 &lt;- MASS::glmmPQL(con~ d.flowers + microsite + dN1, ~1|Rep, family = quasipoisson, data = counts.fl)
#summary(m1)

ggplot(data =counts.ag,(aes(microsite.x, Con))) + geom_boxplot()</code></pre>
<p><img src="index_files/figure-html/pollen%20deposition-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data =counts.ag,(aes(microsite.x, Het))) + geom_boxplot()</code></pre>
<p><img src="index_files/figure-html/pollen%20deposition-2.png" width="672" /></p>
<pre class="r"><code>ggplot(data = counts.ag, (aes(Con))) + geom_freqpoly()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/pollen%20deposition-3.png" width="672" /></p>
<pre class="r"><code>shapiro.test(counts.ag$Con)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  counts.ag$Con
## W = 0.82636, p-value = 2.363e-15</code></pre>
<pre class="r"><code>counts.ag$Flower &lt;- paste(counts.ag$Rep, counts.ag$Flower)
counts.ag$Sample &lt;- paste(counts.ag$Slide, counts.ag$Rep)
counts.ag$d.S &lt;- counts.ag$d.S %&gt;% replace(is.na(.), 0)
counts.ag &lt;- counts.ag %&gt;% mutate(., all = Con + Het)
cor.test(counts.ag$Con, counts.ag$Het)</code></pre>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  counts.ag$Con and counts.ag$Het
## t = 2.3967, df = 229, p-value = 0.01735
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.02791644 0.27985733
## sample estimates:
##       cor 
## 0.1564304</code></pre>
<pre class="r"><code>mean(counts.ag$d.S)</code></pre>
<pre><code>## [1] 183.2857</code></pre>
<pre class="r"><code>mean(counts.ag$dN1)</code></pre>
<pre><code>## [1] 79.37229</code></pre>
<pre class="r"><code>mean(counts.ag$d.flowers)</code></pre>
<pre><code>## [1] 7.025974</code></pre>
<pre class="r"><code>m1 &lt;- glmmTMB(Con ~ d.flowers + dN1 + d.S + (1|Shrub/Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          Con ~ d.flowers + dN1 + d.S + (1 | Shrub/Rep/Flower)
## Data: counts.ag
## 
##      AIC      BIC   logLik deviance df.resid 
##   2382.9   2410.4  -1183.4   2366.9      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups             Name        Variance  Std.Dev. 
##  Flower:(Rep:Shrub) (Intercept) 9.271e-08 0.0003045
##  Rep:Shrub          (Intercept) 3.698e-02 0.1923075
##  Shrub              (Intercept) 3.352e-02 0.1830763
## Number of obs: 231, groups:  Flower:(Rep:Shrub), 78; Rep:Shrub, 26; Shrub, 13
## 
## Overdispersion parameter for nbinom2 family (): 2.22 
## 
## Conditional model:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) 3.9410611  0.1410895  27.933   &lt;2e-16 ***
## d.flowers   0.0053661  0.0105398   0.509   0.6107    
## dN1         0.0024868  0.0014748   1.686   0.0918 .  
## d.S         0.0001620  0.0003125   0.518   0.6041    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>kable(car::Anova(m1, type = 2))</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">Chisq</th>
<th align="right">Df</th>
<th align="right">Pr(&gt;Chisq)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>d.flowers</td>
<td align="right">0.2592101</td>
<td align="right">1</td>
<td align="right">0.6106633</td>
</tr>
<tr class="even">
<td>dN1</td>
<td align="right">2.8431036</td>
<td align="right">1</td>
<td align="right">0.0917668</td>
</tr>
<tr class="odd">
<td>d.S</td>
<td align="right">0.2687942</td>
<td align="right">1</td>
<td align="right">0.6041418</td>
</tr>
</tbody>
</table>
<pre class="r"><code>null &lt;- glmmTMB(Con ~ (1|Shrub/Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)</code></pre>
<pre><code>## Warning in fitTMB(TMBStruc): Model convergence problem; non-positive-definite
## Hessian matrix. See vignette(&#39;troubleshooting&#39;)</code></pre>
<pre class="r"><code>summary(null)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          Con ~ (1 | Shrub/Rep/Flower)
## Data: counts.ag
## 
##      AIC      BIC   logLik deviance df.resid 
##       NA       NA       NA       NA      226 
## 
## Random effects:
## 
## Conditional model:
##  Groups             Name        Variance  Std.Dev. 
##  Flower:(Rep:Shrub) (Intercept) 4.130e-08 2.032e-04
##  Rep:Shrub          (Intercept) 8.571e-02 2.928e-01
##  Shrub              (Intercept) 6.291e-11 7.931e-06
## Number of obs: 231, groups:  Flower:(Rep:Shrub), 78; Rep:Shrub, 26; Shrub, 13
## 
## Overdispersion parameter for nbinom2 family (): 2.22 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  4.20487    0.07338   57.31   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(m1, null)</code></pre>
<pre><code>##      df     AIC
## m1    8 2382.86
## null  5      NA</code></pre>
<pre class="r"><code>anova(m1, null)</code></pre>
<pre><code>## Data: counts.ag
## Models:
## null: Con ~ (1 | Shrub/Rep/Flower), zi=~0, disp=~1
## m1: Con ~ d.flowers + dN1 + d.S + (1 | Shrub/Rep/Flower), zi=~0, disp=~1
##      Df    AIC    BIC  logLik deviance Chisq Chi Df Pr(&gt;Chisq)
## null  5                                                       
## m1    8 2382.9 2410.4 -1183.4   2366.9            3</code></pre>
<pre class="r"><code>m4 &lt;- glmmTMB(Het ~ d.flowers + dN1 + d.S + (1|Shrub/Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)
summary(m4)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          Het ~ d.flowers + dN1 + d.S + (1 | Shrub/Rep/Flower)
## Data: counts.ag
## 
##      AIC      BIC   logLik deviance df.resid 
##   1368.3   1395.9   -676.2   1352.3      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups             Name        Variance  Std.Dev. 
##  Flower:(Rep:Shrub) (Intercept) 1.335e-08 0.0001155
##  Rep:Shrub          (Intercept) 7.641e-02 0.2764241
##  Shrub              (Intercept) 1.168e-01 0.3417106
## Number of obs: 231, groups:  Flower:(Rep:Shrub), 78; Rep:Shrub, 26; Shrub, 13
## 
## Overdispersion parameter for nbinom2 family (): 2.01 
## 
## Conditional model:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.738e+00  2.020e-01   8.606  &lt; 2e-16 ***
## d.flowers   -1.352e-02  1.455e-02  -0.929  0.35272    
## dN1         -7.495e-05  1.775e-03  -0.042  0.96631    
## d.S          1.101e-03  4.109e-04   2.679  0.00739 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>kable(car::Anova(m4, type = 2))</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">Chisq</th>
<th align="right">Df</th>
<th align="right">Pr(&gt;Chisq)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>d.flowers</td>
<td align="right">0.8636442</td>
<td align="right">1</td>
<td align="right">0.3527209</td>
</tr>
<tr class="even">
<td>dN1</td>
<td align="right">0.0017837</td>
<td align="right">1</td>
<td align="right">0.9663123</td>
</tr>
<tr class="odd">
<td>d.S</td>
<td align="right">7.1744378</td>
<td align="right">1</td>
<td align="right">0.0073950</td>
</tr>
</tbody>
</table>
<pre class="r"><code>null &lt;- glmmTMB(Het ~ (1|Shrub/Rep/Flower), family = &quot;nbinom2&quot;, data = counts.ag)

AIC(m4, null)</code></pre>
<pre><code>##      df      AIC
## m4    8 1368.337
## null  5 1368.620</code></pre>
<pre class="r"><code>anova(m4, null)</code></pre>
<pre><code>## Data: counts.ag
## Models:
## null: Het ~ (1 | Shrub/Rep/Flower), zi=~0, disp=~1
## m4: Het ~ d.flowers + dN1 + d.S + (1 | Shrub/Rep/Flower), zi=~0, disp=~1
##      Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)  
## null  5 1368.6 1385.8 -679.31   1358.6                           
## m4    8 1368.3 1395.9 -676.17   1352.3 6.2832      3    0.09862 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>p3 &lt;- ggplot(counts.ag, aes(d.S, Con)) + geom_point(shape = 1) + geom_smooth(colour = &quot;black&quot;, size = 0.5) + geom_jitter(shape = 1) + theme_Publication() + xlab(&quot;Distance to Larrea tridentata&quot;) + ylab(&quot;Conspecific Pollen Deposition&quot;)</code></pre>
<pre><code>## 
## Attaching package: &#39;ggthemes&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:cowplot&#39;:
## 
##     theme_map</code></pre>
<pre class="r"><code>p4 &lt;- ggplot(counts.ag, aes(d.S, Het)) + geom_point(shape = 1) + geom_smooth(colour = &quot;black&quot;, size = 0.5) + geom_jitter(shape = 1) + theme_Publication() + xlab(&quot;Distance to Larrea tridentata&quot;) + ylab(&quot;Heterospecific Pollen Deposition&quot;)

p3</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="index_files/figure-html/pollen%20plots-1.png" width="672" /></p>
<pre class="r"><code>p4</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="index_files/figure-html/pollen%20plots-2.png" width="672" /></p>
<hr />
</div>
</div>
<div id="community-level-effects" class="section level2">
<h2>Community level effects</h2>
<hr />
<div id="vegetation-modelling" class="section level3">
<h3>Vegetation Modelling</h3>
<p>GLMM for vegetation covariates to test for direct shrub facilitation/background flowering levels</p>
<hr />
<p>Annual Percent Cover</p>
<pre class="r"><code>visits &lt;- read.csv(&quot;Output Data/byrep_cleaned.csv&quot;)
metadata &lt;- read.csv(&quot;Output Data/metadata_nobeetle.csv&quot;)

#only care about the veg
visits &lt;- dplyr::select(visits, uniID, treatment, flowering, het.shrub.blooming.neighbours, het.cactus.blooming.neighbours, understory.richness, het.annual.floral.density, PlantID)
visits$flowering &lt;- relevel(visits$flowering, &quot;pre&quot;)
metadata$blooming &lt;- relevel(metadata$blooming, &quot;pre&quot;)

metadata &lt;- dplyr::select(metadata, uniID, plant.id, treatment, blooming, percent.cover, date)
metadata$repID &lt;- paste(metadata$plant.id, metadata$treatment)
visits$repID &lt;- paste(visits$PlantID, visits$treatment)


#percent.cover
shapiro.test(metadata$percent.cover)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  metadata$percent.cover
## W = 0.84516, p-value = 2.406e-14</code></pre>
<pre class="r"><code>mean(metadata$percent.cover)</code></pre>
<pre><code>## [1] 18.82456</code></pre>
<pre class="r"><code>sd(metadata$percent.cover)</code></pre>
<pre><code>## [1] 19.50229</code></pre>
<pre class="r"><code>ggplot(metadata, aes(percent.cover)) + geom_density()</code></pre>
<p><img src="index_files/figure-html/percent%20cover-1.png" width="672" /></p>
<pre class="r"><code>#updating to binomial model because of proportion
metadata$steps &lt;- 100
y &lt;- cbind(metadata$percent.cover, metadata$steps)

g1.b &lt;- glmmTMB(y ~ treatment + blooming + (1|plant.id/repID), family = &quot;binomial&quot;, data = metadata)
g1.b1 &lt;- glmmTMB(y ~ treatment * blooming + (1|plant.id/repID), family = &quot;binomial&quot;, data = metadata)

g1.b.null &lt;- glmmTMB(y ~ 1 + (1|plant.id/repID), family = &quot;binomial&quot;, data = metadata)


AIC(g1.b, g1.b1, g1.b.null)</code></pre>
<pre><code>##           df      AIC
## g1.b       5 1659.513
## g1.b1      6 1592.974
## g1.b.null  3 1826.018</code></pre>
<pre class="r"><code>anova(g1.b, g1.b1, g1.b.null)</code></pre>
<pre><code>## Data: metadata
## Models:
## g1.b.null: y ~ 1 + (1 | plant.id/repID), zi=~0, disp=~1
## g1.b: y ~ treatment + blooming + (1 | plant.id/repID), zi=~0, disp=~1
## g1.b1: y ~ treatment * blooming + (1 | plant.id/repID), zi=~0, disp=~1
##           Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## g1.b.null  3 1826.0 1836.3 -910.01   1820.0                              
## g1.b       5 1659.5 1676.7 -824.76   1649.5 170.505      2  &lt; 2.2e-16 ***
## g1.b1      6 1593.0 1613.5 -790.49   1581.0  68.539      1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g1.b1)</code></pre>
<pre><code>##  Family: binomial  ( logit )
## Formula:          y ~ treatment * blooming + (1 | plant.id/repID)
## Data: metadata
## 
##      AIC      BIC   logLik deviance df.resid 
##   1593.0   1613.5   -790.5   1581.0      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 3.387e-01 0.5820142
##  plant.id       (Intercept) 6.564e-08 0.0002562
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                  -2.9749     0.0991 -30.018  &lt; 2e-16 ***
## treatmentshrub                1.7220     0.1267  13.589  &lt; 2e-16 ***
## bloomingpost                 -0.8599     0.1032  -8.331  &lt; 2e-16 ***
## treatmentshrub:bloomingpost   0.8900     0.1106   8.047  8.5e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(g1.b1, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: y
##                      Chisq Df Pr(&gt;Chisq)    
## (Intercept)        901.071  1    &lt; 2e-16 ***
## treatment          184.651  1    &lt; 2e-16 ***
## blooming            69.402  1    &lt; 2e-16 ***
## treatment:blooming  64.751  1    8.5e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#posthoc in interaction
ph &lt;- lsmeans(g1.b1, pairwise~treatment*blooming, adjust=&quot;tukey&quot;)
summary(ph)</code></pre>
<pre><code>## $lsmeans
##  treatment blooming lsmean     SE  df lower.CL upper.CL
##  open      pre       -2.97 0.0991 222    -3.22    -2.73
##  shrub     pre       -1.25 0.0797 222    -1.45    -1.05
##  open      post      -3.83 0.1133 222    -4.12    -3.55
##  shrub     post      -1.22 0.0787 222    -1.42    -1.03
## 
## Results are given on the logit (not the response) scale. 
## Confidence level used: 0.95 
## Conf-level adjustment: sidak method for 4 estimates 
## 
## $contrasts
##  contrast               estimate     SE  df t.ratio p.value
##  open,pre - shrub,pre    -1.7220 0.1267 222 -13.589 &lt;.0001 
##  open,pre - open,post     0.8599 0.1032 222   8.331 &lt;.0001 
##  open,pre - shrub,post   -1.7521 0.1261 222 -13.893 &lt;.0001 
##  shrub,pre - open,post    2.5819 0.1379 222  18.724 &lt;.0001 
##  shrub,pre - shrub,post  -0.0301 0.0397 222  -0.757 0.8736 
##  open,post - shrub,post  -2.6120 0.1373 222 -19.020 &lt;.0001 
## 
## Results are given on the log odds ratio (not the response) scale. 
## P value adjustment: tukey method for comparing a family of 4 estimates</code></pre>
<pre class="r"><code>ggplot(metadata, aes(treatment, percent.cover)) + geom_boxplot() + facet_grid(~blooming)</code></pre>
<p><img src="index_files/figure-html/percent%20cover-2.png" width="672" /></p>
<pre class="r"><code>ggplot(metadata, aes(treatment, percent.cover)) + geom_boxplot() + theme_Publication() + ylab(&quot;Percent Annual Vegetation Cover&quot;) + xlab(&quot;Microsite&quot;)</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<p><img src="index_files/figure-html/percent%20cover-3.png" width="672" /></p>
<pre class="r"><code>ggplot(metadata, aes(treatment, percent.cover)) + geom_boxplot() + theme_Publication() + ylab(&quot;Percent Annual Vegetation Cover&quot;) + xlab(&quot;Microsite&quot;) + facet_grid(~blooming,labeller=labeller(blooming = labels))</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<p><img src="index_files/figure-html/percent%20cover-4.png" width="672" /></p>
<hr />
<p>Annual Richness</p>
<pre class="r"><code>mean(visits$understory.richness, na.rm = TRUE)</code></pre>
<pre><code>## [1] 2.376623</code></pre>
<pre class="r"><code>sd(visits$understory.richness, na.rm = TRUE)</code></pre>
<pre><code>## [1] 0.8703667</code></pre>
<pre class="r"><code>shapiro.test(visits$understory.richness)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  visits$understory.richness
## W = 0.88912, p-value = 5.431e-12</code></pre>
<pre class="r"><code>ggplot(visits, aes(understory.richness)) + geom_density()</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/annual%20richness-1.png" width="672" /></p>
<pre class="r"><code>g2 &lt;- glmmTMB(understory.richness ~ treatment + flowering + (1|PlantID/repID), family = poisson(link=&quot;log&quot;), data = visits)
g2.2 &lt;- glmmTMB(understory.richness ~ treatment * flowering + (1|PlantID/repID), family = poisson(link=&quot;log&quot;), data = visits)
g2.null &lt;- glmmTMB(understory.richness ~ 1 + (1|PlantID/repID), family = poisson(link=&quot;log&quot;), data = visits)
g2b &lt;- glmmTMB(understory.richness ~ treatment + flowering + (1|PlantID/repID), family = nbinom2, data = visits)</code></pre>
<pre><code>## Warning in fitTMB(TMBStruc): Model convergence problem; non-positive-definite
## Hessian matrix. See vignette(&#39;troubleshooting&#39;)</code></pre>
<pre class="r"><code>summary(g2)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          
## understory.richness ~ treatment + flowering + (1 | PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    709.6    726.8   -349.8    699.6      226 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance  Std.Dev. 
##  repID:PlantID (Intercept) 6.922e-11 8.320e-06
##  PlantID       (Intercept) 1.013e-10 1.006e-05
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     0.89619    0.07359  12.179   &lt;2e-16 ***
## treatmentshrub  0.07186    0.08546   0.841      0.4    
## floweringbloom -0.14068    0.08560  -1.643      0.1    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g2.2)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          
## understory.richness ~ treatment * flowering + (1 | PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    711.6    732.2   -349.8    699.6      225 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance  Std.Dev. 
##  repID:PlantID (Intercept) 8.620e-11 9.284e-06
##  PlantID       (Intercept) 9.482e-11 9.738e-06
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    0.89142    0.08482  10.510   &lt;2e-16 ***
## treatmentshrub                 0.08090    0.11664   0.694    0.488    
## floweringbloom                -0.13045    0.12406  -1.052    0.293    
## treatmentshrub:floweringbloom -0.01951    0.17140  -0.114    0.909    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g2.null)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          understory.richness ~ 1 + (1 | PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    709.0    719.3   -351.5    703.0      228 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance  Std.Dev. 
##  repID:PlantID (Intercept) 1.558e-11 3.947e-06
##  PlantID       (Intercept) 1.602e-10 1.266e-05
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.86568    0.04268   20.28   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(g2, g2.null, g2.2, g2b, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Data: visits
## Models:
## g2.null: understory.richness ~ 1 + (1 | PlantID/repID), zi=~0, disp=~1
## g2: understory.richness ~ treatment + flowering + (1 | PlantID/repID), zi=~0, disp=~1
## g2.2: understory.richness ~ treatment * flowering + (1 | PlantID/repID), zi=~0, disp=~1
## g2b: understory.richness ~ treatment + flowering + (1 | PlantID/repID), zi=~0, disp=~1
##         Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)
## g2.null  3 709.01 719.33 -351.50   703.01                         
## g2       5 709.58 726.79 -349.79   699.58 3.4279      2     0.1802
## g2.2     6 711.56 732.22 -349.78   699.56 0.0130      1     0.9094
## g2b      6                                            0</code></pre>
<pre class="r"><code>AIC(g2, g2.2, g2.null, g2b)</code></pre>
<pre><code>##         df      AIC
## g2       5 709.5776
## g2.2     6 711.5646
## g2.null  3 709.0055
## g2b      6       NA</code></pre>
<pre class="r"><code>car::Anova(g2, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: understory.richness
##            Chisq Df Pr(&gt;Chisq)
## treatment 0.7071  1     0.4004
## flowering 2.7010  1     0.1003</code></pre>
<pre class="r"><code>#null model is the best fit


ggplot(visits, aes(treatment, understory.richness)) + geom_boxplot() + facet_grid(~flowering, labeller=labeller(flowering = labels)) + theme_Publication() + xlab(&quot;Microsite&quot;) + ylab(&quot;Annual Species Richness&quot;)</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="index_files/figure-html/annual%20richness-2.png" width="672" /></p>
<hr />
<p>Annual Floral Density number of all blooms in quadrat</p>
<pre class="r"><code>mean(visits$het.annual.floral.density, na.rm = TRUE)</code></pre>
<pre><code>## [1] 0.965368</code></pre>
<pre class="r"><code>sd(visits$het.annual.floral.density, na.rm = TRUE)</code></pre>
<pre><code>## [1] 3.114987</code></pre>
<pre class="r"><code>ggplot(visits, aes(het.annual.floral.density)) + geom_density()</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/annual%20floral%20density-1.png" width="672" /></p>
<pre class="r"><code>g3.nb &lt;- glmmTMB(het.annual.floral.density ~ flowering * treatment + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = visits)

g3.nb.1 &lt;- glmmTMB(het.annual.floral.density ~ flowering + treatment + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = visits)

g3.nb.null &lt;- glmmTMB(het.annual.floral.density ~ 1 + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = visits)

g3.p &lt;- glmmTMB(het.annual.floral.density ~ 1 + (1|PlantID/repID), family = &quot;poisson&quot;, data = visits)

g3.nb.type1 &lt;- glmmTMB(het.annual.floral.density ~ 1 + (1|PlantID/repID), family = &quot;nbinom1&quot;, data = visits) 

summary(g3.nb)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## het.annual.floral.density ~ flowering * treatment + (1 | PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    494.6    518.7   -240.3    480.6      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance  Std.Dev. 
##  repID:PlantID (Intercept) 8.792e-09 9.377e-05
##  PlantID       (Intercept) 1.522e+00 1.234e+00
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 0.298 
## 
## Conditional model:
##                                Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)                   -0.349924   0.505642  -0.692   0.4889  
## floweringbloom                -1.075848   0.532435  -2.021   0.0433 *
## treatmentshrub                -0.008222   0.487969  -0.017   0.9866  
## floweringbloom:treatmentshrub -0.101781   0.759183  -0.134   0.8933  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g3.nb.1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          
## het.annual.floral.density ~ flowering + treatment + (1 | PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    492.6    513.3   -240.3    480.6      225 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance  Std.Dev. 
##  repID:PlantID (Intercept) 9.988e-09 9.994e-05
##  PlantID       (Intercept) 1.528e+00 1.236e+00
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 0.298 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)    -0.33036    0.48422  -0.682  0.49508   
## floweringbloom -1.12552    0.38323  -2.937  0.00331 **
## treatmentshrub -0.05101    0.36913  -0.138  0.89010   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g3.nb.null)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          het.annual.floral.density ~ 1 + (1 | PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    497.1    510.9   -244.5    489.1      227 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance  Std.Dev. 
##  repID:PlantID (Intercept) 1.207e-08 0.0001099
##  PlantID       (Intercept) 1.761e+00 1.3270192
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 0.271 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  -0.8415     0.3742  -2.249   0.0245 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(g3.nb, g3.nb.null, g3.nb.1, g3.p, g3.nb.type1, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Data: visits
## Models:
## g3.p: het.annual.floral.density ~ 1 + (1 | PlantID/repID), zi=~0, disp=~1
## g3.nb.null: het.annual.floral.density ~ 1 + (1 | PlantID/repID), zi=~0, disp=~1
## g3.nb.type1: het.annual.floral.density ~ 1 + (1 | PlantID/repID), zi=~0, disp=~1
## g3.nb.1: het.annual.floral.density ~ flowering + treatment + (1 | PlantID/repID), zi=~0, disp=~1
## g3.nb: het.annual.floral.density ~ flowering * treatment + (1 | PlantID/repID), zi=~0, disp=~1
##             Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## g3.p         3 646.15 656.48 -320.07   640.15                              
## g3.nb.null   4 497.09 510.86 -244.55   489.09 151.054      1  &lt; 2.2e-16 ***
## g3.nb.type1  4 499.15 512.92 -245.58   491.15   0.000      0   1.000000    
## g3.nb.1      6 492.60 513.26 -240.30   480.60  10.549      2   0.005121 ** 
## g3.nb        7 494.59 518.68 -240.29   480.59   0.018      1   0.893386    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(g3.nb.1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: het.annual.floral.density
##            Chisq Df Pr(&gt;Chisq)   
## flowering 8.6255  1   0.003315 **
## treatment 0.0191  1   0.890096   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(g3.nb, g3.nb.1, g3.p, g3.nb.type1, g3.nb.null)</code></pre>
<pre><code>##             df      AIC
## g3.nb        7 494.5867
## g3.nb.1      6 492.6046
## g3.p         3 646.1484
## g3.nb.type1  4 499.1534
## g3.nb.null   4 497.0949</code></pre>
<pre class="r"><code>#negative binomial type 2, additive model

ggplot(visits, aes(treatment, het.annual.floral.density)) + geom_boxplot() + facet_grid(~flowering, labeller=labeller(flowering = labels)) + theme_Publication() + xlab(&quot;Microsite&quot;) + ylab(&quot;Heterospecific Annual Floral Density&quot;)</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="index_files/figure-html/annual%20floral%20density-2.png" width="672" /></p>
<hr />
<p>Blooming shrub density</p>
<pre class="r"><code>mean(visits$het.shrub.blooming.neighbours, na.rm = TRUE)</code></pre>
<pre><code>## [1] 1.744589</code></pre>
<pre class="r"><code>sd(visits$het.shrub.blooming.neighbours, na.rm = TRUE)</code></pre>
<pre><code>## [1] 2.375537</code></pre>
<pre class="r"><code>ggplot(visits, aes(het.shrub.blooming.neighbours)) + geom_density(kernel = &quot;gaussian&quot;)</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/shrub%20density-1.png" width="672" /></p>
<pre class="r"><code>g4.nb &lt;- glmmTMB(het.shrub.blooming.neighbours ~ flowering * treatment + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = visits)

g4.nb.1 &lt;- glmmTMB(het.shrub.blooming.neighbours ~ flowering + treatment + (1|PlantID/repID), family = &quot;nbinom2&quot;,data = visits)

g4.nb.null &lt;- glmmTMB(het.shrub.blooming.neighbours ~ 1 + (1|PlantID/repID), family = &quot;nbinom2&quot;,data = visits)
summary(g4.nb)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          het.shrub.blooming.neighbours ~ flowering * treatment + (1 |  
##     PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    707.4    731.5   -346.7    693.4      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.008595 0.09271 
##  PlantID       (Intercept) 0.746167 0.86381 
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 46.9 
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    -1.0824     0.2318  -4.669 3.03e-06 ***
## floweringbloom                  1.6433     0.2120   7.751 9.13e-15 ***
## treatmentshrub                  0.2888     0.2529   1.142    0.253    
## floweringbloom:treatmentshrub   0.0718     0.2775   0.259    0.796    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g4.nb.1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          het.shrub.blooming.neighbours ~ flowering + treatment + (1 |  
##     PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    705.4    726.1   -346.7    693.4      225 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.009547 0.09771 
##  PlantID       (Intercept) 0.745988 0.86371 
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 49.6 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     -1.1172     0.1906  -5.862 4.58e-09 ***
## floweringbloom   1.6848     0.1402  12.016  &lt; 2e-16 ***
## treatmentshrub   0.3481     0.1077   3.233  0.00123 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g4.nb.null)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          het.shrub.blooming.neighbours ~ 1 + (1 | PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    830.4    844.2   -411.2    822.4      227 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance  Std.Dev. 
##  repID:PlantID (Intercept) 2.211e-09 4.702e-05
##  PlantID       (Intercept) 3.579e-01 5.983e-01
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Overdispersion parameter for nbinom2 family (): 0.994 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)   0.3835     0.1380    2.78  0.00544 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(g4.nb, g4.nb.null, g4.nb.1, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Data: visits
## Models:
## g4.nb.null: het.shrub.blooming.neighbours ~ 1 + (1 | PlantID/repID), zi=~0, disp=~1
## g4.nb.1: het.shrub.blooming.neighbours ~ flowering + treatment + (1 | , zi=~0, disp=~1
## g4.nb.1:     PlantID/repID), zi=~0, disp=~1
## g4.nb: het.shrub.blooming.neighbours ~ flowering * treatment + (1 | , zi=~0, disp=~1
## g4.nb:     PlantID/repID), zi=~0, disp=~1
##            Df    AIC    BIC  logLik deviance    Chisq Chi Df Pr(&gt;Chisq)    
## g4.nb.null  4 830.45 844.22 -411.22   822.45                               
## g4.nb.1     6 705.42 726.08 -346.71   693.42 129.0278      2     &lt;2e-16 ***
## g4.nb       7 707.36 731.45 -346.68   693.36   0.0669      1     0.7959    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(g4.nb.1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: het.shrub.blooming.neighbours
##            Chisq Df Pr(&gt;Chisq)    
## flowering 144.38  1  &lt; 2.2e-16 ***
## treatment  10.45  1   0.001226 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(g4.nb, g4.nb.1, g4.nb.null)</code></pre>
<pre><code>##            df      AIC
## g4.nb       7 707.3551
## g4.nb.1     6 705.4220
## g4.nb.null  4 830.4498</code></pre>
<pre class="r"><code>ggplot(visits, aes(treatment, het.shrub.blooming.neighbours)) + geom_boxplot() + theme_Publication() + ylab(&quot;Blooming Shrubs within 2 m&quot;) + xlab(&quot;Microsite&quot;)   </code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="index_files/figure-html/shrub%20density-2.png" width="672" /></p>
<pre class="r"><code>ggplot(visits, aes(treatment, het.shrub.blooming.neighbours)) + geom_boxplot() + theme_Publication() + ylab(&quot;Blooming Shrubs within 2 m&quot;) + xlab(&quot;Microsite&quot;) + facet_grid(~flowering,labeller=labeller(flowering = labels)) </code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing

## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="index_files/figure-html/shrub%20density-3.png" width="672" /></p>
<hr />
<p>Blooming cactus density</p>
<pre class="r"><code>mean(visits$het.cactus.blooming.neighbours, na.rm = TRUE)</code></pre>
<pre><code>## [1] 0.1341991</code></pre>
<pre class="r"><code>sd(visits$het.cactus.blooming.neighbours, na.rm = TRUE)</code></pre>
<pre><code>## [1] 0.6214983</code></pre>
<pre class="r"><code>ggplot(visits, aes(het.cactus.blooming.neighbours)) + geom_density(kernel = &quot;gaussian&quot;)</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/cactus%20density-1.png" width="672" /></p>
<pre class="r"><code>g5.nb &lt;- glmmTMB(het.cactus.blooming.neighbours ~ flowering * treatment + (1|PlantID/repID), family = &quot;nbinom2&quot;, data = visits)</code></pre>
<pre><code>## Warning in fitTMB(TMBStruc): Model convergence problem; false convergence (8).
## See vignette(&#39;troubleshooting&#39;)</code></pre>
<pre class="r"><code>g5.ps &lt;- glmmTMB(het.cactus.blooming.neighbours ~ flowering * treatment + (1|PlantID/repID), family = poisson(link = &quot;log&quot;), data = visits)
g5.ps.1 &lt;- glmmTMB(het.cactus.blooming.neighbours ~ flowering + treatment + (1|PlantID/repID), family = poisson(link = &quot;log&quot;), data = visits)
g5.ps.null &lt;- glmmTMB(het.cactus.blooming.neighbours ~ 1 + (1|PlantID/repID), family = poisson(link =&quot;log&quot;), data = visits)


summary(g5.ps)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          
## het.cactus.blooming.neighbours ~ flowering * treatment + (1 |  
##     PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    153.8    174.5    -70.9    141.8      225 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.7949   0.8916  
##  PlantID       (Intercept) 4.2384   2.0587  
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Conditional model:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                    -6.1822     1.3354  -4.629 3.67e-06 ***
## floweringbloom                  2.8441     1.0294   2.763  0.00573 ** 
## treatmentshrub                  0.3061     1.4595   0.210  0.83389    
## floweringbloom:treatmentshrub  -0.3376     1.4639  -0.231  0.81759    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g5.ps.1)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          
## het.cactus.blooming.neighbours ~ flowering + treatment + (1 |  
##     PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    151.9    169.1    -70.9    141.9      226 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.7952   0.8917  
##  PlantID       (Intercept) 4.2368   2.0583  
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Conditional model:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -6.036609   1.142375  -5.284 1.26e-07 ***
## floweringbloom  2.689605   0.731776   3.675 0.000237 ***
## treatmentshrub -0.009015   0.515859  -0.017 0.986056    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(g5.ps.null)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          het.cactus.blooming.neighbours ~ 1 + (1 | PlantID/repID)
## Data: visits
## 
##      AIC      BIC   logLik deviance df.resid 
##    176.3    186.6    -85.1    170.3      228 
## 
## Random effects:
## 
## Conditional model:
##  Groups        Name        Variance Std.Dev.
##  repID:PlantID (Intercept) 0.8098   0.8999  
##  PlantID       (Intercept) 4.3463   2.0848  
## Number of obs: 231, groups:  repID:PlantID, 122; PlantID, 61
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -4.0338     0.8856  -4.555 5.24e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(g5.nb, g5.ps, g5.ps.null, g5.ps.1, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Data: visits
## Models:
## g5.ps.null: het.cactus.blooming.neighbours ~ 1 + (1 | PlantID/repID), zi=~0, disp=~1
## g5.ps.1: het.cactus.blooming.neighbours ~ flowering + treatment + (1 | , zi=~0, disp=~1
## g5.ps.1:     PlantID/repID), zi=~0, disp=~1
## g5.ps: het.cactus.blooming.neighbours ~ flowering * treatment + (1 | , zi=~0, disp=~1
## g5.ps:     PlantID/repID), zi=~0, disp=~1
## g5.nb: het.cactus.blooming.neighbours ~ flowering * treatment + (1 | , zi=~0, disp=~1
## g5.nb:     PlantID/repID), zi=~0, disp=~1
##            Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)    
## g5.ps.null  3 176.27 186.59 -85.133   170.27                             
## g5.ps.1     5 151.86 169.07 -70.929   141.86 28.409      2  6.777e-07 ***
## g5.ps       6 153.80 174.46 -70.902   141.80  0.053      1     0.8179    
## g5.nb       7 155.80 179.90 -70.902   141.80  0.000      1     0.9947    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(g5.ps.1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: het.cactus.blooming.neighbours
##             Chisq Df Pr(&gt;Chisq)    
## flowering 13.5089  1  0.0002374 ***
## treatment  0.0003  1  0.9860564    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(g5.nb, g5.ps, g5.ps.1, g5.ps.null)</code></pre>
<pre><code>##            df      AIC
## g5.nb       7 155.8044
## g5.ps       6 153.8045
## g5.ps.1     5 151.8575
## g5.ps.null  3 176.2665</code></pre>
<pre class="r"><code>#poisson additive is best


ggplot(visits, aes(treatment, het.cactus.blooming.neighbours)) + geom_boxplot() + facet_grid(~flowering, labeller=labeller(flowering = labels)) + theme_Publication() + xlab(&quot;Microsite&quot;) + ylab(&quot;Blooming Cactus Density within 2m&quot;)</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="index_files/figure-html/cactus%20density-2.png" width="672" /></p>
<hr />
</div>
<div id="pan-traps" class="section level3">
<h3>Pan traps</h3>
<p>These are models for abundance, species richness, bee abundance and bee richness from pan traps.</p>
<hr />
</div>
<div id="pan-trap-diversity-calculations" class="section level3">
<h3>Pan trap diversity calculations</h3>
<p>This sections calculates diversity indices and exports full env/metadata .csv</p>
<p>Calculations excluding Melyrid beetles</p>
<pre class="r"><code>insects &lt;- read.csv(&quot;Output Data/pantraps_wide.csv&quot;, header = TRUE)
row.names(insects) &lt;- insects$uniID
insects &lt;- dplyr::select(insects, -X, -uniID)

#filter out Melyrid beetles
insects &lt;- dplyr::select(insects, -Melyridae)
metadata &lt;- read.csv(&quot;Clean Data/pantraps_cov.csv&quot;, header = TRUE)
metadata &lt;- filter(metadata, species != &quot;buckhorn&quot;)
metadata$plant.id &lt;- as.character(metadata$plant.id)
str(metadata)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  8 variables:
##  $ plant.id     : chr  &quot;296&quot; &quot;296&quot; &quot;189&quot; &quot;189&quot; ...
##  $ species      : Factor w/ 2 levels &quot;buckhorn&quot;,&quot;larrea&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ blooming     : Factor w/ 2 levels &quot;post&quot;,&quot;pre&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ date         : Factor w/ 21 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  15 3 25 2 40 15 40 3 70 10 ...
##  $ perennial    : Factor w/ 5 levels &quot;&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X            : Factor w/ 6 levels &quot;&quot;,&quot;blue and white knocked over&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>metadata$uniID &lt;- paste(metadata$date, metadata$plant.id, metadata$treatment)
row.names(metadata) &lt;- metadata$uniID


#check all ids in datasheets are found in the other
#zero.row &lt;- anti_join(metadata, insects, by = &quot;uniID&quot;)
#missing &lt;- anti_join(insects, metadata, by = &quot;uniID&quot;)
#write.csv(zero.row, &quot;zeroreps.csv&quot;)

#check if insects and metadata are the same
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] &quot;214 string mismatches&quot;</code></pre>
<pre class="r"><code>#sort into the same order
metadata &lt;- metadata[rownames(insects), ]
#confirm - woo!
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>#grab and wrangle weather stn data
weather &lt;- read.csv(&quot;Clean Data/pantraps_weather.csv&quot;)
str(weather)</code></pre>
<pre><code>## &#39;data.frame&#39;:    152 obs. of  12 variables:
##  $ date            : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ Hour            : Factor w/ 8 levels &quot;1:00 PM&quot;,&quot;10:00 AM&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Solar           : num  0.81 0.79 0.8 0.81 0.81 0.8 0.63 0.82 0.84 0.76 ...
##  $ Wind            : num  3.9 4.1 5.1 4.9 4.5 3.2 3.3 4.3 4.6 4.7 ...
##  $ Max             : num  9 10.7 9.7 8.6 7.8 7.6 7.2 8.2 8.2 8.2 ...
##  $ Air.Temperature : num  15 15.6 16.9 18.5 19.8 21 21.1 20.7 20.2 18.8 ...
##  $ Soil.Temperature: num  18.9 18.8 18.7 18.8 19 19.3 19.8 20.4 21 21.5 ...
##  $ Humidity        : int  43 42 38 32 29 27 26 26 26 25 ...
##  $ Dew             : num  2.4 2.6 2.4 1.7 1.4 1.1 1.1 0.8 -0.1 -1.6 ...
##  $ Wet             : num  8.2 8.6 9.1 9.5 9.9 10.3 10.3 10 9.5 8.5 ...
##  $ Baro.           : int  873 873 873 873 872 872 872 872 871 871 ...
##  $ Total           : int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<pre class="r"><code>weather.av &lt;- weather %&gt;% group_by(., date) %&gt;% summarise(., mean.Solar = mean(Solar), mean.Wind = mean(Wind), mean.MaxWind = mean(Max), mean.Temp = mean(Air.Temperature))
metadata &lt;- right_join(weather.av, metadata, by = &quot;date&quot;)</code></pre>
<pre><code>## Warning: Column `date` joining factors with different levels, coercing to
## character vector</code></pre>
<pre class="r"><code>#calculate abundances using vegan
metadata$abun &lt;- apply(insects, 1, sum)
#check for total
sum(metadata$abun)</code></pre>
<pre><code>## [1] 2144</code></pre>
<pre class="r"><code>H &lt;- diversity(insects)
simp &lt;- diversity(insects, &quot;simpson&quot;)
S &lt;- specnumber(insects)
J &lt;- H/log(S)
metadata$H &lt;- H
metadata$Simpson &lt;- simp
metadata$Species &lt;- S
metadata$Even &lt;- J

summary(metadata)</code></pre>
<pre><code>##      date             mean.Solar       mean.Wind      mean.MaxWind   
##  Length:228         Min.   :0.5737   Min.   :3.525   Min.   : 9.238  
##  Class :character   1st Qu.:0.6663   1st Qu.:4.787   1st Qu.: 9.625  
##  Mode  :character   Median :0.7688   Median :5.175   Median :10.050  
##                     Mean   :0.7419   Mean   :5.241   Mean   :10.184  
##                     3rd Qu.:0.7987   3rd Qu.:6.025   3rd Qu.:10.512  
##                     Max.   :0.8125   Max.   :6.662   Max.   :11.537  
##                                                                      
##    mean.Temp       plant.id             species    treatment   blooming  
##  Min.   :17.16   Length:228         buckhorn:  0   open :114   post:120  
##  1st Qu.:17.40   Class :character   larrea  :228   shrub:114   pre :108  
##  Median :17.86   Mode  :character                                        
##  Mean   :18.46                                                           
##  3rd Qu.:18.56                                                           
##  Max.   :28.51                                                           
##                                                                          
##  percent.cover   perennial                            X      
##  Min.   : 1.00       :223                              :227  
##  1st Qu.: 2.00   1   :  4   blue and white knocked over:  1  
##  Median :10.00   2   :  1   east                       :  0  
##  Mean   :18.82   3   :  0   east side                  :  0  
##  3rd Qu.:30.00   east:  0   north                      :  0  
##  Max.   :80.00              yellow knocked over        :  0  
##                                                              
##     uniID                abun              H            Simpson      
##  Length:228         Min.   : 0.000   Min.   :0.000   Min.   :0.0000  
##  Class :character   1st Qu.: 5.000   1st Qu.:1.332   1st Qu.:0.7321  
##  Mode  :character   Median : 9.000   Median :1.748   Median :0.8056  
##                     Mean   : 9.404   Mean   :1.583   Mean   :0.7569  
##                     3rd Qu.:12.000   3rd Qu.:1.994   3rd Qu.:0.8571  
##                     Max.   :30.000   Max.   :2.516   Max.   :1.0000  
##                                                                      
##     Species            Even       
##  Min.   : 0.000   Min.   :0.0000  
##  1st Qu.: 4.000   1st Qu.:0.9138  
##  Median : 6.000   Median :0.9577  
##  Mean   : 6.254   Mean   :0.9104  
##  3rd Qu.: 8.000   3rd Qu.:0.9821  
##  Max.   :15.000   Max.   :1.0000  
##                   NA&#39;s   :6</code></pre>
<pre class="r"><code>#no Melyrid beetle output
write.csv(metadata, &quot;Output Data/metadata_nobeetle.csv&quot;)
write.csv(insects, &quot;Output Data/wide_nobeetle.csv&quot;)</code></pre>
<p>Calculations including Melyrid beetles</p>
<pre class="r"><code>#with beetles
insects &lt;- read.csv(&quot;Output Data/pantraps_wide.csv&quot;, header = TRUE)
row.names(insects) &lt;- insects$uniID
insects &lt;- dplyr::select(insects, -X, -uniID, -Zeroes)
#filter out beetles
#insects &lt;- dplyr::select(insects, -Melyridae, -Melyridae.)
metadata &lt;- read.csv(&quot;Clean Data/pantraps_cov.csv&quot;, header = TRUE)
metadata &lt;- filter(metadata, species != &quot;buckhorn&quot;)
metadata$plant.id &lt;- as.character(metadata$plant.id)
str(metadata)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  8 variables:
##  $ plant.id     : chr  &quot;296&quot; &quot;296&quot; &quot;189&quot; &quot;189&quot; ...
##  $ species      : Factor w/ 2 levels &quot;buckhorn&quot;,&quot;larrea&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ blooming     : Factor w/ 2 levels &quot;post&quot;,&quot;pre&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ date         : Factor w/ 21 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  15 3 25 2 40 15 40 3 70 10 ...
##  $ perennial    : Factor w/ 5 levels &quot;&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X            : Factor w/ 6 levels &quot;&quot;,&quot;blue and white knocked over&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>metadata$uniID &lt;- paste(metadata$date, metadata$plant.id, metadata$treatment)
row.names(metadata) &lt;- metadata$uniID


#check all ids in datasheets are found in the other
#zero.row &lt;- anti_join(metadata, insects, by = &quot;uniID&quot;)
#missing &lt;- anti_join(insects, metadata, by = &quot;uniID&quot;)
#write.csv(zero.row, &quot;zeroreps.csv&quot;)
#check if insects and metadata are the same
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] &quot;214 string mismatches&quot;</code></pre>
<pre class="r"><code>#sort into the same order
metadata &lt;- metadata[rownames(insects), ]
#confirm - woo!
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>#grab and wrangle weather stn data
weather &lt;- read.csv(&quot;Clean Data/pantraps_weather.csv&quot;)
str(weather)</code></pre>
<pre><code>## &#39;data.frame&#39;:    152 obs. of  12 variables:
##  $ date            : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ Hour            : Factor w/ 8 levels &quot;1:00 PM&quot;,&quot;10:00 AM&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Solar           : num  0.81 0.79 0.8 0.81 0.81 0.8 0.63 0.82 0.84 0.76 ...
##  $ Wind            : num  3.9 4.1 5.1 4.9 4.5 3.2 3.3 4.3 4.6 4.7 ...
##  $ Max             : num  9 10.7 9.7 8.6 7.8 7.6 7.2 8.2 8.2 8.2 ...
##  $ Air.Temperature : num  15 15.6 16.9 18.5 19.8 21 21.1 20.7 20.2 18.8 ...
##  $ Soil.Temperature: num  18.9 18.8 18.7 18.8 19 19.3 19.8 20.4 21 21.5 ...
##  $ Humidity        : int  43 42 38 32 29 27 26 26 26 25 ...
##  $ Dew             : num  2.4 2.6 2.4 1.7 1.4 1.1 1.1 0.8 -0.1 -1.6 ...
##  $ Wet             : num  8.2 8.6 9.1 9.5 9.9 10.3 10.3 10 9.5 8.5 ...
##  $ Baro.           : int  873 873 873 873 872 872 872 872 871 871 ...
##  $ Total           : int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<pre class="r"><code>weather.av &lt;- weather %&gt;% group_by(., date) %&gt;% summarise(., mean.Solar = mean(Solar), mean.Wind = mean(Wind), mean.MaxWind = mean(Max), mean.Temp = mean(Air.Temperature))
metadata &lt;- right_join(weather.av, metadata, by = &quot;date&quot;)</code></pre>
<pre><code>## Warning: Column `date` joining factors with different levels, coercing to
## character vector</code></pre>
<pre class="r"><code>metadata$abun &lt;- apply(insects, 1, sum)
#check for total
sum(metadata$abun)</code></pre>
<pre><code>## [1] 3387</code></pre>
<pre class="r"><code>H &lt;- diversity(insects)
simp &lt;- diversity(insects, &quot;simpson&quot;)
S &lt;- specnumber(insects)
J &lt;- H/log(S)
metadata$H &lt;- H
metadata$Simpson &lt;- simp
metadata$Species &lt;- S
metadata$Even &lt;- J

summary(metadata)</code></pre>
<pre><code>##      date             mean.Solar       mean.Wind      mean.MaxWind   
##  Length:228         Min.   :0.5737   Min.   :3.525   Min.   : 9.238  
##  Class :character   1st Qu.:0.6663   1st Qu.:4.787   1st Qu.: 9.625  
##  Mode  :character   Median :0.7688   Median :5.175   Median :10.050  
##                     Mean   :0.7419   Mean   :5.241   Mean   :10.184  
##                     3rd Qu.:0.7987   3rd Qu.:6.025   3rd Qu.:10.512  
##                     Max.   :0.8125   Max.   :6.662   Max.   :11.537  
##                                                                      
##    mean.Temp       plant.id             species    treatment   blooming  
##  Min.   :17.16   Length:228         buckhorn:  0   open :114   post:120  
##  1st Qu.:17.40   Class :character   larrea  :228   shrub:114   pre :108  
##  Median :17.86   Mode  :character                                        
##  Mean   :18.46                                                           
##  3rd Qu.:18.56                                                           
##  Max.   :28.51                                                           
##                                                                          
##  percent.cover   perennial                            X      
##  Min.   : 1.00       :223                              :227  
##  1st Qu.: 2.00   1   :  4   blue and white knocked over:  1  
##  Median :10.00   2   :  1   east                       :  0  
##  Mean   :18.82   3   :  0   east side                  :  0  
##  3rd Qu.:30.00   east:  0   north                      :  0  
##  Max.   :80.00              yellow knocked over        :  0  
##                                                              
##     uniID                abun             H            Simpson      
##  Length:228         Min.   : 0.00   Min.   :0.000   Min.   :0.0000  
##  Class :character   1st Qu.:10.00   1st Qu.:1.233   1st Qu.:0.6239  
##  Mode  :character   Median :14.00   Median :1.699   Median :0.7769  
##                     Mean   :14.86   Mean   :1.570   Mean   :0.7034  
##                     3rd Qu.:19.00   3rd Qu.:1.991   3rd Qu.:0.8344  
##                     Max.   :55.00   Max.   :2.552   Max.   :1.0000  
##                                                                     
##     Species           Even       
##  Min.   : 0.00   Min.   :0.0000  
##  1st Qu.: 5.00   1st Qu.:0.7950  
##  Median : 7.00   Median :0.8842  
##  Mean   : 7.11   Mean   :0.8413  
##  3rd Qu.: 9.00   3rd Qu.:0.9464  
##  Max.   :16.00   Max.   :1.0000  
##                  NA&#39;s   :6</code></pre>
<pre class="r"><code>#beetle output
write.csv(metadata, &quot;Output Data/metadata_yesbeetle.csv&quot;)
write.csv(insects, &quot;Output Data/wide_yesbeetle.csv&quot;)</code></pre>
<p>Calculations for only Melyrid beetles</p>
<pre class="r"><code>##beetles only
insects &lt;- read.csv(&quot;Output Data/pantraps_wide.csv&quot;, header = TRUE)
row.names(insects) &lt;- insects$uniID
insects &lt;- dplyr::select(insects, -X, -uniID)
#filter out beetles
insects &lt;- dplyr::select(insects, Melyridae)
metadata &lt;- read.csv(&quot;Clean Data/pantraps_cov.csv&quot;, header = TRUE)
metadata &lt;- filter(metadata, species != &quot;buckhorn&quot;)
metadata$plant.id &lt;- as.character(metadata$plant.id)
str(metadata)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  8 variables:
##  $ plant.id     : chr  &quot;296&quot; &quot;296&quot; &quot;189&quot; &quot;189&quot; ...
##  $ species      : Factor w/ 2 levels &quot;buckhorn&quot;,&quot;larrea&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ blooming     : Factor w/ 2 levels &quot;post&quot;,&quot;pre&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ date         : Factor w/ 21 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  15 3 25 2 40 15 40 3 70 10 ...
##  $ perennial    : Factor w/ 5 levels &quot;&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X            : Factor w/ 6 levels &quot;&quot;,&quot;blue and white knocked over&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>metadata$uniID &lt;- paste(metadata$date, metadata$plant.id, metadata$treatment)
row.names(metadata) &lt;- metadata$uniID

#check if insects and metadata are the same
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] &quot;214 string mismatches&quot;</code></pre>
<pre class="r"><code>#sort into the same order
metadata &lt;- metadata[rownames(insects), ]
#confirm - woo!
all.equal(rownames(insects), rownames(metadata))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>#grab and wrangle weather stn data
weather &lt;- read.csv(&quot;Clean Data/pantraps_weather.csv&quot;)
str(weather)</code></pre>
<pre><code>## &#39;data.frame&#39;:    152 obs. of  12 variables:
##  $ date            : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ Hour            : Factor w/ 8 levels &quot;1:00 PM&quot;,&quot;10:00 AM&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ Solar           : num  0.81 0.79 0.8 0.81 0.81 0.8 0.63 0.82 0.84 0.76 ...
##  $ Wind            : num  3.9 4.1 5.1 4.9 4.5 3.2 3.3 4.3 4.6 4.7 ...
##  $ Max             : num  9 10.7 9.7 8.6 7.8 7.6 7.2 8.2 8.2 8.2 ...
##  $ Air.Temperature : num  15 15.6 16.9 18.5 19.8 21 21.1 20.7 20.2 18.8 ...
##  $ Soil.Temperature: num  18.9 18.8 18.7 18.8 19 19.3 19.8 20.4 21 21.5 ...
##  $ Humidity        : int  43 42 38 32 29 27 26 26 26 25 ...
##  $ Dew             : num  2.4 2.6 2.4 1.7 1.4 1.1 1.1 0.8 -0.1 -1.6 ...
##  $ Wet             : num  8.2 8.6 9.1 9.5 9.9 10.3 10.3 10 9.5 8.5 ...
##  $ Baro.           : int  873 873 873 873 872 872 872 872 871 871 ...
##  $ Total           : int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<pre class="r"><code>weather.av &lt;- weather %&gt;% group_by(., date) %&gt;% summarise(., mean.Solar = mean(Solar), mean.Wind = mean(Wind), mean.MaxWind = mean(Max), mean.Temp = mean(Air.Temperature))
metadata &lt;- right_join(weather.av, metadata, by = &quot;date&quot;)</code></pre>
<pre><code>## Warning: Column `date` joining factors with different levels, coercing to
## character vector</code></pre>
<pre class="r"><code>metadata$abun &lt;- apply(insects, 1, sum)
#check for total
sum(metadata$abun)</code></pre>
<pre><code>## [1] 1243</code></pre>
<pre class="r"><code>H &lt;- diversity(insects)
simp &lt;- diversity(insects, &quot;simpson&quot;)
S &lt;- specnumber(insects)
J &lt;- H/log(S)
metadata$H &lt;- H
metadata$Simpson &lt;- simp
metadata$Species &lt;- S
metadata$Even &lt;- J


summary(metadata)</code></pre>
<pre><code>##      date             mean.Solar       mean.Wind      mean.MaxWind   
##  Length:228         Min.   :0.5737   Min.   :3.525   Min.   : 9.238  
##  Class :character   1st Qu.:0.6663   1st Qu.:4.787   1st Qu.: 9.625  
##  Mode  :character   Median :0.7688   Median :5.175   Median :10.050  
##                     Mean   :0.7419   Mean   :5.241   Mean   :10.184  
##                     3rd Qu.:0.7987   3rd Qu.:6.025   3rd Qu.:10.512  
##                     Max.   :0.8125   Max.   :6.662   Max.   :11.537  
##    mean.Temp       plant.id             species    treatment   blooming  
##  Min.   :17.16   Length:228         buckhorn:  0   open :114   post:120  
##  1st Qu.:17.40   Class :character   larrea  :228   shrub:114   pre :108  
##  Median :17.86   Mode  :character                                        
##  Mean   :18.46                                                           
##  3rd Qu.:18.56                                                           
##  Max.   :28.51                                                           
##  percent.cover   perennial                            X      
##  Min.   : 1.00       :223                              :227  
##  1st Qu.: 2.00   1   :  4   blue and white knocked over:  1  
##  Median :10.00   2   :  1   east                       :  0  
##  Mean   :18.82   3   :  0   east side                  :  0  
##  3rd Qu.:30.00   east:  0   north                      :  0  
##  Max.   :80.00              yellow knocked over        :  0  
##     uniID                abun              H            Simpson      
##  Length:228         Min.   : 0.000   Min.   :4.908   Min.   :0.9899  
##  Class :character   1st Qu.: 1.750   1st Qu.:4.908   1st Qu.:0.9899  
##  Mode  :character   Median : 4.000   Median :4.908   Median :0.9899  
##                     Mean   : 5.452   Mean   :4.908   Mean   :0.9899  
##                     3rd Qu.: 7.000   3rd Qu.:4.908   3rd Qu.:0.9899  
##                     Max.   :46.000   Max.   :4.908   Max.   :0.9899  
##     Species            Even    
##  Min.   :0.0000   Min.   :  0  
##  1st Qu.:1.0000   1st Qu.:Inf  
##  Median :1.0000   Median :Inf  
##  Mean   :0.8553   Mean   :Inf  
##  3rd Qu.:1.0000   3rd Qu.:Inf  
##  Max.   :1.0000   Max.   :Inf</code></pre>
<pre class="r"><code>#no beetle output
write.csv(metadata, &quot;Output Data/metadata_onlybeetle.csv&quot;)
write.csv(insects, &quot;Output Data/wide_onlybeetle.csv&quot;)</code></pre>
<p>Arthropod abundance - Melyridae beetles excluded</p>
<pre class="r"><code>metadata &lt;- read.csv(&quot;Output Data/metadata_nobeetle.csv&quot;)
metadata$repID &lt;- paste(metadata$plant.id, metadata$treatment)
metadata$blooming &lt;- relevel(metadata$blooming, &quot;pre&quot;)
sum(metadata$abun)</code></pre>
<pre><code>## [1] 2144</code></pre>
<pre class="r"><code>str(metadata)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  20 variables:
##  $ X.1          : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ date         : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ mean.Solar   : num  0.762 0.762 0.762 0.762 0.762 ...
##  $ mean.Wind    : num  5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 ...
##  $ mean.MaxWind : num  9.78 9.78 9.78 9.78 9.78 ...
##  $ mean.Temp    : num  18.4 18.4 18.4 18.4 18.4 ...
##  $ plant.id     : int  184 184 189 189 192 192 194 194 275 275 ...
##  $ species      : Factor w/ 1 level &quot;larrea&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##  $ blooming     : Factor w/ 2 levels &quot;pre&quot;,&quot;post&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  10 70 2 25 15 40 3 40 2 20 ...
##  $ perennial    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ X            : Factor w/ 2 levels &quot;&quot;,&quot;blue and white knocked over&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ uniID        : Factor w/ 228 levels &quot;4.10.2017 184 open&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ abun         : int  12 14 18 16 21 30 13 11 0 27 ...
##  $ H            : num  1.31 1.22 2.43 1.75 1.72 ...
##  $ Simpson      : num  0.667 0.612 0.895 0.773 0.789 ...
##  $ Species      : int  5 5 13 8 7 12 6 6 0 10 ...
##  $ Even         : num  0.817 0.755 0.947 0.844 0.886 ...
##  $ repID        : chr  &quot;184 open&quot; &quot;184 shrub&quot; &quot;189 open&quot; &quot;189 shrub&quot; ...</code></pre>
<pre class="r"><code>ggplot(data = metadata, aes(abun)) + geom_freqpoly()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/arthropod%20abundance%20m%20excluded-1.png" width="672" /></p>
<pre class="r"><code>mean(metadata$abun)</code></pre>
<pre><code>## [1] 9.403509</code></pre>
<pre class="r"><code>sd(metadata$abun)</code></pre>
<pre><code>## [1] 5.939073</code></pre>
<pre class="r"><code>shapiro.test(metadata$abun)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  metadata$abun
## W = 0.9356, p-value = 1.843e-08</code></pre>
<pre class="r"><code>ggplot(data = metadata, aes(treatment, abun)) + geom_boxplot() + facet_grid(~blooming)</code></pre>
<p><img src="index_files/figure-html/arthropod%20abundance%20m%20excluded-2.png" width="672" /></p>
<pre class="r"><code>m1 &lt;- glmmTMB(abun ~ treatment * blooming + (1|plant.id/repID), family = &quot;nbinom2&quot;, data = metadata)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ treatment * blooming + (1 | plant.id/repID)
## Data: metadata
## 
##      AIC      BIC   logLik deviance df.resid 
##   1370.2   1394.2   -678.1   1356.2      221 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 1.043e-09 0.0000323
##  plant.id       (Intercept) 3.228e-02 0.1796624
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom2 family (): 6.04 
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                  2.26594    0.07511  30.170  &lt; 2e-16 ***
## treatmentshrub               0.41031    0.09724   4.220 2.45e-05 ***
## bloomingpost                -0.41247    0.10346  -3.987 6.70e-05 ***
## treatmentshrub:bloomingpost -0.28155    0.14107  -1.996    0.046 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#lsmeans(m1, pairwise~blooming*treatment)
car::Anova(m1, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: abun
##                       Chisq Df Pr(&gt;Chisq)    
## (Intercept)        910.2353  1  &lt; 2.2e-16 ***
## treatment           17.8043  1  2.448e-05 ***
## blooming            15.8938  1  6.700e-05 ***
## treatment:blooming   3.9833  1    0.04595 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(abun ~ treatment + blooming + (1|plant.id/repID), family = &quot;nbinom2&quot;, data = metadata)
summary(m2)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ treatment + blooming + (1 | plant.id/repID)
## Data: metadata
## 
##      AIC      BIC   logLik deviance df.resid 
##   1372.1   1392.7   -680.0   1360.1      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 1.348e-09 3.672e-05
##  plant.id       (Intercept) 2.945e-02 1.716e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom2 family (): 5.74 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.33841    0.06686   34.97  &lt; 2e-16 ***
## treatmentshrub  0.27624    0.07157    3.86 0.000114 ***
## bloomingpost   -0.55883    0.07358   -7.60 3.07e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m3 &lt;- glmmTMB(abun ~ (1|repID), family = &quot;nbinom2&quot;, data = metadata)

m4.nb1 &lt;- glmmTMB(abun ~ treatment + blooming + (1|plant.id/repID), family = &quot;nbinom1&quot;, data = metadata)

m4.nb1.int &lt;- glmmTMB(abun ~ treatment * blooming + (1|plant.id/repID), family = &quot;nbinom1&quot;, data = metadata)

anova(m1, m2, m3, m4.nb1, m4.nb1.int, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Data: metadata
## Models:
## m3: abun ~ (1 | repID), zi=~0, disp=~1
## m2: abun ~ treatment + blooming + (1 | plant.id/repID), zi=~0, disp=~1
## m4.nb1: abun ~ treatment + blooming + (1 | plant.id/repID), zi=~0, disp=~1
## m1: abun ~ treatment * blooming + (1 | plant.id/repID), zi=~0, disp=~1
## m4.nb1.int: abun ~ treatment * blooming + (1 | plant.id/repID), zi=~0, disp=~1
##            Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## m3          3 1426.5 1436.8 -710.27   1420.5                              
## m2          6 1372.1 1392.7 -680.04   1360.1 60.4553      3  4.699e-13 ***
## m4.nb1      6 1368.0 1388.6 -678.01   1356.0  4.0665      0  &lt; 2.2e-16 ***
## m1          7 1370.2 1394.2 -678.08   1356.2  0.0000      1          1    
## m4.nb1.int  7 1366.2 1390.2 -676.09   1352.2  3.9856      0  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(m1, m2, m3, m4.nb1, m4.nb1.int)</code></pre>
<pre><code>##            df      AIC
## m1          7 1370.157
## m2          6 1372.080
## m3          3 1426.535
## m4.nb1      6 1368.014
## m4.nb1.int  7 1366.172</code></pre>
<pre class="r"><code>#looks like nbinom1 (negative binomial type one, additive model)

anova(m4.nb1, m4.nb1.int)</code></pre>
<pre><code>## Data: metadata
## Models:
## m4.nb1: abun ~ treatment + blooming + (1 | plant.id/repID), zi=~0, disp=~1
## m4.nb1.int: abun ~ treatment * blooming + (1 | plant.id/repID), zi=~0, disp=~1
##            Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)  
## m4.nb1      6 1368.0 1388.6 -678.01   1356.0                           
## m4.nb1.int  7 1366.2 1390.2 -676.09   1352.2 3.8417      1    0.04999 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#additive and interactive models are not different - using simpler model

summary(m4.nb1)</code></pre>
<pre><code>##  Family: nbinom1  ( log )
## Formula:          abun ~ treatment + blooming + (1 | plant.id/repID)
## Data: metadata
## 
##      AIC      BIC   logLik deviance df.resid 
##   1368.0   1388.6   -678.0   1356.0      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 2.466e-09 4.966e-05
##  plant.id       (Intercept) 3.753e-02 1.937e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom1 family (): 1.57 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.32984    0.06398   36.42  &lt; 2e-16 ***
## treatmentshrub  0.29078    0.06862    4.24 2.26e-05 ***
## bloomingpost   -0.56474    0.07111   -7.94 2.00e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m4.nb1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: abun
##            Chisq Df Pr(&gt;Chisq)    
## treatment 17.956  1  2.261e-05 ***
## blooming  63.063  1  2.002e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<hr />
<p>Including Melyridae beetles</p>
<pre class="r"><code>beetle &lt;- read.csv(&quot;Output Data/metadata_yesbeetle.csv&quot;)
beetle$repID &lt;- paste(beetle$plant.id, beetle$treatment)
beetle$blooming &lt;- relevel(beetle$blooming, &quot;pre&quot;)
sum(beetle$abun)</code></pre>
<pre><code>## [1] 3387</code></pre>
<pre class="r"><code>str(beetle)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  20 variables:
##  $ X.1          : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ date         : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ mean.Solar   : num  0.762 0.762 0.762 0.762 0.762 ...
##  $ mean.Wind    : num  5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 ...
##  $ mean.MaxWind : num  9.78 9.78 9.78 9.78 9.78 ...
##  $ mean.Temp    : num  18.4 18.4 18.4 18.4 18.4 ...
##  $ plant.id     : int  184 184 189 189 192 192 194 194 275 275 ...
##  $ species      : Factor w/ 1 level &quot;larrea&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##  $ blooming     : Factor w/ 2 levels &quot;pre&quot;,&quot;post&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  10 70 2 25 15 40 3 40 2 20 ...
##  $ perennial    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ X            : Factor w/ 2 levels &quot;&quot;,&quot;blue and white knocked over&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ uniID        : Factor w/ 228 levels &quot;4.10.2017 184 open&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ abun         : int  18 16 20 18 22 30 20 11 0 29 ...
##  $ H            : num  1.51 1.44 2.51 1.91 1.83 ...
##  $ Simpson      : num  0.741 0.688 0.905 0.809 0.806 ...
##  $ Species      : int  6 6 14 9 8 12 7 6 0 11 ...
##  $ Even         : num  0.844 0.804 0.951 0.868 0.88 ...
##  $ repID        : chr  &quot;184 open&quot; &quot;184 shrub&quot; &quot;189 open&quot; &quot;189 shrub&quot; ...</code></pre>
<pre class="r"><code>sum(beetle$H)</code></pre>
<pre><code>## [1] 357.8503</code></pre>
<pre class="r"><code>ggplot(data = beetle, aes(abun)) + geom_freqpoly()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/melyride%20included-1.png" width="672" /></p>
<pre class="r"><code>mean(beetle$abun)</code></pre>
<pre><code>## [1] 14.85526</code></pre>
<pre class="r"><code>sd(beetle$abun)</code></pre>
<pre><code>## [1] 8.305357</code></pre>
<pre class="r"><code>m1 &lt;- glmmTMB(abun ~ blooming + treatment + (1|plant.id/repID), family = &quot;nbinom2&quot;, data = beetle)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ blooming + treatment + (1 | plant.id/repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1552.4   1572.9   -770.2   1540.4      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 1.033e-09 3.215e-05
##  plant.id       (Intercept) 5.692e-02 2.386e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom2 family (): 6.54 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.91863    0.06312   46.24  &lt; 2e-16 ***
## bloomingpost   -0.41665    0.06529   -6.38 1.75e-10 ***
## treatmentshrub -0.09334    0.06318   -1.48     0.14    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(abun ~ blooming * treatment + (1|plant.id/repID), family = &quot;nbinom2&quot;, data = beetle)
summary(m2)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ blooming * treatment + (1 | plant.id/repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1553.9   1578.0   -770.0   1539.9      221 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 1.319e-09 3.631e-05
##  plant.id       (Intercept) 5.710e-02 2.390e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom2 family (): 6.56 
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                  2.89843    0.07023   41.27  &lt; 2e-16 ***
## bloomingpost                -0.37670    0.09006   -4.18 2.88e-05 ***
## treatmentshrub              -0.05300    0.08888   -0.60    0.551    
## bloomingpost:treatmentshrub -0.08114    0.12604   -0.64    0.520    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m3 &lt;- glmmTMB(abun ~  (1|plant.id/repID),family = &quot;nbinom2&quot;,  data = beetle)
summary(m3)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ (1 | plant.id/repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1585.7   1599.4   -788.8   1577.7      224 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 1.416e-09 3.763e-05
##  plant.id       (Intercept) 3.126e-02 1.768e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom2 family (): 4.51 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  2.68143    0.04314   62.16   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m4 &lt;-  glmmTMB(abun ~ blooming + treatment + (1|plant.id/repID), family = &quot;nbinom1&quot;, data = beetle)
summary(m4)  </code></pre>
<pre><code>##  Family: nbinom1  ( log )
## Formula:          abun ~ blooming + treatment + (1 | plant.id/repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1548.6   1569.1   -768.3   1536.6      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 2.129e-09 4.614e-05
##  plant.id       (Intercept) 5.715e-02 2.391e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom1 family (): 2.23 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.90480    0.05936   48.94  &lt; 2e-16 ***
## bloomingpost   -0.40426    0.06269   -6.45 1.13e-10 ***
## treatmentshrub -0.07879    0.06071   -1.30    0.194    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(m1, m2, m3, m4)</code></pre>
<pre><code>## Data: beetle
## Models:
## m3: abun ~ (1 | plant.id/repID), zi=~0, disp=~1
## m1: abun ~ blooming + treatment + (1 | plant.id/repID), zi=~0, disp=~1
## m4: abun ~ blooming + treatment + (1 | plant.id/repID), zi=~0, disp=~1
## m2: abun ~ blooming * treatment + (1 | plant.id/repID), zi=~0, disp=~1
##    Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## m3  4 1585.7 1599.4 -788.85   1577.7                              
## m1  6 1552.4 1572.9 -770.18   1540.4 37.3360      2  7.809e-09 ***
## m4  6 1548.6 1569.2 -768.29   1536.6  3.7914      0  &lt; 2.2e-16 ***
## m2  7 1554.0 1578.0 -769.97   1540.0  0.0000      1          1    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(m1, m2, m3, m4)</code></pre>
<pre><code>##    df      AIC
## m1  6 1552.362
## m2  7 1553.948
## m3  4 1585.698
## m4  6 1548.570</code></pre>
<pre class="r"><code>#one and two are pretty much the same, going with simpler, #4 is best (nbinom1)
car::Anova(m4, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: abun
##             Chisq Df Pr(&gt;Chisq)    
## blooming  41.5820  1   1.13e-10 ***
## treatment  1.6846  1     0.1943    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<hr />
<p>Melyridae only</p>
<pre class="r"><code>onlybeetle &lt;- read.csv(&quot;Output Data/metadata_onlybeetle.csv&quot;)
onlybeetle$repID &lt;- paste(onlybeetle$plant.id, onlybeetle$treatment)
onlybeetle$blooming &lt;- relevel(onlybeetle$blooming, &quot;pre&quot;)
sum(onlybeetle$abun)</code></pre>
<pre><code>## [1] 1243</code></pre>
<pre class="r"><code>str(beetle)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  20 variables:
##  $ X.1          : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ date         : Factor w/ 19 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ mean.Solar   : num  0.762 0.762 0.762 0.762 0.762 ...
##  $ mean.Wind    : num  5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 5.15 ...
##  $ mean.MaxWind : num  9.78 9.78 9.78 9.78 9.78 ...
##  $ mean.Temp    : num  18.4 18.4 18.4 18.4 18.4 ...
##  $ plant.id     : int  184 184 189 189 192 192 194 194 275 275 ...
##  $ species      : Factor w/ 1 level &quot;larrea&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##  $ blooming     : Factor w/ 2 levels &quot;pre&quot;,&quot;post&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  10 70 2 25 15 40 3 40 2 20 ...
##  $ perennial    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ X            : Factor w/ 2 levels &quot;&quot;,&quot;blue and white knocked over&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ uniID        : Factor w/ 228 levels &quot;4.10.2017 184 open&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ abun         : int  18 16 20 18 22 30 20 11 0 29 ...
##  $ H            : num  1.51 1.44 2.51 1.91 1.83 ...
##  $ Simpson      : num  0.741 0.688 0.905 0.809 0.806 ...
##  $ Species      : int  6 6 14 9 8 12 7 6 0 11 ...
##  $ Even         : num  0.844 0.804 0.951 0.868 0.88 ...
##  $ repID        : chr  &quot;184 open&quot; &quot;184 shrub&quot; &quot;189 open&quot; &quot;189 shrub&quot; ...</code></pre>
<pre class="r"><code>ggplot(data = onlybeetle, aes(abun)) + geom_freqpoly()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/melyridae%20abundance%20only-1.png" width="672" /></p>
<pre class="r"><code>mean(onlybeetle$abun)</code></pre>
<pre><code>## [1] 5.451754</code></pre>
<pre class="r"><code>sd(onlybeetle$abun)</code></pre>
<pre><code>## [1] 6.256088</code></pre>
<pre class="r"><code>m1 &lt;- glmmTMB(abun ~ blooming * treatment + (1|plant.id/repID), family = &quot;nbinom2&quot;, data = onlybeetle)

summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ blooming * treatment + (1 | plant.id/repID)
## Data: onlybeetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1212.4   1236.4   -599.2   1198.4      221 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 1.252e-09 3.538e-05
##  plant.id       (Intercept) 2.778e-01 5.270e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom2 family (): 2.46 
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   2.0279     0.1252  16.201  &lt; 2e-16 ***
## bloomingpost                 -0.2832     0.1484  -1.908  0.05638 .  
## treatmentshrub               -1.1868     0.1619  -7.331 2.28e-13 ***
## bloomingpost:treatmentshrub   0.6167     0.2205   2.796  0.00517 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(abun ~ blooming + treatment + (1|plant.id/repID), family = &quot;nbinom2&quot;, data = onlybeetle)

m3 &lt;- glmmTMB(abun ~ (1|plant.id/repID), family = &quot;nbinom2&quot;,data = onlybeetle)


AIC(m1, m2, m3)</code></pre>
<pre><code>##    df      AIC
## m1  7 1212.381
## m2  6 1218.034
## m3  4 1263.877</code></pre>
<pre class="r"><code>anova(m1, m2, m3)</code></pre>
<pre><code>## Data: onlybeetle
## Models:
## m3: abun ~ (1 | plant.id/repID), zi=~0, disp=~1
## m2: abun ~ blooming + treatment + (1 | plant.id/repID), zi=~0, disp=~1
## m1: abun ~ blooming * treatment + (1 | plant.id/repID), zi=~0, disp=~1
##    Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## m3  4 1263.9 1277.6 -627.94   1255.9                              
## m2  6 1218.0 1238.6 -603.02   1206.0 49.8430      2  1.502e-11 ***
## m1  7 1212.4 1236.4 -599.19   1198.4  7.6528      1   0.005668 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ blooming * treatment + (1 | plant.id/repID)
## Data: onlybeetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1212.4   1236.4   -599.2   1198.4      221 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 1.252e-09 3.538e-05
##  plant.id       (Intercept) 2.778e-01 5.270e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom2 family (): 2.46 
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   2.0279     0.1252  16.201  &lt; 2e-16 ***
## bloomingpost                 -0.2832     0.1484  -1.908  0.05638 .  
## treatmentshrub               -1.1868     0.1619  -7.331 2.28e-13 ***
## bloomingpost:treatmentshrub   0.6167     0.2205   2.796  0.00517 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type = 3)</code></pre>
<pre><code>## Analysis of Deviance Table (Type III Wald chisquare tests)
## 
## Response: abun
##                       Chisq Df Pr(&gt;Chisq)    
## (Intercept)        262.4703  1  &lt; 2.2e-16 ***
## blooming             3.6408  1   0.056381 .  
## treatment           53.7478  1  2.279e-13 ***
## blooming:treatment   7.8186  1   0.005171 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>lsmeans(m1, pairwise~blooming*treatment)</code></pre>
<pre><code>## $lsmeans
##  blooming treatment lsmean    SE  df lower.CL upper.CL
##  pre      open       2.028 0.125 221    1.781     2.27
##  post     open       1.745 0.123 221    1.502     1.99
##  pre      shrub      0.841 0.145 221    0.555     1.13
##  post     shrub      1.175 0.132 221    0.915     1.43
## 
## Results are given on the log (not the response) scale. 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast               estimate    SE  df t.ratio p.value
##  pre,open - post,open      0.283 0.148 221  1.908  0.2276 
##  pre,open - pre,shrub      1.187 0.162 221  7.331  &lt;.0001 
##  pre,open - post,shrub     0.853 0.153 221  5.560  &lt;.0001 
##  post,open - pre,shrub     0.904 0.165 221  5.487  &lt;.0001 
##  post,open - post,shrub    0.570 0.150 221  3.806  0.0010 
##  pre,shrub - post,shrub   -0.333 0.169 221 -1.971  0.2023 
## 
## Results are given on the log (not the response) scale. 
## P value adjustment: tukey method for comparing a family of 4 estimates</code></pre>
<pre class="r"><code>ggplot(metadata, aes(blooming, abun)) + geom_boxplot() + facet_grid(~treatment)</code></pre>
<p><img src="index_files/figure-html/melyridae%20abundance%20only-2.png" width="672" /></p>
<hr />
<p>Arthropod Richness</p>
<pre class="r"><code>s1 &lt;- glmmTMB(Species ~ blooming + treatment + (1|plant.id/repID), family = poisson, data = beetle)
summary(s1)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          Species ~ blooming + treatment + (1 | plant.id/repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1134.1   1151.2   -562.1   1124.1      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 4.008e-10 2.002e-05
##  plant.id       (Intercept) 3.307e-02 1.819e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.00699    0.04960   40.47  &lt; 2e-16 ***
## bloomingpost   -0.26543    0.05105   -5.20 1.99e-07 ***
## treatmentshrub  0.14709    0.04981    2.95  0.00315 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>s1.nb &lt;- glmmTMB(Species ~ blooming + treatment + (1|plant.id/repID), family = &quot;nbinom1&quot;, data = beetle)</code></pre>
<pre><code>## Warning in fitTMB(TMBStruc): Model convergence problem; non-positive-definite
## Hessian matrix. See vignette(&#39;troubleshooting&#39;)</code></pre>
<pre class="r"><code>summary(s1.nb)</code></pre>
<pre><code>##  Family: nbinom1  ( log )
## Formula:          Species ~ blooming + treatment + (1 | plant.id/repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##       NA       NA       NA       NA      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 1.471e-14 1.213e-07
##  plant.id       (Intercept) 3.307e-02 1.819e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom1 family (): 3.13e-10 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     2.00699    0.04959   40.47  &lt; 2e-16 ***
## bloomingpost   -0.26543    0.05112   -5.19 2.07e-07 ***
## treatmentshrub  0.14709    0.04984    2.95  0.00316 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>s2 &lt;- glmmTMB(Species ~ blooming * treatment + (1|plant.id/repID), family = poisson, data = beetle)
summary(s2)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          Species ~ blooming * treatment + (1 | plant.id/repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1134.6   1155.2   -561.3   1122.6      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 4.744e-10 2.178e-05
##  plant.id       (Intercept) 3.307e-02 1.819e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Conditional model:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                  1.97633    0.05619   35.17  &lt; 2e-16 ***
## bloomingpost                -0.20058    0.07389   -2.71  0.00664 ** 
## treatmentshrub               0.20346    0.06824    2.98  0.00287 ** 
## bloomingpost:treatmentshrub -0.12108    0.09989   -1.21  0.22544    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>s3 &lt;- glmmTMB(Species ~ (1|plant.id/repID), family = poisson, data = beetle)
summary(s3)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          Species ~ (1 | plant.id/repID)
## Data: beetle
## 
##      AIC      BIC   logLik deviance df.resid 
##   1166.1   1176.4   -580.1   1160.1      225 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 1.189e-09 3.448e-05
##  plant.id       (Intercept) 2.823e-02 1.680e-01
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.95076    0.03314   58.86   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>AIC(s1, s1.nb, s2, s3)</code></pre>
<pre><code>##       df      AIC
## s1     5 1134.100
## s1.nb  6       NA
## s2     6 1134.631
## s3     3 1166.136</code></pre>
<pre class="r"><code>#poisson best here
anova(s1,s2, s3)</code></pre>
<pre><code>## Data: beetle
## Models:
## s3: Species ~ (1 | plant.id/repID), zi=~0, disp=~1
## s1: Species ~ blooming + treatment + (1 | plant.id/repID), zi=~0, disp=~1
## s2: Species ~ blooming * treatment + (1 | plant.id/repID), zi=~0, disp=~1
##    Df    AIC    BIC  logLik deviance   Chisq Chi Df Pr(&gt;Chisq)    
## s3  3 1166.1 1176.4 -580.07   1160.1                              
## s1  5 1134.1 1151.2 -562.05   1124.1 36.0356      2  1.496e-08 ***
## s2  6 1134.6 1155.2 -561.32   1122.6  1.4698      1     0.2254    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(s1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: Species
##             Chisq Df Pr(&gt;Chisq)    
## blooming  27.0387  1  1.994e-07 ***
## treatment  8.7202  1   0.003147 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>ggplot(beetle, aes(blooming, Species)) + geom_boxplot() + facet_grid(~treatment)</code></pre>
<p><img src="index_files/figure-html/arthropod%20richness-1.png" width="672" /></p>
<pre class="r"><code>ggplot(beetle, aes(treatment, Species)) + geom_boxplot() + facet_grid(~blooming)</code></pre>
<p><img src="index_files/figure-html/arthropod%20richness-2.png" width="672" /></p>
<pre class="r"><code>#species accumulation
insects &lt;- read.csv(&quot;Output Data/wide_yesbeetle.csv&quot;)
row.names(insects) &lt;- insects$X
insects &lt;- select(insects, -X)
plot(specaccum(insects), xlab = &quot;# of samples&quot;, ylab = &quot;# of species&quot;)</code></pre>
<p><img src="index_files/figure-html/species%20accumulation-1.png" width="672" /></p>
<pre class="r"><code>insects &lt;- read.csv(&quot;Output Data/wide_yesbeetle.csv&quot;)
bees &lt;- select(insects, 5:7,12,14,16,36,37,42,43,49,50,61,64,65,67,72,73,75,87,92,96)


metadata &lt;- read.csv(&quot;Clean Data/pantraps_cov.csv&quot;, header = TRUE)
metadata &lt;- filter(metadata, species != &quot;buckhorn&quot;)
metadata$plant.id &lt;- as.character(metadata$plant.id)
str(metadata)</code></pre>
<pre><code>## &#39;data.frame&#39;:    228 obs. of  8 variables:
##  $ plant.id     : chr  &quot;296&quot; &quot;296&quot; &quot;189&quot; &quot;189&quot; ...
##  $ species      : Factor w/ 2 levels &quot;buckhorn&quot;,&quot;larrea&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ treatment    : Factor w/ 2 levels &quot;open&quot;,&quot;shrub&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ blooming     : Factor w/ 2 levels &quot;post&quot;,&quot;pre&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ date         : Factor w/ 21 levels &quot;4.10.2017&quot;,&quot;4.11.2017&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ percent.cover: int  15 3 25 2 40 15 40 3 70 10 ...
##  $ perennial    : Factor w/ 5 levels &quot;&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ X            : Factor w/ 6 levels &quot;&quot;,&quot;blue and white knocked over&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>metadata$uniID &lt;- paste(metadata$date, metadata$plant.id, metadata$treatment)
row.names(metadata) &lt;- metadata$uniID


beemeta &lt;- metadata

beemeta$abun &lt;- apply(bees, 1, sum)
#check for total
sum(beemeta$abun)</code></pre>
<pre><code>## [1] 144</code></pre>
<pre class="r"><code>H &lt;- diversity(bees)
simp &lt;- diversity(bees, &quot;simpson&quot;)
S &lt;- specnumber(bees)
J &lt;- H/log(S)
beemeta$H &lt;- H
beemeta$Simpson &lt;- simp
beemeta$Species &lt;- S
beemeta$Even &lt;- J


t.test(beemeta$Species ~ beemeta$blooming)</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  beemeta$Species by beemeta$blooming
## t = 0.30599, df = 224.71, p-value = 0.7599
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.1662234  0.2273345
## sample estimates:
## mean in group post  mean in group pre 
##          0.5583333          0.5277778</code></pre>
<pre class="r"><code>beemeta$repID &lt;- paste(beemeta$plant.id, beemeta$treatment)
library(glmmTMB)
m1 &lt;- glmmTMB(Species ~ treatment + blooming + (1|plant.id/repID), family = &quot;nbinom2&quot;, beemeta)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          Species ~ treatment + blooming + (1 | plant.id/repID)
## Data: beemeta
## 
##      AIC      BIC   logLik deviance df.resid 
##    456.3    476.9   -222.2    444.3      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 1.415e-08 1.190e-04
##  plant.id       (Intercept) 6.523e-09 8.076e-05
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom2 family (): 15.7 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -0.55101    0.15266  -3.609 0.000307 ***
## treatmentshrub -0.06457    0.18278  -0.353 0.723867    
## bloomingpre    -0.05632    0.18327  -0.307 0.758605    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: Species
##            Chisq Df Pr(&gt;Chisq)
## treatment 0.1248  1     0.7239
## blooming  0.0944  1     0.7586</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(Species ~ treatment + blooming + (1|plant.id/repID), family = &quot;poisson&quot;, beemeta)

summary(m2)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          Species ~ treatment + blooming + (1 | plant.id/repID)
## Data: beemeta
## 
##      AIC      BIC   logLik deviance df.resid 
##    454.4    471.6   -222.2    444.4      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance Std.Dev.
##  repID:plant.id (Intercept) 0.027506 0.16585 
##  plant.id       (Intercept) 0.003259 0.05709 
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -0.56642    0.17177  -3.298 0.000975 ***
## treatmentshrub -0.06445    0.18227  -0.354 0.723650    
## bloomingpre    -0.05502    0.18053  -0.305 0.760554    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m3 &lt;- glmmTMB(Species ~ treatment * blooming + (1|plant.id/repID), family = &quot;poisson&quot;, beemeta)

null &lt;- glmmTMB(Species ~  (1|plant.id/repID), family = &quot;poisson&quot;, beemeta)

#poisson is best
AIC(m1, m2, m3, null)</code></pre>
<pre><code>##      df      AIC
## m1    6 456.3296
## m2    5 454.4282
## m3    6 456.3870
## null  3 450.6457</code></pre>
<pre class="r"><code>#null model has lowest AIC
car::Anova(m2, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: Species
##            Chisq Df Pr(&gt;Chisq)
## treatment 0.1250  1     0.7236
## blooming  0.0929  1     0.7606</code></pre>
<pre class="r"><code>#bee abundance

m1 &lt;- glmmTMB(abun ~ treatment + blooming + (1|plant.id/repID), family = &quot;nbinom2&quot;, beemeta)
summary(m1)</code></pre>
<pre><code>##  Family: nbinom2  ( log )
## Formula:          abun ~ treatment + blooming + (1 | plant.id/repID)
## Data: beemeta
## 
##      AIC      BIC   logLik deviance df.resid 
##    505.7    526.3   -246.9    493.7      222 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance  Std.Dev. 
##  repID:plant.id (Intercept) 5.291e-09 7.274e-05
##  plant.id       (Intercept) 5.255e-03 7.249e-02
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Overdispersion parameter for nbinom2 family (): 1.86 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)    -0.47282    0.17801  -2.656   0.0079 **
## treatmentshrub -0.05412    0.19352  -0.280   0.7797   
## bloomingpre     0.07755    0.19354   0.401   0.6886   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: abun
##            Chisq Df Pr(&gt;Chisq)
## treatment 0.0782  1     0.7797
## blooming  0.1606  1     0.6886</code></pre>
<pre class="r"><code>m2 &lt;- glmmTMB(abun ~ treatment + blooming + (1|plant.id/repID), family = &quot;poisson&quot;, beemeta)

summary(m2)</code></pre>
<pre><code>##  Family: poisson  ( log )
## Formula:          abun ~ treatment + blooming + (1 | plant.id/repID)
## Data: beemeta
## 
##      AIC      BIC   logLik deviance df.resid 
##    508.1    525.3   -249.1    498.1      223 
## 
## Random effects:
## 
## Conditional model:
##  Groups         Name        Variance Std.Dev.
##  repID:plant.id (Intercept) 0.20189  0.4493  
##  plant.id       (Intercept) 0.05032  0.2243  
## Number of obs: 228, groups:  repID:plant.id, 126; plant.id, 63
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -0.60572    0.17468  -3.468 0.000525 ***
## treatmentshrub -0.03797    0.18856  -0.201 0.840403    
## bloomingpre     0.09369    0.16868   0.555 0.578605    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m3 &lt;- glmmTMB(abun ~ treatment * blooming + (1|plant.id/repID), family = &quot;poisson&quot;, beemeta)

null &lt;- glmmTMB(abun ~  (1|plant.id/repID), family = &quot;poisson&quot;, beemeta)

#poisson is best
AIC(m1, m2, m3, null)</code></pre>
<pre><code>##      df      AIC
## m1    6 505.7089
## m2    5 508.1479
## m3    6 509.9581
## null  3 504.4983</code></pre>
<pre class="r"><code>#null model has lowest AIC
car::Anova(m2, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: abun
##            Chisq Df Pr(&gt;Chisq)
## treatment 0.0406  1     0.8404
## blooming  0.3085  1     0.5786</code></pre>
<p>###Visitation to L. tridentata In-situ observation of visitation to L. tridentata, to determine which pollinators were visiting and if visitation was related to flower number and/or height</p>
<pre class="r"><code>larrea &lt;- read.csv(&quot;Clean Data/larreavisits.csv&quot;)
cov &lt;- read.csv(&quot;Clean Data/insitu_cov_larrea.csv&quot;)
sizes &lt;- read.csv(&quot;Clean Data/video_larreadimensions.csv&quot;)
cov &lt;- distinct(cov)
cov &lt;- select(cov, -date)
cov$repID &lt;- paste(cov$plant.id, &quot;post&quot;)

larrea$repID &lt;- paste(larrea$PlantID, larrea$pre.post)
cov &lt;- inner_join(cov, sizes, by = &quot;plant.id&quot;)</code></pre>
<pre><code>## Warning: Column `plant.id` joining factors with different levels, coercing to
## character vector</code></pre>
<pre class="r"><code>cov &lt;- select(cov, -plant.id)
larrea &lt;- left_join(larrea, cov, by = &quot;repID&quot;)

#N.FLOWER is only applicable to post. it was just easier to join this way!

count(larrea, pre.post)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   pre.post     n
##   &lt;fct&gt;    &lt;int&gt;
## 1 post       401
## 2 pre        138</code></pre>
<pre class="r"><code>#how does floral visitation relate to #flowers
fl &lt;- filter(larrea, part.used == &quot;flower&quot;)
fl.count &lt;- fl %&gt;% count(repID)

lar.all &lt;- left_join(cov, fl.count, by = &quot;repID&quot;)

#there are 58 because of the wind 

#attach neighbour density
pans &lt;- read.csv(&quot;Output Data/metadata_yesbeetle.csv&quot;)
pans$repID &lt;- paste(pans$plant.id, pans$blooming)
pans &lt;- filter(pans, blooming == &quot;post&quot; &amp; treatment == &quot;shrub&quot;)
lar.all &lt;- left_join(lar.all, pans, by = &quot;repID&quot;)

lar.all$n[is.na(lar.all$n)] &lt;- 0

#join video covariates
vid.cov &lt;- read.csv(&quot;Clean Data/video_cov.csv&quot;)
vid.cov$flowering &lt;- gsub(&quot;bloom&quot;, &quot;post&quot;, vid.cov$flowering)
vid.cov$repID &lt;- paste(vid.cov$PlantID, vid.cov$flowering)
lar.all &lt;- vid.cov %&gt;% filter(flowering == &quot;post&quot; &amp; treatment == &quot;shrub&quot;) %&gt;% left_join(lar.all, vid.cov, by = &quot;repID&quot;)

ggplot(lar.all, aes(n)) + geom_density()</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_density).</code></pre>
<p><img src="index_files/figure-html/larrea%20visitation-1.png" width="672" /></p>
<pre class="r"><code>visitors &lt;- fl %&gt;% group_by(., pre.post, part.used) %&gt;% count(., v.species)
sum(visitors$n)</code></pre>
<pre><code>## [1] 197</code></pre>
<pre class="r"><code>#modelling
cov &lt;- left_join(cov, fl.count, by = &quot;repID&quot;)
cov$n[is.na(cov$n)] &lt;- 0

m1 &lt;- glm(data = cov, family = &quot;quasipoisson&quot;(link=&quot;log&quot;), n ~ n.flowers)

summary(m1)</code></pre>
<pre><code>## 
## Call:
## glm(formula = n ~ n.flowers, family = quasipoisson(link = &quot;log&quot;), 
##     data = cov)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.6742  -1.5054  -0.4227   0.8007   5.2371  
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept) 0.7820540  0.2417340   3.235  0.00204 **
## n.flowers   0.0013408  0.0005728   2.341  0.02283 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 3.367143)
## 
##     Null deviance: 198.46  on 57  degrees of freedom
## Residual deviance: 182.84  on 56  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>car::Anova(m1)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: n
##           LR Chisq Df Pr(&gt;Chisq)  
## n.flowers   4.6383  1    0.03127 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>m2 &lt;- glm(data = cov, family = &quot;quasipoisson&quot;(link=&quot;log&quot;), n ~ n.flowers + height)
m3 &lt;- glm(data = cov, family = &quot;quasipoisson&quot;(link=&quot;log&quot;), n ~ height)

summary(m2)</code></pre>
<pre><code>## 
## Call:
## glm(formula = n ~ n.flowers + height, family = quasipoisson(link = &quot;log&quot;), 
##     data = cov)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.8819  -1.5538  -0.3812   1.0401   4.7540  
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept) -8.865e-05  6.637e-01   0.000   0.9999  
## n.flowers    1.069e-03  6.084e-04   1.756   0.0847 .
## height       4.010e-03  3.087e-03   1.299   0.1995  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 3.265603)
## 
##     Null deviance: 197.77  on 56  degrees of freedom
## Residual deviance: 177.29  on 54  degrees of freedom
##   (1 observation deleted due to missingness)
## AIC: NA
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>summary(m3)</code></pre>
<pre><code>## 
## Call:
## glm(formula = n ~ height, family = quasipoisson(link = &quot;log&quot;), 
##     data = cov)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.1211  -1.6240  -0.5905   1.1983   4.6031  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept) 0.044102   0.638327   0.069    0.945  
## height      0.005400   0.002824   1.913    0.061 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 3.209795)
## 
##     Null deviance: 197.77  on 56  degrees of freedom
## Residual deviance: 186.19  on 55  degrees of freedom
##   (1 observation deleted due to missingness)
## AIC: NA
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>car::Anova(m3, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: n
##        LR Chisq Df Pr(&gt;Chisq)  
## height   3.6066  1    0.05755 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>ggplot(cov, aes(n.flowers, n)) + geom_point(shape = 1) + geom_smooth(color = &quot;black&quot;, size = 0.5) + theme_Publication() + xlab(&quot;Floral abundance&quot;) + ylab(&quot;Visits per 15 min&quot;)</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="index_files/figure-html/larrea%20visitation-2.png" width="672" /></p>
<pre class="r"><code>#cor.test(repcounts.all$n.flowers, repcounts.all$width)
cor.test(lar.all$n.flowers, lar.all$height)</code></pre>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  lar.all$n.flowers and lar.all$height
## t = 2.6659, df = 56, p-value = 0.01002
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.08463171 0.54651435
## sample estimates:
##       cor 
## 0.3355914</code></pre>
<pre class="r"><code>#cor.test(repcounts.all$width, repcounts.all$height)

mean(lar.all$height)</code></pre>
<pre><code>## [1] NA</code></pre>
<hr />
</div>
</div>
</div>
<div id="abiotic-effects" class="section level1">
<h1>Abiotic effects</h1>
<p>16 data loggers were placed in shrub/open microsites (8 and 8).</p>
<pre class="r"><code>setwd(&quot;Clean Data/loggers&quot;)
temp &lt;- list.files(pattern=&quot;*.csv&quot;)
name &lt;- list.files(pattern=&quot;*.csv&quot;)
datalist &lt;- list()
for (i in 1:length(temp)) {
  ob &lt;- read.csv(temp[i], header = FALSE)    #read in csv
  ob &lt;- ob[-1,] #delete weird first row
  #colnames(ob) &lt;- as.character(unlist(ob[1,]))
  ob &lt;- ob[-1,]

  ob$loggername &lt;- name[i]
  datalist[[i]] &lt;- ob
}

allLoggers &lt;- bind_rows(datalist)
colnames(allLoggers) &lt;- c(&quot;1&quot;, &quot;date.time&quot;, &quot;temp&quot;, &quot;light.intensity&quot;, &quot;coupler.detached&quot;, &quot;coupler.attached&quot;, &quot;host.connected&quot;, &quot;stopped&quot;, &quot;logger.name&quot;, &quot;end.of.file&quot;, &quot;empty col&quot;)

#now for some wrangling
# split day and time column

 
allLoggers &lt;- dplyr::select(allLoggers, -11)  
allLoggers &lt;- separate(allLoggers, date.time, c(&quot;Date&quot;, &quot;time&quot;), sep = 9) %&gt;% dplyr::select(-1) %&gt;% separate(&quot;logger.name&quot;, c(&quot;plant.id&quot;, &quot;treatment&quot;, sep = &quot;-&quot;)) %&gt;% dplyr::select(Date:light.intensity, plant.id:treatment) %&gt;% separate(plant.id, c(&quot;species&quot;, &quot;id&quot;), sep = 1)

#delete rows from first days and last days
#delete rows from last day

allLoggers$Date &lt;- gsub(&quot; &quot;,&quot;&quot;, allLoggers$Date)
allLoggers &lt;- filter(allLoggers, Date != &quot;05/11/17&quot; &amp; Date != &quot;03/17/17&quot; &amp; Date != &quot;03/18/17&quot;) 
allLoggers &lt;- filter(allLoggers, Date != &quot;&quot;) 
                     
#convert time from 12 to 24 hours
allLoggers$time &lt;- format(strptime(allLoggers$time, &quot;%I:%M:%S %p&quot;), format=&quot;%H:%M:%S&quot;)

allLoggers$hour &lt;- substr(allLoggers$time,1,2)
allLoggers$temp &lt;- as.numeric(allLoggers$temp)
#EDA

str(allLoggers)</code></pre>
<pre><code>## &#39;data.frame&#39;:    81408 obs. of  8 variables:
##  $ Date           : chr  &quot;03/19/17&quot; &quot;03/19/17&quot; &quot;03/19/17&quot; &quot;03/19/17&quot; ...
##  $ time           : chr  &quot;00:00:00&quot; &quot;00:30:00&quot; &quot;01:00:00&quot; &quot;01:30:00&quot; ...
##  $ temp           : num  52.6 53.1 47.4 45.3 44.6 ...
##  $ light.intensity: chr  &quot;0.0&quot; &quot;0.0&quot; &quot;0.0&quot; &quot;0.0&quot; ...
##  $ species        : chr  &quot;B&quot; &quot;B&quot; &quot;B&quot; &quot;B&quot; ...
##  $ id             : chr  &quot;253&quot; &quot;253&quot; &quot;253&quot; &quot;253&quot; ...
##  $ treatment      : chr  &quot;Open&quot; &quot;Open&quot; &quot;Open&quot; &quot;Open&quot; ...
##  $ hour           : chr  &quot;00&quot; &quot;00&quot; &quot;01&quot; &quot;01&quot; ...</code></pre>
<pre class="r"><code>#larrea only

larrea &lt;- filter(allLoggers, species == &quot;L&quot;)
dailymax &lt;- larrea %&gt;% group_by(treatment, Date, id) %&gt;% summarise(maxTemp = max(temp))
ggplot(data = dailymax, aes(Date, maxTemp, color = treatment)) + geom_point() </code></pre>
<p><img src="index_files/figure-html/data%20loggers-1.png" width="672" /></p>
<pre class="r"><code>dailymin &lt;- larrea %&gt;% group_by(treatment, Date, id) %&gt;% summarise(minTemp = min(temp))
ggplot(data = dailymin, aes(Date, minTemp, color = treatment)) + geom_point() </code></pre>
<p><img src="index_files/figure-html/data%20loggers-2.png" width="672" /></p>
<pre class="r"><code>larrea$temp &lt;- as.numeric(larrea$temp)
larrea$hour &lt;- as.numeric(larrea$hour)
daytime &lt;- filter(larrea, hour &gt;= 9 &amp; hour&lt;21)
daytime &lt;- na.omit(daytime)
nighttime &lt;- filter(larrea, hour &gt;=21 | hour&lt;9)
nighttime &lt;-na.omit(nighttime)
all &lt;- larrea %&gt;% group_by(treatment, Date, id) %&gt;% summarise(meanTemp = mean(temp), varTemp = sd(temp))


meanday &lt;- daytime %&gt;% group_by(treatment, Date, id) %&gt;% summarise(meanTemp = mean(temp), varTemp = sd(temp))

meannight&lt;- nighttime %&gt;% group_by(treatment, Date, id) %&gt;% summarise(meanTemp = mean(temp), varTemp = sd(temp))

str(larrea)</code></pre>
<pre><code>## &#39;data.frame&#39;:    40704 obs. of  8 variables:
##  $ Date           : chr  &quot;03/19/17&quot; &quot;03/19/17&quot; &quot;03/19/17&quot; &quot;03/19/17&quot; ...
##  $ time           : chr  &quot;00:27:13&quot; &quot;00:57:13&quot; &quot;01:27:13&quot; &quot;01:57:13&quot; ...
##  $ temp           : num  46.9 44.4 42.7 42.4 41.4 ...
##  $ light.intensity: chr  &quot;0.0&quot; &quot;0.0&quot; &quot;0.0&quot; &quot;0.0&quot; ...
##  $ species        : chr  &quot;L&quot; &quot;L&quot; &quot;L&quot; &quot;L&quot; ...
##  $ id             : chr  &quot;104&quot; &quot;104&quot; &quot;104&quot; &quot;104&quot; ...
##  $ treatment      : chr  &quot;Open&quot; &quot;Open&quot; &quot;Open&quot; &quot;Open&quot; ...
##  $ hour           : num  0 0 1 1 2 2 3 3 4 4 ...</code></pre>
<pre class="r"><code>larrea$hour &lt;- as.factor(larrea$hour)

#figure for all
ggplot(data = larrea, aes(hour, ((temp-32)*0.5556))) + geom_boxplot(aes(fill = treatment)) + theme_Publication() + xlab(&quot;Hour&quot;) + ylab(&quot;Temperature in °C&quot;) + scale_fill_manual(values=c(&quot;#AF955A&quot;, &quot;darkgreen&quot;), name = &quot;Microsite&quot;)</code></pre>
<p><img src="index_files/figure-html/data%20loggers-3.png" width="672" /></p>
<pre class="r"><code>meannight$treatment &lt;- as.factor(meannight$treatment)
kruskal.test(meannight$meanTemp ~ meannight$treatment)</code></pre>
<pre><code>## 
##  Kruskal-Wallis rank sum test
## 
## data:  meannight$meanTemp by meannight$treatment
## Kruskal-Wallis chi-squared = 48.314, df = 1, p-value = 3.631e-12</code></pre>
<pre class="r"><code>ggplot(meannight, aes(meanTemp, fill = treatment)) + geom_density()       </code></pre>
<p><img src="index_files/figure-html/data%20loggers-4.png" width="672" /></p>
<pre class="r"><code>#mean nightime temps
meannight$id &lt;- as.factor(meannight$id)
m1 &lt;- glmmTMB(meanTemp ~ treatment + (1|id), family = Gamma(link = &quot;log&quot;), data = meannight)
shapiro.test(resid(m1))</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  resid(m1)
## W = 0.98423, p-value = 6.447e-08</code></pre>
<pre class="r"><code>summary(m1)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          meanTemp ~ treatment + (1 | id)
## Data: meannight
## 
##      AIC      BIC   logLik deviance df.resid 
##   5635.6   5654.5  -2813.8   5627.6      844 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  id     (Intercept) 0.001156 0.034   
## Number of obs: 848, groups:  id, 8
## 
## Dispersion estimate for Gamma family (sigma^2): 0.0149 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    3.968319   0.013402  296.09  &lt; 2e-16 ***
## treatmentShrub 0.059057   0.008383    7.05 1.85e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m1, type =2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: meanTemp
##            Chisq Df Pr(&gt;Chisq)    
## treatment 49.635  1  1.852e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#mean daytime temps
m2 &lt;- glmmTMB(meanTemp ~ treatment + (1|id), family = Gamma(link = &quot;log&quot;), data = meanday)
summary(m2)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          meanTemp ~ treatment + (1 | id)
## Data: meanday
## 
##      AIC      BIC   logLik deviance df.resid 
##   6235.0   6253.9  -3113.5   6227.0      844 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance  Std.Dev.
##  id     (Intercept) 0.0003273 0.01809 
## Number of obs: 848, groups:  id, 8
## 
## Dispersion estimate for Gamma family (sigma^2): 0.0104 
## 
## Conditional model:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     4.563877   0.008092   564.0   &lt;2e-16 ***
## treatmentShrub -0.064621   0.007011    -9.2   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m2, type =2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: meanTemp
##            Chisq Df Pr(&gt;Chisq)    
## treatment 84.959  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>meanAll &lt;- rbind(meanday, meannight)

#overal temperature variation
m3 &lt;- glmmTMB(varTemp ~ treatment + (1|id), family = Gamma(link = &quot;log&quot;), data = all)
summary(m3)</code></pre>
<pre><code>##  Family: Gamma  ( log )
## Formula:          varTemp ~ treatment + (1 | id)
## Data: all
## 
##      AIC      BIC   logLik deviance df.resid 
##   5063.6   5082.6  -2527.8   5055.6      844 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  id     (Intercept) 0.003514 0.05927 
## Number of obs: 848, groups:  id, 8
## 
## Dispersion estimate for Gamma family (sigma^2): 0.0317 
## 
## Conditional model:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     3.42565    0.02268   151.1   &lt;2e-16 ***
## treatmentShrub -0.27953    0.01226   -22.8   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>car::Anova(m3, type = 2)</code></pre>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: varTemp
##           Chisq Df Pr(&gt;Chisq)    
## treatment 519.9  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="rii" class="section level1">
<h1>RII</h1>
<p>This code bootstraps 95% confidence intervals. Adapted from code written by Dr. Alex Filazzola <a href="https://github.com/afilazzola/CommEcolFunctions" class="uri">https://github.com/afilazzola/CommEcolFunctions</a></p>
<pre class="r"><code>rii.m &lt;- function(x, j, var)
{
  #parse out shrub and open
  s1 &lt;- subset(x, treatment == &quot;shrub&quot;, select=var)
  o1 &lt;- subset(x, treatment == &quot;open&quot;, select=var)
  return1 &lt;- (s1 - o1) / (s1+o1)  # Rii formula
  # attach factors
  x1 &lt;- x[seq(1, nrow(x), by = 2),]
  return2 &lt;- cbind(x1[j], return1)
  return2[is.na(return2)] &lt;- 0
  print(return2)
}

rii.b &lt;- function(x, j, var)
{
  #parse out shrub and open
  s1 &lt;- subset(x, flowering == &quot;bloom&quot;, select=var)
  o1 &lt;- subset(x, flowering == &quot;pre&quot;, select=var)
  return1 &lt;- (s1 - o1) / (s1+o1)  # Rii formula
  # attach factors
  x1 &lt;- x[seq(1, nrow(x), by = 2),]
  return2 &lt;- cbind(x1[j], return1)
  return2[is.na(return2)] &lt;- 0
  print(return2)
}
bootmean &lt;- function(d, i) mean(d[i])

byrep &lt;- read.csv(&quot;Output Data/byrep_cleaned.csv&quot;)
metadata &lt;- read.csv(&quot;Output Data/metadata_nobeetle.csv&quot;)
yesbeetle &lt;- read.csv(&quot;Output Data/metadata_yesbeetle.csv&quot;)
pre &lt;- filter(byrep, flowering == &quot;pre&quot;)
pre &lt;- dplyr::select(pre, Date, mean.Solar, mean.Wind, mean.Temp, PlantID, treatment, flowering, understory.richness, visits.per.hour, flowers.per.hour)

#split into 2 dataframes, rename the visitation columns and then rbind
#need to match up microsites
#there are 2 unmatched reps
pre &lt;- arrange(pre, PlantID)
pre &lt;- filter(pre, PlantID != 266 &amp; PlantID != 275 &amp; PlantID != 276 &amp; PlantID != 196)

post &lt;- filter(byrep, flowering ==&quot;bloom&quot;)
post &lt;- dplyr::select(post, Date, mean.Solar, mean.Wind, mean.Temp, PlantID, treatment, flowering, understory.richness, visits.per.hour, flowers.per.hour)
post &lt;- arrange(post, PlantID)
post &lt;- filter(post, PlantID != 198)
post &lt;- distinct(post)

pre.visits &lt;- rii.m(pre, c(1:7), 8:10)</code></pre>
<pre><code>##          Date mean.Solar mean.Wind mean.Temp PlantID treatment flowering
## 1   4.20.2017  0.7987500  6.125000  17.86250     104      open       pre
## 3   4.19.2017  0.7762500  6.025000  17.90000     114      open       pre
## 5   4.10.2017  0.7625000  5.150000  18.35000     146      open       pre
## 7   4.13.2017  0.7600000  6.112500  18.56250     180      open       pre
## 9   4.19.2017  0.7762500  6.025000  17.90000     181      open       pre
## 11  4.16.2017  0.7387500  5.175000  18.75000     182      open       pre
## 13  4.19.2017  0.7762500  6.025000  17.90000     183      open       pre
## 15  4.14.2017  0.7671429  6.242857  15.88571     184      open       pre
## 17  4.16.2017  0.7387500  5.175000  18.75000     185      open       pre
## 19  4.13.2017  0.7600000  6.112500  18.56250     186      open       pre
## 21  4.10.2017  0.7625000  5.150000  18.35000     187      open       pre
## 23  4.14.2017  0.7671429  6.242857  15.88571     188      open       pre
## 25  4.12.2017  0.7587500  6.662500  18.61250     189      open       pre
## 27  4.12.2017  0.7587500  6.662500  18.61250     190      open       pre
## 29  4.11.2017  0.6100000  6.325000  18.57500     191      open       pre
## 31  4.13.2017  0.7600000  6.112500  18.56250     192      open       pre
## 33  4.10.2017  0.7625000  5.150000  18.35000     193      open       pre
## 35  4.11.2017  0.6100000  6.325000  18.57500     194      open       pre
## 37  4.14.2017  0.7671429  6.242857  15.88571     195      open       pre
## 39  4.14.2017  0.7671429  6.242857  15.88571     197      open       pre
## 41  4.19.2017  0.7762500  6.025000  17.90000     198      open       pre
## 43  4.13.2017  0.7600000  6.112500  18.56250     199      open       pre
## 45  4.20.2017  0.7987500  6.125000  17.86250     261      open       pre
## 47  4.13.2017  0.7600000  6.112500  18.56250     262      open       pre
## 49  4.12.2017  0.7587500  6.662500  18.61250     263      open       pre
## 51  4.16.2017  0.7387500  5.175000  18.75000     264      open       pre
## 53  4.11.2017  0.6100000  6.325000  18.57500     265      open       pre
## 55  4.14.2017  0.7671429  6.242857  15.88571     268      open       pre
## 57  4.14.2017  0.7671429  6.242857  15.88571     269      open       pre
## 59  4.18.2017  0.6685714  6.014286  16.25714     270      open       pre
## 61  4.18.2017  0.6685714  6.014286  16.25714     271      open       pre
## 63  4.12.2017  0.7587500  6.662500  18.61250     272      open       pre
## 65  4.10.2017  0.7625000  5.150000  18.35000     273      open       pre
## 67  4.19.2017  0.7762500  6.025000  17.90000     274      open       pre
## 69  4.15.2017  0.7687500  5.175000  18.50000     278      open       pre
## 71  4.15.2017  0.7687500  5.175000  18.50000     280      open       pre
## 73  4.19.2017  0.7762500  6.025000  17.90000     281      open       pre
## 75  4.15.2017  0.7687500  5.175000  18.50000     282      open       pre
## 77  4.18.2017  0.6685714  6.014286  16.25714     283      open       pre
## 79  4.20.2017  0.7987500  6.125000  17.86250     285      open       pre
## 81  4.16.2017  0.7387500  5.175000  18.75000     286      open       pre
## 83  4.10.2017  0.7625000  5.150000  18.35000     288      open       pre
## 85  4.11.2017  0.6100000  6.325000  18.57500     289      open       pre
## 87  4.18.2017  0.6685714  6.014286  16.25714     290      open       pre
## 89  4.16.2017  0.7387500  5.175000  18.75000     291      open       pre
## 91  4.12.2017  0.7587500  6.662500  18.61250     293      open       pre
## 93  4.15.2017  0.7687500  5.175000  18.50000     294      open       pre
## 95  4.15.2017  0.7687500  5.175000  18.50000     295      open       pre
## 97  4.12.2017  0.7587500  6.662500  18.61250     296      open       pre
## 99  4.18.2017  0.6685714  6.014286  16.25714     297      open       pre
## 101 4.18.2017  0.6685714  6.014286  16.25714     298      open       pre
## 103 4.15.2017  0.7687500  5.175000  18.50000     299      open       pre
## 105 4.13.2017  0.7600000  6.112500  18.56250     300      open       pre
## 107 4.20.2017  0.7987500  6.125000  17.86250     301      open       pre
## 109 4.20.2017  0.7987500  6.125000  17.86250     302      open       pre
## 111 4.20.2017  0.7987500  6.125000  17.86250     303      open       pre
##     understory.richness visits.per.hour flowers.per.hour
## 1            -0.2000000      0.00000000       0.00000000
## 3             0.3333333     -0.32327375      -0.43086291
## 5            -0.2500000     -0.53995650      -0.64828245
## 7             0.1428571     -0.49268367      -0.37631269
## 9             0.2000000      0.09979235       0.09979235
## 11            0.2000000      0.09080377       0.41167651
## 13            0.0000000      1.00000000       1.00000000
## 15            0.2000000      1.00000000       1.00000000
## 17            0.0000000     -0.84112430      -0.84112430
## 19            0.0000000     -0.39470508      -0.44954263
## 21            0.0000000     -0.24053372      -0.39150535
## 23            0.0000000     -0.42573377      -0.53599233
## 25            0.3333333      0.07970170      -0.04068744
## 27            0.1428571     -0.01510029       0.07591301
## 29            0.3333333     -0.13339954      -0.32473562
## 31           -0.2000000     -0.85854322      -0.87413790
## 33            0.1428571     -0.53661648      -0.60419442
## 35            0.2000000     -0.16648570       0.02088555
## 37            0.2000000      0.06795422       0.06795422
## 39           -0.5000000      1.00000000       1.00000000
## 41           -0.1428571     -0.04021855      -0.04021855
## 43           -0.3333333      0.47209055       0.63381000
## 45            0.3333333      1.00000000       1.00000000
## 47           -0.2000000     -0.19191919      -0.19191919
## 49            0.0000000     -0.58408139      -0.70206837
## 51            0.3333333     -0.24078953      -0.15323474
## 53            0.0000000      0.36856445       0.31660500
## 55           -0.2000000     -0.86015705      -0.92754546
## 57            0.0000000     -0.46210327      -0.46210327
## 59            0.2000000      0.41789617       0.41789617
## 61            0.2000000     -0.06500618      -0.06500618
## 63            0.2000000     -0.38523645      -0.16953939
## 65            0.2000000     -0.49155244      -0.62027508
## 67            0.2000000      0.59512283       0.59512283
## 69            0.0000000      0.06763726       0.06763726
## 71           -0.2000000     -0.69652598      -0.38197977
## 73            0.0000000     -1.00000000      -1.00000000
## 75            0.2000000     -0.09849443      -0.09849443
## 77            0.3333333      0.21679413       0.21679413
## 79           -0.2000000      1.00000000       1.00000000
## 81           -0.3333333     -0.75099206      -0.75099206
## 83            0.0000000     -0.39427116      -0.39427116
## 85            0.4285714      1.00000000       1.00000000
## 87            0.0000000      0.00000000       0.00000000
## 89            0.0000000     -0.01779812      -0.01779812
## 91           -0.1428571     -1.00000000      -1.00000000
## 93            0.0000000      0.16324168       0.02087126
## 95            0.3333333      0.41225952       0.41225952
## 97            0.5000000      0.39944808       0.13930504
## 99           -0.5000000     -1.00000000      -1.00000000
## 101           0.0000000      0.00000000       0.00000000
## 103          -0.2000000      0.11282376      -0.16497997
## 105           0.0000000      0.06278348       0.06278348
## 107          -0.2000000     -1.00000000      -1.00000000
## 109           0.0000000      0.56896852       0.56896852
## 111           0.3333333     -0.33248225      -0.33248225</code></pre>
<pre class="r"><code>post.visits &lt;- rii.m(post, c(1:7), 8:10)</code></pre>
<pre><code>##          Date mean.Solar mean.Wind mean.Temp PlantID treatment flowering
## 1   4.27.2017  0.6600000  4.125000  17.36250     104      open     bloom
## 3   4.26.2017  0.6562500  5.187500  17.40000     114      open     bloom
## 5   4.22.2017  0.7737500  5.425000  17.20000     146      open     bloom
## 7   4.21.2017  0.7728571  7.128571  15.92857     180      open     bloom
## 9   4.27.2017  0.6600000  4.125000  17.36250     181      open     bloom
## 11  4.21.2017  0.7728571  7.128571  15.92857     182      open     bloom
## 13  4.30.2017  0.8087500  4.787500  17.52500     183      open     bloom
## 15  4.29.2017  0.8125000  5.000000  17.26250     184      open     bloom
## 17   5.2.2017  0.7971429  6.200000  16.20000     185      open     bloom
## 19  4.27.2017  0.6600000  4.125000  17.36250     186      open     bloom
## 21  4.30.2017  0.8087500  4.787500  17.52500     187      open     bloom
## 23  4.25.2017  0.7142857  5.985714  16.41429     188      open     bloom
## 25  4.21.2017  0.7728571  7.128571  15.92857     189     shrub     bloom
## 27  4.26.2017  0.6562500  5.187500  17.40000     190      open     bloom
## 29  4.29.2017  0.8125000  5.000000  17.26250     191      open     bloom
## 31  4.23.2017  0.7775000  4.575000  17.16250     192      open     bloom
## 33   5.2.2017  0.7971429  6.200000  16.20000     193      open     bloom
## 35  4.21.2017  0.7728571  7.128571  15.92857     194      open     bloom
## 37  4.22.2017  0.7737500  5.425000  17.20000     195      open     bloom
## 39  4.23.2017  0.7775000  4.575000  17.16250     196      open     bloom
## 41  4.22.2017  0.7737500  5.425000  17.20000     197      open     bloom
## 43  4.29.2017  0.8125000  5.000000  17.26250     199      open     bloom
## 45   5.1.2017  0.8025000  5.137500  17.43750     261      open     bloom
## 47  4.25.2017  0.7142857  5.985714  16.41429     262      open     bloom
## 49  4.30.2017  0.8087500  4.787500  17.52500     263      open     bloom
## 51  4.23.2017  0.7775000  4.575000  17.16250     264      open     bloom
## 53  4.27.2017  0.6600000  4.125000  17.36250     265      open     bloom
## 55  4.22.2017  0.7737500  5.425000  17.20000     266      open     bloom
## 57  4.27.2017  0.6600000  4.125000  17.36250     268      open     bloom
## 59  4.26.2017  0.6562500  5.187500  17.40000     269      open     bloom
## 61  4.26.2017  0.6562500  5.187500  17.40000     270      open     bloom
## 63  4.29.2017  0.8125000  5.000000  17.26250     271      open     bloom
## 65  4.27.2017  0.6600000  4.125000  17.36250     272      open     bloom
## 67   5.1.2017  0.8025000  5.137500  17.43750     273      open     bloom
## 69  4.30.2017  0.8087500  4.787500  17.52500     274      open     bloom
## 71  4.21.2017  0.7728571  7.128571  15.92857     275     shrub     bloom
## 73  4.21.2017  0.7728571  7.128571  15.92857     276     shrub     bloom
## 75  4.29.2017  0.8125000  5.000000  17.26250     278      open     bloom
## 77   5.1.2017  0.8025000  5.137500  17.43750     280      open     bloom
## 79   5.2.2017  0.7971429  6.200000  16.20000     281      open     bloom
## 81  4.25.2017  0.7142857  5.985714  16.41429     282      open     bloom
## 83   5.1.2017  0.8025000  5.137500  17.43750     283      open     bloom
## 85  4.30.2017  0.8087500  4.787500  17.52500     285      open     bloom
## 87  4.26.2017  0.6562500  5.187500  17.40000     286      open     bloom
## 89  4.26.2017  0.6562500  5.187500  17.40000     288      open     bloom
## 91  4.22.2017  0.7737500  5.425000  17.20000     289      open     bloom
## 93  4.30.2017  0.8087500  4.787500  17.52500     290      open     bloom
## 95   5.1.2017  0.8025000  5.137500  17.43750     291      open     bloom
## 97  4.25.2017  0.7142857  5.985714  16.41429     293      open     bloom
## 99  4.25.2017  0.7142857  5.985714  16.41429     294      open     bloom
## 101 4.23.2017  0.7775000  4.575000  17.16250     295      open     bloom
## 103 4.29.2017  0.8125000  5.000000  17.26250     296      open     bloom
## 105 4.25.2017  0.7142857  5.985714  16.41429     297      open     bloom
## 107 4.23.2017  0.7775000  4.575000  17.16250     298      open     bloom
## 109  5.2.2017  0.7971429  6.200000  16.20000     300      open     bloom
## 111 4.23.2017  0.7775000  4.575000  17.16250     301      open     bloom
## 113  5.2.2017  0.7971429  6.200000  16.20000     302      open     bloom
## 115 4.22.2017  0.7737500  5.425000  17.20000    new1      open     bloom
##     understory.richness visits.per.hour flowers.per.hour
## 1             0.0000000    -0.172437578     -0.114778289
## 3             0.0000000     0.350885157      0.350885157
## 5             0.0000000    -1.000000000     -1.000000000
## 7            -0.5000000    -0.073640483     -0.317789932
## 9             0.0000000     0.640607950      0.678306066
## 11            0.0000000     0.177209078      0.282752815
## 13            0.0000000    -0.388557468     -0.388557468
## 15            0.0000000    -1.000000000     -1.000000000
## 17            0.0000000     1.000000000      1.000000000
## 19            0.5000000     1.000000000      1.000000000
## 21            0.3333333    -0.773864865     -0.898115853
## 23            0.0000000     0.000000000      0.000000000
## 25            0.0000000     0.000000000      0.000000000
## 27            0.0000000     0.000000000      0.000000000
## 29            0.3333333    -1.000000000     -1.000000000
## 31           -0.2000000    -0.651570028     -0.519233414
## 33            0.2000000    -1.000000000     -1.000000000
## 35            0.0000000     0.000000000      0.000000000
## 37            0.2000000     0.466625175      0.466625175
## 39            0.2000000     0.423433376      0.470536847
## 41            0.0000000     0.008340693      0.008340693
## 43            0.0000000    -1.000000000     -1.000000000
## 45           -0.3333333     0.000000000      0.000000000
## 47            0.0000000     1.000000000      1.000000000
## 49           -0.3333333    -0.524814831     -0.621105492
## 51            0.0000000     0.021329726     -0.314237809
## 53            0.5000000     0.000000000      0.000000000
## 55            0.0000000     0.409843861      0.522130709
## 57            0.0000000    -1.000000000     -1.000000000
## 59            0.0000000    -1.000000000     -1.000000000
## 61            0.0000000    -1.000000000     -1.000000000
## 63            0.3333333    -0.317255435     -0.317255435
## 65            0.2000000     1.000000000      1.000000000
## 67            0.2000000     1.000000000      1.000000000
## 69            0.2000000     0.320395119      0.320395119
## 71            0.5000000     0.573656595      0.297142516
## 73            0.3333333    -0.736976563     -0.808321192
## 75            0.2000000     0.000000000      0.000000000
## 77           -0.2000000    -0.423767301     -0.423767301
## 79           -0.5000000    -0.476598960     -0.718805592
## 81            0.0000000     0.000000000      0.000000000
## 83            0.0000000     0.000000000      0.000000000
## 85           -0.2000000     0.295025406      0.295025406
## 87            0.3333333    -1.000000000     -1.000000000
## 89           -0.2000000    -1.000000000     -1.000000000
## 91           -0.5000000    -1.000000000     -1.000000000
## 93            0.0000000    -0.174879890     -0.537295050
## 95            0.0000000     1.000000000      1.000000000
## 97            0.2000000    -1.000000000     -1.000000000
## 99            0.2000000    -1.000000000     -1.000000000
## 101          -0.2000000    -0.255797854     -0.255797854
## 103          -0.2000000     1.000000000      1.000000000
## 105           0.3333333     0.000000000      0.000000000
## 107          -0.2000000     0.226579594      0.392238985
## 109           0.2000000    -1.000000000     -1.000000000
## 111           0.0000000    -1.000000000     -1.000000000
## 113          -0.2000000     1.000000000      1.000000000
## 115           0.0000000    -0.063314857      0.138438182</code></pre>
<pre class="r"><code>t.test(post.visits$flowers.per.hour)</code></pre>
<pre><code>## 
##  One Sample t-test
## 
## data:  post.visits$flowers.per.hour
## t = -1.7176, df = 57, p-value = 0.0913
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  -0.33653624  0.02576924
## sample estimates:
##  mean of x 
## -0.1553835</code></pre>
<pre class="r"><code>rii.visits.micro &lt;- rbind(pre.visits, post.visits)

#from melyridae excluded pan traps

prepan &lt;- filter(metadata, blooming == &quot;pre&quot;)
prepan &lt;- dplyr::select(prepan, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, blooming, abun, percent.cover)
#split into 2 dataframes, rename the visitation columns and then rbind
#there are 2 unmatched reps
prepan &lt;- arrange(prepan, plant.id)

#prepan &lt;- filter(prepan, plant.id != 266 &amp; plant.id != 275 &amp; plant.id != 276 &amp; plant.id != 196)

pre.pan &lt;- rii.m(prepan, c(1:7), 8:9)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment blooming
## 1   4.16.2017    0.73875    5.1750   18.7500      146      open      pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180      open      pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181      open      pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183      open      pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184      open      pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185      open      pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186      open      pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187      open      pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188      open      pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189      open      pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190      open      pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191      open      pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192      open      pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193      open      pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194      open      pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195      open      pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196      open      pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197      open      pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198      open      pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199      open      pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262      open      pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264      open      pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265      open      pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266      open      pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267      open      pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268      open      pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269      open      pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270      open      pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271      open      pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272      open      pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273      open      pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274      open      pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275      open      pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276      open      pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278      open      pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280      open      pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281      open      pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282      open      pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283      open      pre
## 79  4.13.2017    0.76000    6.1125   18.5625      284      open      pre
## 81  4.19.2017    0.77625    6.0250   17.9000      286      open      pre
## 83  4.20.2017    0.79875    6.1250   17.8625      287      open      pre
## 85  4.11.2017    0.61000    6.3250   18.5750      288      open      pre
## 87  4.12.2017    0.75875    6.6625   18.6125      289      open      pre
## 89  4.19.2017    0.77625    6.0250   17.9000      290      open      pre
## 91  4.17.2017    0.57375    5.5375   18.4125      291      open      pre
## 93  4.13.2017    0.76000    6.1125   18.5625      293      open      pre
## 95  4.13.2017    0.76000    6.1125   18.5625      294      open      pre
## 97  4.17.2017    0.57375    5.5375   18.4125      295      open      pre
## 99  4.10.2017    0.76250    5.1500   18.3500      296      open      pre
## 101 4.19.2017    0.77625    6.0250   17.9000      297      open      pre
## 103 4.16.2017    0.73875    5.1750   18.7500      298      open      pre
## 105 4.17.2017    0.57375    5.5375   18.4125      299      open      pre
## 107 4.15.2017    0.76875    5.1750   18.5000      300      open      pre
##            abun percent.cover
## 1   -0.40000000     0.1428571
## 3   -0.08108108     0.7142857
## 5   -0.38461538     0.8918919
## 7    0.04761905     0.7500000
## 9    0.07692308     0.7500000
## 11   0.20000000     0.7333333
## 13   0.71428571     0.4285714
## 15   0.04347826     0.8181818
## 17   0.42857143     0.9718310
## 19  -0.05882353     0.8518519
## 21  -0.08571429     0.7777778
## 23   0.12000000     0.9047619
## 25   0.17647059     0.4545455
## 27   0.25000000     0.9444444
## 29  -0.08333333     0.8604651
## 31  -0.04347826     0.8181818
## 33  -0.08333333     0.8750000
## 35  -0.23809524     0.7777778
## 37   0.48148148     0.8181818
## 39   0.02325581     0.1578947
## 41   0.48717949     0.5555556
## 43   0.36842105     0.6363636
## 45   0.41176471     0.6666667
## 47   0.03225806     0.8750000
## 49   0.33333333     0.9047619
## 51   0.10000000     0.9230769
## 53   0.25000000     0.6923077
## 55   0.17647059     0.8518519
## 57   0.76470588     0.9230769
## 59   0.29411765     0.6666667
## 61   0.25000000     0.6000000
## 63   0.42857143     0.6000000
## 65   1.00000000     0.8181818
## 67   0.11111111     0.4285714
## 69   0.70000000    -0.2000000
## 71   0.46666667     0.5555556
## 73  -0.33333333     0.8750000
## 75   0.00000000    -0.1111111
## 77   0.42857143     0.7142857
## 79  -0.17647059     0.8750000
## 81   0.25000000     0.8750000
## 83  -0.06666667     0.8181818
## 85   0.42105263     0.9230769
## 87   0.04000000     0.9230769
## 89   0.37500000     0.6000000
## 91   0.21428571     0.9444444
## 93   0.35483871     0.6000000
## 95   0.47826087     0.9230769
## 97   0.30000000     0.7777778
## 99   0.04000000     0.6666667
## 101  0.00000000     0.8918919
## 103  0.45454545     0.4285714
## 105  0.33333333     0.2000000
## 107  0.05263158     0.8518519</code></pre>
<pre class="r"><code>postpan &lt;- filter(metadata, blooming ==&quot;post&quot;)
postpan &lt;- dplyr::select(postpan, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, blooming, abun, percent.cover)
postpan &lt;- arrange(postpan, plant.id)

post.pan &lt;- rii.m(postpan, c(1:7), 8:9)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment blooming
## 1   4.30.2017    0.80875    4.7875   17.5250      104      open     post
## 3   4.29.2017    0.81250    5.0000   17.2625      114      open     post
## 5   4.23.2017    0.77750    4.5750   17.1625      146      open     post
## 7   4.22.2017    0.77375    5.4250   17.2000      180      open     post
## 9   4.30.2017    0.80875    4.7875   17.5250      181      open     post
## 11  4.22.2017    0.77375    5.4250   17.2000      182      open     post
## 13   5.3.2017    0.78625    4.4750   17.5500      183      open     post
## 15   5.1.2017    0.80250    5.1375   17.4375      184      open     post
## 17   5.5.2017    0.66625    3.5250   28.5125      185      open     post
## 19  4.30.2017    0.80875    4.7875   17.5250      186      open     post
## 21   5.3.2017    0.78625    4.4750   17.5500      187      open     post
## 23  4.27.2017    0.66000    4.1250   17.3625      188      open     post
## 25  4.22.2017    0.77375    5.4250   17.2000      189      open     post
## 27  4.29.2017    0.81250    5.0000   17.2625      190      open     post
## 29   5.1.2017    0.80250    5.1375   17.4375      191      open     post
## 31  4.26.2017    0.65625    5.1875   17.4000      192      open     post
## 33   5.5.2017    0.66625    3.5250   28.5125      193      open     post
## 35  4.22.2017    0.77375    5.4250   17.2000      194      open     post
## 37  4.23.2017    0.77750    4.5750   17.1625      195      open     post
## 39  4.26.2017    0.65625    5.1875   17.4000      196      open     post
## 41  4.23.2017    0.77750    4.5750   17.1625      197      open     post
## 43   5.4.2017    0.80500    5.0625   17.7875      198      open     post
## 45   5.1.2017    0.80250    5.1375   17.4375      199      open     post
## 47   5.4.2017    0.80500    5.0625   17.7875      261      open     post
## 49  4.27.2017    0.66000    4.1250   17.3625      262      open     post
## 51   5.3.2017    0.78625    4.4750   17.5500      263      open     post
## 53  4.26.2017    0.65625    5.1875   17.4000      264      open     post
## 55  4.30.2017    0.80875    4.7875   17.5250      265      open     post
## 57  4.23.2017    0.77750    4.5750   17.1625      266      open     post
## 59  4.23.2017    0.77750    4.5750   17.1625      267      open     post
## 61  4.30.2017    0.80875    4.7875   17.5250      268      open     post
## 63  4.29.2017    0.81250    5.0000   17.2625      269      open     post
## 65  4.29.2017    0.81250    5.0000   17.2625      270      open     post
## 67   5.1.2017    0.80250    5.1375   17.4375      271      open     post
## 69  4.30.2017    0.80875    4.7875   17.5250      272      open     post
## 71   5.4.2017    0.80500    5.0625   17.7875      273      open     post
## 73   5.3.2017    0.78625    4.4750   17.5500      274      open     post
## 75  4.22.2017    0.77375    5.4250   17.2000      275      open     post
## 77  4.22.2017    0.77375    5.4250   17.2000      276      open     post
## 79   5.1.2017    0.80250    5.1375   17.4375      278      open     post
## 81   5.4.2017    0.80500    5.0625   17.7875      280      open     post
## 83   5.5.2017    0.66625    3.5250   28.5125      281      open     post
## 85  4.27.2017    0.66000    4.1250   17.3625      282      open     post
## 87   5.4.2017    0.80500    5.0625   17.7875      283      open     post
## 89   5.3.2017    0.78625    4.4750   17.5500      285      open     post
## 91  4.29.2017    0.81250    5.0000   17.2625      286      open     post
## 93  4.29.2017    0.81250    5.0000   17.2625      288      open     post
## 95  4.23.2017    0.77750    4.5750   17.1625      289      open     post
## 97   5.3.2017    0.78625    4.4750   17.5500      290      open     post
## 99   5.4.2017    0.80500    5.0625   17.7875      291      open     post
## 101 4.27.2017    0.66000    4.1250   17.3625      293      open     post
## 103 4.27.2017    0.66000    4.1250   17.3625      294      open     post
## 105 4.26.2017    0.65625    5.1875   17.4000      295      open     post
## 107  5.1.2017    0.80250    5.1375   17.4375      296      open     post
## 109 4.27.2017    0.66000    4.1250   17.3625      297      open     post
## 111 4.26.2017    0.65625    5.1875   17.4000      298      open     post
## 113  5.5.2017    0.66625    3.5250   28.5125      300      open     post
## 115 4.26.2017    0.65625    5.1875   17.4000      301      open     post
## 117  5.5.2017    0.66625    3.5250   28.5125      302      open     post
## 119  5.5.2017    0.66625    3.5250   28.5125      303      open     post
##            abun percent.cover
## 1   -0.33333333     0.6000000
## 3    0.10000000     0.4285714
## 5    0.00000000     0.8000000
## 7    0.41176471     0.9230769
## 9    0.36000000     0.9230769
## 11  -0.28571429     0.8000000
## 13  -0.20000000     0.6666667
## 15   1.00000000     0.9230769
## 17  -0.36842105     0.9736842
## 19  -0.26315789     0.6666667
## 21   0.53846154     0.9607843
## 23   0.60000000     0.8750000
## 25   0.00000000     0.8644068
## 27   0.16666667     0.7391304
## 29   0.33333333     0.8867925
## 31   0.37500000     0.9696970
## 33  -0.04347826     0.9607843
## 35  -0.23076923     0.9753086
## 37   0.11111111     0.8518519
## 39   0.06666667     0.9047619
## 41  -0.60000000     0.9672131
## 43  -0.20000000     0.9565217
## 45  -1.00000000     0.7142857
## 47   0.17647059    -0.3333333
## 49   1.00000000     0.7777778
## 51  -0.13043478     0.6000000
## 53  -0.11111111     0.9512195
## 55  -0.25000000     0.8750000
## 57  -0.09090909     0.9047619
## 59   0.00000000     0.9444444
## 61  -0.05263158     0.8750000
## 63   0.41176471     0.9047619
## 65   0.27272727     0.8518519
## 67   0.33333333     0.9230769
## 69  -0.60000000     0.5789474
## 71   0.14285714     0.9047619
## 73  -0.25000000     0.8518519
## 75   0.38461538     0.9696970
## 77   0.18181818     0.9047619
## 79  -1.00000000     0.3333333
## 81   0.05263158     0.1111111
## 83   0.33333333     0.9565217
## 85  -0.27272727     0.7391304
## 87   0.30000000     0.6666667
## 89   0.21739130     0.5789474
## 91   0.23076923     0.8750000
## 93   0.76470588     0.9047619
## 95   0.06666667     0.9565217
## 97  -0.42857143     0.9047619
## 99   0.41176471     0.9047619
## 101  0.33333333     0.7777778
## 103  0.50000000     0.9047619
## 105  0.33333333     0.9565217
## 107 -1.00000000     0.6666667
## 109  1.00000000     0.9230769
## 111  0.14285714     0.5151515
## 113 -0.11111111     0.5789474
## 115 -0.11111111     0.9565217
## 117  0.00000000     0.8518519
## 119  0.00000000     0.8867925</code></pre>
<pre class="r"><code>rii.pan.micro &lt;- rbind(pre.pan, post.pan)


pre.beetle &lt;- filter(yesbeetle, blooming == &quot;pre&quot;)
pre.beetle &lt;- dplyr::select(pre.beetle, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, blooming, Species)

pre.beetle &lt;- arrange(pre.beetle, plant.id)

#prepan &lt;- filter(prepan, plant.id != 266 &amp; plant.id != 275 &amp; plant.id != 276 &amp; plant.id != 196)
pre.beetle &lt;- rii.m(pre.beetle, c(1:7), 8)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment blooming
## 1   4.16.2017    0.73875    5.1750   18.7500      146      open      pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180      open      pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181      open      pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183      open      pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184      open      pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185      open      pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186      open      pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187      open      pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188      open      pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189      open      pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190      open      pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191      open      pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192      open      pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193      open      pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194      open      pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195      open      pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196      open      pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197      open      pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198      open      pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199      open      pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262      open      pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264      open      pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265      open      pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266      open      pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267      open      pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268      open      pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269      open      pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270      open      pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271      open      pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272      open      pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273      open      pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274      open      pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275      open      pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276      open      pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278      open      pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280      open      pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281      open      pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282      open      pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283      open      pre
## 79  4.13.2017    0.76000    6.1125   18.5625      284      open      pre
## 81  4.19.2017    0.77625    6.0250   17.9000      286      open      pre
## 83  4.20.2017    0.79875    6.1250   17.8625      287      open      pre
## 85  4.11.2017    0.61000    6.3250   18.5750      288      open      pre
## 87  4.12.2017    0.75875    6.6625   18.6125      289      open      pre
## 89  4.19.2017    0.77625    6.0250   17.9000      290      open      pre
## 91  4.17.2017    0.57375    5.5375   18.4125      291      open      pre
## 93  4.13.2017    0.76000    6.1125   18.5625      293      open      pre
## 95  4.13.2017    0.76000    6.1125   18.5625      294      open      pre
## 97  4.17.2017    0.57375    5.5375   18.4125      295      open      pre
## 99  4.10.2017    0.76250    5.1500   18.3500      296      open      pre
## 101 4.19.2017    0.77625    6.0250   17.9000      297      open      pre
## 103 4.16.2017    0.73875    5.1750   18.7500      298      open      pre
## 105 4.17.2017    0.57375    5.5375   18.4125      299      open      pre
## 107 4.15.2017    0.76875    5.1750   18.5000      300      open      pre
##         Species
## 1   -0.25000000
## 3   -0.04761905
## 5   -0.42857143
## 7   -0.17647059
## 9    0.00000000
## 11   0.09090909
## 13   0.38461538
## 15  -0.23076923
## 17   0.20000000
## 19  -0.21739130
## 21   0.00000000
## 23   0.00000000
## 25   0.20000000
## 27   0.22222222
## 29  -0.07692308
## 31  -0.05882353
## 33  -0.25000000
## 35   0.06666667
## 37   0.22222222
## 39   0.00000000
## 41   0.29411765
## 43   0.16666667
## 45   0.14285714
## 47   0.00000000
## 49   0.25000000
## 51   0.11111111
## 53   0.13043478
## 55   0.06666667
## 57   0.50000000
## 59   0.23076923
## 61   0.29411765
## 63   0.28000000
## 65   1.00000000
## 67   0.12500000
## 69   0.64705882
## 71   0.23809524
## 73  -0.42857143
## 75  -0.06666667
## 77   0.14285714
## 79  -0.07692308
## 81   0.06666667
## 83   0.00000000
## 85   0.20000000
## 87   0.15789474
## 89   0.33333333
## 91  -0.11111111
## 93   0.33333333
## 95   0.28571429
## 97   0.14285714
## 99  -0.04000000
## 101  0.00000000
## 103  0.33333333
## 105  0.28571429
## 107  0.00000000</code></pre>
<pre class="r"><code>post.beetle &lt;- filter(yesbeetle, blooming == &quot;post&quot;)
post.beetle &lt;- dplyr::select(post.beetle, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, blooming, Species)

post.beetle &lt;- arrange(post.beetle, plant.id)

#prepan &lt;- filter(prepan, plant.id != 266 &amp; plant.id != 275 &amp; plant.id != 276 &amp; plant.id != 196)
post.beetle &lt;- rii.m(post.beetle, c(1:7), 8)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment blooming
## 1   4.30.2017    0.80875    4.7875   17.5250      104      open     post
## 3   4.29.2017    0.81250    5.0000   17.2625      114      open     post
## 5   4.23.2017    0.77750    4.5750   17.1625      146      open     post
## 7   4.22.2017    0.77375    5.4250   17.2000      180      open     post
## 9   4.30.2017    0.80875    4.7875   17.5250      181      open     post
## 11  4.22.2017    0.77375    5.4250   17.2000      182      open     post
## 13   5.3.2017    0.78625    4.4750   17.5500      183      open     post
## 15   5.1.2017    0.80250    5.1375   17.4375      184      open     post
## 17   5.5.2017    0.66625    3.5250   28.5125      185      open     post
## 19  4.30.2017    0.80875    4.7875   17.5250      186      open     post
## 21   5.3.2017    0.78625    4.4750   17.5500      187      open     post
## 23  4.27.2017    0.66000    4.1250   17.3625      188      open     post
## 25  4.22.2017    0.77375    5.4250   17.2000      189      open     post
## 27  4.29.2017    0.81250    5.0000   17.2625      190      open     post
## 29   5.1.2017    0.80250    5.1375   17.4375      191      open     post
## 31  4.26.2017    0.65625    5.1875   17.4000      192      open     post
## 33   5.5.2017    0.66625    3.5250   28.5125      193      open     post
## 35  4.22.2017    0.77375    5.4250   17.2000      194      open     post
## 37  4.23.2017    0.77750    4.5750   17.1625      195      open     post
## 39  4.26.2017    0.65625    5.1875   17.4000      196      open     post
## 41  4.23.2017    0.77750    4.5750   17.1625      197      open     post
## 43   5.4.2017    0.80500    5.0625   17.7875      198      open     post
## 45   5.1.2017    0.80250    5.1375   17.4375      199      open     post
## 47   5.4.2017    0.80500    5.0625   17.7875      261      open     post
## 49  4.27.2017    0.66000    4.1250   17.3625      262      open     post
## 51   5.3.2017    0.78625    4.4750   17.5500      263      open     post
## 53  4.26.2017    0.65625    5.1875   17.4000      264      open     post
## 55  4.30.2017    0.80875    4.7875   17.5250      265      open     post
## 57  4.23.2017    0.77750    4.5750   17.1625      266      open     post
## 59  4.23.2017    0.77750    4.5750   17.1625      267      open     post
## 61  4.30.2017    0.80875    4.7875   17.5250      268      open     post
## 63  4.29.2017    0.81250    5.0000   17.2625      269      open     post
## 65  4.29.2017    0.81250    5.0000   17.2625      270      open     post
## 67   5.1.2017    0.80250    5.1375   17.4375      271      open     post
## 69  4.30.2017    0.80875    4.7875   17.5250      272      open     post
## 71   5.4.2017    0.80500    5.0625   17.7875      273      open     post
## 73   5.3.2017    0.78625    4.4750   17.5500      274      open     post
## 75  4.22.2017    0.77375    5.4250   17.2000      275      open     post
## 77  4.22.2017    0.77375    5.4250   17.2000      276      open     post
## 79   5.1.2017    0.80250    5.1375   17.4375      278      open     post
## 81   5.4.2017    0.80500    5.0625   17.7875      280      open     post
## 83   5.5.2017    0.66625    3.5250   28.5125      281      open     post
## 85  4.27.2017    0.66000    4.1250   17.3625      282      open     post
## 87   5.4.2017    0.80500    5.0625   17.7875      283      open     post
## 89   5.3.2017    0.78625    4.4750   17.5500      285      open     post
## 91  4.29.2017    0.81250    5.0000   17.2625      286      open     post
## 93  4.29.2017    0.81250    5.0000   17.2625      288      open     post
## 95  4.23.2017    0.77750    4.5750   17.1625      289      open     post
## 97   5.3.2017    0.78625    4.4750   17.5500      290      open     post
## 99   5.4.2017    0.80500    5.0625   17.7875      291      open     post
## 101 4.27.2017    0.66000    4.1250   17.3625      293      open     post
## 103 4.27.2017    0.66000    4.1250   17.3625      294      open     post
## 105 4.26.2017    0.65625    5.1875   17.4000      295      open     post
## 107  5.1.2017    0.80250    5.1375   17.4375      296      open     post
## 109 4.27.2017    0.66000    4.1250   17.3625      297      open     post
## 111 4.26.2017    0.65625    5.1875   17.4000      298      open     post
## 113  5.5.2017    0.66625    3.5250   28.5125      300      open     post
## 115 4.26.2017    0.65625    5.1875   17.4000      301      open     post
## 117  5.5.2017    0.66625    3.5250   28.5125      302      open     post
## 119  5.5.2017    0.66625    3.5250   28.5125      303      open     post
##         Species
## 1   -0.06666667
## 3   -0.05263158
## 5   -0.06666667
## 7    0.29411765
## 9   -0.07692308
## 11  -0.07692308
## 13  -0.14285714
## 15   0.50000000
## 17  -0.30000000
## 19   0.00000000
## 21   0.33333333
## 23  -0.20000000
## 25   0.23809524
## 27   0.14285714
## 29   0.20000000
## 31   0.23076923
## 33  -0.04761905
## 35  -0.33333333
## 37   0.11111111
## 39  -0.06666667
## 41  -0.33333333
## 43  -0.06666667
## 45  -0.71428571
## 47   0.17647059
## 49   0.50000000
## 51  -0.12500000
## 53   0.00000000
## 55  -0.06666667
## 57  -0.07692308
## 59  -0.11111111
## 61   0.05882353
## 63   0.37500000
## 65   0.16666667
## 67   0.14285714
## 69  -0.33333333
## 71   0.20000000
## 73  -0.25000000
## 75   0.09090909
## 77   0.15789474
## 79  -0.33333333
## 81   0.15789474
## 83   0.33333333
## 85  -0.33333333
## 87   0.25000000
## 89   0.11111111
## 91   0.09090909
## 93   0.71428571
## 95   0.07692308
## 97  -0.50000000
## 99   0.28571429
## 101  0.20000000
## 103  0.60000000
## 105  0.16666667
## 107 -0.33333333
## 109  1.00000000
## 111  0.07692308
## 113 -0.20000000
## 115 -0.33333333
## 117  0.14285714
## 119  0.00000000</code></pre>
<pre class="r"><code>rii.arth.richness.micro &lt;- rbind(pre.beetle, post.beetle)

#bootstrapping means and CI for microsite RII

flowers.rii &lt;- boot(rii.visits.micro$flowers.per.hour, bootmean, R=10000, stype =&quot;i&quot;)
ci.flowers &lt;- boot.ci(flowers.rii)
normal.flowers &lt;- ci.flowers$normal



#annual richness
richness.rii &lt;- boot(rii.visits.micro$understory.richness, bootmean, R=10000, stype =&quot;i&quot;)
ci.richness &lt;- boot.ci(richness.rii)
normal.richness &lt;- ci.richness$normal

#percent cover
percent.cover.rii &lt;- boot(rii.pan.micro$percent.cover, bootmean, R=10000, stype =&quot;i&quot;)
ci.percent.cover &lt;- boot.ci(percent.cover.rii)
normal.percent.cover &lt;- ci.percent.cover$normal

#arthropod abundance
abun.rii &lt;- boot(rii.pan.micro$abun, bootmean, R=10000, stype =&quot;i&quot;)
ci.abun &lt;- boot.ci(abun.rii)
normal.abun &lt;- ci.abun$normal

#arthropod richness
arth.rich.rii &lt;- boot(rii.arth.richness.micro$Species, bootmean, R=10000, stype =&quot;i&quot;)
ci.arth.rich &lt;- boot.ci(arth.rich.rii)
normal.arth.rich &lt;- ci.arth.rich$normal

#OK bloom effects split by microsites

byrep &lt;- read.csv(&quot;Output Data/byrep_cleaned.csv&quot;)

shrub &lt;- filter(byrep, treatment == &quot;shrub&quot;)
shrub &lt;- dplyr::select(shrub, Date, mean.Solar, mean.Wind, mean.Temp, PlantID, treatment, flowering, understory.richness, visits.per.hour, flowers.per.hour)

#split into 2 dataframes, rename the visitation columns and then rbind
#need to match up microsites
#there are 2 unmatched reps
shrub &lt;- arrange(shrub, PlantID)

shrub &lt;- filter(shrub, PlantID != 196 &amp; PlantID != &quot;new1&quot; &amp; PlantID != 303 &amp; PlantID != 299 &amp; PlantID !=199) 
shrub &lt;- subset(shrub[-43,])

#all matched

open &lt;- filter(byrep, treatment == &quot;open&quot;) 
open &lt;- dplyr::select(open, Date, mean.Solar, mean.Wind, mean.Temp, PlantID, treatment, flowering, understory.richness, visits.per.hour, flowers.per.hour)
open &lt;- arrange(open, PlantID) 
open &lt;- filter(open, PlantID != 266 &amp; PlantID != &quot;new1&quot; &amp; PlantID != 303 &amp; PlantID != 299 &amp; PlantID != 275 &amp; PlantID != 276) 

rii.shrub.visits &lt;- rii.b(shrub, c(1:7), 8:10)</code></pre>
<pre><code>##          Date mean.Solar mean.Wind mean.Temp PlantID treatment flowering
## 1   4.20.2017  0.7987500  6.125000  17.86250     104     shrub       pre
## 3   4.19.2017  0.7762500  6.025000  17.90000     114     shrub       pre
## 5   4.10.2017  0.7625000  5.150000  18.35000     146     shrub       pre
## 7   4.13.2017  0.7600000  6.112500  18.56250     180     shrub       pre
## 9   4.19.2017  0.7762500  6.025000  17.90000     181     shrub       pre
## 11  4.16.2017  0.7387500  5.175000  18.75000     182     shrub       pre
## 13  4.19.2017  0.7762500  6.025000  17.90000     183     shrub       pre
## 15  4.14.2017  0.7671429  6.242857  15.88571     184     shrub       pre
## 17  4.16.2017  0.7387500  5.175000  18.75000     185     shrub       pre
## 19  4.13.2017  0.7600000  6.112500  18.56250     186     shrub       pre
## 21  4.10.2017  0.7625000  5.150000  18.35000     187     shrub       pre
## 23  4.14.2017  0.7671429  6.242857  15.88571     188     shrub       pre
## 25  4.12.2017  0.7587500  6.662500  18.61250     189     shrub       pre
## 27  4.12.2017  0.7587500  6.662500  18.61250     190     shrub       pre
## 29  4.11.2017  0.6100000  6.325000  18.57500     191     shrub       pre
## 31  4.13.2017  0.7600000  6.112500  18.56250     192     shrub       pre
## 33  4.10.2017  0.7625000  5.150000  18.35000     193     shrub       pre
## 35  4.11.2017  0.6100000  6.325000  18.57500     194     shrub       pre
## 37  4.14.2017  0.7671429  6.242857  15.88571     195     shrub       pre
## 39  4.14.2017  0.7671429  6.242857  15.88571     197     shrub       pre
## 41  4.19.2017  0.7762500  6.025000  17.90000     198     shrub       pre
## 44  4.20.2017  0.7987500  6.125000  17.86250     261     shrub       pre
## 46  4.13.2017  0.7600000  6.112500  18.56250     262     shrub       pre
## 48  4.12.2017  0.7587500  6.662500  18.61250     263     shrub       pre
## 50  4.16.2017  0.7387500  5.175000  18.75000     264     shrub       pre
## 52  4.11.2017  0.6100000  6.325000  18.57500     265     shrub       pre
## 54  4.10.2017  0.7625000  5.150000  18.35000     266     shrub       pre
## 56  4.14.2017  0.7671429  6.242857  15.88571     268     shrub       pre
## 58  4.14.2017  0.7671429  6.242857  15.88571     269     shrub       pre
## 60  4.18.2017  0.6685714  6.014286  16.25714     270     shrub       pre
## 62  4.18.2017  0.6685714  6.014286  16.25714     271     shrub       pre
## 64  4.12.2017  0.7587500  6.662500  18.61250     272     shrub       pre
## 66  4.10.2017  0.7625000  5.150000  18.35000     273     shrub       pre
## 68  4.19.2017  0.7762500  6.025000  17.90000     274     shrub       pre
## 70  4.11.2017  0.6100000  6.325000  18.57500     275     shrub       pre
## 72  4.16.2017  0.7387500  5.175000  18.75000     276     shrub       pre
## 74  4.15.2017  0.7687500  5.175000  18.50000     278     shrub       pre
## 76  4.15.2017  0.7687500  5.175000  18.50000     280     shrub       pre
## 78  4.19.2017  0.7762500  6.025000  17.90000     281     shrub       pre
## 80  4.15.2017  0.7687500  5.175000  18.50000     282     shrub       pre
## 82  4.18.2017  0.6685714  6.014286  16.25714     283     shrub       pre
## 84  4.20.2017  0.7987500  6.125000  17.86250     285     shrub       pre
## 86  4.16.2017  0.7387500  5.175000  18.75000     286     shrub       pre
## 88  4.10.2017  0.7625000  5.150000  18.35000     288     shrub       pre
## 90  4.11.2017  0.6100000  6.325000  18.57500     289     shrub       pre
## 92  4.18.2017  0.6685714  6.014286  16.25714     290     shrub       pre
## 94  4.16.2017  0.7387500  5.175000  18.75000     291     shrub       pre
## 96  4.12.2017  0.7587500  6.662500  18.61250     293     shrub       pre
## 98  4.15.2017  0.7687500  5.175000  18.50000     294     shrub       pre
## 100 4.15.2017  0.7687500  5.175000  18.50000     295     shrub       pre
## 102 4.12.2017  0.7587500  6.662500  18.61250     296     shrub       pre
## 104 4.18.2017  0.6685714  6.014286  16.25714     297     shrub       pre
## 106 4.18.2017  0.6685714  6.014286  16.25714     298     shrub       pre
## 108 4.13.2017  0.7600000  6.112500  18.56250     300     shrub       pre
## 110 4.20.2017  0.7987500  6.125000  17.86250     301     shrub       pre
## 112 4.20.2017  0.7987500  6.125000  17.86250     302     shrub       pre
##     understory.richness visits.per.hour flowers.per.hour
## 1             0.0000000     1.000000000       1.00000000
## 3            -0.3333333    -0.280883780      -0.28088378
## 5            -0.2000000    -1.000000000      -1.00000000
## 7            -0.6000000     0.037331753      -0.10609119
## 9             0.0000000     0.301857273       0.52343548
## 11            0.0000000     0.468538012       0.26659404
## 13           -0.2000000    -0.501320720      -0.50132072
## 15           -0.2000000    -1.000000000      -1.00000000
## 17           -0.3333333     0.130513870       0.32210601
## 19           -0.1428571    -0.255636837      -0.11705447
## 21           -0.3333333    -0.837710332      -0.83771033
## 23            0.2000000    -1.000000000      -1.00000000
## 25            0.0000000    -1.000000000      -1.00000000
## 27           -0.3333333    -1.000000000      -1.00000000
## 29           -0.3333333    -1.000000000      -1.00000000
## 31            0.0000000     0.005522209       0.20529547
## 33           -0.1428571    -1.000000000      -1.00000000
## 35           -0.2000000    -1.000000000      -1.00000000
## 37            0.0000000     0.065558130       0.06555813
## 39            0.3333333    -0.673317328      -0.82213207
## 41            0.0000000    -1.000000000      -1.00000000
## 44           -0.6000000    -1.000000000      -1.00000000
## 46            0.2000000    -0.666190422      -0.66619042
## 48            0.0000000    -0.368031515      -0.52908735
## 50           -0.3333333    -0.601130290      -0.65618030
## 52            0.0000000    -1.000000000      -1.00000000
## 54            0.2000000     0.210141084       0.21014108
## 56            0.0000000    -1.000000000      -1.00000000
## 58            0.5000000    -1.000000000      -1.00000000
## 60           -0.2000000    -1.000000000      -1.00000000
## 62           -0.2000000     0.017896336       0.01789634
## 64            0.0000000    -0.314693295      -0.31469330
## 66            0.0000000    -0.487906315      -0.48790631
## 68            0.0000000    -0.442881816      -0.44288182
## 70            0.0000000    -0.092159662      -0.09215966
## 72            0.0000000    -0.465366451      -0.46536645
## 74            0.0000000    -1.000000000      -1.00000000
## 76            0.0000000    -0.195342820      -0.57571623
## 78            0.0000000     1.000000000       1.00000000
## 80            0.0000000    -1.000000000      -1.00000000
## 82            0.0000000    -1.000000000      -1.00000000
## 84            0.0000000     0.033123978       0.03312398
## 86            0.3333333    -1.000000000      -1.00000000
## 88           -0.2000000    -1.000000000      -1.00000000
## 90           -0.6666667    -1.000000000      -1.00000000
## 92           -0.2000000     1.000000000       1.00000000
## 94            0.0000000    -0.327678871      -0.13663324
## 96            0.0000000     0.000000000       0.00000000
## 98            0.0000000    -1.000000000      -1.00000000
## 100          -0.3333333    -0.091718825      -0.09171883
## 102          -0.2000000    -0.896781141      -0.91531520
## 104           0.6000000     0.000000000       0.00000000
## 106           0.0000000     1.000000000       1.00000000
## 108           0.2000000    -1.000000000      -1.00000000
## 110          -1.0000000     0.000000000       0.00000000
## 112           0.3333333    -0.242510699      -0.24251070</code></pre>
<pre class="r"><code>rii.open.visits &lt;- rii.b(open, c(1:7), 8:10)</code></pre>
<pre><code>##          Date mean.Solar mean.Wind mean.Temp PlantID treatment flowering
## 1   4.20.2017  0.7987500  6.125000  17.86250     104      open       pre
## 3   4.19.2017  0.7762500  6.025000  17.90000     114      open       pre
## 5   4.10.2017  0.7625000  5.150000  18.35000     146      open       pre
## 7   4.13.2017  0.7600000  6.112500  18.56250     180      open       pre
## 9   4.19.2017  0.7762500  6.025000  17.90000     181      open       pre
## 11  4.16.2017  0.7387500  5.175000  18.75000     182      open       pre
## 13  4.19.2017  0.7762500  6.025000  17.90000     183      open       pre
## 15  4.14.2017  0.7671429  6.242857  15.88571     184      open       pre
## 17  4.16.2017  0.7387500  5.175000  18.75000     185      open       pre
## 19  4.13.2017  0.7600000  6.112500  18.56250     186      open       pre
## 21  4.10.2017  0.7625000  5.150000  18.35000     187      open       pre
## 23  4.14.2017  0.7671429  6.242857  15.88571     188      open       pre
## 25  4.12.2017  0.7587500  6.662500  18.61250     189      open       pre
## 27  4.12.2017  0.7587500  6.662500  18.61250     190      open       pre
## 29  4.11.2017  0.6100000  6.325000  18.57500     191      open       pre
## 31  4.13.2017  0.7600000  6.112500  18.56250     192      open       pre
## 33  4.10.2017  0.7625000  5.150000  18.35000     193      open       pre
## 35  4.11.2017  0.6100000  6.325000  18.57500     194      open       pre
## 37  4.14.2017  0.7671429  6.242857  15.88571     195      open       pre
## 39  4.11.2017  0.6100000  6.325000  18.57500     196      open       pre
## 41  4.14.2017  0.7671429  6.242857  15.88571     197      open       pre
## 43  4.19.2017  0.7762500  6.025000  17.90000     198      open       pre
## 45  4.13.2017  0.7600000  6.112500  18.56250     199      open       pre
## 47  4.20.2017  0.7987500  6.125000  17.86250     261      open       pre
## 49  4.13.2017  0.7600000  6.112500  18.56250     262      open       pre
## 51  4.12.2017  0.7587500  6.662500  18.61250     263      open       pre
## 53  4.16.2017  0.7387500  5.175000  18.75000     264      open       pre
## 55  4.11.2017  0.6100000  6.325000  18.57500     265      open       pre
## 57  4.14.2017  0.7671429  6.242857  15.88571     268      open       pre
## 59  4.14.2017  0.7671429  6.242857  15.88571     269      open       pre
## 61  4.18.2017  0.6685714  6.014286  16.25714     270      open       pre
## 63  4.18.2017  0.6685714  6.014286  16.25714     271      open       pre
## 65  4.12.2017  0.7587500  6.662500  18.61250     272      open       pre
## 67  4.10.2017  0.7625000  5.150000  18.35000     273      open       pre
## 69  4.19.2017  0.7762500  6.025000  17.90000     274      open       pre
## 71  4.15.2017  0.7687500  5.175000  18.50000     278      open       pre
## 73  4.15.2017  0.7687500  5.175000  18.50000     280      open       pre
## 75  4.19.2017  0.7762500  6.025000  17.90000     281      open       pre
## 77  4.15.2017  0.7687500  5.175000  18.50000     282      open       pre
## 79  4.18.2017  0.6685714  6.014286  16.25714     283      open       pre
## 81  4.20.2017  0.7987500  6.125000  17.86250     285      open       pre
## 83  4.16.2017  0.7387500  5.175000  18.75000     286      open       pre
## 85  4.10.2017  0.7625000  5.150000  18.35000     288      open       pre
## 87  4.11.2017  0.6100000  6.325000  18.57500     289      open       pre
## 89  4.18.2017  0.6685714  6.014286  16.25714     290      open       pre
## 91  4.16.2017  0.7387500  5.175000  18.75000     291      open       pre
## 93  4.12.2017  0.7587500  6.662500  18.61250     293      open       pre
## 95  4.15.2017  0.7687500  5.175000  18.50000     294      open       pre
## 97  4.15.2017  0.7687500  5.175000  18.50000     295      open       pre
## 99  4.12.2017  0.7587500  6.662500  18.61250     296      open       pre
## 101 4.18.2017  0.6685714  6.014286  16.25714     297      open       pre
## 103 4.18.2017  0.6685714  6.014286  16.25714     298      open       pre
## 105 4.13.2017  0.7600000  6.112500  18.56250     300      open       pre
## 107 4.20.2017  0.7987500  6.125000  17.86250     301      open       pre
## 109 4.20.2017  0.7987500  6.125000  17.86250     302      open       pre
##     understory.richness visits.per.hour flowers.per.hour
## 1            -0.2000000       1.0000000        1.0000000
## 3             0.0000000      -0.7575297       -0.8061906
## 5            -0.4285714      -0.5638517       -0.7133025
## 7             0.0000000      -0.4040460       -0.1713548
## 9             0.2000000      -0.3341714       -0.1437809
## 11            0.0000000       0.3970570        0.3970570
## 13           -0.2000000       1.0000000        1.0000000
## 15            0.0000000       1.0000000        1.0000000
## 17           -0.3333333      -1.0000000       -1.0000000
## 19           -0.6000000      -1.0000000       -1.0000000
## 21           -0.6000000      -0.4043977       -0.1631613
## 23            0.2000000      -1.0000000       -1.0000000
## 25            0.0000000      -1.0000000       -1.0000000
## 27           -0.2000000      -1.0000000       -1.0000000
## 29           -0.3333333      -0.6440033       -0.7476991
## 31            0.0000000      -0.4654393       -0.5130157
## 33           -0.2000000      -0.8421419       -0.8826684
## 35            0.0000000      -1.0000000       -1.0000000
## 37            0.0000000      -0.3557713       -0.3557713
## 39           -0.2000000      -0.5858139       -0.3137462
## 41           -0.2000000       1.0000000        1.0000000
## 43           -0.3333333      -1.0000000       -1.0000000
## 45            0.2000000      -0.8271642       -0.8271642
## 47            0.0000000       0.0000000        0.0000000
## 49            0.0000000      -1.0000000       -1.0000000
## 51            0.3333333      -0.4396668       -0.6251664
## 53            0.0000000      -0.7451054       -0.5478377
## 55           -0.5000000      -1.0000000       -1.0000000
## 57           -0.2000000      -0.9221091       -0.9221091
## 59            0.5000000       0.2934029        0.2934029
## 61            0.0000000      -0.3061285       -0.3061285
## 63           -0.3333333       0.2741935        0.2741935
## 65            0.0000000      -1.0000000       -1.0000000
## 67            0.0000000      -1.0000000       -1.0000000
## 69            0.0000000      -0.1217297       -0.1217297
## 71           -0.2000000      -1.0000000       -1.0000000
## 73            0.0000000      -0.5413985       -0.5413985
## 75            0.5000000       0.5861390        0.7850350
## 77            0.2000000      -1.0000000       -1.0000000
## 79            0.3333333      -1.0000000       -1.0000000
## 81            0.0000000       1.0000000        1.0000000
## 83           -0.3333333      -0.6559877       -0.5248462
## 85            0.0000000      -0.6121301       -0.5375824
## 87            0.2000000       1.0000000        1.0000000
## 89           -0.2000000       1.0000000        1.0000000
## 91            0.0000000      -1.0000000       -1.0000000
## 93           -0.3333333      -0.5878263       -0.5878263
## 95           -0.2000000      -0.6436425       -0.7202714
## 97            0.2000000       0.5426894        0.5426894
## 99            0.5000000      -1.0000000       -1.0000000
## 101          -0.2000000      -1.0000000       -1.0000000
## 103           0.2000000       1.0000000        1.0000000
## 105           0.0000000      -0.6793431       -0.6793431
## 107          -1.0000000       0.2686780        0.2686780
## 109           0.5000000      -1.0000000       -1.0000000</code></pre>
<pre class="r"><code>metadata &lt;- read.csv(&quot;Output Data/metadata_nobeetle.csv&quot;)
metadata &lt;- rename(metadata, flowering = blooming)
metadata$flowering &lt;- gsub(&quot;post&quot;, &quot;bloom&quot;, metadata$flowering)
shrubpan &lt;- filter(metadata, treatment == &quot;shrub&quot;)
shrubpan &lt;- dplyr::select(shrubpan, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, flowering, abun, percent.cover)
#split into 2 dataframes, rename the visitation columns and then rbind

shrubpan &lt;- arrange(shrubpan, plant.id)

shrubpan &lt;- filter(shrubpan, plant.id != 104 &amp; plant.id != 114 &amp; plant.id != 182 &amp; plant.id != 263 &amp; plant.id != 287 &amp; plant.id != 299 &amp; plant.id != 301 &amp; plant.id != 302 &amp; plant.id != 303 &amp; plant.id != 261)
 

rii.shrubpan &lt;- rii.b(shrubpan, c(1:7), 8:9)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment flowering
## 1   4.16.2017    0.73875    5.1750   18.7500      146     shrub       pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180     shrub       pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181     shrub       pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183     shrub       pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184     shrub       pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185     shrub       pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186     shrub       pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187     shrub       pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188     shrub       pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189     shrub       pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190     shrub       pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191     shrub       pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192     shrub       pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193     shrub       pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194     shrub       pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195     shrub       pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196     shrub       pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197     shrub       pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198     shrub       pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199     shrub       pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262     shrub       pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264     shrub       pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265     shrub       pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266     shrub       pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267     shrub       pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268     shrub       pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269     shrub       pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270     shrub       pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271     shrub       pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272     shrub       pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273     shrub       pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274     shrub       pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275     shrub       pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276     shrub       pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278     shrub       pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280     shrub       pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281     shrub       pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282     shrub       pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283     shrub       pre
## 79  4.13.2017    0.76000    6.1125   18.5625      284     shrub       pre
## 81  4.19.2017    0.77625    6.0250   17.9000      286     shrub       pre
## 83  4.11.2017    0.61000    6.3250   18.5750      288     shrub       pre
## 85  4.12.2017    0.75875    6.6625   18.6125      289     shrub       pre
## 87  4.19.2017    0.77625    6.0250   17.9000      290     shrub       pre
## 89  4.17.2017    0.57375    5.5375   18.4125      291     shrub       pre
## 91  4.13.2017    0.76000    6.1125   18.5625      293     shrub       pre
## 93  4.13.2017    0.76000    6.1125   18.5625      294     shrub       pre
## 95  4.17.2017    0.57375    5.5375   18.4125      295     shrub       pre
## 97  4.10.2017    0.76250    5.1500   18.3500      296     shrub       pre
## 99  4.19.2017    0.77625    6.0250   17.9000      297     shrub       pre
## 101 4.16.2017    0.73875    5.1750   18.7500      298     shrub       pre
## 103 4.15.2017    0.76875    5.1750   18.5000      300     shrub       pre
##            abun percent.cover
## 1    0.07692308    0.38461538
## 3   -0.17241379    0.42857143
## 5    0.61904762    0.17647059
## 7   -0.69230769   -0.75000000
## 9   -0.75000000   -0.47368421
## 11   0.00000000    0.07142857
## 13  -0.62162162   -0.60000000
## 15  -0.09090909    0.42857143
## 17   0.09090909   -0.07692308
## 19  -0.10344828    0.37500000
## 21  -0.06666667   -0.33333333
## 23  -0.75000000    0.11111111
## 25  -0.46341463    0.23809524
## 27  -0.29032258    0.17647059
## 29  -0.37500000    0.33333333
## 31  -0.37500000    0.00000000
## 33  -0.15789474    0.14285714
## 35  -0.60000000    0.20000000
## 37  -0.42857143    0.38461538
## 39  -1.00000000   -0.29411765
## 41  -0.70588235    0.06666667
## 43  -0.23809524    0.28000000
## 45  -0.33333333    0.20000000
## 47  -0.52380952    0.45454545
## 49  -0.55555556   -0.06666667
## 51  -0.10000000    0.09090909
## 53  -0.25000000   -0.46666667
## 55  -0.17647059    0.00000000
## 57  -0.57894737   -0.33333333
## 59  -0.57142857   -0.25000000
## 61  -0.30434783    0.00000000
## 63  -0.61290323   -0.23076923
## 65  -0.50000000    0.52941176
## 67  -0.07142857   -0.11111111
## 69  -1.00000000   -0.66666667
## 71  -0.37500000   -0.16666667
## 73   0.50000000    0.20000000
## 75  -0.52941176    0.00000000
## 77   0.44444444   -0.20000000
## 79   0.33333333    0.33333333
## 81  -0.11111111    0.00000000
## 83  -0.28571429   -0.11111111
## 85  -0.23809524    0.28571429
## 87  -0.69230769   -0.33333333
## 89  -0.17241379    0.06666667
## 91  -0.82608696   -0.66666667
## 93  -0.70000000   -0.42857143
## 95  -0.13043478    0.05882353
## 97  -1.00000000    0.00000000
## 99  -0.55555556   -0.16666667
## 101  0.00000000    0.00000000
## 103 -0.42857143   -0.25000000</code></pre>
<pre class="r"><code>openpan &lt;- filter(metadata, treatment ==&quot;open&quot;)
openpan &lt;- dplyr::select(openpan, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, flowering, abun, percent.cover)
openpan &lt;- arrange(openpan, plant.id)

openpan &lt;- filter(openpan, plant.id != 104 &amp; plant.id != 114 &amp; plant.id != 182 &amp; plant.id != 263 &amp; plant.id != 287 &amp; plant.id != 299 &amp; plant.id != 301 &amp; plant.id != 302 &amp; plant.id != 303 &amp; plant.id != 261)

rii.openpan &lt;- rii.b(openpan, c(1:7), 8:9)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment flowering
## 1   4.16.2017    0.73875    5.1750   18.7500      146      open       pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180      open       pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181      open       pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183      open       pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184      open       pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185      open       pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186      open       pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187      open       pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188      open       pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189      open       pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190      open       pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191      open       pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192      open       pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193      open       pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194      open       pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195      open       pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196      open       pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197      open       pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198      open       pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199      open       pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262      open       pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264      open       pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265      open       pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266      open       pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267      open       pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268      open       pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269      open       pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270      open       pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271      open       pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272      open       pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273      open       pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274      open       pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275      open       pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276      open       pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278      open       pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280      open       pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281      open       pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282      open       pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283      open       pre
## 79  4.13.2017    0.76000    6.1125   18.5625      284      open       pre
## 81  4.19.2017    0.77625    6.0250   17.9000      286      open       pre
## 83  4.11.2017    0.61000    6.3250   18.5750      288      open       pre
## 85  4.12.2017    0.75875    6.6625   18.6125      289      open       pre
## 87  4.19.2017    0.77625    6.0250   17.9000      290      open       pre
## 89  4.17.2017    0.57375    5.5375   18.4125      291      open       pre
## 91  4.13.2017    0.76000    6.1125   18.5625      293      open       pre
## 93  4.13.2017    0.76000    6.1125   18.5625      294      open       pre
## 95  4.17.2017    0.57375    5.5375   18.4125      295      open       pre
## 97  4.10.2017    0.76250    5.1500   18.3500      296      open       pre
## 99  4.19.2017    0.77625    6.0250   17.9000      297      open       pre
## 101 4.16.2017    0.73875    5.1750   18.7500      298      open       pre
## 103 4.15.2017    0.76875    5.1750   18.5000      300      open       pre
##            abun percent.cover
## 1   -0.33333333    -0.5000000
## 3   -0.60000000    -0.2500000
## 5   -0.05882353     0.0000000
## 7   -0.53846154    -0.6666667
## 9   -1.00000000    -0.8181818
## 11   0.52941176    -0.8181818
## 13   0.41176471    -0.7777778
## 15  -0.57142857    -0.3333333
## 17  -0.14285714     0.6000000
## 19  -0.16129032     0.3333333
## 21  -0.31034483    -0.2500000
## 23  -0.83333333     0.2000000
## 25  -0.61538462    -0.8750000
## 27   0.00000000     0.0000000
## 29  -0.23809524    -0.5000000
## 31  -0.50000000    -0.1111111
## 33  -0.30000000     0.0000000
## 35  -0.23809524    -0.6666667
## 37   0.26315789    -0.3333333
## 39  -0.55555556    -0.7777778
## 41  -1.00000000    -0.3333333
## 43   0.25000000    -0.6666667
## 45   0.33333333    -0.3333333
## 47  -0.42857143     0.3333333
## 49  -0.27272727    -0.3333333
## 51   0.05263158     0.3333333
## 53  -0.41176471    -0.8181818
## 55  -0.27272727     0.0000000
## 57   0.00000000    -0.3333333
## 59   0.33333333    -0.1111111
## 61  -0.20000000    -0.6666667
## 63   0.00000000    -0.6666667
## 65   1.00000000    -0.3333333
## 67  -0.14285714    -0.8181818
## 69  -0.50000000    -0.8750000
## 71   0.05882353     0.3333333
## 73  -0.14285714    -0.3333333
## 75  -0.30000000    -0.7857143
## 77   0.55555556    -0.1111111
## 79  -0.05263158     0.7777778
## 81  -0.09090909     0.0000000
## 83  -0.69230769     0.0000000
## 85  -0.26315789     0.0000000
## 87   0.00000000    -0.8181818
## 89  -0.37500000     0.3333333
## 91  -0.81818182    -0.8181818
## 93  -0.71428571    -0.3333333
## 95  -0.16666667    -0.6666667
## 97  -0.92000000     0.0000000
## 99  -1.00000000    -0.3333333
## 101  0.33333333    -0.1111111
## 103 -0.28571429     0.3333333</code></pre>
<pre class="r"><code>#arthropod richness, needs beetle dataset
yesbeetle &lt;- read.csv(&quot;Output Data/metadata_yesbeetle.csv&quot;)
yesbeetle &lt;- rename(yesbeetle, flowering = blooming)
yesbeetle$flowering &lt;- gsub(&quot;post&quot;, &quot;bloom&quot;, yesbeetle$flowering)
shrubrich &lt;- filter(yesbeetle, treatment == &quot;shrub&quot;)
shrubrich &lt;- dplyr::select(shrubrich, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, flowering, Species)
#split into 2 dataframes, rename the visitation columns and then rbind

shrubrich&lt;- arrange(shrubrich, plant.id)

shrubrich &lt;- filter(shrubrich, plant.id != 104 &amp; plant.id != 114 &amp; plant.id != 182 &amp; plant.id != 263 &amp; plant.id != 287 &amp; plant.id != 299 &amp; plant.id != 301 &amp; plant.id != 302 &amp; plant.id != 303 &amp; plant.id != 261)
 

rii.shrubrich &lt;- rii.b(shrubrich, c(1:7), 8)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment flowering
## 1   4.16.2017    0.73875    5.1750   18.7500      146     shrub       pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180     shrub       pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181     shrub       pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183     shrub       pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184     shrub       pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185     shrub       pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186     shrub       pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187     shrub       pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188     shrub       pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189     shrub       pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190     shrub       pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191     shrub       pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192     shrub       pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193     shrub       pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194     shrub       pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195     shrub       pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196     shrub       pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197     shrub       pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198     shrub       pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199     shrub       pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262     shrub       pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264     shrub       pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265     shrub       pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266     shrub       pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267     shrub       pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268     shrub       pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269     shrub       pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270     shrub       pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271     shrub       pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272     shrub       pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273     shrub       pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274     shrub       pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275     shrub       pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276     shrub       pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278     shrub       pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280     shrub       pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281     shrub       pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282     shrub       pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283     shrub       pre
## 79  4.13.2017    0.76000    6.1125   18.5625      284     shrub       pre
## 81  4.19.2017    0.77625    6.0250   17.9000      286     shrub       pre
## 83  4.11.2017    0.61000    6.3250   18.5750      288     shrub       pre
## 85  4.12.2017    0.75875    6.6625   18.6125      289     shrub       pre
## 87  4.19.2017    0.77625    6.0250   17.9000      290     shrub       pre
## 89  4.17.2017    0.57375    5.5375   18.4125      291     shrub       pre
## 91  4.13.2017    0.76000    6.1125   18.5625      293     shrub       pre
## 93  4.13.2017    0.76000    6.1125   18.5625      294     shrub       pre
## 95  4.17.2017    0.57375    5.5375   18.4125      295     shrub       pre
## 97  4.10.2017    0.76250    5.1500   18.3500      296     shrub       pre
## 99  4.19.2017    0.77625    6.0250   17.9000      297     shrub       pre
## 101 4.16.2017    0.73875    5.1750   18.7500      298     shrub       pre
## 103 4.15.2017    0.76875    5.1750   18.5000      300     shrub       pre
##         Species
## 1    0.07692308
## 3    0.04761905
## 5    0.20000000
## 7   -0.40000000
## 9   -0.33333333
## 11   0.07692308
## 13  -0.12500000
## 15   0.23076923
## 17  -0.50000000
## 19   0.18181818
## 21   0.04347826
## 23  -0.53846154
## 25  -0.20000000
## 27  -0.04761905
## 29  -0.33333333
## 31  -0.23076923
## 33   0.07692308
## 35  -0.45454545
## 37  -0.22222222
## 39  -0.80000000
## 41  -0.57142857
## 43   0.12500000
## 45  -0.06666667
## 47  -0.25000000
## 49  -0.42857143
## 51  -0.05263158
## 53  -0.08333333
## 55  -0.06666667
## 57  -0.38461538
## 59  -0.33333333
## 61  -0.10000000
## 63  -0.45454545
## 65  -0.29411765
## 67   0.10000000
## 69  -0.86666667
## 71  -0.08333333
## 73   0.50000000
## 75  -0.27272727
## 77   0.42857143
## 79   0.25000000
## 81  -0.14285714
## 83  -0.11111111
## 85  -0.22222222
## 87  -0.66666667
## 89   0.05882353
## 91  -0.53846154
## 93  -0.38461538
## 95  -0.06666667
## 97  -0.84615385
## 99  -0.50000000
## 101 -0.06666667
## 103 -0.38461538</code></pre>
<pre class="r"><code>openrich &lt;- filter(yesbeetle, treatment ==&quot;open&quot;)
openrich &lt;- dplyr::select(openrich, date, mean.Solar, mean.Wind, mean.Temp, plant.id, treatment, flowering, Species)
openrich &lt;- arrange(openrich, plant.id)

openrich &lt;- filter(openrich, plant.id != 104 &amp; plant.id != 114 &amp; plant.id != 182 &amp; plant.id != 263 &amp; plant.id != 287 &amp; plant.id != 299 &amp; plant.id != 301 &amp; plant.id != 302 &amp; plant.id != 303 &amp; plant.id != 261)

rii.openrich &lt;- rii.b(openrich, c(1:7), 8)</code></pre>
<pre><code>##          date mean.Solar mean.Wind mean.Temp plant.id treatment flowering
## 1   4.16.2017    0.73875    5.1750   18.7500      146      open       pre
## 3   4.12.2017    0.75875    6.6625   18.6125      180      open       pre
## 5   4.20.2017    0.79875    6.1250   17.8625      181      open       pre
## 7   4.20.2017    0.79875    6.1250   17.8625      183      open       pre
## 9   4.10.2017    0.76250    5.1500   18.3500      184      open       pre
## 11  4.20.2017    0.79875    6.1250   17.8625      185      open       pre
## 13  4.15.2017    0.76875    5.1750   18.5000      186      open       pre
## 15  4.11.2017    0.61000    6.3250   18.5750      187      open       pre
## 17  4.16.2017    0.73875    5.1750   18.7500      188      open       pre
## 19  4.10.2017    0.76250    5.1500   18.3500      189      open       pre
## 21  4.13.2017    0.76000    6.1125   18.5625      190      open       pre
## 23  4.12.2017    0.75875    6.6625   18.6125      191      open       pre
## 25  4.10.2017    0.76250    5.1500   18.3500      192      open       pre
## 27  4.11.2017    0.61000    6.3250   18.5750      193      open       pre
## 29  4.10.2017    0.76250    5.1500   18.3500      194      open       pre
## 31  4.16.2017    0.73875    5.1750   18.7500      195      open       pre
## 33  4.12.2017    0.75875    6.6625   18.6125      196      open       pre
## 35  4.11.2017    0.61000    6.3250   18.5750      197      open       pre
## 37  4.12.2017    0.75875    6.6625   18.6125      198      open       pre
## 39  4.15.2017    0.76875    5.1750   18.5000      199      open       pre
## 41  4.15.2017    0.76875    5.1750   18.5000      262      open       pre
## 43  4.19.2017    0.77625    6.0250   17.9000      264      open       pre
## 45  4.12.2017    0.75875    6.6625   18.6125      265      open       pre
## 47  4.11.2017    0.61000    6.3250   18.5750      266      open       pre
## 49  4.13.2017    0.76000    6.1125   18.5625      267      open       pre
## 51  4.16.2017    0.73875    5.1750   18.7500      268      open       pre
## 53  4.15.2017    0.76875    5.1750   18.5000      269      open       pre
## 55  4.19.2017    0.77625    6.0250   17.9000      270      open       pre
## 57  4.16.2017    0.73875    5.1750   18.7500      271      open       pre
## 59  4.13.2017    0.76000    6.1125   18.5625      272      open       pre
## 61  4.11.2017    0.61000    6.3250   18.5750      273      open       pre
## 63  4.20.2017    0.79875    6.1250   17.8625      274      open       pre
## 65  4.10.2017    0.76250    5.1500   18.3500      275      open       pre
## 67  4.15.2017    0.76875    5.1750   18.5000      276      open       pre
## 69  4.17.2017    0.57375    5.5375   18.4125      278      open       pre
## 71  4.17.2017    0.57375    5.5375   18.4125      280      open       pre
## 73  4.20.2017    0.79875    6.1250   17.8625      281      open       pre
## 75  4.17.2017    0.57375    5.5375   18.4125      282      open       pre
## 77  4.19.2017    0.77625    6.0250   17.9000      283      open       pre
## 79  4.13.2017    0.76000    6.1125   18.5625      284      open       pre
## 81  4.19.2017    0.77625    6.0250   17.9000      286      open       pre
## 83  4.11.2017    0.61000    6.3250   18.5750      288      open       pre
## 85  4.12.2017    0.75875    6.6625   18.6125      289      open       pre
## 87  4.19.2017    0.77625    6.0250   17.9000      290      open       pre
## 89  4.17.2017    0.57375    5.5375   18.4125      291      open       pre
## 91  4.13.2017    0.76000    6.1125   18.5625      293      open       pre
## 93  4.13.2017    0.76000    6.1125   18.5625      294      open       pre
## 95  4.17.2017    0.57375    5.5375   18.4125      295      open       pre
## 97  4.10.2017    0.76250    5.1500   18.3500      296      open       pre
## 99  4.19.2017    0.77625    6.0250   17.9000      297      open       pre
## 101 4.16.2017    0.73875    5.1750   18.7500      298      open       pre
## 103 4.15.2017    0.76875    5.1750   18.5000      300      open       pre
##         Species
## 1   -0.11111111
## 3   -0.29411765
## 5   -0.17647059
## 7   -0.42857143
## 9   -0.71428571
## 11   0.44444444
## 13   0.27272727
## 15  -0.33333333
## 17  -0.14285714
## 19  -0.27272727
## 21  -0.10000000
## 23  -0.66666667
## 25  -0.23076923
## 27   0.22222222
## 29  -0.07692308
## 31  -0.38461538
## 33  -0.11111111
## 35  -0.07692308
## 37   0.06666667
## 39  -0.20000000
## 41  -0.71428571
## 43   0.28571429
## 45   0.14285714
## 47  -0.17647059
## 49  -0.09090909
## 51   0.00000000
## 53  -0.33333333
## 55  -0.16666667
## 57   0.00000000
## 59   0.23076923
## 61   0.00000000
## 63   0.05263158
## 65   1.00000000
## 67   0.06666667
## 69  -0.20000000
## 71   0.00000000
## 73  -0.25000000
## 75   0.00000000
## 77   0.33333333
## 79   0.06666667
## 81  -0.16666667
## 83  -0.66666667
## 85  -0.14285714
## 87   0.09090909
## 89  -0.33333333
## 91  -0.42857143
## 93  -0.66666667
## 95  -0.09090909
## 97  -0.73333333
## 99  -1.00000000
## 101  0.20000000
## 103 -0.20000000</code></pre>
<pre class="r"><code>#floral visitation
#shrubs
flowers.shrub.rii &lt;- boot(rii.shrub.visits$flowers.per.hour, bootmean, R=10000, stype =&quot;i&quot;)
ci.flowers.shrub &lt;- boot.ci(flowers.shrub.rii)
normal.flowers.shrub &lt;- ci.flowers.shrub$normal

#open
flowers.open.rii &lt;- boot(rii.open.visits$flowers.per.hour, bootmean, R=10000, stype =&quot;i&quot;)
ci.flowers.open &lt;- boot.ci(flowers.open.rii)
normal.flowers.open &lt;- ci.flowers.open$normal


#annual understory richness

understory.richness.shrub.rii &lt;- boot(rii.shrub.visits$understory.richness, bootmean, R=10000, stype =&quot;i&quot;)
ci.understory.richness.shrub &lt;- boot.ci(understory.richness.shrub.rii)
normal.understory.richness.shrub &lt;- ci.understory.richness.shrub$normal

#open
understory.richness.open.rii &lt;- boot(rii.open.visits$understory.richness, bootmean, R=10000, stype =&quot;i&quot;)
ci.understory.richness.open &lt;- boot.ci(understory.richness.open.rii)
normal.understory.richness.open &lt;- ci.understory.richness.open$normal


#annual percent cover
percent.shrub.rii &lt;- boot(rii.shrubpan$percent.cover, bootmean, R=10000, stype =&quot;i&quot;)
ci.percent.shrub &lt;- boot.ci(percent.shrub.rii)
normal.percent.shrub &lt;- ci.percent.shrub$normal

#open
percent.open.rii &lt;- boot(rii.openpan$percent.cover, bootmean, R=10000, stype =&quot;i&quot;)
ci.percent.open &lt;- boot.ci(percent.open.rii)
normal.percent.open &lt;- ci.percent.open$normal


#arthropd abundance
abun.shrub.rii &lt;- boot(rii.shrubpan$abun, bootmean, R=10000, stype =&quot;i&quot;)
ci.abun.shrub &lt;- boot.ci(abun.shrub.rii)
normal.abun.shrub &lt;- ci.abun.shrub$normal

#open
abun.open.rii &lt;- boot(rii.openpan$abun, bootmean, R=10000, stype =&quot;i&quot;)
ci.abun.open &lt;- boot.ci(abun.open.rii)
normal.abun.open &lt;- ci.abun.open$normal



#arthropod richness
Species.shrub.rii &lt;- boot(rii.shrubrich$Species, bootmean, R=10000, stype =&quot;i&quot;)
ci.Species.shrub &lt;- boot.ci(Species.shrub.rii)
normal.Species.shrub &lt;- ci.Species.shrub$normal

Species.open.rii &lt;- boot(rii.openrich$Species, bootmean, R=10000, stype =&quot;i&quot;)
ci.Species.open &lt;- boot.ci(Species.open.rii)
normal.Species.open &lt;- ci.Species.open$normal</code></pre>
<pre class="r"><code>means.all &lt;- rbind(flowers.rii$t0, percent.cover.rii$t0, richness.rii$t0, abun.rii$t0, arth.rich.rii$t0, flowers.shrub.rii$t0, flowers.open.rii$t0, percent.shrub.rii$t0, percent.open.rii$t0, understory.richness.shrub.rii$t0, understory.richness.open.rii$t0, abun.shrub.rii$t0, abun.open.rii$t0, Species.shrub.rii$t0, Species.open.rii$t0)


colnames(means.all) &lt;- c(&quot;means&quot;)

ci.all &lt;- rbind(normal.flowers, normal.percent.cover, normal.richness, normal.abun, normal.arth.rich, normal.flowers.shrub, normal.flowers.open, normal.percent.shrub, normal.percent.open, normal.understory.richness.shrub, normal.understory.richness.open, normal.abun.shrub, normal.abun.open, normal.Species.shrub, normal.Species.open)


all.new &lt;- cbind(means.all, ci.all)
all.new &lt;- as.data.frame(all.new)

all.new$id &lt;- c(&quot;microsite&quot;, &quot;microsite&quot;, &quot;microsite&quot;, &quot;microsite&quot;, &quot;microsite&quot;, &quot;shrub&quot;, &quot;open&quot;, &quot;shrub&quot;, &quot;open&quot;,&quot;shrub&quot;, &quot;open&quot;,&quot;shrub&quot;, &quot;open&quot;,&quot;shrub&quot;, &quot;open&quot;)
                
all.new$metric &lt;- c(&quot;visits&quot;, &quot;percent.cover&quot;, &quot;annual.richness&quot;, &quot;arth.abundance&quot; , &quot;arth.richness&quot;, &quot;visits&quot;, &quot;visits&quot;, &quot;percent.cover&quot;, &quot;percent.cover&quot;, &quot;annual.richness&quot;, &quot;annual.richness&quot;, &quot;arth.abundance&quot;, &quot;arth.abundance&quot;, &quot;arth.richness&quot;, &quot;arth.richness&quot;)


all.new$metric &lt;- as.factor(all.new$metric)
all.new$id &lt;- as.factor(all.new$id)


all.new$metric &lt;- factor(all.new$metric, levels = c(&quot;arth.richness&quot;, &quot;arth.abundance&quot;, &quot;annual.richness&quot;, &quot;percent.cover&quot;, &quot;visits&quot;))
                         

metrics &lt;- rev(c(&quot;Pollinator floral \n visitation per hour&quot;, &quot;Annual \n Percent Cover&quot;, &quot;Annual Species \n Richness&quot;, &quot;Arthropod \n Abundance&quot;, &quot;Arthropod \n Richness&quot;))

#write.csv(all.boot, &quot;Output Data/allboot.csv&quot;)
#write.csv(all.new, &quot;Output Data/allnewboot.csv&quot;)


ggplot(all.new, aes(x=metric, y=means)) + geom_errorbar(aes(ymin=V3, ymax=V4, fill = id), width=.1, position= position_dodge(width = 0.5))+ geom_line(aes(fill = id),position=position_dodge(width=0.5)) + geom_point(aes(fill = id), position=position_dodge(width=0.5), colour=&quot;black&quot;,pch=21, size=5) + ylim(1, -1) + theme(axis.text.x=element_text(angle=90, vjust=.5)) + ylab(&quot;RII&quot;) + xlab(&quot;&quot;) + geom_hline(aes(yintercept=0)) + theme_Publication() + coord_flip() + scale_x_discrete(limits=levels(all.new$metric), labels = metrics)+ scale_fill_manual(&quot;&quot;,values = c(&quot;black&quot;, &quot;lightgray&quot;, &quot;white&quot;), labels = c(&quot;Microsite: \n Shrub vs. Open&quot;, &quot;Bloom period: \n Open&quot;, &quot;Bloom period: \n Shrub&quot;))  </code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## geom_path: Each group consists of only one observation. Do you need to adjust
## the group aesthetic?</code></pre>
<p><img src="index_files/figure-html/RII%20figures-1.png" width="672" /></p>
<pre class="r"><code>#theme(legend.position = c(0.8, 0.1))  + ylab(&quot;RII Microsite&quot;) + theme(axis.title.x = element_text(size =11)) + guides(fill = guide_legend(nrow = 2, byrow = TRUE)) </code></pre>
<pre class="r"><code>sizes &lt;- read.csv(&quot;Clean Data/video_larreadimensions.csv&quot;)
sizes$PlantID &lt;- sizes$plant.id
mean(sizes$width)</code></pre>
<pre><code>## [1] NA</code></pre>
<pre class="r"><code>h &lt;- left_join(byrep, sizes, by = &quot;PlantID&quot;)</code></pre>
<pre><code>## Warning: Column `PlantID` joining factors with different levels, coercing to
## character vector</code></pre>
<pre class="r"><code>h &lt;- filter(h, treatment == &quot;shrub&quot; &amp; flowering == &quot;pre&quot;)
mean(h$width, na.rm = TRUE)</code></pre>
<pre><code>## [1] 342.5965</code></pre>
<pre class="r"><code>sd(h$width, na.rm = TRUE)</code></pre>
<pre><code>## [1] 103.9497</code></pre>
<pre class="r"><code>mean(h$height, na.rm = TRUE)</code></pre>
<pre><code>## [1] 211.7895</code></pre>
<pre class="r"><code>sd(h$height, na.rm = TRUE)</code></pre>
<pre><code>## [1] 46.2388</code></pre>
<div id="figures" class="section level2">
<h2>Figures</h2>
<pre class="r"><code>data &lt;- read.csv(&quot;Output Data/rtu_by_rep.csv&quot;)
summary &lt;- data %&gt;% group_by(rtu, treatment, flowering) %&gt;% summarise(mean.visits = mean(visits.per.hour), se.visits = se(visits.per.hour), mean.flowers = mean(flowers.per.hour), se.flowers = se(flowers.per.hour))

summary$t &lt;- paste(summary$treatment, summary$flowering)
summary$t &lt;- as.factor(summary$t)
summary$t &lt;- factor(summary$t, levels = c(&quot;shrub pre&quot;, &quot;open pre&quot;, &quot;shrub bloom&quot;, &quot;open bloom&quot;))

summary$flowering &lt;- relevel(summary$flowering, &quot;pre&quot;)
labels &lt;- c(pre = &quot;Pre-blooming&quot;, post = &quot;Blooming&quot;, bloom = &quot;Blooming&quot;)


ggplot(summary, aes(rtu, mean.visits, group = t)) + geom_bar(aes (fill = t), stat = &quot;identity&quot;, position = &quot;dodge&quot;, color = &quot;black&quot;) + geom_errorbar(aes(ymin = mean.visits - se.visits, ymax = mean.visits + se.visits), width = 0.2, position = position_dodge(0.9)) + theme_Publication()  + ylab(&quot;Mean foraging bouts/hr &quot;) + scale_x_discrete(labels = c(&quot;Solitary Bee&quot;, &quot;Bombyliidae&quot;, &quot;Honeybee&quot;, &quot;Lepidoptera&quot;, &quot;Other&quot;, &quot;Syrphidae&quot;)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.2), axis.title.y = element_text(size = 12)) + scale_fill_manual(&quot;&quot;, values = c(&quot;shrub pre&quot; =&quot;black&quot;, &quot;open pre&quot;= &quot;white&quot;, &quot;shrub bloom&quot;= &quot;black&quot;, &quot;open bloom&quot;= &quot;white&quot;)) + theme(legend.position = &quot;none&quot;, legend.title = element_blank(),axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank()) + xlab(&quot;&quot;) + facet_grid(~flowering, labeller=labeller(flowering = labels)) </code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>ggplot(summary, aes(rtu, mean.flowers, group = t)) + geom_bar(aes (fill = t), stat = &quot;identity&quot;, position = &quot;dodge&quot;, color = &quot;black&quot;) + geom_errorbar(aes(ymin = mean.flowers - se.flowers, ymax = mean.flowers + se.flowers), width = 0.2, position = position_dodge(0.9)) + theme_Publication() + ylab(&quot;Mean flowers visited/hr&quot;) + scale_x_discrete(labels = c(&quot;Solitary bees&quot;, &quot;Bee flies&quot;, &quot;Honeybees&quot;, &quot;Butterflies and \n sphinx moths&quot;, &quot;Other&quot;, &quot;Hoverflies&quot;)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1), axis.title.y = element_text(size = 12)) + scale_fill_manual(&quot;&quot;, values = c(&quot;shrub pre&quot; =&quot;black&quot;, &quot;open pre&quot;= &quot;white&quot;, &quot;shrub bloom&quot;= &quot;black&quot;, &quot;open bloom&quot;= &quot;white&quot;)) + xlab(&quot;&quot;) + facet_grid(~flowering) + theme(strip.background = element_blank(), strip.text = element_blank()) + theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<pre class="r"><code>#figure2
data &lt;- read.csv(&quot;Output Data/rtu_by_rep.csv&quot;)
summary2 &lt;- byrep %&gt;% group_by(treatment, flowering) %&gt;% summarise(mean.visits = mean(visits.per.hour), se.visits = se(visits.per.hour), mean.flowers = mean(flowers.per.hour), se.flowers = se(flowers.per.hour))


summary2$t &lt;- paste(summary2$treatment, summary2$flowering)

summary2$t &lt;- as.factor(summary2$t)

summary2$t &lt;- factor(summary2$t, levels = c(&quot;shrub pre&quot;, &quot;open pre&quot;, &quot;shrub bloom&quot;, &quot;open bloom&quot;))

summary2$flowering &lt;- relevel(summary2$flowering, &quot;pre&quot;)
summary2$treatment &lt;- relevel(summary2$treatment, &quot;shrub&quot;)
labels &lt;- c(pre = &quot;Pre-blooming&quot;, post = &quot;Full Bloom&quot;, bloom = &quot;Full Bloom&quot;)


ggplot(summary2, aes(treatment, mean.visits)) + geom_bar(aes (fill = treatment), stat = &quot;identity&quot;, position = &quot;dodge&quot;, color = &quot;black&quot;) + geom_errorbar(aes(ymin = mean.visits - se.visits, ymax = mean.visits + se.visits), width = 0.2, position = position_dodge(0.9)) + theme_Publication()  + ylab(&quot;Mean foraging bouts/hr &quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1), axis.title.y = element_text(size = 12)) + scale_fill_manual(&quot;&quot;, values = c(&quot;shrub&quot; =&quot;black&quot;, &quot;open&quot;= &quot;white&quot;)) + theme(legend.position = &quot;none&quot;, legend.title = element_blank(),axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank()) + xlab(&quot;&quot;) + facet_grid(~flowering, labeller=labeller(flowering = labels))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-3-3.png" width="672" /></p>
<pre class="r"><code>ggplot(summary2, aes(treatment, mean.flowers)) + geom_bar(aes (fill = treatment), stat = &quot;identity&quot;, position = &quot;dodge&quot;, color = &quot;black&quot;) + geom_errorbar(aes(ymin = mean.flowers - se.flowers, ymax = mean.flowers + se.flowers), width = 0.2, position = position_dodge(0.9)) + theme_Publication()  + ylab(&quot;Mean flowers visited/hr &quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1), axis.title.y = element_text(size = 12)) + scale_fill_manual(&quot;&quot;, values = c(&quot;shrub&quot; =&quot;black&quot;, &quot;open&quot;= &quot;white&quot;)) + theme(legend.position = &quot;none&quot;, legend.title = element_blank(),axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank()) + xlab(&quot;&quot;) + facet_grid(~flowering)  + theme(strip.background = element_blank(), strip.text = element_blank()) + theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-3-4.png" width="672" /></p>
<pre class="r"><code>se &lt;- function(x) sd(x, na.rm = T)/sqrt(length(x)) ## SE

summary3 &lt;- rtu.data %&gt;% group_by(microsite, flowering) %&gt;% summarise(mean.duration = mean(dec.total.time, na.rm = T), se.duration = se(dec.total.time))

summary3$microsite &lt;- relevel(summary3$microsite, &quot;shrub&quot;)

summary3$t &lt;- paste(summary3$microsite, summary3$flowering)


summary3$t &lt;- as.factor(summary3$t)
summary3$t &lt;- factor(summary3$t, levels = c(&quot;shrub pre&quot;, &quot;open pre&quot;, &quot;shrub bloom&quot;, &quot;open bloom&quot;))


ggplot(summary3, aes(microsite, mean.duration*60)) + geom_bar(aes (fill = microsite), stat = &quot;identity&quot;, position = &quot;dodge&quot;, color = &quot;black&quot;) + geom_errorbar(aes(ymin = mean.duration*60 - se.duration*60, ymax = mean.duration*60 + se.duration*60), width = 0.2, position = position_dodge(0.9)) + theme_Publication()  + ylab(&quot;Mean visit duration (min)&quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1), axis.title.y = element_text(size = 12)) + scale_fill_manual(&quot;&quot;, values = c(&quot;shrub&quot; =&quot;black&quot;, &quot;open&quot;= &quot;white&quot;)) + theme(axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank()) + xlab(&quot;&quot;) + facet_grid(~flowering)  + theme(strip.background = element_blank(), strip.text = element_blank())</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-3-5.png" width="672" /></p>
<pre class="r"><code>visits &lt;- read.csv(&quot;Output Data/byrep_cleaned.csv&quot;)
metadata &lt;- read.csv(&quot;Output Data/metadata_nobeetle.csv&quot;)
nobeetle &lt;- read.csv(&quot;Output Data/metadata_nobeetle.csv&quot;)
incbeetle &lt;- read.csv(&quot;Output Data/metadata_yesbeetle.csv&quot;)
onlybeetle &lt;- read.csv(&quot;Output Data/metadata_onlybeetle.csv&quot;)

labels &lt;- c(pre = &quot;Pre-blooming&quot;, post = &quot;Full bloom&quot;, bloom = &quot;Blooming&quot;)
visits$flowering &lt;- relevel(visits$flowering, &quot;pre&quot;)
metadata$blooming &lt;- relevel(metadata$blooming, &quot;pre&quot;)
metadata$treatment &lt;- relevel(metadata$treatment, &quot;shrub&quot;)
visits$treatment &lt;- relevel(visits$treatment, &quot;shrub&quot;)
incbeetle$treatment &lt;- relevel(incbeetle$treatment, &quot;shrub&quot;)
incbeetle$blooming &lt;- relevel(incbeetle$blooming, &quot;pre&quot;)
onlybeetle$blooming &lt;- relevel(onlybeetle$blooming, &quot;pre&quot;)
byrtu$flowering &lt;- relevel(byrtu$flowering, &quot;pre&quot;)

a &lt;- ggplot(metadata, aes(treatment, percent.cover)) + 
  stat_boxplot(geom =&#39;errorbar&#39;, width = 0.2) + geom_boxplot(aes(fill = treatment)) + theme_Publication() + ggtitle(&quot;Percent Annual Cover&quot;) + ylab(&quot;&quot;) + xlab(&quot;&quot;) + facet_grid(~blooming,labeller=labeller(blooming = labels))  +theme(plot.title = element_text(size = (10)))+ facet_grid(~blooming,labeller=labeller(blooming = labels)) + scale_fill_manual(&quot;&quot;, values = c(&quot;shrub&quot; =&quot;black&quot;, &quot;open&quot;= &quot;white&quot;)) + theme(legend.position = &quot;none&quot;) + stat_summary(fun=mean, colour=&quot;red&quot;, geom=&quot;point&quot;, shape=18, size=3,show.legend = FALSE) + theme(plot.margin=unit(c(1,0.1,0,1), &quot;cm&quot;), axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank())</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre class="r"><code>a</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>b &lt;- ggplot(visits, aes(treatment, understory.richness)) + 
  stat_boxplot(geom =&#39;errorbar&#39;, width = 0.2) + geom_boxplot(aes(fill = treatment)) + theme_Publication() + ggtitle(&quot;Annual Richness&quot;) + ylab(&quot;&quot;) + xlab(&quot;&quot;)  +theme(plot.title = element_text(size = (10)))+ facet_grid(~flowering,labeller=labeller(flowering = labels)) + scale_fill_manual(&quot;&quot;, values = c(&quot;shrub&quot; =&quot;black&quot;, &quot;open&quot;= &quot;white&quot;)) + theme(legend.position = &quot;none&quot;) + stat_summary(fun.y=mean, colour=&quot;red&quot;, geom=&quot;point&quot;, shape=18, size=3,show_guide = FALSE) + theme(plot.margin=unit(c(1,1,0,0.1), &quot;cm&quot;),axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank())</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: `fun.y` is deprecated. Use `fun` instead.</code></pre>
<pre><code>## Warning: `show_guide` has been deprecated. Please use `show.legend` instead.</code></pre>
<pre class="r"><code>c &lt;- ggplot(metadata, aes(treatment, abun)) + 
  stat_boxplot(geom =&#39;errorbar&#39;, width = 0.2) + geom_boxplot(aes(fill = treatment)) + theme_Publication() + ggtitle(&quot;Arthropod Abundance&quot;) + ylab(&quot;&quot;) + xlab(&quot;&quot;) + facet_grid(~blooming,labeller=labeller(blooming = labels))  +theme(plot.title = element_text(size = (10)))+ facet_grid(~blooming,labeller=labeller(blooming = labels)) + scale_fill_manual(&quot;&quot;, values = c(&quot;shrub&quot; =&quot;black&quot;, &quot;open&quot;= &quot;white&quot;)) + theme(legend.position = &quot;none&quot;) + stat_summary(fun.y=mean, colour=&quot;red&quot;, geom=&quot;point&quot;, shape=18, size=3,show_guide = FALSE) + theme(strip.background = element_blank(), strip.text = element_blank()) + theme(plot.margin=unit(c(0.1,0.1,1,1), &quot;cm&quot;),axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank())</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: `fun.y` is deprecated. Use `fun` instead.</code></pre>
<pre><code>## Warning: `show_guide` has been deprecated. Please use `show.legend` instead.</code></pre>
<pre class="r"><code>d &lt;- ggplot(incbeetle, aes(treatment, Species)) + 
  stat_boxplot(geom =&#39;errorbar&#39;, width = 0.2) + geom_boxplot(aes(fill = treatment)) + theme_Publication() + ggtitle(&quot;Arthropod Richness&quot;) + ylab(&quot;&quot;) + xlab(&quot;&quot;) + facet_grid(~blooming,labeller=labeller(blooming = labels))  +theme(plot.title = element_text(size = (10)))+ facet_grid(~blooming,labeller=labeller(blooming = labels)) + scale_fill_manual(&quot;&quot;, values = c(&quot;shrub&quot; =&quot;black&quot;, &quot;open&quot;= &quot;white&quot;)) + theme(legend.position = &quot;none&quot;) + stat_summary(fun.y=mean, colour=&quot;red&quot;, geom=&quot;point&quot;, shape=18, size=3,show_guide = FALSE) + theme(strip.background = element_blank(), strip.text = element_blank()) + theme(plot.margin=unit(c(0.1,1,1,0), &quot;cm&quot;),axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank())</code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre><code>## Warning: `fun.y` is deprecated. Use `fun` instead.</code></pre>
<pre><code>## Warning: `show_guide` has been deprecated. Please use `show.legend` instead.</code></pre>
<pre class="r"><code>library(cowplot)

cowplot::plot_grid(a,b,c,d)</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_summary).</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
